<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Confluent Cloud for Apache Flink - Exploring the API</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2025/03/25/confluent-cloud-for-apache-flink-exploring-the-api/">
		
		<script src="/js/copy-code.js"></script>
		
		
		
		

		
		<meta property="og:title" content="Confluent Cloud for Apache Flink - Exploring the API" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2025/03/h_IMG_1456.webp" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2025/03/25/confluent-cloud-for-apache-flink-exploring-the-api/" />
		<meta property="og:site_name" content="Confluent Cloud for Apache Flink - Exploring the API" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		
		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only' 
                })
		</script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/images/2025/03/h_IMG_1456.webp'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://bsky.app/profile/rmoff.net"><i class="fa-brands fa-bluesky"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://data-folks.masto.host/@rmoff"><i class="fab fa-mastodon"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Confluent Cloud for Apache Flink - Exploring the API</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2025-03-25T15:26:13Z">Mar 25, 2025</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/apache-flink" class="no-underline category near-white dim">Apache Flink</a>, <a href="https://rmoff.net/categories/confluent-cloud" class="no-underline category near-white dim">Confluent Cloud</a>, <a href="https://rmoff.net/categories/api" class="no-underline category near-white dim">API</a>
								<span class="display-print">at https://rmoff.net/2025/03/25/confluent-cloud-for-apache-flink-exploring-the-api/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="https://bsky.app/profile/rmoff.net" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw8">
	<div class="paragraph">
<p><a href="https://www.confluent.io/en-gb/blog/serverless-flink-confluent-cloud-generally-available/">Confluent Cloud for Apache Flink</a> gives you access to run Flink workloads using a serverless platform on Confluent Cloud.
After <a href="https://rmoff.net/2025/03/13/creating-an-http-source-connector-on-confluent-cloud-from-the-cli/">poking around the Confluent Cloud API for configuring connectors</a> I wanted to take a look at the same for Flink.</p>
</div>
<div class="paragraph">
<p>Using the API is useful particularly if you want to script a deployment, or automate a bulk operation that might be tiresome to do otherwise.
It‚Äôs also handy if you just prefer living in the CLI :)</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As well as the Confluent Cloud API, there is the <a href="https://docs.confluent.io/confluent-cli/current/overview.html">Confluent CLI</a> too with nice things like a <a href="https://docs.confluent.io/confluent-cli/current/command-reference/flink/confluent_flink_shell.html">Flink shell</a> built in.
</td>
</tr>
</tbody></table>
</div>
<div class="sect1">
<h2 id="_understanding_the_deployment_model_within_confluent_cloud">Understanding the deployment model within Confluent Cloud&nbsp;<a class="headline-hash" href="#_understanding_the_deployment_model_within_confluent_cloud">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can hack away at the API blindly, hopping between HTTP error codes and the API docs, until you succeed.
I did this to start with, and I don‚Äôt recommend it.
Spending a bit of time understanding the basic model of components makes things much easier in the long run.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/03/cc-flink-01.svg" alt="cc flink 01"/>
</div>
</div>
<div class="paragraph">
<p>One key thing to understand is that <a href="https://docs.confluent.io/cloud/current/flink/overview.html#ccloud-flink-overview-metadata-mapping">Flink on Confluent Cloud models Kafka topics as Flink tables</a>.
Not only that, but the Confluent Cloud Environment is represented in Flink SQL as a catalog, and each Confluent Cloud Kafka cluster in Flink SQL as a database.</p>
</div>
<div class="paragraph">
<p>When it comes to running Flink SQL, each <em>statement</em> runs within a <a href="https://docs.confluent.io/cloud/current/flink/concepts/compute-pools.html"><em>compute pool</em></a>.
One compute pool can run many statements.
Each environment can have many compute pools, as can each cloud provider and region within the environment.
You might create multiple compute pools for the purpose of workload isolation, or cost management.</p>
</div>
<div class="paragraph">
<p>If you want to work with Flink SQL interactively through Confluent Cloud‚Äôs web interface you‚Äôll need a <em>workspace</em>.
Each compute pool has one or more workspaces.
You don‚Äôt have to have a workspace if you‚Äôre only submitting Flink SQL through the API or CLI.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authentication">Authentication&nbsp;<a class="headline-hash" href="#_authentication">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use the Confluent Cloud API you need an API key.
More accurately, you probably need several API keys :)
API keys are <a href="https://docs.confluent.io/cloud/current/security/authenticate/workload-identities/service-accounts/api-keys/overview.html#resource-scopes">scoped to a particular resource</a>; there is no such thing as <a href="https://xkcd.com/149/"><code>sudo make me a sandwich</code></a> on Confluent Cloud.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/03/cc-flink-02.svg" alt="cc flink 02"/>
</div>
</div>
<div class="paragraph">
<p>To work with Flink you need an API key for the environment/cloud provider/region.
Note that this is at a different granularity than a Kafka cluster, for which the API key is per-cluster.
You‚Äôll also want a <code>cloud</code> API key for working with compute pools and API keys themselves.</p>
</div>
<div class="paragraph">
<p>To create an API key you can use the <a href="https://docs.confluent.io/confluent-cli/current/command-reference/api-key/confluent_api-key_create.html">Confluent CLI</a>, the web UI, or <a href="https://docs.confluent.io/cloud/current/api.html#tag/API-Keys-(iamv2)/operation/createIamV2ApiKey">the API itself</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lets_get_started">üü¢ Let‚Äôs get started! üèÅ&nbsp;<a class="headline-hash" href="#_lets_get_started">üîó</a> </h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In this article I‚Äôm using <a href="https://httpie.io/">httpie</a> to make my <code>http</code> calls, as I like the syntax.
If you prefer you can use <code>curl</code> or any other tool that makes HTTP calls :)
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>If you don‚Äôt already have your Confluent Cloud environment set up, see <a href="/2025/03/13/creating-an-http-source-connector-on-confluent-cloud-from-the-cli/#_setup">my previous article</a>.
In this we created a Confluent Cloud environment, a Kafka cluster in that environment, and also a Schema Registry which was implicitly created.</p>
</div>
<div class="paragraph">
<p>Set the environment ID as an environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #0086B3">export </span><span style="color: #008080">CNFL_ENV</span><span style="color: #000000;font-weight: bold">=</span>env-253ngy</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don‚Äôt know your environment ID, you can get it from the web UI:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/03/cc-flink-06.webp" alt="cc flink 06"/>
</div>
</div>
<div class="paragraph">
<p>We‚Äôll set up an API key for the <code>cloud</code> resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #008080">$ </span>confluent api-key create <span style="color: #000080">--resource</span> cloud
It may take a couple of minutes <span style="color: #000000;font-weight: bold">for </span>the API key to be ready.
Save the API key and secret. The secret is not retrievable later.
+------------+------------------------------------------------------------------+
| API Key    | <span style="color: #000000;font-weight: bold">(</span>XXXmy-cloud-api-keyXXX<span style="color: #000000;font-weight: bold">)</span>                                         |
| API Secret | <span style="color: #000000;font-weight: bold">(</span>XXXmy-cloud-api-secretXXX<span style="color: #000000;font-weight: bold">)</span>                                      |
+------------+------------------------------------------------------------------+</code></pre>
</div>
</div>
<div class="paragraph">
<p>This API key I‚Äôve set as an environment variable as we need it for interacting with compute pools, and to create an API key for the Flink resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #0086B3">export </span><span style="color: #008080">CNFL_CLOUD_API_KEY</span><span style="color: #000000;font-weight: bold">=(</span>XXXmy-cloud-api-keyXXX<span style="color: #000000;font-weight: bold">)</span>
<span style="color: #0086B3">export </span><span style="color: #008080">CNFL_CLOUD_API_SECRET</span><span style="color: #000000;font-weight: bold">=(</span>XXXmy-cloud-api-secretXXX<span style="color: #000000;font-weight: bold">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since Flink resources are region-specific I‚Äôm going to store the region details as environment variables too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #0086B3">export </span><span style="color: #008080">REGION</span><span style="color: #000000;font-weight: bold">=</span>us-west-2
<span style="color: #0086B3">export </span><span style="color: #008080">CLOUD</span><span style="color: #000000;font-weight: bold">=</span>aws</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compute_pools">Compute pools&nbsp;<a class="headline-hash" href="#_compute_pools">üîó</a> </h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/images/2025/03/cc-flink-cp.svg" alt="cc flink cp"/>
</div>
</div>
<div class="paragraph">
<p>Before we can do anything with Flink we need a <a href="https://docs.confluent.io/cloud/current/api.html#tag/Compute-Pools-(fcpmv2)">compute pool</a>.</p>
</div>
<div class="sect2">
<h3 id="_get_compute_pools">Get compute pools&nbsp;<a class="headline-hash" href="#_get_compute_pools">üîó</a> </h3>
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/Compute-Pools-(fcpmv2)/operation/listFcpmV2ComputePools">API doc</a></p>
</div>
<div class="paragraph">
<p>Let‚Äôs see which, if any, compute pools exist:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http GET https://api.confluent.cloud/fcpm/v2/compute-pools<span style="color: #d14">\?</span><span style="color: #008080">environment</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #008080">$CNFL_ENV</span> <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #000080">--print</span> b</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>--print b</code> option is shorthand for <code>--print body</code> which prints the response body and none of the noisy response headers.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The response shows us that there are no compute pools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">api_version</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">fcpm/v2</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">data</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">[],</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">kind</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">ComputePoolList</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">metadata</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">first</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">next</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;&#34;</span>
    <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_compute_pool">Create a compute pool&nbsp;<a class="headline-hash" href="#_create_a_compute_pool">üîó</a> </h3>
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/Compute-Pools-(fcpmv2)/operation/createFcpmV2ComputePool">API doc</a></p>
</div>
<div class="paragraph">
<p>Since we got an empty metadata response from the above query, let‚Äôs go ahead and create a compute pool.</p>
</div>
<div class="paragraph">
<p>A compute pool has a defined capacity, expressed in CFUs.
As well as its capacity, we‚Äôll give it a name and specify where it‚Äôs to be located in terms of environment, cloud provider, and region.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http POST https://api.confluent.cloud/fcpm/v2/compute-pools <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #000080">--print</span> b <span style="color: #d14">\</span>
    spec:<span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">&#39;{
        &#34;display_name&#34;: &#34;my-new-flink-pool&#34;,
        &#34;cloud&#34;: &#34;&#39;</span><span style="color: #008080">$CLOUD</span><span style="color: #d14">&#39;&#34;,
        &#34;region&#34;: &#34;&#39;</span><span style="color: #008080">$REGION</span><span style="color: #d14">&#39;&#34;,
        &#34;max_cfu&#34;: 20,
        &#34;environment&#34;: {
            &#34;id&#34;:&#34;&#39;</span><span style="color: #008080">$CNFL_ENV</span><span style="color: #d14">&#39;&#34;
            }
        }&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns a rich set of data, including the ID of the created pool.
We want to store this as we‚Äôll need it later on.
We could copy and paste the ID from the JSON response into a manual <code>export</code> command, but we‚Äôre not heathens here‚Äîlet‚Äôs automate it!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #008080">response</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span>http POST https://api.confluent.cloud/fcpm/v2/compute-pools <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #000080">--print</span> b <span style="color: #d14">\</span>
    spec:<span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">&#39;{
        &#34;display_name&#34;: &#34;my-flink-pool-&#39;</span><span style="color: #d14">$(</span><span style="color: #0086B3">date</span> +%Y-%m-%d<span style="color: #d14">)</span><span style="color: #d14">&#39;&#34;,
        &#34;cloud&#34;: &#34;&#39;</span><span style="color: #008080">$CLOUD</span><span style="color: #d14">&#39;&#34;,
        &#34;region&#34;: &#34;&#39;</span><span style="color: #008080">$REGION</span><span style="color: #d14">&#39;&#34;,
        &#34;max_cfu&#34;: 20,
        &#34;environment&#34;: {
            &#34;id&#34;:&#34;&#39;</span><span style="color: #008080">$CNFL_ENV</span><span style="color: #d14">&#39;&#34;
            }
        }&#39;</span><span style="color: #d14">)</span>

<span style="color: #0086B3">export </span><span style="color: #008080">CNFL_COMPUTE_POOL_ID</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span><span style="color: #0086B3">echo</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$response</span><span style="color: #d14">&#34;</span> | jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.id&#39;</span><span style="color: #d14">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We‚Äôve created a second compute pool, and this time captured the details about it into the <code>CNFL_COMPUTE_POOL_ID</code> environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #008080">$ </span><span style="color: #0086B3">echo</span> <span style="color: #008080">$CNFL_COMPUTE_POOL_ID</span>

lfcp-kz3m1p</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let‚Äôs look at what we‚Äôve now got in terms of compute pools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #008080">$ </span>http GET https://api.confluent.cloud/fcpm/v2/compute-pools<span style="color: #d14">\?</span>environment<span style="color: #d14">\=</span><span style="color: #008080">$CNFL_ENV</span> <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #000080">--print</span> b <span style="color: #d14">\</span>
    | jq <span style="color: #d14">&#39;.data[] | .spec.display_name + &#34; (&#34; + .id + &#34;): &#34; + .status.phase&#39;</span>

<span style="color: #d14">&#34;AWS.us-west-2.env-253ngy.c267 (lfcp-mxd977): PROVISIONED&#34;</span>
<span style="color: #d14">&#34;my-new-flink-pool (lfcp-8oxrj0): PROVISIONED&#34;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_delete_a_compute_pool">Delete a compute pool&nbsp;<a class="headline-hash" href="#_delete_a_compute_pool">üîó</a> </h3>
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/Compute-Pools-(fcpmv2)/operation/deleteFcpmV2ComputePool">API doc</a></p>
</div>
<div class="paragraph">
<p>What about the <code>my-new-flink-pool</code> compute pool that we created first‚Äîit seems a waste, if not downright confusing, to keep it lying around.
Plus it gives a good excuse to try out the delete API.</p>
</div>
<div class="paragraph">
<p>First we need the compute pool‚Äôs ID, which we can see from the output above (<code>lfcp-8oxrj0</code>).</p>
</div>
<div class="paragraph">
<p>Then we use the <code>DELETE</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http DELETE https://api.confluent.cloud/fcpm/v2/compute-pools/lfcp-8oxrj0?environment<span style="color: #d14">\=</span><span style="color: #008080">$CNFL_ENV</span> <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The return code should be <code>HTTP/1.1 204 No Content</code> if successful.</p>
</div>
<div class="sect3">
<h4 id="_delete_all_compute_pools">Delete all compute pools&nbsp;<a class="headline-hash" href="#_delete_all_compute_pools">üîó</a> </h4>
<div class="paragraph">
<p>What about if we‚Äôve been messing about and have a ton of compute pools that we want to get rid of all at once?</p>
</div>
<div class="paragraph">
<p>This is why I like using APIs, because you can start to chain specific things (managing compute pools) with general shell techniques‚Äîin this case, <code>xargs</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http GET https://api.confluent.cloud/fcpm/v2/compute-pools<span style="color: #d14">\?</span>environment<span style="color: #d14">\=</span><span style="color: #008080">$CNFL_ENV</span> <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #000080">--print</span> b | <span style="color: #d14">\</span>
    <span style="color: #d14">\</span>
    jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.data[].id&#39;</span> | <span style="color: #d14">\</span>
    <span style="color: #d14">\</span>
    xargs <span style="color: #000080">-Ifoo</span> http DELETE https://api.confluent.cloud/fcpm/v2/compute-pools/foo<span style="color: #d14">\?</span>environment<span style="color: #d14">\=</span><span style="color: #008080">$CNFL_ENV</span> <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(I‚Äôm using additional line continuation characters (<code>\</code>) just to break the command up so you can see what the constituent parts of it are).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_side_step_regions">A side step: Regions&nbsp;<a class="headline-hash" href="#_a_side_step_regions">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/Regions-(fcpmv2)/operation/listFcpmV2Regions">API doc</a></p>
</div>
<div class="paragraph">
<p>No resource to create here, just query.
To interact with Flink we need to know the HTTP endpoint for the region in which the compute pool is located.
We can get this using the <a href="https://docs.confluent.io/cloud/current/api.html#tag/Regions-(fcpmv2)">regions API</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http GET <span style="color: #d14">&#34;https://api.confluent.cloud/fcpm/v2/regions?cloud=</span><span style="color: #008080">$CLOUD</span><span style="color: #d14">&amp;region_name=</span><span style="color: #008080">$REGION</span><span style="color: #d14">&#34;</span> <span style="color: #d14">\</span>
        <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #000080">--print</span> b</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">api_version</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">fcpm/v2</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">data</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">[</span>
        <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">api_version</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">fcpm/v2</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">cloud</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">AWS</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">display_name</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">Oregon (us-west-2)</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">http_endpoint</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">https://flink.us-west-2.aws.confluent.cloud</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">id</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">aws.us-west-2</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">kind</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">Region</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">metadata</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
                <span style="color: #d14">&#34;</span><span style="color: #d14">self</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;&#34;</span>
            <span style="background-color: #f8f8f8">},</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">private_http_endpoint</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">https://flink.us-west-2.aws.private.confluent.cloud</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">region_name</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">us-west-2</span><span style="color: #d14">&#34;</span>
        <span style="background-color: #f8f8f8">}</span>
    <span style="background-color: #f8f8f8">],</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">kind</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">RegionList</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">metadata</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">first</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">next</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">total_size</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">1</span>
    <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As above with the compute pool ID, I‚Äôm going to store the Flink API endpoint (<code>http_endpoint</code>) in an environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #0086B3">export </span><span style="color: #008080">CNFL_FLINK_API_URL</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span><span style="color: #d14">\</span>
        http GET <span style="color: #d14">&#34;https://api.confluent.cloud/fcpm/v2/regions?cloud=</span><span style="color: #008080">$CLOUD</span><span style="color: #d14">&amp;region_name=</span><span style="color: #008080">$REGION</span><span style="color: #d14">&#34;</span> <span style="color: #d14">\</span>
        <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> | jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.data[].http_endpoint&#39;</span><span style="color: #d14">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_were_almost_ready_to_start_sending_flink_sql_to_confluent_cloud">We‚Äôre almost ready to start sending Flink SQL to Confluent Cloud‚Ä¶&nbsp;<a class="headline-hash" href="#_were_almost_ready_to_start_sending_flink_sql_to_confluent_cloud">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>We‚Äôve created a compute pool, we‚Äôve got the Flink API endpoint; we now just need a Flink API key.</p>
</div>
<div class="sect2">
<h3 id="_flink_api_key">Flink API key&nbsp;<a class="headline-hash" href="#_flink_api_key">üîó</a> </h3>
<div class="paragraph">
<p>A Flink API key operates at the environment/cloud provider/region level.
Before we can generate it we need the ID of our user, which we can get from‚Ä¶the user API:</p>
</div>
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/Users-(iamv2)/operation/listIamV2Users">API doc</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #0086B3">export </span><span style="color: #008080">CNFL_USER</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span>http GET https://api.confluent.cloud/iam/v2/users <span style="color: #d14">\</span>
                    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> | <span style="color: #d14">\</span>
                    jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.data[] | select (.full_name==&#34;rmoff&#34;) | .id&#39;</span><span style="color: #d14">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
I‚Äôm hardcoding my username in here.
There may be a better way to do this :)
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Now we can create the Flink API key.
I‚Äôm going to do like we did with the compute pool and store the response in an environment variable:</p>
</div>
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/API-Keys-(iamv2)/operation/createIamV2ApiKey">API doc</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #008080">response</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span>http POST https://api.confluent.cloud/iam/v2/api-keys <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #d14">\</span>
    spec:<span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">&#39;{
        &#34;owner&#34;: {&#34;id&#34; :&#34;&#39;</span><span style="color: #008080">$CNFL_USER</span><span style="color: #d14">&#39;&#34;},
        &#34;resource&#34;: {&#34;id&#34;:&#34;&#39;</span><span style="color: #008080">$CNFL_ENV</span><span style="color: #d14">&#39;.&#39;</span><span style="color: #008080">$CLOUD</span><span style="color: #d14">&#39;.&#39;</span><span style="color: #008080">$REGION</span><span style="color: #d14">&#39;&#34;}
    }&#39;</span><span style="color: #d14">)</span>

<span style="color: #0086B3">export </span><span style="color: #008080">CNFL_FLINK_API_KEY</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span><span style="color: #0086B3">echo</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$response</span><span style="color: #d14">&#34;</span> | jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.id&#39;</span><span style="color: #d14">)</span>
<span style="color: #0086B3">export </span><span style="color: #008080">CNFL_FLINK_API_SECRET</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span><span style="color: #0086B3">echo</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$response</span><span style="color: #d14">&#34;</span> | jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.spec.secret&#39;</span><span style="color: #d14">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_statements">Statements&nbsp;<a class="headline-hash" href="#_statements">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)">API doc</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/03/cc-flink-statements.svg" alt="cc flink statements"/>
</div>
</div>
<div class="paragraph">
<p>Statements are how you send Flink SQL to Confluent Cloud.
They need a compute pool and Flink API key, both of which we created above.</p>
</div>
<div class="paragraph">
<p>There are just a few more variables that we need to set for when we call the statements API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Organization ID, which we can get from the organisation API:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #0086B3">export </span><span style="color: #008080">CNFL_ORG</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span>http GET <span style="color: #d14">&#34;https://api.confluent.cloud/org/v2/organizations&#34;</span> <span style="color: #d14">\</span>
        <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #000080">--print</span> b | jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.data[].id&#39;</span><span style="color: #d14">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><em>This assumes that there is only one org; if that‚Äôs not the case you‚Äôll need to amend it to use the correct one.</em></p>
</div>
</li>
<li>
<p>When you run a Flink SQL statement you need to provide a catalog (a Confluent Cloud environment) and database (a Kafka cluster) context.
This may or may not be the same as where the table you‚Äôre interacting with is located, but it must be provided nonetheless.
In the web UI it‚Äôs set by default so you may not even notice it‚Äîwith the API you need to provide it explicitly.</p>
</li>
<li>
<p>Whilst we set the ID of the Confluent Cloud environment above, we need its <em>name</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #0086B3">export </span><span style="color: #008080">CNFL_ENV_NAME</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span><span style="color: #d14">\</span>
    http GET https://api.confluent.cloud/org/v2/environments/<span style="color: #008080">$CNFL_ENV</span> <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span> | jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.display_name&#39;</span><span style="color: #d14">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For the Kafka cluster, here‚Äôs a way to pick the first Kafka cluster from your environment and get its ID and name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #008080">response</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span>http GET <span style="color: #d14">&#34;https://api.confluent.cloud/cmk/v2/clusters?environment=</span><span style="color: #008080">$CNFL_ENV</span><span style="color: #d14">&#34;</span> <span style="color: #d14">\</span>
            <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_CLOUD_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_CLOUD_API_SECRET</span><span style="color: #d14">&#34;</span><span style="color: #d14">)</span>

<span style="color: #0086B3">export </span><span style="color: #008080">CNFL_KAFKA_CLUSTER</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span><span style="color: #0086B3">echo</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$response</span><span style="color: #d14">&#34;</span> | jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.data[0].id&#39;</span><span style="color: #d14">)</span>
<span style="color: #0086B3">export </span><span style="color: #008080">CNFL_KAFKA_CLUSTER_NAME</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">$(</span><span style="color: #0086B3">echo</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$response</span><span style="color: #d14">&#34;</span> | jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.data[0].spec.display_name&#39;</span><span style="color: #d14">)</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_list_statements">List statements&nbsp;<a class="headline-hash" href="#_list_statements">üîó</a> </h3>
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)/operation/listSqlv1Statements">API doc</a></p>
</div>
<div class="paragraph">
<p>This will list all the statements that have been run in the environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http GET <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The scope for this is the entire Flink deployment (environment/cloud provider/region), so you‚Äôll see statements not just those on the compute pool you‚Äôve created, or even only those on compute pools that currently exist.
This threw me at first, because if you‚Äôve been running things in the Flink environment already you may well get a long list returned.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>With jq we can list just the statement names and status:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http GET <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span> | <span style="color: #d14">\</span>
    jq <span style="color: #d14">&#39;.data[]| .name + &#34;: &#34; + .status.phase&#39;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code>&#34;ctas-measures-20250318121833: STOPPED&#34;
&#34;ctas-measures-dim-20250318122944: STOPPED&#34;
&#34;ctas-readings-2025-03-18-10-43-45: FAILED&#34;
&#34;ctas-readings-2025-03-18-10-53-18: COMPLETED&#34;
&#34;ctas-readings-2025-03-18-11-23-20: FAILED&#34;
&#34;ctas-readings-enriched-20250318131826: FAILED&#34;
&#34;ctas-readings-enriched-20250318131958: FAILED&#34;
&#34;ctas-readings-enriched-20250318132444: STOPPED&#34;
&#34;ctas-stations-20250318122308: STOPPED&#34;
&#34;ctas-stations-dim-20250318123821: STOPPED&#34;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_statement">Create a statement&nbsp;<a class="headline-hash" href="#_create_a_statement">üîó</a> </h3>
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)/operation/createSqlv1Statement">API doc</a></p>
</div>
<div class="paragraph">
<p>When you create a statement you need to specify the Flink SQL, compute pool ID, and then the environment name and Kafka cluster name as <code>properties</code> for the catalog and database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http POST <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #d14">\</span>
    <span style="color: #008080">name</span><span style="color: #000000;font-weight: bold">=</span>my-flink-sql-statement-00 <span style="color: #d14">\</span>
    spec:<span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">&#39;{
        &#34;compute_pool_id&#34;: &#34;&#39;</span><span style="color: #008080">$CNFL_COMPUTE_POOL_ID</span><span style="color: #d14">&#39;&#34;,
        &#34;statement&#34;: &#34;CREATE TABLE foo AS SELECT name, COUNT(*) AS cnt FROM (VALUES (&#39;</span>Bob<span style="color: #d14">&#39;), (&#39;</span>Alice<span style="color: #d14">&#39;), (&#39;</span>Greg<span style="color: #d14">&#39;), (&#39;</span>Bob<span style="color: #d14">&#39;)) AS NameTable(name) GROUP BY name;&#34;,
        &#34;properties&#34;: {
            &#34;sql.current-catalog&#34;: &#34;&#39;</span><span style="color: #008080">$CNFL_ENV_NAME</span><span style="color: #d14">&#39;&#34;,
            &#34;sql.current-database&#34;: &#34;&#39;</span><span style="color: #008080">$CNFL_KAFKA_CLUSTER_NAME</span><span style="color: #d14">&#39;&#34;
        }
    }&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then fetch the statement back to see its status:</p>
</div>
<div class="paragraph">
<p>üìï API doc: <a href="https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)/operation/getSqlv1Statement">API doc</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http GET <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements/my-flink-sql-statement-00 <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript">    <span style="background-color: #f8f8f8">[</span><span style="color: #a61717;background-color: #e3d2d2">‚Ä¶</span><span style="background-color: #f8f8f8">]</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">spec</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">properties</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">sql.current-catalog</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">rmoff</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">sql.current-database</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">cluster00</span><span style="color: #d14">&#34;</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">statement</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">CREATE TABLE foo AS SELECT name, COUNT(*) AS cnt FROM (VALUES (Bob), (Alice), (Greg), (Bob)) AS NameTable(name) GROUP BY name;</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="background-color: #f8f8f8">[</span><span style="color: #a61717;background-color: #e3d2d2">‚Ä¶</span><span style="background-color: #f8f8f8">]</span>
    <span style="background-color: #f8f8f8">},</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">status</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">detail</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">SQL validation failed. Error from line 1, column 64 to line 1, column 66.</span><span style="color: #d14">\n\n</span><span style="color: #d14">Caused by: Column &#39;Bob&#39; not found in any table</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">network_kind</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">PUBLIC</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">phase</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">FAILED</span><span style="color: #d14">&#34;</span>
    <span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You‚Äôll notice that it says <code>FAILED</code>.
This is where we get into the fun of calling APIs from the shell.
Single quotes, double quotes‚Ä¶all are fun and have their own nuances to understand.
If we look carefully at the <code>statement</code> value returned above we can see that indeed <code>Bob</code> et al are no longer single quoted‚Äîbut should be.
The single quotes got lost in the <code>http</code> command submission.</p>
</div>
<div class="paragraph">
<p>Let‚Äôs use proper quoting for the single quotes in the SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http POST <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #d14">\</span>
    <span style="color: #008080">name</span><span style="color: #000000;font-weight: bold">=</span>my-flink-sql-statement-01 <span style="color: #d14">\</span>
    spec:<span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">&#39;{
        &#34;compute_pool_id&#34;: &#34;&#39;</span><span style="color: #008080">$CNFL_COMPUTE_POOL_ID</span><span style="color: #d14">&#39;&#34;,
        &#34;statement&#34;: &#34;CREATE TABLE foo AS SELECT name, COUNT(*) AS cnt FROM (VALUES (&#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;Bob&#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;), (&#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;Alice&#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;), (&#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;Greg&#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;), (&#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;Bob&#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;)) AS NameTable(name) GROUP BY name;&#34;,
        &#34;properties&#34;: {
            &#34;sql.current-catalog&#34;: &#34;&#39;</span><span style="color: #008080">$CNFL_ENV_NAME</span><span style="color: #d14">&#39;&#34;,
            &#34;sql.current-database&#34;: &#34;&#39;</span><span style="color: #008080">$CNFL_KAFKA_CLUSTER_NAME</span><span style="color: #d14">&#39;&#34;
        }
    }&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This time the statement works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"> http GET <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements/my-flink-sql-statement-01 <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span> | jq <span style="color: #d14">&#39;.status&#39;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">{</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">detail</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">network_kind</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">PUBLIC</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">phase</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">COMPLETED</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">scaling_status</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">last_updated</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">2025-03-26T10:25:58Z</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">scaling_state</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">OK</span><span style="color: #d14">&#34;</span>
  <span style="background-color: #f8f8f8">},</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">traits</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">is_append_only</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #000000;font-weight: bold">true</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">is_bounded</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #000000;font-weight: bold">true</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">schema</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{},</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">sql_kind</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">CREATE_TABLE_AS</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">upsert_columns</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #000000;font-weight: bold">null</span>
  <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we load up the Confluent Cloud web UI we can see that the table has indeed been created:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/03/cc-flink-03.webp" alt="cc flink 03" width="25%"/>
</div>
</div>
<div class="paragraph">
<p>Can we get this information (i.e. a list of tables) for ourselves from the API?</p>
</div>
<div class="paragraph">
<p>We can, and it‚Äôs a good excuse to look at how we get the <em>results</em> from a statement.
So far we‚Äôve just run a statement with no result set‚Äîit just created a table.
Like many databases, Flink SQL on Confluent Cloud provides an information schema that holds metadata about the contents of the database.
Let‚Äôs run a query to show all &#39;tables&#39; (topics) in a &#39;database&#39; (Kafka cluster).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http POST <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #d14">\</span>
    <span style="color: #008080">name</span><span style="color: #000000;font-weight: bold">=</span>list-tables-00 <span style="color: #d14">\</span>
    spec:<span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">&#39;{
        &#34;compute_pool_id&#34;: &#34;&#39;</span><span style="color: #008080">$CNFL_COMPUTE_POOL_ID</span><span style="color: #d14">&#39;&#34;,
        &#34;statement&#34;: &#34;SELECT * FROM `INFORMATION_SCHEMA`.`TABLES` WHERE TABLE_TYPE = &#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;BASE TABLE&#39;</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39; AND TABLE_CATALOG_ID = &#39;</span><span style="color: #d14">\&#39;</span><span style="color: #008080">$CNFL_ENV</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39; AND TABLE_SCHEMA_ID = &#39;</span><span style="color: #d14">\&#39;</span><span style="color: #008080">$CNFL_KAFKA_CLUSTER</span><span style="color: #d14">\&#39;</span><span style="color: #d14">&#39;&#34;,
        &#34;properties&#34;: {
            &#34;sql.current-catalog&#34;: &#34;&#39;</span><span style="color: #008080">$CNFL_ENV_NAME</span><span style="color: #d14">&#39;&#34;,
            &#34;sql.current-database&#34;: &#34;&#39;</span><span style="color: #008080">$CNFL_KAFKA_CLUSTER_NAME</span><span style="color: #d14">&#39;&#34;
        }
    }&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This time, when we fetch the <code>status</code> of the statement, it‚Äôs not just <code>COMPLETED</code> but gives us information about the schema of the resultset:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http GET <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements/list-tables-00 <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span> | jq <span style="color: #d14">&#39;.status&#39;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">{</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">detail</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">network_kind</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">PUBLIC</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">phase</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">COMPLETED</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">traits</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">is_append_only</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #000000;font-weight: bold">true</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">is_bounded</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #000000;font-weight: bold">true</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">schema</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">columns</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">[</span>
        <span style="background-color: #f8f8f8">{</span>
          <span style="color: #d14">&#34;</span><span style="color: #d14">name</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">TABLE_CATALOG_ID</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
          <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">length</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">2147483647</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">nullable</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #000000;font-weight: bold">false</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">VARCHAR</span><span style="color: #d14">&#34;</span>
          <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="background-color: #f8f8f8">{</span>
          <span style="color: #d14">&#34;</span><span style="color: #d14">name</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">TABLE_CATALOG</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
          <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">length</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">2147483647</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">nullable</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #000000;font-weight: bold">false</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">VARCHAR</span><span style="color: #d14">&#34;</span>
          <span style="background-color: #f8f8f8">}</span>
    <span style="background-color: #f8f8f8">[</span><span style="color: #a61717;background-color: #e3d2d2">‚Ä¶</span><span style="background-color: #f8f8f8">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But what about the data itself?</p>
</div>
</div>
<div class="sect2">
<h3 id="_reading_the_results_from_a_statement">Reading the results from a statement&nbsp;<a class="headline-hash" href="#_reading_the_results_from_a_statement">üîó</a> </h3>
<div class="paragraph">
<p>üìï API doc: <a href="https://docs.confluent.io/cloud/current/api.html#tag/Statement-Results-(sqlv1)/operation/getSqlv1StatementResult">API doc</a></p>
</div>
<div class="paragraph">
<p>To get the results from a statement you use the <code>/results</code> endpoint against the statement name, thus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http GET <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements/list-tables-00/results <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span> <span style="color: #000080">--print</span> b</code></pre>
</div>
</div>
<div class="paragraph">
<p>The schema we got from the statement endpoint above (<code>status.traits.schema</code>), so the resultset just gives us the actual data, plus metadata on how to page through the results if there is more data than is returned in a single response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">api_version</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">sql/v1</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">kind</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">StatementResult</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">metadata</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">created_at</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">2025-03-26T10:41:55.989063Z</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">next</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">self</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">https://flink.us-west-2.aws.confluent.cloud/sql/v1/organizations/178cb46b-d78e-435d-8b6e-d8d023a08e6f/environments/env-253ngy/statements/list-tables-00/res
ults</span><span style="color: #d14">&#34;</span>
    <span style="background-color: #f8f8f8">},</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">results</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">data</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">[</span>
            <span style="background-color: #f8f8f8">{</span>
                <span style="color: #d14">&#34;</span><span style="color: #d14">row</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">[</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">env-253ngy</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">rmoff</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">lkc-qnygo6</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">cluster00</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">foo</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">BASE TABLE</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">YES</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">HASH</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">6</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">YES</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">$rowtime</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">`SOURCE_WATERMARK`()</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #d14">&#34;</span><span style="color: #d14">YES</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
                    <span style="color: #000000;font-weight: bold">null</span>
                <span style="background-color: #f8f8f8">]</span>
            <span style="background-color: #f8f8f8">},</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As much as I am a fan of using APIs as a quick and powerful way to interact with something, reading SQL results is where I draw the line; trying to piece the above resultset manually together is not my idea of fun‚Äîand is why the Confluent Cloud Flink Workspace is a much nicer way to do this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/03/cc-flink-04.webp" alt="cc flink 04"/>
</div>
</div>
<div class="paragraph">
<p>or the Confluent CLI Flink shell:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/03/cc-flink-05.webp" alt="cc flink 05" width="50%"/>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_delete_statements">Delete statements&nbsp;<a class="headline-hash" href="#_delete_statements">üîó</a> </h3>
<div class="paragraph">
<p>üìï <a href="https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)/operation/deleteSqlv1Statement">API doc</a></p>
</div>
<div class="paragraph">
<p>Let‚Äôs wrap up by tidying up after ourselves, and looking at how to delete statements.</p>
</div>
<div class="paragraph">
<p>To delete a statement use the <code>DELETE</code> method on the statement‚Äôs endpoint using its name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http DELETE <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements/list-tables-00 <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You‚Äôll get a <code>HTTP/1.1 202 Accepted</code> response if successful.</p>
</div>
<div class="paragraph">
<p>If we want to clean up your environment and delete all statements you can use something like the following.
Use it very carefully; it‚Äôll literally delete all the statements with no undo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">http GET <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span> | <span style="color: #d14">\</span>
    <span style="color: #d14">\</span>
    jq <span style="color: #000080">-r</span> <span style="color: #d14">&#39;.data[].name&#39;</span> | <span style="color: #d14">\</span>
    <span style="color: #d14">\</span>
    xargs <span style="color: #000080">-Ifoo</span> http DELETE <span style="color: #008080">$CNFL_FLINK_API_URL</span>/sql/v1/organizations/<span style="color: #008080">$CNFL_ORG</span>/environments/<span style="color: #008080">$CNFL_ENV</span>/statements/foo <span style="color: #d14">\</span>
    <span style="color: #000080">--auth</span> <span style="color: #d14">&#34;</span><span style="color: #008080">$CNFL_FLINK_API_KEY</span><span style="color: #d14">:</span><span style="color: #008080">$CNFL_FLINK_API_SECRET</span><span style="color: #d14">&#34;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><a href="https://bsky.app/profile/rmoff.net"><b class="fa-brands fa-bluesky"></b></a>  <em>Robin Moffatt works on the DevRel team at Confluent. He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2025 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
