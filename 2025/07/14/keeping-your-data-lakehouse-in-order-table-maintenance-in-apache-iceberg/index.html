<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2025/07/h_IMG_0987.webp" >
		
		<title>Keeping your Data Lakehouse in Order: Table Maintenance in Apache Iceberg</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2025/07/14/keeping-your-data-lakehouse-in-order-table-maintenance-in-apache-iceberg/">
		
		

		
		<meta property="og:title" content="Keeping your Data Lakehouse in Order: Table Maintenance in Apache Iceberg" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2025/07/h_IMG_0987.webp" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2025/07/14/keeping-your-data-lakehouse-in-order-table-maintenance-in-apache-iceberg/" />
		<meta property="og:site_name" content="Keeping your Data Lakehouse in Order: Table Maintenance in Apache Iceberg" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2025/07/h_IMG_0987.webp');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Keeping your Data Lakehouse in Order: Table Maintenance in Apache Iceberg</h1>
			<p class="article-hero-meta">
				
					<time datetime="2025-07-14T14:43:04Z">14 Jul 2025</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/apache-iceberg">Apache Iceberg</a>, <a href="https://rmoff.net/categories/apache-spark">Apache Spark</a>, <a href="https://rmoff.net/categories/trino">Trino</a>, <a href="https://rmoff.net/categories/minio">MinIO</a>
					<span class="display-print">at https://rmoff.net/2025/07/14/keeping-your-data-lakehouse-in-order-table-maintenance-in-apache-iceberg/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_do_try_this_at_home">Do try this at home!</a></li>
    <li><a href="#_what_happens_when_you_write_data_to_iceberg">What happens when you write data to Iceberg?</a></li>
    <li><a href="#_data_about_the_metadata">Data about the metadata</a></li>
    <li><a href="#_why_all_these_files">Why all these files?</a>
      <ul>
        <li><a href="#_time_travel_in_iceberg">Time travel in Iceberg</a></li>
        <li><a href="#_ctrl_z_for_your_data_lakehouse">Ctrl-Z for your data lakehouse</a></li>
      </ul>
    </li>
    <li><a href="#_sodoesnt_this_get_messy">So‚Ä¶doesn‚Äôt this get messy?</a>
      <ul>
        <li><a href="#_combining_data_files_into_fewer_data_files">Combining data files into fewer data files</a></li>
        <li><a href="#_expiring_snapshots">Expiring snapshots</a></li>
      </ul>
    </li>
    <li><a href="#_other_table_maintenance_options">Other table maintenance options</a>
      <ul>
        <li><a href="#_apache_amoro">Apache Amoro</a></li>
        <li><a href="#_aws">AWS</a></li>
        <li><a href="#_nimtable">Nimtable</a></li>
      </ul>
    </li>
    <li><a href="#_further_reading">Further reading</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Apache Iceberg</span><span data-pagefind-filter="category" style="display:none">Apache Spark</span><span data-pagefind-filter="category" style="display:none">Trino</span><span data-pagefind-filter="category" style="display:none">MinIO</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2025/07/h_IMG_0987.webp" style="display:none" alt="">
	<div class="paragraph">
<p>Iceberg nicely decouples storage from ingest and query (yay!).
When we say &#34;decouples&#34; it‚Äôs a fancy way of saying &#34;doesn‚Äôt do&#34;.
Which, in the case of ingest and query, is really powerful.
It means that we can store data in an open format, populated by one or more tools, and queried by the same, or other tools.
Iceberg gets to be very opinionated and optimised around what it was built for (storing tabular data in a flexible way that can be efficiently queried).
This is amazing!</p>
</div>
<div class="paragraph">
<p>But, what Iceberg doesn‚Äôt do is any housekeeping on its data and metadata.
This means that getting data in and out of Apache Iceberg isn‚Äôt where the story stops.</p>
</div>
<div class="paragraph">
<p>You can provision your object storage, choose a metadata catalog, and chuck an engine on it all (like Flink, Trino, or Spark).
But you still need to think about the files that Iceberg is writing.
Because under the covers of your Iceberg table is this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/07/iceberg-metadata.webp" alt="iceberg metadata" width="500"/>
</div>
<div class="title">Credit: <a href="https://iceberg.apache.org/spec/#overview">Apache Iceberg docs</a>.</div>
</div>
<div class="paragraph">
<p>Let‚Äôs take a step back and look at what happens when you write some data to Iceberg.</p>
</div>
<div class="sect1">
<h2 id="_do_try_this_at_home">Do try this at home!&nbsp;<a class="headline-hash" href="#_do_try_this_at_home">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to try this at home and follow along as you read the blog post, you can use <a href="https://github.com/rmoff/examples/tree/main/iceberg/trino-polaris-minio">this Docker Compose</a> to bring up a local stack of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://polaris.apache.org/">Polaris</a> (catalog)</p>
</li>
<li>
<p><a href="https://min.io/">MinIO</a> (object store)</p>
</li>
<li>
<p><a href="https://trino.io">Trino</a> (engine) &amp; <a href="https://spark.apache.org">Spark</a> (engine) and <a href="https://jupyter.org/">Jupyter</a> (notebook)</p>
</li>
<li>
<p><a href="https://github.com/nimtable/nimtable">Nimtable</a> (catalog UI &amp; maintenance)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_happens_when_you_write_data_to_iceberg">What happens when you write data to Iceberg?&nbsp;<a class="headline-hash" href="#_what_happens_when_you_write_data_to_iceberg">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>‚ÑπÔ∏è <em>For more in-depth notes on this subject, check out Alex Merced‚Äôs <a href="https://www.dremio.com/blog/the-life-of-a-write-query-for-apache-iceberg-tables/">article</a></em>.</p>
</div>
<div class="paragraph">
<p>When you first create a table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">CREATE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span>
  <span style="color: #f8f8f2;background-color: #49483e">IF</span> <span style="color: #66d9ef;font-weight: bold">NOT</span> <span style="color: #66d9ef;font-weight: bold">EXISTS</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
    <span style="color: #f8f8f2;background-color: #49483e">customer_id</span> <span style="color: #f8f8f2">BIGINT</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #f8f8f2;background-color: #49483e">first_name</span> <span style="color: #f8f8f2">VARCHAR</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">255</span><span style="color: #f8f8f2;background-color: #49483e">),</span>
    <span style="color: #f8f8f2;background-color: #49483e">last_name</span> <span style="color: #f8f8f2">VARCHAR</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">255</span><span style="color: #f8f8f2;background-color: #49483e">),</span>
    <span style="color: #f8f8f2;background-color: #49483e">email</span> <span style="color: #f8f8f2">VARCHAR</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">255</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
  <span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Iceberg writes a single <strong>metadata file</strong> holding details including the table‚Äôs location and its schema:</p>
</div>
<details>
<summary class="title"><code>metadata/00000-69666f0f-2902-49ae-a717-0d8eb81c4825.metadata.json</code> <em>(click to expand)</em></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">format-version</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">table-uuid</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">ee794fd1-2144-42ce-a9f3-e3807ec4c054</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">location</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">s3://warehouse/rmoff/customers</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">last-sequence-number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">last-updated-ms</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1752247098598</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">last-column-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">current-schema-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">schemas</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
        <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">type</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">struct</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">schema-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">fields</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">name</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">customer_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">required</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">false</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">type</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">long</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">name</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">first_name</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">required</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">false</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">type</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">string</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">name</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">last_name</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">required</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">false</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">type</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">string</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">name</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">email</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">required</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">false</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">type</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">string</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">}</span>
            <span style="color: #f8f8f2;background-color: #49483e">]</span>
        <span style="color: #f8f8f2;background-color: #49483e">}</span>
    <span style="color: #f8f8f2;background-color: #49483e">],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">default-spec-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partition-specs</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
        <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">spec-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">fields</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[]</span>
        <span style="color: #f8f8f2;background-color: #49483e">}</span>
    <span style="color: #f8f8f2;background-color: #49483e">],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">last-partition-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">999</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">default-sort-order-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sort-orders</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
        <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">order-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">fields</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[]</span>
        <span style="color: #f8f8f2;background-color: #49483e">}</span>
    <span style="color: #f8f8f2;background-color: #49483e">],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">properties</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">owner</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">root</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">created-at</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">2025-07-11T15:18:18.570926252Z</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">write.parquet.compression-codec</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">zstd</span><span style="color: #e6db74">&#34;</span>
    <span style="color: #f8f8f2;background-color: #49483e">},</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">current-snapshot-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">refs</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{},</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshots</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">statistics</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partition-statistics</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshot-log</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">metadata-log</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[]</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>Other than that, there‚Äôs nothing else written at this point.
Now let‚Äôs write one row of data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">INSERT</span> <span style="color: #66d9ef;font-weight: bold">INTO</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">customer_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">first_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">email</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #66d9ef;font-weight: bold">VALUES</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;Rey&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;Skywalker&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;rey@rebelscum.org&#39;</span><span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This causes several more files to be written by Iceberg, both <code>/data</code> and <code>/metadata</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code>$ mc ls -r minio/warehouse/rmoff/customers/
[‚Ä¶] data/00000-0-e3b7a202-2481-4d9f-9b7c-9830908a425a-0-00001.parquet <i class="conum" data-value="1"></i><b>(1)</b>
[‚Ä¶] metadata/00000-69666f0f-2902-49ae-a717-0d8eb81c4825.metadata.json <i class="conum" data-value="2"></i><b>(2)</b>
[‚Ä¶] metadata/00001-d35fd98b-8761-4998-bd74-9677c9929e63.metadata.json <i class="conum" data-value="3"></i><b>(3)</b>
[‚Ä¶] metadata/ab613eb0-2f90-4273-869e-ee6d1425ab9a-m0.avro <i class="conum" data-value="4"></i><b>(4)</b>
[‚Ä¶] metadata/snap-653583197990088094-1-ab613eb0-2f90-4273-869e-ee6d1425ab9a.avro <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The row of data that I just wrote</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Metadata (v00000, original, as shown above)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Metadata (v00001, new)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Manifest list</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Manifest file</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The v00001 <strong>metadata file</strong> is similar to the first, except that it now includes snapshot details:</p>
</div>
<details>
<summary class="title">Extract from <code>metadata/00001-d35fd98b-8761-4998-bd74-9677c9929e63.metadata.json</code></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">‚Ä¶</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">current-snapshot-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">653583197990088094</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">refs</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">main</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshot-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">653583197990088094</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">type</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">branch</span><span style="color: #e6db74">&#34;</span>
        <span style="color: #f8f8f2;background-color: #49483e">}</span>
    <span style="color: #f8f8f2;background-color: #49483e">},</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshots</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
        <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sequence-number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshot-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">653583197990088094</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">timestamp-ms</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1752247268656</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">summary</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">operation</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">append</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">spark.app.id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">local-1752247081867</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added-data-files</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">1</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added-records</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">1</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added-files-size</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">1367</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">changed-partition-count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">1</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">total-records</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">1</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">total-files-size</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">1367</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">total-data-files</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">1</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">total-delete-files</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">0</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">total-position-deletes</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">0</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">total-equality-deletes</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">0</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">engine-version</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">3.5.5</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">app-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">local-1752247081867</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">engine-name</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">spark</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">iceberg-version</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">Apache Iceberg 1.8.1 (commit 9ce0fcf0af7becf25ad9fc996c3bad2afdcfd33d)</span><span style="color: #e6db74">&#34;</span>
            <span style="color: #f8f8f2;background-color: #49483e">},</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">manifest-list</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">s3://warehouse/rmoff/customers/metadata/snap-653583197990088094-1-ab613eb0-2f90-4273-869e-ee6d1425ab9a.avro</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">schema-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span>
        <span style="color: #f8f8f2;background-color: #49483e">}</span>
    <span style="color: #f8f8f2;background-color: #49483e">],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">statistics</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partition-statistics</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshot-log</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
        <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">timestamp-ms</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1752247268656</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshot-id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">653583197990088094</span>
        <span style="color: #f8f8f2;background-color: #49483e">}</span>
    <span style="color: #f8f8f2;background-color: #49483e">],</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">metadata-log</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
        <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">timestamp-ms</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1752247098598</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">metadata-file</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">s3://warehouse/rmoff/customers/metadata/00000-69666f0f-2902-49ae-a717-0d8eb81c4825.metadata.json</span><span style="color: #e6db74">&#34;</span>
        <span style="color: #f8f8f2;background-color: #49483e">}</span>
    <span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">‚Ä¶</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>In the snapshot data is referenced a <strong>manifest list</strong>:</p>
</div>
<details>
<summary class="title"><code>metadata/snap-653583197990088094-1-ab613eb0-2f90-4273-869e-ee6d1425ab9a.avro</code> (<em>converted to JSON</em>)</summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #f8f8f2;background-color: #49483e">{</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">manifest_path</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">s3://warehouse/rmoff/customers/metadata/ab613eb0-2f90-4273-869e-ee6d1425ab9a-m0.avro</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">manifest_length</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">7192</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partition_spec_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">content</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">min_sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added_snapshot_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">653583197990088094</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added_files_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">existing_files_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">deleted_files_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added_rows_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">existing_rows_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">deleted_rows_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partitions</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[]</span>
  <span style="color: #f8f8f2;background-color: #49483e">},</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key_metadata</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>This in turn references a <strong>Manifest file</strong>:</p>
</div>
<details>
<summary class="title"><code>metadata/ab613eb0-2f90-4273-869e-ee6d1425ab9a-m0.avro</code></summary>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">status</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshot_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">long</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">653583197990088094</span>
    <span style="color: #f8f8f2;background-color: #49483e">},</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">file_sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">data_file</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">content</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">file_path</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">s3://warehouse/rmoff/customers/data/00000-0-e3b7a202-2481-4d9f-9b7c-9830908a425a-0-00001.parquet</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">file_format</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">PARQUET</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partition</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{},</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">record_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">file_size_in_bytes</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1367</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">column_sizes</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">43</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">42</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">48</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">56</span>
                <span style="color: #f8f8f2;background-color: #49483e">}</span>
            <span style="color: #f8f8f2;background-color: #49483e">]</span>
        <span style="color: #f8f8f2;background-color: #49483e">},</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value_counts</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span>
                <span style="color: #f8f8f2;background-color: #49483e">}</span>
            <span style="color: #f8f8f2;background-color: #49483e">]</span>
        <span style="color: #f8f8f2;background-color: #49483e">},</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">null_value_counts</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span>
                <span style="color: #f8f8f2;background-color: #49483e">}</span>
            <span style="color: #f8f8f2;background-color: #49483e">]</span>
        <span style="color: #f8f8f2;background-color: #49483e">},</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">nan_value_counts</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[]</span>
        <span style="color: #f8f8f2;background-color: #49483e">},</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">lower_bounds</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0001</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">Rey</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">Skywalker</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">rey@rebelscum.or</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">}</span>
            <span style="color: #f8f8f2;background-color: #49483e">]</span>
        <span style="color: #f8f8f2;background-color: #49483e">},</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">upper_bounds</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0001</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #ae81ff">\</span><span style="color: #e6db74">u0000</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">Rey</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">3</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">Skywalker</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">},</span>
                <span style="color: #f8f8f2;background-color: #49483e">{</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">4</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">value</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">rey@rebelscum.os</span><span style="color: #e6db74">&#34;</span>
                <span style="color: #f8f8f2;background-color: #49483e">}</span>
            <span style="color: #f8f8f2;background-color: #49483e">]</span>
        <span style="color: #f8f8f2;background-color: #49483e">},</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key_metadata</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">split_offsets</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
                <span style="color: #ae81ff">4</span>
            <span style="color: #f8f8f2;background-color: #49483e">]</span>
        <span style="color: #f8f8f2;background-color: #49483e">},</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">equality_ids</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sort_order_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">int</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span>
        <span style="color: #f8f8f2;background-color: #49483e">},</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">referenced_data_file</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span>
    <span style="color: #f8f8f2;background-color: #49483e">}</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
</div>
</details>
<div class="paragraph">
<p>As you can see from the Manifest file, this points to the data file that was written, and holds some basic statistics about the data such as upper and lower bound values of each column.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_about_the_metadata">Data about the metadata&nbsp;<a class="headline-hash" href="#_data_about_the_metadata">üîó</a> </h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/images/2025/07/metadata.webp" alt="yo dawg" width="i heard you like metadata - so I got you some data about the metadata"/>
</div>
</div>
<div class="paragraph">
<p>Instead of poking around in object store buckets, we can get a good view of what‚Äôs happening beneath the surface of an Iceberg table using the system tables that expose this metadata.</p>
</div>
<div class="paragraph">
<p>How you access these tables depends on your query engine for Iceberg.
<a href="https://trino.io/docs/current/connector/iceberg.html#metadata-tables">Trino uses a <code>$</code> separator</a> (<code>mytable$snapshots</code>) whilst <a href="https://iceberg.apache.org/docs/nightly/spark-queries/#inspecting-tables">Spark uses qualifier suffix</a> (<code>catalog.db.table.snapshots</code>).</p>
</div>
<div class="paragraph">
<p>Here is the above metadata, seen through the <a href="https://iceberg.apache.org/docs/nightly/spark-queries/#inspecting-tables">tables in Spark</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>metadata_log_entries</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">polaris</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">metadata_log_entries</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
<col style="width: 20%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">timestamp</th>
<th class="tableblock halign-left valign-top">file</th>
<th class="tableblock halign-left valign-top">latest_snapshot_id</th>
<th class="tableblock halign-left valign-top">latest_schema_id</th>
<th class="tableblock halign-left valign-top">latest_sequence_number</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2025-07-11 15:18:18.598000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s3://warehouse/rmoff/customers/metadata/00000-69666f0f-2902-49ae-a717-0d8eb81c4825.metadata.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2025-07-11 15:21:08.656000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s3://warehouse/rmoff/customers/metadata/00001-d35fd98b-8761-4998-bd74-9677c9929e63.metadata.json</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">653583197990088094</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code>manifests</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">polaris</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">manifests</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3333%;"/>
<col style="width: 8.3337%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">content</th>
<th class="tableblock halign-left valign-top">path</th>
<th class="tableblock halign-left valign-top">length</th>
<th class="tableblock halign-left valign-top">partition_spec_id</th>
<th class="tableblock halign-left valign-top">added_snapshot_id</th>
<th class="tableblock halign-left valign-top">added_data_files_count</th>
<th class="tableblock halign-left valign-top">existing_data_files_count</th>
<th class="tableblock halign-left valign-top">deleted_data_files_count</th>
<th class="tableblock halign-left valign-top">added_delete_files_count</th>
<th class="tableblock halign-left valign-top">existing_delete_files_count</th>
<th class="tableblock halign-left valign-top">deleted_delete_files_count</th>
<th class="tableblock halign-left valign-top">partition_summaries</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s3://warehouse/rmoff/customers/metadata/ab613eb0-2f90-4273-869e-ee6d1425ab9a-m0.avro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">653583197990088094</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[]</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p><code>snapshots</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">polaris</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">snapshots</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;"/>
<col style="width: 16.6666%;"/>
<col style="width: 16.6666%;"/>
<col style="width: 16.6666%;"/>
<col style="width: 16.6666%;"/>
<col style="width: 16.667%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">committed_at</th>
<th class="tableblock halign-left valign-top">snapshot_id</th>
<th class="tableblock halign-left valign-top">parent_id</th>
<th class="tableblock halign-left valign-top">operation</th>
<th class="tableblock halign-left valign-top">manifest_list</th>
<th class="tableblock halign-left valign-top">summary</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2025-07-11 15:21:08.656000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">653583197990088094</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">append</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">s3://warehouse/rmoff/customers/metadata/snap-653583197990088094-1-ab613eb0-2f90-4273-869e-ee6d1425ab9a.avro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">\{&#39;engine-version&#39;: &#39;3.5.5&#39;, &#39;added-data-files&#39;: &#39;1&#39;,
&#39;total-equality-deletes&#39;: &#39;0&#39;, &#39;app-id&#39;: &#39;local-1752247081867&#39;,
&#39;added-records&#39;: &#39;1&#39;, &#39;total-records&#39;: &#39;1&#39;, &#39;spark.app.id&#39;:
&#39;local-1752247081867&#39;, &#39;changed-partition-count&#39;: &#39;1&#39;, &#39;engine-name&#39;:
&#39;spark&#39;, &#39;total-position-deletes&#39;: &#39;0&#39;, &#39;added-files-size&#39;: &#39;1367&#39;,
&#39;total-delete-files&#39;: &#39;0&#39;, &#39;iceberg-version&#39;: &#39;Apache Iceberg 1.8.1
(commit 9ce0fcf0af7becf25ad9fc996c3bad2afdcfd33d)&#39;, &#39;total-files-size&#39;:
&#39;1367&#39;, &#39;total-data-files&#39;: &#39;1&#39;}</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Plus the data file itself for a table, in <code>files</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span>
  <span style="color: #f8f8f2;background-color: #49483e">file_path</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">record_count</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">file_size_in_bytes</span>
<span style="color: #66d9ef;font-weight: bold">FROM</span>
  <span style="color: #f8f8f2;background-color: #49483e">polaris</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">files</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;"/>
<col style="width: 33.3333%;"/>
<col style="width: 33.3334%;"/>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file_path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">record_count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file_size_in_bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">s3://warehouse/rmoff/customers/data/00000-0-e3b7a202-2481-4d9f-9b7c-9830908a425a-0-00001.parquet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1367</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_all_these_files">Why all these files?&nbsp;<a class="headline-hash" href="#_why_all_these_files">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>After a few more changes to the data on the table, what started off as five files in the bucket is now ten times that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>docker compose <span style="color: #f8f8f2">exec </span>minio-client mc <span style="color: #f8f8f2">ls</span> <span style="color: #f92672">-r</span> minio/warehouse/rmoff/customers
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-0-e3b7a202-2481-4d9f-9b7c-9830908a425a-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-10-e314c682-0973-4851-a1d3-02ec2ff474d3-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-11-9cc47f12-f4f9-4db0-a942-2dd67cd3b1ba-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-12-1d30b129-68e1-4860-a4f5-f996916125d4-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-13-fa0ef50e-e976-41dc-8335-dd67568ed81e-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-14-3b349ccd-1cb1-467b-b0cd-68d98d081c62-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-22-613312a3-36fa-4714-8088-217bfce711b5-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-24-e0fd0048-a3c1-4acc-bac5-cbe1df00d5a0-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-8-b2dad931-1680-499f-894f-2d853aa523f9-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] data/00000-9-8527fa9b-5d74-4edc-8620-d9a4cf73f6f4-0-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00000-69666f0f-2902-49ae-a717-0d8eb81c4825.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00001-d35fd98b-8761-4998-bd74-9677c9929e63.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00002-9b2338d4-020e-4a9f-83cc-214c567a04e4.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00003-4dab419f-a92a-448c-b594-4c41a150c16a.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00004-dc4755fc-aecd-468c-bc1a-5475ad56b376.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00005-2e94a329-5463-44b0-bfc5-d7a70932ca54.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00006-743f8acd-b533-4f15-868a-8c8cb6531e98.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00007-f4e31526-9a63-4709-833c-2aeee0b070a3.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00008-5e69c6e7-afd0-4c76-86ef-502b6e684d5f.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00009-475e53be-14d1-4692-ba63-b736ee3289e7.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00010-99acda0d-dd1d-429e-b1a1-2d61f9ad5e0d.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00011-99c4c0cc-3454-433f-a5a2-7c3ae496e7d5.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/00012-1a421573-e57e-4d12-b112-b4b226cdc939.metadata.json
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/228ccff5-47ff-4253-94e9-eca15e40fac3-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/44a08557-5c09-45af-979c-a3f6bd20f73f-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/4a03f20d-a439-4f31-a903-7f3c6460918c-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/7d48f2bc-3284-406d-ade6-a4acb3a449bf-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/822c7500-d614-4362-9771-5a4d85fc8637-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/ab613eb0-2f90-4273-869e-ee6d1425ab9a-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/adaa1024-c57f-4d40-a77c-f90ae7657691-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/adaa1024-c57f-4d40-a77c-f90ae7657691-m1.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/adaa1024-c57f-4d40-a77c-f90ae7657691-m2.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/adaa1024-c57f-4d40-a77c-f90ae7657691-m3.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/adaa1024-c57f-4d40-a77c-f90ae7657691-m4.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/adaa1024-c57f-4d40-a77c-f90ae7657691-m5.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/adaa1024-c57f-4d40-a77c-f90ae7657691-m6.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/adaa1024-c57f-4d40-a77c-f90ae7657691-m7.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/bed8d569-0d51-49b8-ab45-90506fa8e225-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/c7835d36-f795-4972-b596-47207e01c4b3-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/d4c87db9-87f4-4a0c-86be-22b280415213-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/e06e486c-1679-4b8c-807e-f97771d2098e-m0.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-3955300550128988035-1-adaa1024-c57f-4d40-a77c-f90ae7657691.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-4323972595265181943-1-d4c87db9-87f4-4a0c-86be-22b280415213.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-6183377644092012057-1-c7835d36-f795-4972-b596-47207e01c4b3.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-653583197990088094-1-ab613eb0-2f90-4273-869e-ee6d1425ab9a.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-6908561599456501560-1-4a03f20d-a439-4f31-a903-7f3c6460918c.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-707189909035517389-1-e06e486c-1679-4b8c-807e-f97771d2098e.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-7224052145290180020-1-228ccff5-47ff-4253-94e9-eca15e40fac3.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-7609541883410176846-1-44a08557-5c09-45af-979c-a3f6bd20f73f.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-8234548320069527226-1-bed8d569-0d51-49b8-ab45-90506fa8e225.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-8447691896096706468-1-822c7500-d614-4362-9771-5a4d85fc8637.avro
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶] metadata/snap-8687338518067749463-1-7d48f2bc-3284-406d-ade6-a4acb3a449bf.avro</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a by-product of how Iceberg provides its rich functionality.
Iceberg has been designed and built so that it supports features such as <a href="https://iceberg.apache.org/docs/nightly/branching/">branching</a>, <a href="https://iceberg.apache.org/docs/nightly/evolution/">schema evolution</a>, <a href="https://iceberg.apache.org/docs/nightly/partitioning/#icebergs-hidden-partitioning">partitioning</a>, and <a href="https://trino.io/docs/current/connector/iceberg.html#time-travel-queries">time travel</a>.</p>
</div>
<div class="sect2">
<h3 id="_time_travel_in_iceberg">Time travel in Iceberg&nbsp;<a class="headline-hash" href="#_time_travel_in_iceberg">üîó</a> </h3>
<div class="paragraph">
<p>For example, I can query the table‚Äôs state as it was half an hour ago.
In this case, Iceberg uses these files to reconstruct the data and schema of a table at a given time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span> <span style="color: #f8f8f2">TIMESTAMP</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #66d9ef;font-weight: bold">OF</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">NOW</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f92672;font-weight: bold">-</span> <span style="color: #f8f8f2;background-color: #49483e">INTERVAL</span> <span style="color: #ae81ff">30</span> <span style="color: #f8f8f2;background-color: #49483e">MINUTES</span><span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">customer_id</th>
<th class="tableblock halign-left valign-top">first_name</th>
<th class="tableblock halign-left valign-top">last_name</th>
<th class="tableblock halign-left valign-top">email</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hermione</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Granger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:leviosaaaaa@hogwarts.edu">leviosaaaaa@hogwarts.edu</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skywalker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:rey@rebelscum.org">rey@rebelscum.org</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Time travel in Iceberg is based around the concept of snapshots.
We can look up the snapshot that was current at the point in time we‚Äôre querying (30 minutes ago, in this example):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f8f8f2;background-color: #49483e">manifest_list</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">snapshot_id</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">polaris</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">snapshots</span>
    <span style="color: #66d9ef;font-weight: bold">WHERE</span> <span style="color: #f8f8f2;background-color: #49483e">committed_at</span> <span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #f8f8f2;background-color: #49483e">NOW</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f92672;font-weight: bold">-</span> <span style="color: #f8f8f2;background-color: #49483e">INTERVAL</span> <span style="color: #ae81ff">30</span> <span style="color: #f8f8f2;background-color: #49483e">MINUTES</span>
    <span style="color: #66d9ef;font-weight: bold">ORDER</span> <span style="color: #66d9ef;font-weight: bold">BY</span> <span style="color: #f8f8f2;background-color: #49483e">committed_at</span> <span style="color: #66d9ef;font-weight: bold">ASC</span> <span style="color: #66d9ef;font-weight: bold">LIMIT</span> <span style="color: #ae81ff">1</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">manifest_list</th>
<th class="tableblock halign-left valign-top">snapshot_id</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">s3://warehouse/rmoff/customers/metadata/snap-707189909035517389-1-e06e486c-1679-4b8c-807e-f97771d2098e.avro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">707189909035517389</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <strong>manifest list</strong> for this snapshot holds the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">manifest_path</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">s3://warehouse/rmoff/customers/metadata/e06e486c-1679-4b8c-807e-f97771d2098e-m0.avro</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">manifest_length</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">7194</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partition_spec_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">content</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">min_sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added_snapshot_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">707189909035517389</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added_files_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">existing_files_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">deleted_files_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added_rows_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">existing_rows_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">deleted_rows_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partitions</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[]</span>
    <span style="color: #f8f8f2;background-color: #49483e">},</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key_metadata</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span>
<span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">manifest_path</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">s3://warehouse/rmoff/customers/metadata/ab613eb0-2f90-4273-869e-ee6d1425ab9a-m0.avro</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">manifest_length</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">7192</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partition_spec_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">content</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">min_sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added_snapshot_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">653583197990088094</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added_files_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">existing_files_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">deleted_files_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">added_rows_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">existing_rows_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">deleted_rows_count</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">partitions</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
        <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">array</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[]</span>
    <span style="color: #f8f8f2;background-color: #49483e">},</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">key_metadata</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The two referenced manifest files contain pointers to the data files:</p>
</div>
<div class="listingblock">
<div class="title"><code>e06e486c-1679-4b8c-807e-f97771d2098e-m0.avro</code></div>
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #f8f8f2;background-color: #49483e">{</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">status</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshot_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">long</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">707189909035517389</span>
  <span style="color: #f8f8f2;background-color: #49483e">},</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">file_sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">data_file</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">content</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">file_path</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">s3://warehouse/rmoff/customers/data/00000-8-b2dad931-1680-499f-894f-2d853aa523f9-0-00001.parquet</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">‚Ä¶</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>ab613eb0-2f90-4273-869e-ee6d1425ab9a-m0.avro</code></div>
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #f8f8f2;background-color: #49483e">{</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">status</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">snapshot_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">long</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">653583197990088094</span>
  <span style="color: #f8f8f2;background-color: #49483e">},</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">file_sequence_number</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">data_file</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">content</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">file_path</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">s3://warehouse/rmoff/customers/data/00000-0-e3b7a202-2481-4d9f-9b7c-9830908a425a-0-00001.parquet</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and then the data files:</p>
</div>
<div class="listingblock">
<div class="title"><code>00000-0-e3b7a202-2481-4d9f-9b7c-9830908a425a-0-00001.parquet</code></div>
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ customer_id ‚îÇ first_name ‚îÇ last_name ‚îÇ       email       ‚îÇ
‚îÇ    int64    ‚îÇ  varchar   ‚îÇ  varchar  ‚îÇ      varchar      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ      1      ‚îÇ Rey        ‚îÇ Skywalker ‚îÇ rey@rebelscum.org ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>00000-8-b2dad931-1680-499f-894f-2d853aa523f9-0-00001.parquet</code></div>
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ customer_id ‚îÇ first_name ‚îÇ last_name ‚îÇ          email           ‚îÇ
‚îÇ    int64    ‚îÇ  varchar   ‚îÇ  varchar  ‚îÇ         varchar          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ      2      ‚îÇ Hermione   ‚îÇ Granger   ‚îÇ leviosaaaaa@hogwarts.edu ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</code></pre>
</div>
</div>
<div class="paragraph">
<p>These two rows of data match what is shown in the <code>TIMESTAMP AS OF</code> time travel query above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ctrl_z_for_your_data_lakehouse">Ctrl-Z for your data lakehouse&nbsp;<a class="headline-hash" href="#_ctrl_z_for_your_data_lakehouse">üîó</a> </h3>
<div class="paragraph">
<p>Since Iceberg builds these layers of data and metadata for a table over time, it means that you can also rollback the table to one of its former states.
To do this Iceberg simply changes the pointer of the current snapshot to a previous one.</p>
</div>
<div class="paragraph">
<p>Both <a href="https://iceberg.apache.org/docs/nightly/spark-procedures/#rollback_to_snapshot">Spark</a> and <a href="https://trino.io/docs/current/connector/iceberg.html#rolling-back-to-a-previous-snapshot">Trino</a> provide <code>rollback_to_snapshot</code>.
The joy of open standards is that even if you‚Äôre using an engine for your Iceberg work that has not implemented this feature, you can just use one that has for this operation alone, and then go back to your other one as normal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #75715e;font-style: italic">-- uh oh, someone forgot a predicate</span>
<span style="color: #66d9ef;font-weight: bold">DELETE</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">CALL</span> <span style="color: #f8f8f2;background-color: #49483e">polaris</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #66d9ef;font-weight: bold">system</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">rollback_to_snapshot</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;rmoff.customers&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">707189909035517389</span><span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code> customer_id | first_name | last_name |          email           | phone
-------------+------------+-----------+--------------------------+-------
           1 | Rey        | Skywalker | rey@rebelscum.org        | NULL
           2 | Hermione   | Granger   | leviosaaaaa@hogwarts.edu | NULL</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sodoesnt_this_get_messy">So‚Ä¶doesn‚Äôt this get messy?&nbsp;<a class="headline-hash" href="#_sodoesnt_this_get_messy">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Well, yes.
Particularly if you think that typically for every commit to Iceberg, a new data file is written.
That data file could be thousands of records; it could also be one.</p>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the source of your data coming into Iceberg is a streaming platform (such as Kafka Connect) then it‚Äôs more likely you could end up with smaller files if the volume of ingest is much lower than the rate.
That is to say, if you want to be able to read the data sooner, you‚Äôll set the commit period shorter.
But the tradeoff of a shorter commit time is that you‚Äôre going to end up with lots of smaller data files, unless you have large volumes of data coming in during that period.</p>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>We can look at the metadata about the files and compare the number of data files to the <code>record_count</code> across them all:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">trino</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">data_file_ct</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">SUM</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">record_count</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">record_ct</span>
                <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2">&#34;customers$files&#34;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
 <span style="color: #f8f8f2;background-color: #49483e">data_file_ct</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">record_ct</span>
<span style="color: #75715e;font-style: italic">--------------+-----------</span>
           <span style="color: #ae81ff">1</span>  <span style="color: #f92672;font-weight: bold">|</span>        <span style="color: #ae81ff">3</span>
<span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span><span style="color: #f8f8f2;background-color: #49483e">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that the table has one data file, holding three records.</p>
</div>
<div class="paragraph">
<p>If I run five separate <code>INSERT</code> s, each of one row, we‚Äôll find we end up adding five data files, for just five records</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">trino</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">data_file_ct</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">SUM</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">record_count</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">record_ct</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2">&#34;customers$files&#34;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
 <span style="color: #f8f8f2;background-color: #49483e">data_file_ct</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">record_ct</span>
<span style="color: #75715e;font-style: italic">--------------+-----------</span>
           <span style="color: #ae81ff">6</span>  <span style="color: #f92672;font-weight: bold">|</span>        <span style="color: #ae81ff">8</span>
<span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span><span style="color: #f8f8f2;background-color: #49483e">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These small files can cause challenges in several aspects, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Performance overhead of metadata management</p>
</li>
<li>
<p>Object store access request costs (more files == more requests)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To address these problems Iceberg has several housekeeping functions.
As with the rollback procedure above, not all engines provide them.
In Iceberg, Spark usually has the <a href="https://iceberg.apache.org/docs/nightly/spark-procedures/">best support</a>, and that‚Äôs the case here.
Trino provides <a href="https://trino.io/docs/current/connector/iceberg.html#optimize">capabilities</a> in this area too.
Flink has a <a href="https://iceberg.apache.org/docs/nightly/flink-actions/#rewrite-files-action"><code>RewriteDataFilesAction</code></a> but this isn‚Äôt exposed in Flink SQL.</p>
</div>
<div class="sect2">
<h3 id="_combining_data_files_into_fewer_data_files">Combining data files into fewer data files&nbsp;<a class="headline-hash" href="#_combining_data_files_into_fewer_data_files">üîó</a> </h3>
<div class="paragraph">
<p>Trino provides <a href="https://trino.io/docs/current/connector/iceberg.html#optimize"><code>ALTER TABLE‚Ä¶EXECUTE optimize</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">trino</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">ALTER</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span> <span style="color: #66d9ef;font-weight: bold">EXECUTE</span> <span style="color: #f8f8f2;background-color: #49483e">optimize</span><span style="color: #f8f8f2;background-color: #49483e">;</span>

<span style="color: #f8f8f2;background-color: #49483e">trino</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">data_file_ct</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">SUM</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">record_count</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">record_ct</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2">&#34;customers$files&#34;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
 <span style="color: #f8f8f2;background-color: #49483e">data_file_ct</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">record_ct</span>
<span style="color: #75715e;font-style: italic">--------------+-----------</span>
            <span style="color: #ae81ff">1</span> <span style="color: #f92672;font-weight: bold">|</span>         <span style="color: #ae81ff">8</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the data file count is now one, whilst the record count is still eight.</p>
</div>
<div class="paragraph">
<p>I‚Äôll add a few more small files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">trino</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">data_file_ct</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">SUM</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">record_count</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">record_ct</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2">&#34;customers$files&#34;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
 <span style="color: #f8f8f2;background-color: #49483e">data_file_ct</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">record_ct</span>
<span style="color: #75715e;font-style: italic">--------------+-----------</span>
            <span style="color: #ae81ff">6</span> <span style="color: #f92672;font-weight: bold">|</span>        <span style="color: #ae81ff">13</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and then use Spark‚Äôs <a href="https://iceberg.apache.org/docs/nightly/spark-procedures/#rewrite_data_files"><code>rewrite_data_files</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">CALL</span> <span style="color: #f8f8f2;background-color: #49483e">polaris</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #66d9ef;font-weight: bold">system</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">rewrite_data_files</span>
    <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">table</span> <span style="color: #f92672;font-weight: bold">=&gt;</span> <span style="color: #e6db74">&#39;rmoff.customers&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #66d9ef;font-weight: bold">options</span> <span style="color: #f92672;font-weight: bold">=&gt;</span> <span style="color: #66d9ef;font-weight: bold">map</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;rewrite-all&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;true&#39;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
    <span style="color: #f8f8f2;background-color: #49483e">)</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
<col style="width: 25%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">rewritten_data_files_count</th>
<th class="tableblock halign-left valign-top">added_data_files_count</th>
<th class="tableblock halign-left valign-top">rewritten_bytes_count</th>
<th class="tableblock halign-left valign-top">failed_data_files_count</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7757</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">data_file_ct</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">SUM</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">record_count</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">record_ct</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">polaris</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">files</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">data_file_ct</th>
<th class="tableblock halign-left valign-top">record_ct</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_expiring_snapshots">Expiring snapshots&nbsp;<a class="headline-hash" href="#_expiring_snapshots">üîó</a> </h3>
<div class="paragraph">
<p>Being able to roll back a table‚Äôs state, or query it at a particular point in time, is rather useful‚Äîbut do you need <em>all</em> of those snapshots?
A snapshot is created for each change to the table meaning that you can end up with rather a lot of them.</p>
</div>
<div class="paragraph">
<p>To clean up snapshots you can use <a href="https://iceberg.apache.org/docs/nightly/spark-procedures/#expire_snapshots"><code>expire_snapshots</code></a> (Spark) or <a href="https://trino.io/docs/current/connector/iceberg.html#expire-snapshots"><code>ALTER TABLE ‚Ä¶ EXECUTE expire_snapshots</code></a> (Trino):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">trino</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2">&#34;customers$snapshots&#34;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
        <span style="color: #f8f8f2;background-color: #49483e">committed_at</span>         <span style="color: #f92672;font-weight: bold">|</span>     <span style="color: #f8f8f2;background-color: #49483e">snapshot_id</span>     <span style="color: #f92672;font-weight: bold">|</span>      <span style="color: #f8f8f2;background-color: #49483e">parent_id</span>      <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">operation</span>
<span style="color: #75715e;font-style: italic">-----------------------------+---------------------+---------------------+-----------</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">37</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">31</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">531</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2403840741999442414</span> <span style="color: #f92672;font-weight: bold">|</span>                <span style="color: #66d9ef;font-weight: bold">NULL</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">37</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">38</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">926</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">3830932525036690208</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2403840741999442414</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">37</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">39</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">916</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">6409867327989167022</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">3830932525036690208</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">37</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">40</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">921</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span>  <span style="color: #ae81ff">325546929694535411</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">6409867327989167022</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">37</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">41</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">808</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span>  <span style="color: #ae81ff">269825382665437490</span> <span style="color: #f92672;font-weight: bold">|</span>  <span style="color: #ae81ff">325546929694535411</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">37</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">42</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">757</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span>  <span style="color: #ae81ff">129306070246549703</span> <span style="color: #f92672;font-weight: bold">|</span>  <span style="color: #ae81ff">269825382665437490</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">40</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">290</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">8861050211953882166</span> <span style="color: #f92672;font-weight: bold">|</span>  <span style="color: #ae81ff">129306070246549703</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">replace</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">42</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">07</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">828</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2371922233042001406</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">8861050211953882166</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">42</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">08</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">031</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">5882833294520864762</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2371922233042001406</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">42</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">08</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">230</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2961764211154500616</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">5882833294520864762</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">42</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">08</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">407</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">6373025590410861521</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2961764211154500616</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">42</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">08</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">600</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2039216781855207414</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">6373025590410861521</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">append</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">44</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">42</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">232</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">4056286565502898119</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2039216781855207414</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">replace</span>
<span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">13</span> <span style="color: #66d9ef;font-weight: bold">rows</span><span style="color: #f8f8f2;background-color: #49483e">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">trino</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">SET</span> <span style="color: #66d9ef;font-weight: bold">SESSION</span> <span style="color: #f8f8f2;background-color: #49483e">iceberg</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">expire_snapshots_min_retention</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;30s&#39;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>

<span style="color: #f8f8f2;background-color: #49483e">trino</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">ALTER</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span> <span style="color: #66d9ef;font-weight: bold">EXECUTE</span> <span style="color: #f8f8f2;background-color: #49483e">expire_snapshots</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">retention_threshold</span> <span style="color: #f92672;font-weight: bold">=&gt;</span> <span style="color: #e6db74">&#39;60 s&#39;</span><span style="color: #f8f8f2;background-color: #49483e">);</span>

<span style="color: #f8f8f2;background-color: #49483e">trino</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2;background-color: #49483e">rmoff</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2">&#34;customers$snapshots&#34;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
        <span style="color: #f8f8f2;background-color: #49483e">committed_at</span>         <span style="color: #f92672;font-weight: bold">|</span>     <span style="color: #f8f8f2;background-color: #49483e">snapshot_id</span>     <span style="color: #f92672;font-weight: bold">|</span>      <span style="color: #f8f8f2;background-color: #49483e">parent_id</span>      <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">operation</span>
<span style="color: #75715e;font-style: italic">-----------------------------+---------------------+---------------------+-----------</span>
 <span style="color: #ae81ff">2025</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">14</span> <span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">44</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">42</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">232</span> <span style="color: #f8f8f2;background-color: #49483e">UTC</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">4056286565502898119</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2039216781855207414</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">replace</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_table_maintenance_options">Other table maintenance options&nbsp;<a class="headline-hash" href="#_other_table_maintenance_options">üîó</a> </h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apache_amoro">Apache Amoro&nbsp;<a class="headline-hash" href="#_apache_amoro">üîó</a> </h3>
<div class="paragraph">
<p><a href="https://amoro.apache.org/">Apache Amoro</a> (incubating) is a new project that offers an Iceberg catalog with <a href="https://amoro.apache.org//quick-start/#check-self-optimizing">built-in optimisation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_aws">AWS&nbsp;<a class="headline-hash" href="#_aws">üîó</a> </h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-tables.html">S3 Tables</a> supports <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/s3-tables-maintenance.html">built-in table maintenance</a>.</p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/glue/latest/dg/populate-otf.html">AWS Glue Data Catalog</a> provides <a href="https://docs.aws.amazon.com/glue/latest/dg/enable-compaction.html">compaction</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_nimtable">Nimtable&nbsp;<a class="headline-hash" href="#_nimtable">üîó</a> </h3>
<div class="paragraph">
<p><a href="https://github.com/nimtable/nimtable">Nimtable</a> is an Apache 2.0 licensed project that was released around June this year.
It offers table compaction as part of its offering as a &#34;Control Plane for Apache Iceberg&#34;.</p>
</div>
<div class="paragraph">
<p>Once you‚Äôve connected it to an existing catalog (such as Polaris) it shows you the contents of the catalog:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/07/2025-07-15T14-13-38-360Z.png" alt="2025 07 15T14 13 38 360Z"/>
</div>
</div>
<div class="paragraph">
<p>It analyses the tables (presumably using similar heuristics as described above) to identify if they need optimising, and provides details of its analysis too:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/07/2025-07-15T14-15-56-975Z.png" alt="2025 07 15T14 15 56 975Z"/>
</div>
</div>
<div class="paragraph">
<p>There‚Äôs also the obligatory <del>magic fairy dust</del> AI sprinkled onto it which puts the analysis into words.</p>
</div>
<div class="paragraph">
<p>As well as the textual analysis there‚Äôs a nice visualisation showing the rate of growth over time, broken down by type of change (insert/update/delete)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/07/2025-07-15T14-18-23-597Z.png" alt="2025 07 15T14 18 23 597Z"/>
</div>
</div>
<div class="paragraph">
<p>For tables that do need optimising you can run a one-off job, or set it to run on a schedule</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/07/2025-07-15T14-18-47-488Z.png" alt="2025 07 15T14 18 47 488Z"/>
</div>
</div>
<div class="paragraph">
<p>Finally, it also includes a SQL editor which is a nice touch.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2025/07/2025-07-15T14-24-19-915Z.png" alt="2025 07 15T14 24 19 915Z"/>
</div>
</div>
<div class="paragraph">
<p>I‚Äôve only had a quick poke around, but the UI is nice and the analysis definitely useful to have.
And whilst I‚Äôve not tried it, if it behaves as claimed, the automatic optimisation could be a really nice tool if you‚Äôre self-managing your Iceberg files.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_reading">Further reading&nbsp;<a class="headline-hash" href="#_further_reading">üîó</a> </h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.tabular.io/apache-iceberg-cookbook/data-operations-compaction/">File compaction - Tabular</a></p>
</li>
<li>
<p><a href="https://dev.to/thedanicafine/the-apache-iceberg-small-file-problem-1k2m">The Apache Iceberg‚Ñ¢ Small File Problem - Danica Fine</a></p>
</li>
<li>
<p><a href="https://www.dremio.com/blog/compaction-in-apache-iceberg-fine-tuning-your-iceberg-tables-data-files/">Compaction in Apache Iceberg: Fine-Tuning Your Iceberg Table‚Äôs Data Files - Alex Merced</a></p>
</li>
<li>
<p><a href="https://medium.com/ancestry-product-and-technology/solving-the-small-file-problem-in-iceberg-tables-6c31a295f724">Solving the Small File Problem in Iceberg Tables - Thomas Cardenas</a></p>
</li>
<li>
<p><a href="https://www.oreilly.com/library/view/apache-iceberg-the/9781098148614/ch04.html">Apache Iceberg: The Definitive Guide - Chapter 4. Optimizing the Performance of Iceberg Tables</a></p>
</li>
<li>
<p><a href="https://www.starburst.io/blog/apache-iceberg-files/">The file explosion problem in Apache Iceberg and what to do when it happens to you - Daniel Abadi</a></p>
</li>
</ul>
</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_do_try_this_at_home">Do try this at home!</a></li>
    <li><a href="#_what_happens_when_you_write_data_to_iceberg">What happens when you write data to Iceberg?</a></li>
    <li><a href="#_data_about_the_metadata">Data about the metadata</a></li>
    <li><a href="#_why_all_these_files">Why all these files?</a>
      <ul>
        <li><a href="#_time_travel_in_iceberg">Time travel in Iceberg</a></li>
        <li><a href="#_ctrl_z_for_your_data_lakehouse">Ctrl-Z for your data lakehouse</a></li>
      </ul>
    </li>
    <li><a href="#_sodoesnt_this_get_messy">So‚Ä¶doesn‚Äôt this get messy?</a>
      <ul>
        <li><a href="#_combining_data_files_into_fewer_data_files">Combining data files into fewer data files</a></li>
        <li><a href="#_expiring_snapshots">Expiring snapshots</a></li>
      </ul>
    </li>
    <li><a href="#_other_table_maintenance_options">Other table maintenance options</a>
      <ul>
        <li><a href="#_apache_amoro">Apache Amoro</a></li>
        <li><a href="#_aws">AWS</a></li>
        <li><a href="#_nimtable">Nimtable</a></li>
      </ul>
    </li>
    <li><a href="#_further_reading">Further reading</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
