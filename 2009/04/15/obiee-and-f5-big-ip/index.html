<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>OBIEE and F5 BIG-IP</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2009/04/15/obiee-and-f5-big-ip/">
		
		
		
		<meta name="generator" content="Hugo 0.85.0" />

		
		<meta property="og:title" content="OBIEE and F5 BIG-IP" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/img/default-header-img.jpg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2009/04/15/obiee-and-f5-big-ip/" />
		<meta property="og:site_name" content="OBIEE and F5 BIG-IP" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/img/default-header-img.jpg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">OBIEE and F5 BIG-IP</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2009-04-15T00:00:00Z">Apr 15, 2009</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/apache" class="no-underline category near-white dim">Apache</a>, <a href="https://rmoff.net/categories/load-balancing" class="no-underline category near-white dim">Load-Balancing</a>, <a href="https://rmoff.net/categories/oas" class="no-underline category near-white dim">Oas</a>, <a href="https://rmoff.net/categories/obiee" class="no-underline category near-white dim">Obiee</a>
								<span class="display-print">at https://rmoff.net/2009/04/15/obiee-and-f5-big-ip/</span>
							
						
					</h2>
				</div>

				
				
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw7">
	<p>We&rsquo;ve got a setup of two OAS/Presentation Services boxes and two BI Server boxes, with load balancing/failover throughout.<br>
The Load Balancing of the web requests is being done through a separate bit of kit, an F5 BIG-IP load balancer. This directs the requests at the two OAS servers.</p>
<p>The problem we have is that by default OAS serves HTTP on port 7777, but the F5 is using port 80. A request for our load balanced URL: <a href="http://bi.mycompany.com/analytics/">http://bi.mycompany.com/analytics/</a> barfs out with</p>
<blockquote>
<p>Internet Explorer cannot display the webpage</p>
<p>Most likely causes:<br>
-You are not connected to the Internet.<br>
-The website is encountering problems.<br>
-There might be a typing error in the address.</p>
</blockquote>
<p>or in FireFox:</p>
<blockquote>
<p>Failed to Connect The connection was refused when attempting to contact bi.mycompany.com:7777. Though the site seems valid, the browser was unable to establish a connection.</p>
</blockquote>
<p>Using the excellent <a href="https://addons.mozilla.org/en-US/firefox/addon/6647">HttpFox add-in</a> for Firefox I could see the HTTP requests/responses:</p>
<ol>
<li><a href="http://bi.mycompany.com/analytics/">http://bi.mycompany.com/analytics/</a> goes via the loadbalancer on the default HTTP port 80 to OAS</li>
<li>OAS responds with HTTP/1.1 302 Moved Temporarily to <a href="http://bi.mycompany.com:7777/analytics/saw.dll?Dashboard">http://bi.mycompany.com:7777/analytics/saw.dll?Dashboard</a></li>
<li>The web client requests this URL (<a href="http://bi.mycompany.com:7777/analytics/saw.dll?Dashboard">http://bi.mycompany.com:7777/analytics/saw.dll?Dashboard</a>) from the load balancer but because it&rsquo;s port 7777 F5 rejects the request (NS_ERROR_CONNECTION_REFUSED)</li>
</ol>
<p>We could also just use the direct URL <a href="http://bi.mycompany.com/analytics/saw.dll?Dashboard">http://bi.mycompany.com/analytics/saw.dll?Dashboard</a> but this is hardly user friendly (and also means that if they typo when entering it they&rsquo;ll get an unhelpful error as above)</p>
<p>Looking at the httpd.conf for Apache to find the port config made me think of the UseCanonicalName setting which I also <a href="http://rnm1978.blogspot.com/2009/04/oas-makes-you-log-in-twice.html">encountered recently</a>. This setting is to do with how Apache deals with the server name in the URL being requested and the hostname of the server configured in Apache.<br>
When I got the behaviour described above UseCanonicalName was set to Off, which I think means Apache does not rewrite the URL at all, so the redirect was to <a href="http://bi.mycompany.com:7777/analytics/saw.dll?Dashboard">http://bi.mycompany.com:7777/analytics/saw.dll?Dashboard</a> which is the F5 Load Balancer address.<br>
If I changed UseCanonicalName to On then the F5 load balancing starts to work, as this happens instead:</p>
<ol>
<li><a href="http://bi.mycompany.com/analytics/">http://bi.mycompany.com/analytics/</a> goes via the loadbalancer on the default HTTP port 80 to OAS</li>
<li>OAS responds with HTTP/1.1 302 Moved Temporarily to http://oasserver_1.mycompany.com:7777/analytics/saw.dll?Dashboard</li>
</ol>
<p>i.e. the request goes directly to one of the load balanced servers, and correctly on port 7777.
The disadvantage of this is that the URL used by the web client then becomes http://oasserver_1.mycompany.com which means the user is no longer hitting the load balancer so any failover wouldn&rsquo;t get picked up. It also means that users might start bookmarking OAS servers directly instead of the load balancer, again meaning that they don&rsquo;t hit the load balancer so a server failover wouldn&rsquo;t get picked up.</p>
<p>Eventually I got this resolved, with a bit of help from a very helpful chap at Oracle. By changing the httpd.conf to set Port 80, when Apache rewrites URLs it now uses Port 80.
Listen remains as 7777.
Traffic from web client now hits the LB on port 80, which forwards to 7777 on one of the OAS servers, which if necessary rewrite the URL and use port 80 in the rewrite.<br>
Because Listen remains as 7777 there is no need to run Apache as root.<br>
You can also set ServerName to the load balancer address (bi.mycompany.com) and UseCanonicalName to On. If you do this then I don&rsquo;t think it&rsquo;s possible to access web pages on a specific OAS server (eg oasserver_1) because entering http://oasserver_1.mycompany.com:7777/analytics just redirects to bi.mycompany.com/analytics.</p>
<p>Ref: <a href="http://www.f5.com/pdf/deployment-guides/f5-oracle10g-dg.pdf">Deploying F5 with Oracle Application Server 10g</a><br>
Ref: <a href="http://www.blogger.com/Default%20page%20%28bi.morrisonsplc.co.uk/%29%20is%20OAS%20homepage.%20%20Should%20we%20amend%20this%20to%20be%20a%20redirect%20to%20/analytics?%20Will%20the%20only%20access%20be%20via%20ebiz%20%28and%20thus%20direct%20URL%29?%20/app/oracle/product/OAS_1013/Apache/Apache/htdocs/index.html.en">Oracle HTTP Server - Port setting</a><br>
Ref: Metalink 301755.1 - What Is the Difference Between Port &amp; Listen In Httpd.Conf</p>

</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><a href="https://www.youtube.com/c/rmoff"><b class="fab fa-youtube-square"></b></a> <a href="https://www.linkedin.com/in/robinmoffatt/"><b class="fab fa-linkedin"></b></a> <em>Robin Moffatt is a Principal Developer Advocate at Confluent, and an Oracle ACE Director (Alumnus). He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2022 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
