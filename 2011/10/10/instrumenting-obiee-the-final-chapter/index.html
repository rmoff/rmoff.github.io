<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/img/default-header-img.webp" type="image/webp">
		
		<title>Instrumenting OBIEE - the final chapter</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2011/10/10/instrumenting-obiee-the-final-chapter/">
		
		

		
		<meta property="og:title" content="Instrumenting OBIEE - the final chapter" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/img/default-header-img.jpg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2011/10/10/instrumenting-obiee-the-final-chapter/" />
		<meta property="og:site_name" content="Instrumenting OBIEE - the final chapter" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/img/default-header-img.webp');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Instrumenting OBIEE - the final chapter</h1>
			<p class="article-hero-meta">
				
					<time datetime="2011-10-10T00:00:00Z">10 Oct 2011</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/dbms_application_info">dbms_application_info</a>, <a href="https://rmoff.net/categories/dbms_session">dbms_session</a>, <a href="https://rmoff.net/categories/monitoring">monitoring</a>, <a href="https://rmoff.net/categories/obiee">OBIEE</a>, <a href="https://rmoff.net/categories/performance">performance</a>, <a href="https://rmoff.net/categories/systemsmanagement">systemsmanagement</a>
					<span class="display-print">at https://rmoff.net/2011/10/10/instrumenting-obiee-the-final-chapter/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#this-article-has-been-superseded-by-a-newer-version"><em><strong>This article has been superseded by a newer version:Â Instrumenting OBIEE Database Connections For Improved Performance Diagnostics</strong></em></a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#the-problem">The Problem</a></li>
    <li><a href="#the-solution">The solution</a></li>
    <li><a href="#implementing-it---overview">Implementing it - overview</a></li>
    <li><a href="#implementing-it---init-block-and-dummy-variables">Implementing it - Init Block and Dummy Variables</a>
      <ul>
        <li><a href="#summary-1">Summary:</a></li>
        <li><a href="#step-by-step">Step-by-step</a></li>
      </ul>
    </li>
    <li><a href="#implementing-it---connection-pool">Implementing it - connection pool</a></li>
    <li><a href="#testing-the-changes">Testing the changes</a></li>
    <li><a href="#not-a-fan-of-sqlplus">Not a fan of sql*plus?</a></li>
    <li><a href="#warning">Warning</a></li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">dbms_application_info</span><span data-pagefind-filter="category" style="display:none">dbms_session</span><span data-pagefind-filter="category" style="display:none">monitoring</span><span data-pagefind-filter="category" style="display:none">OBIEE</span><span data-pagefind-filter="category" style="display:none">performance</span><span data-pagefind-filter="category" style="display:none">systemsmanagement</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/img/default-header-img.jpg" style="display:none" alt="">
	<p>Â </p>
<hr>
<p>Â </p>
<h3 id="this-article-has-been-superseded-by-a-newer-version"><em><strong>This article has been superseded by a newer version:Â <a href="http://www.rittmanmead.com/2015/03/instrumenting-obiee-database-connections-for-improved-performance-diagnostics/">Instrumenting OBIEE Database Connections For Improved Performance Diagnostics</a></strong></em>&nbsp;<a class="headline-hash" href="#this-article-has-been-superseded-by-a-newer-version">ðŸ”—</a> </h3>
<hr>
<p>Â </p>
<p>(<em>Previously on this blog: <a href="/2010/01/26/identify-your-obiee-users-by-setting-client-id-in-oracle-connection/">1</a>, <a href="/2011/02/02/instrumenting-obiee-for-tracing-oracle-db-calls/">2</a>, <a href="/2011/08/08/have-you-defined-client_id-in-obiee-yet/">3</a>&hellip;</em>)</p>
<h2 id="summary">Summary&nbsp;<a class="headline-hash" href="#summary">ðŸ”—</a> </h2>
<p>Instrument your code. Stop guessing. Make your DBA happy. Make your life as a BI Admin easier.</p>
<h2 id="the-problem">The Problem&nbsp;<a class="headline-hash" href="#the-problem">ðŸ”—</a> </h2>
<p>OBIEE will typically connect to the database using a generic application account. (Hopefully, you&rsquo;ll have isolated it to an account used only for this purpose - if you haven&rsquo;t, you should.)</p>
<p>The problem is that you lose a lot of visibility of work both up and down the stack.</p>
<ul>
<li>An OBIEE query is causing a problem on the database - <strong>how do you identify the originator</strong>?</li>
<li>You want to investigate the performance of an OBIEE query, but <strong>how do you identify which DB session it is</strong>?</li>
</ul>
<p><img src="/images/rnm1978/2011-10-10_1032_-0000.png" alt="" title="2011-10-10_1032_ 0000"> We know SID 491 is causing a problem, but how do we identify the originating OBIEE user?</p>
<p>You <strong>could</strong> start piecing together Usage Tracking and NQQuery.log files, but it&rsquo;s hardly convenient or instantaneous is it?</p>
<h2 id="the-solution">The solution&nbsp;<a class="headline-hash" href="#the-solution">ðŸ”—</a> </h2>
<p>By taking advantage of native Oracle procedures, we can instrument our OBIEE code to pass through lots of valuable information:</p>
<p><img src="/images/rnm1978/2011-10-10_1033_-0001.png" alt="" title="2011-10-10_1033_ 0001"> Now we can see which OBIEE user fired the query resulting in SID 491, and not only the user, but the dashboard and request name they are running.</p>
<p>This works in both OBIEE 10g and 11g.</p>
<p>See <a href="/2011/02/02/instrumenting-obiee-for-tracing-oracle-db-calls/">my previous post here for further background</a>, and discussion of the procedures used.</p>
<h2 id="implementing-it---overview">Implementing it - overview&nbsp;<a class="headline-hash" href="#implementing-it---overview">ðŸ”—</a> </h2>
<p>In essence, we harness internal OBIEE session variables which hold the user ID, name, dashboard and report name. We put a set of database calls on the connection pool(s) associated with query requests.</p>
<p>We have to do a bit of trickery to work around two issues.</p>
<p>Firstly, the variables may not be set (you may not have saved your new request yet, or may be running it outside of a dashboard). To get around this, we create two dummy session variables with the same names, and populate them with dummy init blocks.</p>
<p>Secondly, there is a limitation to the number of characters that can be passed through, and so we manipulate the string if necessary to use the right-most characters.</p>
<h2 id="implementing-it---init-block-and-dummy-variables">Implementing it - Init Block and Dummy Variables&nbsp;<a class="headline-hash" href="#implementing-it---init-block-and-dummy-variables">ðŸ”—</a> </h2>
<h3 id="summary-1">Summary:&nbsp;<a class="headline-hash" href="#summary-1">ðŸ”—</a> </h3>
<p>Create two init block/session variable pairs:</p>
<p><img src="/images/rnm1978/2011-10-10_1145_-0000.png" alt="" title="2011-10-10_1145_ 0000"> Session Variables</p>
<p><img src="/images/rnm1978/2011-10-10_1145_-0001.png" alt="" title="2011-10-10_1145_ 0001"> Initialisation Blocks</p>
<p>Be sure to use a connection pool which isn&rsquo;t used for queries.</p>
<h3 id="step-by-step">Step-by-step&nbsp;<a class="headline-hash" href="#step-by-step">ðŸ”—</a> </h3>
<p>Load up your RPD. If you haven&rsquo;t already, create a new connection pool that is just for these init blocks. It can be to any database - in the examples below it&rsquo;s an Oracle one, but any that supports selecting from a dummy table like DUAL in Oracle.</p>
<p>Go to Manage -&gt; Variables, click on Session -&gt; Initialisation Blocks. Right click in the section to the right, and select New Initialization Block. <img src="/images/rnm1978/2011-10-10_1051_-0000.png" alt="" title="2011-10-10_1051_ 0000"></p>
<p>Call the init block Dummy_SawSrcPath_InitBlock, and then click on &ldquo;Edit Data Source&rdquo;<img src="/images/rnm1978/2011-10-10_1053_-0000.png" alt="" title="2011-10-10_1053_ 0000"></p>
<p>Set the Data Source Type to Database, and the init string to</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;[unsaved request]&#39;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>dual<span style="color:#bbb">
</span></span></span></code></pre></div><p>Click on Browse to set the Connection Pool used. The connection pool should be one exclusively for init blocks (not the same you use for queries). If you try to use the same connection pool as for queries, you&rsquo;ll most likely get an error when you logon.</p>
<p>Once you&rsquo;ve set the connection pool, click on Test - you should get a result as shown: <img src="/images/rnm1978/2011-10-10_1125_-0000.png" alt="" title="2011-10-10_1125_ 0000"></p>
<p>If the Test doesn&rsquo;t succeed then you need to fix the problem before you continue.</p>
<p>Assuming it&rsquo;s worked, click OK to return to the Init Block creation window. We now want to define the dummy variable, so to do so click on &ldquo;Edit Data Target&rdquo;: <img src="/images/rnm1978/2011-10-10_1129_-0000.png" alt="" title="2011-10-10_1129_ 0000"> Click on New to create a new variable, and give it the name SAW_SRC_PATH. Make sure you get the name exactly correct, no typos. Give it a default initializer, and then click OK. <img src="/images/rnm1978/2011-10-10_1132_-0000.png" alt="" title="2011-10-10_1132_ 0000"> Make sure your init block setup now looks like this: <img src="/images/rnm1978/2011-10-10_1137_-0000.png" alt="" title="2011-10-10_1137_ 0000"> Click on Test, and expect to get this returned: <img src="/images/rnm1978/2011-10-10_1140_-0000.png" alt="" title="2011-10-10_1140_ 0000"> Assuming it works, then click OK to save the new Init Block and Variable.</p>
<p>Repeat as above to create an init block/variable pair for SAW_DASHBOARD, looking like this: <img src="/images/rnm1978/2011-10-10_1142_-0000.png" alt="" title="2011-10-10_1142_ 0000"></p>
<p>When you&rsquo;ve finished, you should have two init block/variables pairs set up like this:</p>
<p><img src="/images/rnm1978/2011-10-10_1145_-0000.png" alt="" title="2011-10-10_1145_ 0000"> Session Variables</p>
<p><img src="/images/rnm1978/2011-10-10_1145_-0001.png" alt="" title="2011-10-10_1145_ 0001"> Initialisation Blocks</p>
<h2 id="implementing-it---connection-pool">Implementing it - connection pool&nbsp;<a class="headline-hash" href="#implementing-it---connection-pool">ðŸ”—</a> </h2>
<p>Add these three SQL statements to the &ldquo;Execute before query&rdquo; of &ldquo;Connection Scripts&rdquo; of each Connection Pool which is used for queries. Do not add them to ones which are used for init blocks / authentication etc.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">call</span><span style="color:#bbb"> </span>dbms_application_info.set_client_info(client_info<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;VALUEOF(NQ_SESSION.DISPLAYNAME)&#39;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">call</span><span style="color:#bbb"> </span>dbms_session.set_identifier(<span style="color:#ba2121">&#39;VALUEOF(NQ_SESSION.USER)&#39;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">call</span><span style="color:#bbb"> </span>dbms_application_info.set_module(module_name<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;OBIEE: &#39;</span><span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">case</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">when</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">length</span>(<span style="color:#ba2121">&#39;VALUEOF(NQ_SESSION.SAW_DASHBOARD)&#39;</span>)<span style="color:#008000;font-weight:bold">case</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">when</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">length</span>(<span style="color:#ba2121">&#39;VALUEOF(NQ_SESSION.SAW_SRC_PATH)&#39;</span>)<span style="color:#666">&lt;</span><span style="color:#666">31</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">then</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;VALUEOF(NQ_SESSION.SAW_SRC_PATH)&#39;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">else</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;...&#39;</span><span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span>substr(<span style="color:#ba2121">&#39;VALUEOF(NQ_SESSION.SAW_SRC_PATH)&#39;</span>,<span style="color:#666">-</span><span style="color:#666">28</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">end</span>);<span style="color:#bbb">
</span></span></span></code></pre></div><p><img src="/images/rnm1978/2011-10-10_1156_-0000.png" alt="" title="2011-10-10_1156_ 0000"></p>
<p>This sets values as follows:</p>
<ul>
<li><strong>Client Identifier</strong> is the OBIEE login <strong>user id</strong></li>
<li><strong>Client Info</strong> is the user&rsquo;s <strong>display name.</strong></li>
<li><strong>Module</strong> and <strong>Action</strong> are populated with the <strong>dashboard</strong> name (prefixed by &ldquo;OBIEE&rdquo;) and <strong>report</strong> names respectively, truncated to the left if necessary to fit into the field size.</li>
</ul>
<p>NB CLIENT_IDENTIFIER and CLIENT_INFO have a larger capacity so could be used if you want to view more of the report/dashboard detail:</p>
<pre tabindex="0"><code>V$SESSION column      Max value length
MODULE                47
ACTION                31
CLIENT_INFO           63
CLIENT_IDENTIFIER     63
</code></pre><p>Reference: <a href="http://download.oracle.com/docs/cd/B28359_01/appdev.111/b28419/d_appinf.htm#i999290">DBMS_APPLICATION_INFO</a> <a href="http://download.oracle.com/docs/cd/B28359_01/appdev.111/b28419/d_sessio.htm#ARPLS054">DBMS_SESSION</a></p>
<h2 id="testing-the-changes">Testing the changes&nbsp;<a class="headline-hash" href="#testing-the-changes">ðŸ”—</a> </h2>
<p>If you&rsquo;re currently logged into Answers, logout and log back in. This is necessary for the dummy session variables to populate.</p>
<p>Run this sql*plus SQL script below to look at any existing OBIEE queries running on the database.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>linesize<span style="color:#bbb"> </span><span style="color:#666">170</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>col<span style="color:#bbb"> </span>program<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a30<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>col<span style="color:#bbb"> </span>client_info<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a20<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>col<span style="color:#bbb"> </span>client_identifier<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a18<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>col<span style="color:#bbb"> </span>module<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a47<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>col<span style="color:#bbb"> </span>action<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a31<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>SID,PROGRAM,<span style="color:#bbb"> </span>CLIENT_IDENTIFIER,<span style="color:#bbb"> </span>CLIENT_INFO,<span style="color:#bbb"> </span>MODULE,<span style="color:#bbb"> </span>ACTION<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>V$SESSION<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">LOWER</span>(PROGRAM)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">LIKE</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;nqsserver%&#39;</span>;<span style="color:#bbb">
</span></span></span></code></pre></div><p>Now login to Answers, and run an existing report, or create a new one. When you re-run the SQL script you should see your session now listed: <img src="/images/rnm1978/2011-10-10_1206_-0000.png" alt="" title="2011-10-10_1206_ 0000"></p>
<h2 id="not-a-fan-of-sqlplus">Not a fan of sql*plus?&nbsp;<a class="headline-hash" href="#not-a-fan-of-sqlplus">ðŸ”—</a> </h2>
<p><a href="http://www.thatjeffsmith.com/archive/2011/05/i-only-use-sqlplus-a-desperate-cry-for-help/">If for some strange reason you don&rsquo;t love sql*plus</a>, you can obviously use the above SQL in any other SQL client. Or, you can fire up Enterprise Manager and see the same set of information: <img src="/images/rnm1978/2011-10-10_1308_-0000.png" alt="" title="2011-10-10_1308_ 0000"> (run at a different time from the SQL above, so different report and dashboard names)</p>
<h2 id="warning">Warning&nbsp;<a class="headline-hash" href="#warning">ðŸ”—</a> </h2>
<p>It&rsquo;s occurred to me that by parsing in user-provided values to a string that&rsquo;s executed on the database, there could be the potential for a breach through SQL Injection via a maliciously named report or dashboard.</p>
<p>I&rsquo;ve not been able to find a report name which does cause trouble, but I have never tried exploiting SQL injection before.</p>
<p>It is another good reason to make sure that you&rsquo;re using a DB account solely created for reporting queries from OBIEE, because then its privileges can be greatly restricted. This isn&rsquo;t an excuse not to test for SQL Injection, but a reminder of why good practices such as granting of least privileges exist.</p>
<h2 id="troubleshooting">Troubleshooting&nbsp;<a class="headline-hash" href="#troubleshooting">ðŸ”—</a> </h2>
<ul>
<li>Make sure you <strong>don&rsquo;t</strong>suffix the database calls with semi-colons (statement terminators). If you do you&rsquo;ll probably get an error like this:</li>
</ul>
<pre tabindex="0"><code>[nQSError: 17001] Oracle Error code: 911, message: ORA-00911: invalid character at OCI call OCIStmtExecute
</code></pre><ul>
<li>If you&rsquo;re having problems implementing this, or doing further playing around with it, you can see the exact SQL that&rsquo;s executed on connection by bumping up LOGLEVEL and checking NQQuery.log.</li>
<li>Don&rsquo;t use the same connection pool for the init blocks as you do for queries. If you try this, then the init blocks will fire and try to submit a command on the database which requires the variables that the very init blocks are trying to populate. Confused? OBIEE certainly will be too.</li>
<li>If someone creates a report or dashboard with single quote in the name, it causes problems. The error will be ambiguous too:<img src="/images/rnm1978/2011-10-10_1453_-0000.png" alt="" title="2011-10-10_1453_ 0000"> State: HY000. Code: 10058. [NQODBC</li>
</ul>

	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#this-article-has-been-superseded-by-a-newer-version"><em><strong>This article has been superseded by a newer version:Â Instrumenting OBIEE Database Connections For Improved Performance Diagnostics</strong></em></a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#the-problem">The Problem</a></li>
    <li><a href="#the-solution">The solution</a></li>
    <li><a href="#implementing-it---overview">Implementing it - overview</a></li>
    <li><a href="#implementing-it---init-block-and-dummy-variables">Implementing it - Init Block and Dummy Variables</a>
      <ul>
        <li><a href="#summary-1">Summary:</a></li>
        <li><a href="#step-by-step">Step-by-step</a></li>
      </ul>
    </li>
    <li><a href="#implementing-it---connection-pool">Implementing it - connection pool</a></li>
    <li><a href="#testing-the-changes">Testing the changes</a></li>
    <li><a href="#not-a-fan-of-sqlplus">Not a fan of sql*plus?</a></li>
    <li><a href="#warning">Warning</a></li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
