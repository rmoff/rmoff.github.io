<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>rmoff&#39;s random ramblings</title>
    <link>https://rmoff.net/</link>
    <description>Recent content on rmoff&#39;s random ramblings</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>2025-07-04</lastBuildDate>
    
        <atom:link href="https://rmoff.net/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Writing to Apache Iceberg on S3 using Kafka Connect with Glue catalog</title>
      <link>https://rmoff.net/2025/07/04/writing-to-apache-iceberg-on-s3-using-kafka-connect-with-glue-catalog/</link>
      <pubDate>2025-07-04</pubDate>
      
      <guid>https://rmoff.net/2025/07/04/writing-to-apache-iceberg-on-s3-using-kafka-connect-with-glue-catalog/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/07/t_IMG_0587.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Without wanting to mix my temperature metaphors, Iceberg is the new hawtness, and getting data into it from other places is a common task.
I &lt;a href=&#34;https://rmoff.net/2025/06/24/writing-to-apache-iceberg-on-s3-using-flink-sql-with-glue-catalog/&#34;&gt;wrote previously about using Flink SQL to do this&lt;/a&gt;, and today I’m going to look at doing the same using Kafka Connect.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Kafka Connect can send data to Iceberg from any Kafka topic.
The source Kafka topic(s) can be populated by a Kafka Connect source connector (such as Debezium), or a regular application producing directly to it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/07/kc.excalidraw.png&#34; alt=&#34;kc.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’m going to use AWS’s Glue Data Catalog, but the sink also works with other Iceberg catalogs.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
You can find the Docker Compose for this article &lt;a href=&#34;https://github.com/rmoff/examples/tree/main/iceberg/kafka-kafkaconnect-aws&#34;&gt;here&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_kafka_connect_and_the_iceberg_sink_connector&#34;&gt;Kafka Connect and the Iceberg Sink Connector&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Kafka Connect is a framework for data integration, and is part of Apache Kafka.
There is a rich ecosystem of connectors for getting data in and out of Kafka, and Kafka Connect itself provides a set of features that you’d expect for a resilient data integration platform, including scaling, schema handling, restarts, serialisation, and more.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The Apache Iceberg connector for Kafka Connect was &lt;a href=&#34;https://www.tabular.io/blog/intro-kafka-connect/&#34;&gt;originally created by folk at Tabular&lt;/a&gt; and has subsequently been &lt;a href=&#34;https://github.com/apache/iceberg/pull/8701#issue-1922301136&#34;&gt;contributed to&lt;/a&gt; &lt;a href=&#34;https://iceberg.apache.org/docs/nightly/kafka-connect/&#34;&gt;the Apache Iceberg project&lt;/a&gt; (via a brief stint on &lt;a href=&#34;https://github.com/databricks/iceberg-kafka-connect&#34;&gt;a Databricks repo&lt;/a&gt; following the Tabular acquisition).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;For the purposes of this blog I’m still using the Tabular version since it has a pre-built binary available on &lt;a href=&#34;https://www.confluent.io/hub/tabular/iceberg-kafka-connect&#34;&gt;Confluent Hub&lt;/a&gt; which makes it easier to install.
If you want to use the Apache Iceberg version you currently &lt;a href=&#34;https://iceberg.apache.org/docs/nightly/kafka-connect/#installation&#34;&gt;need to build the connector yourself&lt;/a&gt;.
There is &lt;a href=&#34;https://github.com/apache/iceberg/issues/10745&#34;&gt;work underway&lt;/a&gt; to make it available on Confluent Hub.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’m running a &lt;a href=&#34;https://hub.docker.com/r/confluentinc/cp-kafka-connect&#34;&gt;Kafka Connect Docker image&lt;/a&gt; provided by Confluent because it provides the &lt;a href=&#34;https://docs.confluent.io/platform/7.5/connect/confluent-hub/client.html#install-components-with-c-hub-client&#34;&gt;&lt;code&gt;confluent-hub&lt;/code&gt; CLI tool&lt;/a&gt; which is a handy way for installing pre-built connectors and saves me having to do it myself.
It’s worth noting that the &lt;code&gt;confluent-hub&lt;/code&gt; CLI is being deprecated in favour of the broader &lt;code&gt;confluent&lt;/code&gt; CLI tool and &lt;code&gt;confluent connect plugin install&lt;/code&gt; to install connectors.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;confluent-hub &lt;span style=&#34;color: #f8f8f2&#34;&gt;install&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;--no-prompt&lt;/span&gt; tabular/iceberg-kafka-connect:0.6.19&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you’re using Docker you can bake this in at runtime &lt;a href=&#34;https://github.com/confluentinc/demo-scene/blob/master/connect-cluster/docker-compose-scenario02.yml#L97-L107&#34;&gt;like this&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s check that the connector is installed.
We can use the Kafka Connect REST API for this and the &lt;code&gt;/connector-plugins&lt;/code&gt; endpoint:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;curl &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; localhost:8083/connector-plugins|jq &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;.[].class&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;org.apache.kafka.connect.mirror.MirrorCheckpointConnector&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;org.apache.kafka.connect.mirror.MirrorHeartbeatConnector&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;org.apache.kafka.connect.mirror.MirrorSourceConnector&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;(Note that it’s &lt;code&gt;io.tabular&lt;/code&gt; and not &lt;code&gt;org.apache&lt;/code&gt;, since we’re using the Tabular version of the connector for now).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_kcctl&#34;&gt;kcctl 🧸&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;REST APIs are all very well, but a nicer way of managing Kafka Connect is &lt;a href=&#34;https://github.com/kcctl/kcctl&#34;&gt;&lt;strong&gt;kcctl&lt;/strong&gt;&lt;/a&gt;.
This is a CLI client built for Kafka Connect.
On the Mac it’s a simple install from Brew: &lt;code&gt;brew install kcctl/tap/kcctl&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Once you’ve installed kcctl, configure it to point to the Kafka Connect worker cluster:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl config set-context &lt;span style=&#34;color: #f8f8f2&#34;&gt;local&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;--cluster&lt;/span&gt; http://localhost:8083&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we can easily inspect the cluster:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl info
URL:               http://localhost:8083
Version:           8.0.0-ccs
Commit:            42dc8a94fe8a158bfc3241b5a93a1adde9973507
Kafka Cluster ID:  5L6g3nShT-eMCtK--X86sw&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We can also look at the sink connectors installed (which is a subset of those shown above):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl get plugins &lt;span style=&#34;color: #f92672&#34;&gt;--types&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;sink

 TYPE   CLASS                                             VERSION
 sink   io.tabular.iceberg.connect.IcebergSinkConnector   1.5.2-kc-0.6.19&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_11_sending_data_from_one_kafka_topic_to_an_iceberg_table&#34;&gt;1:1 (Sending data from one Kafka topic to an Iceberg table)&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/07/kc11.excalidraw.png&#34; alt=&#34;kc11.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ll start by looking at the most simple example, sending data from a Kafka topic to a table in Iceberg.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’m going to populate a Kafka topic with some dummy data.
I’m using JSON to serialise it; bear in mind that an explicitly-declared schema stored in a Schema Registry and the data serialised with something like Avro is often a better approach.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;{&amp;#34;order_id&amp;#34;: &amp;#34;001&amp;#34;, &amp;#34;customer_id&amp;#34;: &amp;#34;cust_123&amp;#34;, &amp;#34;product&amp;#34;: &amp;#34;laptop&amp;#34;, &amp;#34;quantity&amp;#34;: 1, &amp;#34;price&amp;#34;: 999.99}
{&amp;#34;order_id&amp;#34;: &amp;#34;002&amp;#34;, &amp;#34;customer_id&amp;#34;: &amp;#34;cust_456&amp;#34;, &amp;#34;product&amp;#34;: &amp;#34;mouse&amp;#34;, &amp;#34;quantity&amp;#34;: 2, &amp;#34;price&amp;#34;: 25.50}
{&amp;#34;order_id&amp;#34;: &amp;#34;003&amp;#34;, &amp;#34;customer_id&amp;#34;: &amp;#34;cust_789&amp;#34;, &amp;#34;product&amp;#34;: &amp;#34;keyboard&amp;#34;, &amp;#34;quantity&amp;#34;: 1, &amp;#34;price&amp;#34;: 75.00}
{&amp;#34;order_id&amp;#34;: &amp;#34;004&amp;#34;, &amp;#34;customer_id&amp;#34;: &amp;#34;cust_321&amp;#34;, &amp;#34;product&amp;#34;: &amp;#34;monitor&amp;#34;, &amp;#34;quantity&amp;#34;: 1, &amp;#34;price&amp;#34;: 299.99}
{&amp;#34;order_id&amp;#34;: &amp;#34;005&amp;#34;, &amp;#34;customer_id&amp;#34;: &amp;#34;cust_654&amp;#34;, &amp;#34;product&amp;#34;: &amp;#34;headphones&amp;#34;, &amp;#34;quantity&amp;#34;: 1, &amp;#34;price&amp;#34;: 149.99}&amp;#39;&lt;/span&gt; | docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-T&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #f92672&#34;&gt;-P&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #f92672&#34;&gt;-t&lt;/span&gt; orders&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_configuring_the_apache_iceberg_kafka_connect_sink&#34;&gt;Configuring the Apache Iceberg Kafka Connect sink&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now let’s instantiate our Iceberg sink.
The &lt;a href=&#34;https://iceberg.apache.org/docs/nightly/kafka-connect/#initial-setup&#34;&gt;docs&lt;/a&gt; are pretty good, and include details of how to use different catalogs.
I’m going to configure the sink thus:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Read messages from the &lt;code&gt;orders&lt;/code&gt; topic&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Write them to the Iceberg table &lt;code&gt;foo.kc.orders&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Use the AWS Glue Data Catalog to store metadata&lt;/p&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;I’ve passed my local AWS credentials as environment variables to the Kafka Connect docker container.
This is not a secure way of doing things, but suffices plenty for these sandbox testing purposes.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Store the Iceberg files on S3 in the &lt;code&gt;rmoff-lakehouse&lt;/code&gt; bucket under the &lt;code&gt;/01&lt;/code&gt; path&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Using kcctl it looks like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-kc_orders&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;orders&amp;#34;,
    &amp;#34;iceberg.tables&amp;#34;: &amp;#34;foo.kc.orders&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/01/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Check if it worked:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl get connectors

 NAME                     TYPE   STATE     TASKS
 iceberg-sink-kc_orders   sink   RUNNING   0: FAILED

&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl describe connector iceberg-sink-kc_orders
Name:       iceberg-sink-kc_orders
Type:       sink
State:      RUNNING
Worker ID:  kafka-connect:8083
Config:
  connector.class:               io.tabular.iceberg.connect.IcebergSinkConnector
  iceberg.catalog.catalog-impl:  org.apache.iceberg.aws.glue.GlueCatalog
  iceberg.catalog.io-impl:       org.apache.iceberg.aws.s3.S3FileIO
  iceberg.catalog.warehouse:     s3://rmoff-lakehouse/00/
  iceberg.tables:                foo.kc.orders
  name:                          iceberg-sink-kc_orders
  topics:                        orders
Tasks:
  0:
    State:      FAILED
    Worker ID:  kafka-connect:8083
    Trace:      org.apache.kafka.connect.errors.ConnectException: Tolerance exceeded &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in &lt;/span&gt;error handler
        at
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]
      Caused by: org.apache.kafka.connect.errors.DataException: JsonConverter with schemas.enable requires &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;schema&amp;#34;&lt;/span&gt; and &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;payload&amp;#34;&lt;/span&gt; fields and may not contain additional fields. If you are trying to deserialize plain JSON data, &lt;span style=&#34;color: #f8f8f2&#34;&gt;set &lt;/span&gt;schemas.enable&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;false &lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in &lt;/span&gt;your converter configuration.
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So, no dice on the first attempt.
(Note also the confusing fact that the &lt;em&gt;connector&lt;/em&gt; has a state of &lt;code&gt;RUNNING&lt;/code&gt; whilst the &lt;em&gt;task&lt;/em&gt; is &lt;code&gt;FAILED&lt;/code&gt;—this is just &lt;em&gt;one of those things&lt;/em&gt; about how Kafka Connect works 🙃).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The error is to do with how Kafka Connect handles deserialising messages from Kafka topics.
It’s reading JSON, but expecting to find &lt;code&gt;schema&lt;/code&gt; and &lt;code&gt;payload&lt;/code&gt; elements within it—and these aren’t there.
&lt;a href=&#34;https://www.confluent.io/blog/kafka-connect-deep-dive-converters-serialization-explained/#json-message-without-expected-schema-payload-structure&#34;&gt;This blog post&lt;/a&gt; explains the issue in more detail.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To fix it we’ll change the connector configuration, which we can do easily with kcctl’s &lt;code&gt;patch&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl patch connector iceberg-sink-kc_orders &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; key.converter&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;org.apache.kafka.connect.json.JsonConverter &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; key.converter.schemas.enable&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;false&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; value.converter&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;org.apache.kafka.connect.json.JsonConverter &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; value.converter.schemas.enable&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Check the connector state again:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl describe connector iceberg-sink-kc_orders
Name:       iceberg-sink-kc_orders
Type:       sink
State:      RUNNING
Worker ID:  kafka-connect:8083
Config:
  connector.class:                 io.tabular.iceberg.connect.IcebergSinkConnector
  iceberg.catalog.catalog-impl:    org.apache.iceberg.aws.glue.GlueCatalog
  iceberg.catalog.io-impl:         org.apache.iceberg.aws.s3.S3FileIO
  iceberg.catalog.warehouse:       s3://rmoff-lakehouse/01/
  iceberg.tables:                  foo.kc.orders
  key.converter:                   org.apache.kafka.connect.json.JsonConverter
  key.converter.schemas.enable:    &lt;span style=&#34;color: #f8f8f2&#34;&gt;false
  &lt;/span&gt;name:                            iceberg-sink-kc_orders
  topics:                          orders
  value.converter:                 org.apache.kafka.connect.json.JsonConverter
  value.converter.schemas.enable:  &lt;span style=&#34;color: #f8f8f2&#34;&gt;false
&lt;/span&gt;Tasks:
  0:
    State:      FAILED
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]
      Caused by: org.apache.iceberg.exceptions.NoSuchTableException: Invalid table identifier: foo.kc.orders&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This time the error is entirely self-inflicted.
Hot off my blog post about &lt;a href=&#34;https://rmoff.net/2025/06/24/writing-to-apache-iceberg-on-s3-using-flink-sql-with-glue-catalog/&#34;&gt;doing this in Flink SQL&lt;/a&gt;, I had in my mind that the table needed a three-part qualification; &lt;code&gt;catalog.database.table&lt;/code&gt;.
In fact, we only need to specify &lt;code&gt;database.table&lt;/code&gt;.
In addition I’ve realised that the table doesn’t exist already, and by default the connector won’t automagically create it—so let’s fix that too.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl patch connector iceberg-sink-kc_orders &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; iceberg.tables&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;kc.orders &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; iceberg.tables.auto-create-enabled&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’re getting closer, but not quite there yet:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]
    Caused by: software.amazon.awssdk.services.glue.model.EntityNotFoundException: Database kc not found. &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;(&lt;/span&gt;Service: Glue, Status Code: 400, Request ID: 16a25fcf-01be-44e9-ba67-cc71431f3945&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s see what databases we &lt;em&gt;do&lt;/em&gt; have:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws glue get-databases &lt;span style=&#34;color: #f92672&#34;&gt;--region&lt;/span&gt; us-east-1 &lt;span style=&#34;color: #f92672&#34;&gt;--query&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;DatabaseList[].Name&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;--output&lt;/span&gt; table

+--------------------+
|    GetDatabases    |
+--------------------+
|  default_database  |
|  my_glue_db        |
|  new_glue_db       |
|  rmoff_db          |
+--------------------+&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So, let’s use a database that does exist (&lt;code&gt;rmoff_db&lt;/code&gt;):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl patch connector iceberg-sink-kc_orders &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; iceberg.tables&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;rmoff_db.orders&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we’re up and running :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl describe connector iceberg-sink-kc_orders
Name:       iceberg-sink-kc_orders
Type:       sink
State:      RUNNING
Worker ID:  kafka-connect:8083
Config:
  connector.class:                     io.tabular.iceberg.connect.IcebergSinkConnector
  iceberg.catalog.catalog-impl:        org.apache.iceberg.aws.glue.GlueCatalog
  iceberg.catalog.io-impl:             org.apache.iceberg.aws.s3.S3FileIO
  iceberg.catalog.warehouse:           s3://rmoff-lakehouse/01/
  iceberg.tables:                      rmoff_db.orders
  iceberg.tables.auto-create-enabled:  &lt;span style=&#34;color: #f8f8f2&#34;&gt;true
  &lt;/span&gt;key.converter:                       org.apache.kafka.connect.json.JsonConverter
  key.converter.schemas.enable:        &lt;span style=&#34;color: #f8f8f2&#34;&gt;false
  &lt;/span&gt;name:                                iceberg-sink-kc_orders
  topics:                              orders
  value.converter:                     org.apache.kafka.connect.json.JsonConverter
  value.converter.schemas.enable:      &lt;span style=&#34;color: #f8f8f2&#34;&gt;false
&lt;/span&gt;Tasks:
  0:
    State:      RUNNING
    Worker ID:  kafka-connect:8083
Topics:
  orders&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_examining_the_iceberg_table&#34;&gt;Examining the Iceberg table&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we’ll have a look at the Iceberg table.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The table has been registered in the Glue Data Catalog:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws glue get-tables &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--region&lt;/span&gt; us-east-1 &lt;span style=&#34;color: #f92672&#34;&gt;--database-name&lt;/span&gt; rmoff_db &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--query&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TableList[].Name&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;--output&lt;/span&gt; table

+----------------+
|    GetTables   |
+----------------+
|  orders        |
+----------------+&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;And there’s something in the S3 bucket:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws s3 &lt;span style=&#34;color: #f92672&#34;&gt;--recursive&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;ls &lt;/span&gt;s3://rmoff-lakehouse/01
2025-06-30 16:44:39       1320 01/rmoff_db.db/orders/metadata/00000-bcbeeafa-4556-4a52-92ee-5dbc34d35d6b.metadata.json&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;However, this is just the table’s Iceberg metadata—but nothing else.
That’s because Kafka Connect won’t flush the data to storage straight away; by default it’s every 5 minutes.
The configuration that controls this is &lt;code&gt;iceberg.control.commit.interval-ms&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So, if we wait long enough, we’ll see some data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws s3 &lt;span style=&#34;color: #f92672&#34;&gt;--recursive&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;ls &lt;/span&gt;s3://rmoff-lakehouse/01
2025-06-30 16:51:35       1635 01/rmoff_db.db/orders/data/00001-1751298279338-409ff5c8-244f-4104-8b81-dfe47fcbb2b3-00001.parquet
2025-06-30 16:44:39       1320 01/rmoff_db.db/orders/metadata/00000-bcbeeafa-4556-4a52-92ee-5dbc34d35d6b.metadata.json
2025-06-30 16:55:09       2524 01/rmoff_db.db/orders/metadata/00001-e8341cee-cf17-4255-bcf1-6e87cf41bbf3.metadata.json
2025-06-30 16:55:08       6950 01/rmoff_db.db/orders/metadata/cbe2651d-7c83-4465-a2e1-d92bb3e0b61d-m0.avro
2025-06-30 16:55:09       4233 01/rmoff_db.db/orders/metadata/snap-6069858821353147927-1-cbe2651d-7c83-4465-a2e1-d92bb3e0b61d.avro&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Alternatively we can be impatient (&lt;em&gt;and inefficient, if we were to use this for real as you’d get a ton of small files as a result&lt;/em&gt;) and override it to commit every second:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl patch connector iceberg-sink-kc_orders &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; iceberg.control.commit.interval-ms&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;1000&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now let’s have a look at this data that we’ve written.
The absolute joy of Iceberg is the freedom that it gives you by decoupling storage from engine.
This means that we can write the data with one engine (here, Kafka Connect), and read it from another.
Let’s use DuckDB.
Because, quack.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;DuckDB &lt;a href=&#34;https://duckdb.org/docs/stable/core_extensions/iceberg/amazon_sagemaker_lakehouse.html#connecting-to-amazon-sagemaker-lakehouse&#34;&gt;supports&lt;/a&gt; AWS Glue Data Catalog for Iceberg metadata.
I had &lt;a href=&#34;https://github.com/duckdb/duckdb-iceberg/issues/265#issuecomment-3009061597&#34;&gt;some trouble&lt;/a&gt; with it, but found a &lt;a href=&#34;https://github.com/duckdb/duckdb-iceberg/issues/265#issuecomment-2959813611&#34;&gt;useful workaround&lt;/a&gt; (yay open source).
There’s also a comprehensive &lt;a href=&#34;https://tobilg.com/using-amazon-sagemaker-lakehouse-with-duckdb&#34;&gt;blog post&lt;/a&gt; from Tobias Müller
on how to get it to work with a ton of IAM, ARN, and WTF (I think I made the last one up)—probably useful if you need to get this to work with any semblance of security.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So, first we create an &lt;code&gt;S3&lt;/code&gt; secret in DuckDB to provide our AWS credentials, which I’m doing via &lt;a href=&#34;https://duckdb.org/docs/stable/core_extensions/httpfs/s3api.html#credential_chain-provider&#34;&gt;&lt;code&gt;credential_chain&lt;/code&gt;&lt;/a&gt; which will read them from my local environment variables.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;🟡◗&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SECRET&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;iceberg_secret&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TYPE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;S3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;PROVIDER&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;credential_chain&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Then we attach the Glue data catalog as a new database to the DuckDB session.
Here, &lt;code&gt;1234&lt;/code&gt; is my AWS account id (which you can get with &lt;code&gt;aws sts get-caller-identity --query Account&lt;/code&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;🟡◗&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ATTACH&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1234&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;glue_catalog&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TYPE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;iceberg&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENDPOINT_TYPE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;glue&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Once you’ve done this you should be able to list the table(s) in your Glue Data Catalog:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;-- These are DuckDB databases
🟡◗ SHOW DATABASES;
┌───────────────┐
│ database_name │
│    varchar    │
├───────────────┤
│ glue_catalog  │
│ memory        │
└───────────────┘

🟡◗ SELECT * FROM information_schema.tables
    WHERE table_catalog = &amp;#39;glue_catalog&amp;#39;
      AND table_schema=&amp;#39;rmoff_db&amp;#39;;
┌───────────────┬──────────────┬──────────────────┬────────────┬
│ table_catalog │ table_schema │    table_name    │ table_type │
│    varchar    │   varchar    │     varchar      │  varchar   │
├───────────────┼──────────────┼──────────────────┼────────────┼
│ glue_catalog  │ rmoff_db     │ orders           │ BASE TABLE │
└───────────────┴──────────────┴──────────────────┴────────────┴&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Terminology-wise, a &lt;em&gt;catalog&lt;/em&gt; in AWS Glue Data Catalog is a &lt;em&gt;database&lt;/em&gt; in DuckDB (&lt;code&gt;SHOW DATABASES&lt;/code&gt;), and also a &lt;em&gt;catalog&lt;/em&gt; (&lt;code&gt;table_catalog&lt;/code&gt;).
A Glue &lt;em&gt;database&lt;/em&gt; is a DuckDB &lt;em&gt;schema&lt;/em&gt;.
And a table is a table in both :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s finish this section by checking that the data we wrote to Kafka is indeed in Iceberg.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the source data read from the Kafka topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-it&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #f92672&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #f92672&#34;&gt;-C&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-t&lt;/span&gt; orders
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;order_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;001&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;customer_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;cust_123&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;product&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;laptop&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;quantity&amp;#34;&lt;/span&gt;: 1, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;price&amp;#34;&lt;/span&gt;: 999.99&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;order_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;002&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;customer_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;cust_456&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;product&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;mouse&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;quantity&amp;#34;&lt;/span&gt;: 2, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;price&amp;#34;&lt;/span&gt;: 25.50&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;order_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;003&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;customer_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;cust_789&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;product&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;keyboard&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;quantity&amp;#34;&lt;/span&gt;: 1, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;price&amp;#34;&lt;/span&gt;: 75.00&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;order_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;004&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;customer_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;cust_321&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;product&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;monitor&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;quantity&amp;#34;&lt;/span&gt;: 1, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;price&amp;#34;&lt;/span&gt;: 299.99&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;order_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;005&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;customer_id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;cust_654&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;product&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;headphones&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;quantity&amp;#34;&lt;/span&gt;: 1, &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;price&amp;#34;&lt;/span&gt;: 149.99&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and now the Iceberg table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ USE glue_catalog.rmoff_db;
🟡◗ SELECT * FROM orders;
┌────────────┬──────────┬────────┬─────────────┬──────────┐
│  product   │ quantity │ price  │ customer_id │ order_id │
│  varchar   │  int64   │ double │   varchar   │ varchar  │
├────────────┼──────────┼────────┼─────────────┼──────────┤
│ laptop     │        1 │ 999.99 │ cust_123    │ 001      │
│ mouse      │        2 │   25.5 │ cust_456    │ 002      │
│ keyboard   │        1 │   75.0 │ cust_789    │ 003      │
│ monitor    │        1 │ 299.99 │ cust_321    │ 004      │
│ headphones │        1 │ 149.99 │ cust_654    │ 005      │
└────────────┴──────────┴────────┴─────────────┴──────────┘&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Write another row of data to the Kafka topic (&lt;code&gt;order_id&lt;/code&gt;: &lt;code&gt;006&lt;/code&gt;):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;{&amp;#34;order_id&amp;#34;: &amp;#34;006&amp;#34;, &amp;#34;customer_id&amp;#34;: &amp;#34;cust_987&amp;#34;, &amp;#34;product&amp;#34;: &amp;#34;webcam&amp;#34;, &amp;#34;quantity&amp;#34;: 1, &amp;#34;price&amp;#34;: 89.99}&amp;#39;&lt;/span&gt; | docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-T&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #f92672&#34;&gt;-P&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #f92672&#34;&gt;-t&lt;/span&gt; orders&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now wait a second (or whatever &lt;code&gt;iceberg.control.commit.interval-ms&lt;/code&gt; is set to), and check the Iceberg table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT * FROM orders;
┌────────────┬──────────┬────────┬─────────────┬──────────┐
│  product   │ quantity │ price  │ customer_id │ order_id │
│  varchar   │  int64   │ double │   varchar   │ varchar  │
├────────────┼──────────┼────────┼─────────────┼──────────┤
│ webcam     │        1 │  89.99 │ cust_987    │ 006      │ &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
│ laptop     │        1 │ 999.99 │ cust_123    │ 001      │
│ mouse      │        2 │   25.5 │ cust_456    │ 002      │
│ keyboard   │        1 │   75.0 │ cust_789    │ 003      │
│ monitor    │        1 │ 299.99 │ cust_321    │ 004      │
│ headphones │        1 │ 149.99 │ cust_654    │ 005      │
└────────────┴──────────┴────────┴─────────────┴──────────┘&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The new row of data 🎉&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_schemas&#34;&gt;Schemas&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now that we’ve got the basic connection between Kafka and Iceberg using Kafka Connect working, let’s look at it in a bit more detail.
The first thing that warrants a bit of attention is the schema of the data.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the first record of data from our Kafka topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;001&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;cust_123&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;product&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;laptop&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;quantity&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;price&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;999.99&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Eyeballing it, you and I can probably guess at the data types of the schema.
Quantity is an integer, probably.
Price, a decimal (unless you don’t realise it’s a currency and guess that it’s a float or double).
Product is obviously a character field.
What about the order ID though?
It looks numeric, but has leading zeros; so a character field also?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;My point is, there is no &lt;strong&gt;declared schema&lt;/strong&gt;, only an inferred one.
What does it look like written to Iceberg?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws glue get-table &lt;span style=&#34;color: #f92672&#34;&gt;--region&lt;/span&gt; us-east-1 &lt;span style=&#34;color: #f92672&#34;&gt;--database-name&lt;/span&gt; rmoff_db &lt;span style=&#34;color: #f92672&#34;&gt;--name&lt;/span&gt; orders &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--query&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Table.StorageDescriptor.Columns[].{Name:Name,Type:Type}&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;--output&lt;/span&gt; table

+--------------+----------+
|        GetTable         |
+--------------+----------+
|     Name     |  Type    |
+--------------+----------+
|  product     |  string  |
|  quantity    |  bigint  |
|  price       |  double  |
|  customer_id |  string  |
|  order_id    |  string  |
+--------------+----------+&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Not bad—only the &lt;code&gt;price&lt;/code&gt; being stored as a &lt;code&gt;DOUBLE&lt;/code&gt; is wrong.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What about if we were to use a timestamp in the source data?
And a boolean?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s a new dataset in a Kafka topic.
It’s roughly based on click behaviour.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;2023-02-01T14:30:25Z&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ad_cost&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;1.50&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;is_conversion&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;user_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;001234567890&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Using the same Kafka Connect approach as above:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-kc_clicks&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;clicks&amp;#34;,
    &amp;#34;iceberg.tables&amp;#34;: &amp;#34;rmoff_db.clicks&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/01/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;key.converter.schemas.enable&amp;#34;: &amp;#34;false&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;value.converter.schemas.enable&amp;#34;: &amp;#34;false&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;it ends up like this in Iceberg:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;❯ aws glue get-table &lt;span style=&#34;color: #f92672&#34;&gt;--region&lt;/span&gt; us-east-1 &lt;span style=&#34;color: #f92672&#34;&gt;--database-name&lt;/span&gt; rmoff_db &lt;span style=&#34;color: #f92672&#34;&gt;--name&lt;/span&gt; clicks&lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--query&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Table.StorageDescriptor.Columns[].{Name:Name,Type:Type}&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;--output&lt;/span&gt; table

+----------------+----------+
|         GetTable          |
+----------------+----------+
|      Name      |  Type    |
+----------------+----------+
|  click_ts      |  string  |
|  ad_cost       |  string  |
|  user_id       |  string  |
|  is_conversion |  string  |
+----------------+----------+&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here we start to see the real flaw if we just rely on inferred schemas.
Holding a currency as a string?
&lt;a href=&#34;https://www.destroyallsoftware.com/talks/wat&#34;&gt;Wat&lt;/a&gt;.
Storing a timestamp as a string?
Gross.
Using a string to hold a boolean?
Fine, until someone decides to put a value other than &lt;code&gt;true&lt;/code&gt; or &lt;code&gt;false&lt;/code&gt; in it. Or &lt;code&gt;True&lt;/code&gt;. Or &lt;code&gt;TRuE&lt;/code&gt;. And so on.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Data types exist for a reason, and part of good data pipeline hygiene is making use of them.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_enough_of_the_lecturinghow_do_i_use_an_explicit_schema_with_kafka_connect&#34;&gt;Enough of the lecturing…How do I use an explicit schema with Kafka Connect?&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;One option (but not one I’d recommend) is &lt;a href=&#34;https://www.confluent.io/blog/kafka-connect-deep-dive-converters-serialization-explained/#json-schemas&#34;&gt;embedding the schema directly in the message&lt;/a&gt;.
This is actually what the &lt;code&gt;JsonConverter&lt;/code&gt; was defaulting to in the first example above and through an error because we’d not done it.
Here’s what the above &lt;code&gt;clicks&lt;/code&gt; record looks like with embedded schema:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;schema&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;struct&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;fields&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;field&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;int64&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;org.apache.kafka.connect.data.Timestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;version&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;optional&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;false&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;field&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ad_cost&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;org.apache.kafka.connect.data.Decimal&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;version&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;parameters&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
          &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;scale&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;optional&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;false&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;field&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;is_conversion&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;boolean&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;optional&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;false&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;field&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;user_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;optional&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;false&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;payload&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1675258225000&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ad_cost&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;1.50&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;is_conversion&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;user_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;001234567890&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Even though our Kafka Connect worker is defaulting to using it, I’m going to explicitly configure &lt;code&gt;schemas.enable&lt;/code&gt; just for clarity:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-kc_clicks_schema&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;clicks_with_schema&amp;#34;,
    &amp;#34;iceberg.tables&amp;#34;: &amp;#34;rmoff_db.clicks_embedded_schema&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/01/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;key.converter.schemas.enable&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;value.converter.schemas.enable&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The first time I try it, it fails:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;org.apache.kafka.connect.errors.DataException: Invalid bytes &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;for &lt;/span&gt;Decimal field
com.fasterxml.jackson.databind.exc.InvalidFormatException: Cannot access contents of TextNode as binary due to broken Base64 encoding: Illegal character &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;(&lt;/span&gt;code 0x2e&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in &lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;base64 &lt;/span&gt;content&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;That’s because the &lt;code&gt;ad_cost&lt;/code&gt; field is defined as a logical &lt;code&gt;Decimal&lt;/code&gt; type, but physically stored as &lt;code&gt;bytes&lt;/code&gt;, so I need to write it as that in the topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;payload&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1675258225000&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ad_cost&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;AJY=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;is_conversion&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;user_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;001234567890&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Where on earth do I get &lt;code&gt;AJY=&lt;/code&gt; from?
I’ll let &lt;a href=&#34;https://claude.ai/&#34;&gt;Claude&lt;/a&gt; explain:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;For decimal 1.50 with scale 2, we need to ensure proper signed integer encoding:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Unscale&lt;/strong&gt;: 1.50 × 10² = 150&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Convert to signed bytes&lt;/strong&gt;: 150 as a positive integer needs to be encoded as &lt;code&gt;[0, 150]&lt;/code&gt; (2 bytes) or use proper big-endian encoding&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Base64 encode&lt;/strong&gt;: The bytes &lt;code&gt;[0, 150]&lt;/code&gt; encode to &lt;code&gt;&amp;#34;AJY=&amp;#34;&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With the connector restarted reading from a fresh topic with this newly-encoded decimal value in it, things look good in Iceberg:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT * FROM clicks_embedded_schema;
┌──────────────────────────┬───────────────┬───────────────┬──────────────┐
│         click_ts         │    ad_cost    │ is_conversion │   user_id    │
│ timestamp with time zone │ decimal(38,2) │    boolean    │   varchar    │
├──────────────────────────┼───────────────┼───────────────┼──────────────┤
│ 2023-02-01 13:30:25+00   │          1.50 │ true          │ 001234567890 │ &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Proper data types, yay!&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;BUT&lt;/strong&gt;…this is a pretty heavy way of doing things.
Bytes might be cheap, but do we really want to spend over 80% of the message on sending the full schema definition with &lt;em&gt;every single record&lt;/em&gt;?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is where a Schema Registry comes in.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_schema_registry&#34;&gt;Schema Registry&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;A schema registry is basically what it says on the tin.
A registry, of schemas.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Instead of passing the full schema each time (like above), a client will have a &lt;em&gt;reference&lt;/em&gt; to the schema in the message, and then retrieve the actual schema from the registry.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/07/sr.excalidraw.png&#34; alt=&#34;sr.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The most well known of the schema registries in the Kafka ecosystem is Confluent’s &lt;a href=&#34;https://github.com/confluentinc/schema-registry&#34;&gt;Schema Registry&lt;/a&gt;.
I’ll show you shortly how it is used automatically within a pipeline, but first I’m going to demonstrate its &amp;#34;manual&amp;#34; use.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;There are multiple serialisation options available, including:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Avro&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Protobuf&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;JSONSchema&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’m going to demonstrate Avro here.
A schema for the &lt;code&gt;clicks&lt;/code&gt; data above looks something like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;record&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ClickEvent&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;fields&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;long&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;logicalType&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;timestamp-millis&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ad_cost&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;logicalType&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;decimal&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;precision&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;scale&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;is_conversion&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;boolean&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;user_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Send this to Schema Registry using the REST API:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;http POST localhost:8081/subjects/clicks-value/versions &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
  Content-Type:application/vnd.schemaregistry.v1+json &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2&#34;&gt;schema&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;{&amp;#34;type&amp;#34;:&amp;#34;record&amp;#34;,&amp;#34;name&amp;#34;:&amp;#34;ClickEvent&amp;#34;,&amp;#34;fields&amp;#34;:[{&amp;#34;name&amp;#34;:&amp;#34;click_ts&amp;#34;,&amp;#34;type&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;long&amp;#34;,&amp;#34;logicalType&amp;#34;:&amp;#34;timestamp-millis&amp;#34;}},{&amp;#34;name&amp;#34;:&amp;#34;ad_cost&amp;#34;,&amp;#34;type&amp;#34;:{&amp;#34;type&amp;#34;:&amp;#34;bytes&amp;#34;,&amp;#34;logicalType&amp;#34;:&amp;#34;decimal&amp;#34;,&amp;#34;precision&amp;#34;:10,&amp;#34;scale&amp;#34;:2}},{&amp;#34;name&amp;#34;:&amp;#34;is_conversion&amp;#34;,&amp;#34;type&amp;#34;:&amp;#34;boolean&amp;#34;},{&amp;#34;name&amp;#34;:&amp;#34;user_id&amp;#34;,&amp;#34;type&amp;#34;:&amp;#34;string&amp;#34;}]}&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This will return the ID that the schema has been assigned.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now send the message to Kafka, specifying &lt;code&gt;value.schema.id&lt;/code&gt; as the schema ID returned in the step above:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;printf&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;{&amp;#34;click_ts&amp;#34;: 1675258225000, &amp;#34;ad_cost&amp;#34;: &amp;#34;1.50&amp;#34;, &amp;#34;is_conversion&amp;#34;: true, &amp;#34;user_id&amp;#34;: &amp;#34;001234567890&amp;#34;}\n&amp;#39;&lt;/span&gt; | &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-T&lt;/span&gt; kafka-connect kafka-avro-console-producer &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
                        &lt;span style=&#34;color: #f92672&#34;&gt;--bootstrap-server&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
                        &lt;span style=&#34;color: #f92672&#34;&gt;--topic&lt;/span&gt; clicks_registry &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
                        &lt;span style=&#34;color: #f92672&#34;&gt;--property&lt;/span&gt; schema.registry.url&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;http://schema-registry:8081 &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
                        &lt;span style=&#34;color: #f92672&#34;&gt;--property&lt;/span&gt; value.schema.id&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What we now have is a Kafka topic with a message that holds &lt;em&gt;just&lt;/em&gt; the payload plus a &lt;em&gt;pointer&lt;/em&gt; to the schema.
It’s the best of both worlds; a small message footprint, but a fully-defined schema available for any consumer to use.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;An Avro-serialised message is smaller than a JSON one holding the same data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;# Count the bytes in Avro message&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-T&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #f92672&#34;&gt;-C&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #f92672&#34;&gt;-t&lt;/span&gt; clicks_registry &lt;span style=&#34;color: #f92672&#34;&gt;-c1&lt;/span&gt; | &lt;span style=&#34;color: #f8f8f2&#34;&gt;wc&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-c&lt;/span&gt;
31

&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;# Count the bytes in JSON message&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-T&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #f92672&#34;&gt;-C&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #f92672&#34;&gt;-t&lt;/span&gt; clicks &lt;span style=&#34;color: #f92672&#34;&gt;-c1&lt;/span&gt; | &lt;span style=&#34;color: #f8f8f2&#34;&gt;wc&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-c&lt;/span&gt;
108&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s finish off by sending this Avro data over to Iceberg:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-clicks-registry&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;clicks_registry&amp;#34;,
    &amp;#34;iceberg.tables&amp;#34;: &amp;#34;rmoff_db.clicks_schema_registry&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/01/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The data lands in Iceberg with its data types looking good:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT * FROM clicks_schema_registry;
┌──────────────────────────┬───────────────┬───────────────┬──────────────┐
│         click_ts         │    ad_cost    │ is_conversion │   user_id    │
│ timestamp with time zone │ decimal(38,2) │    boolean    │   varchar    │
├──────────────────────────┼───────────────┼───────────────┼──────────────┤
│ 2023-02-01 13:30:25+00   │    8251118.56 │ true          │ 001234567890 │&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But…what’s this?
For some reason &lt;code&gt;ad_cost&lt;/code&gt; is &lt;code&gt;8251118.56&lt;/code&gt; even though the source data was &lt;code&gt;1.50&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;title&#34;&gt;Decimals…again&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Similar to the &lt;code&gt;Decimal&lt;/code&gt; issue above when I embedded the schema in a JSON message, providing a decimal value in Avro also requires special attention.
In this case it’s the Kafka producer that I’m using that needs to be persuaded to serialise it correctly.
This time I’ll let Gemini explain:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To represent the decimal &lt;code&gt;1.50&lt;/code&gt; for a &lt;code&gt;bytes&lt;/code&gt; field with a &lt;code&gt;Decimal&lt;/code&gt; logical type and a scale of 2, you must provide the value as &lt;code&gt;{&amp;#34;ad_cost&amp;#34;: &amp;#34;\\u0000\\u0096&amp;#34;}&lt;/code&gt;. Here’s why:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Unscaled Integer&lt;/strong&gt;: The &lt;code&gt;Decimal&lt;/code&gt; logical type is stored as a raw &lt;code&gt;bytes&lt;/code&gt; array representing an unscaled integer. For a value of &lt;code&gt;1.50&lt;/code&gt; and a &lt;code&gt;scale&lt;/code&gt; of &lt;code&gt;2&lt;/code&gt;, the unscaled integer is &lt;code&gt;1.50 * 10^2 = 150&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Signed Bytes&lt;/strong&gt;: Avro’s decimal representation uses signed, big-endian bytes. The integer &lt;code&gt;150&lt;/code&gt; is &lt;code&gt;0x96&lt;/code&gt; in hexadecimal. However, a single byte &lt;code&gt;0x96&lt;/code&gt; has its most significant bit set, causing it to be interpreted as a negative number in two’s complement.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Positive Number Padding&lt;/strong&gt;: To ensure the number is treated as positive &lt;code&gt;150&lt;/code&gt;, a &lt;code&gt;0x00&lt;/code&gt; padding byte must be prepended, resulting in the two-byte sequence &lt;code&gt;[0x00, 0x96]&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;JSON String Encoding&lt;/strong&gt;: The &lt;code&gt;kafka-avro-console-producer&lt;/code&gt; requires this byte sequence to be provided as a JSON string using unicode escapes, which is &lt;code&gt;&amp;#34;\u0000\u0096&amp;#34;&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Shell Escaping&lt;/strong&gt;: Your shell will interpret and consume the single backslashes. To pass the literal escape sequences to the producer’s JSON parser, you must escape the backslashes themselves, resulting in &lt;code&gt;{&amp;#34;ad_cost&amp;#34;: &amp;#34;\\u0000\\u0096&amp;#34;}&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With the serialisation of the decimal value corrected thus:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;printf&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;{&amp;#34;click_ts&amp;#34;: 1675258225000, &amp;#34;ad_cost&amp;#34;: &amp;#34;\\u0000\\u0096&amp;#34; ,&amp;#34;is_conversion&amp;#34;: true, &amp;#34;user_id&amp;#34;: &amp;#34;001234567890&amp;#34;}\n&amp;#39;&lt;/span&gt; | &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-T&lt;/span&gt; kafka-connect kafka-avro-console-producer &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
                        &lt;span style=&#34;color: #f92672&#34;&gt;--bootstrap-server&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
                        &lt;span style=&#34;color: #f92672&#34;&gt;--topic&lt;/span&gt; clicks_registry &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
                        &lt;span style=&#34;color: #f92672&#34;&gt;--property&lt;/span&gt; schema.registry.url&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;http://schema-registry:8081 &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
                        &lt;span style=&#34;color: #f92672&#34;&gt;--property&lt;/span&gt; value.schema.id&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I finally got the expected value showing in Iceberg:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT * FROM clicks_schema_registry;
┌──────────────────────────┬───────────────┬───────────────┬──────────────┐
│         click_ts         │    ad_cost    │ is_conversion │   user_id    │
│ timestamp with time zone │ decimal(38,2) │    boolean    │   varchar    │
├──────────────────────────┼───────────────┼───────────────┼──────────────┤
│ 2023-02-01 13:30:25+00   │          1.50 │ true          │ 001234567890 │&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_postgres_to_iceberg_via_kafka_connect&#34;&gt;Postgres to Iceberg via Kafka Connect&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s put this into practice now.
I’m going to use Kafka Connect with the Debezium connector to get data from Postgres and then write it to Iceberg with the same sink connector we’ve used above.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/07/pg00.excalidraw.png&#34; alt=&#34;pg00.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;First, create and populate Postgres table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;clicks&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;click_ts&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ZONE&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ad_cost&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;38&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;is_conversion&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;BOOLEAN&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;user_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;

&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;clicks&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ad_cost&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;is_conversion&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;user_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2023-02-01 13:30:25+00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;001234567890&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Then check we’ve got the Debezium connector installed on our Kafka Connect worker:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl get plugins &lt;span style=&#34;color: #f92672&#34;&gt;--types&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;source

 &lt;/span&gt;TYPE     CLASS                                                       VERSION
 &lt;span style=&#34;color: #f8f8f2&#34;&gt;source   &lt;/span&gt;io.debezium.connector.postgresql.PostgresConnector          3.1.2.Final&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and create a Debezium source connector:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;postgres-clicks-source&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.debezium.connector.postgresql.PostgresConnector&amp;#34;,
    &amp;#34;database.hostname&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;database.port&amp;#34;: &amp;#34;5432&amp;#34;,
    &amp;#34;database.user&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;database.password&amp;#34;: &amp;#34;Welcome123&amp;#34;,
    &amp;#34;database.dbname&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;table.include.list&amp;#34;: &amp;#34;public.clicks&amp;#34;,
    &amp;#34;topic.prefix&amp;#34;: &amp;#34;dbz&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Using kcctl we can see that the connector is running, and writing data to a topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl describe connector postgres-clicks-source
Name:       postgres-clicks-source
Type:       &lt;span style=&#34;color: #f8f8f2&#34;&gt;source
&lt;/span&gt;State:      RUNNING
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]
Topics:
  dbz.public.clicks&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If we take a look at the topic we can quickly see a mistake I’ve made in the configuration of the connector:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt; docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-T&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #f92672&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #f92672&#34;&gt;-C&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-t&lt;/span&gt; dbz.public.clicks &lt;span style=&#34;color: #f92672&#34;&gt;-c1&lt;/span&gt;

&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;schema&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;struct&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;fields&amp;#34;&lt;/span&gt;:[&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;struct&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;fields&amp;#34;&lt;/span&gt;:[&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;string&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;optional&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;io.debezium.time.ZonedTimestamp&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;version&amp;#34;&lt;/span&gt;:1,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;field&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;click_ts&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;,&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;bytes&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;optional&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;org.apache.kafka.connect.data.Decimal&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;version&amp;#34;&lt;/span&gt;:1,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;parameters&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;scale&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;connect.decimal.precision&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;38&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;field&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;ad_cost&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;,&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;boolean&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;optional&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;field&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;is_conversion&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;,&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;string&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;optional&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;field&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}]&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;optional&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;dbz.public.clicks.Value&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;field&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;before&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;,&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;struct&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;fields&amp;#34;&lt;/span&gt;:[&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;string&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;optional&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;name&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;io.debezium.time.ZonedTimestamp&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;version&amp;#34;&lt;/span&gt;:1,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;field&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;click_ts&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;,&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;type&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;bytes&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;optional&amp;#34;&lt;/span&gt;:true,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;name
[…]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;It’s using the &lt;code&gt;JsonConverter&lt;/code&gt; with an embedded schema.
That’s not what we want, so let’s create a new version of the connector.
It’s important to create a new version, because the existing one won’t re-read messages from the topic just because we change its configuration because logically it has processed that data already.
We also need to make sure we write to a different topic; writing JSON and Avro to the same Kafka topic is a recipe for disaster (or at least, wailing and gnashing of teeth when a sink connector spectacularly fails to read the messages).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl delete connector postgres-clicks-source

&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;postgres-clicks-source-avro&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.debezium.connector.postgresql.PostgresConnector&amp;#34;,
    &amp;#34;database.hostname&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;database.port&amp;#34;: &amp;#34;5432&amp;#34;,
    &amp;#34;database.user&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;database.password&amp;#34;: &amp;#34;Welcome123&amp;#34;,
    &amp;#34;database.dbname&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;table.include.list&amp;#34;: &amp;#34;public.clicks&amp;#34;,
    &amp;#34;topic.prefix&amp;#34;: &amp;#34;dbz-avro&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we can see the Avro data in the topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-T&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #f92672&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #f92672&#34;&gt;-C&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-t&lt;/span&gt; dbz-avro.public.clicks &lt;span style=&#34;color: #f92672&#34;&gt;-c1&lt;/span&gt;

62023-02-01T13:30:25.000000Z0012345678903.1.2.Finalpostgresqldbz-avroe
firstpostgres&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;[null,&amp;#34;&lt;/span&gt;34511440&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;]Ђӻ0
                                  public
                                        clicks
                                               reʷӻ0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To deserialise it correctly we use &lt;code&gt;-s avro&lt;/code&gt; as above, and we see that &lt;a href=&#34;https://debezium.io/documentation/reference/stable/transformations/event-flattening.html#_change_event_structure&#34;&gt;the payload from Debezium&lt;/a&gt; is more complex than a simple message:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-T&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #f92672&#34;&gt;-C&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #f92672&#34;&gt;-t&lt;/span&gt; dbz-avro.public.clicks &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
                        &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; avro &lt;span style=&#34;color: #f92672&#34;&gt;-r&lt;/span&gt; http://schema-registry:8081 &lt;span style=&#34;color: #f92672&#34;&gt;-c1&lt;/span&gt; | jq &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;before&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;after&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Value&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;2023-02-01T13:30:25.000000Z&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ad_cost&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;is_conversion&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;boolean&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;true&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;user_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;001234567890&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;source&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;version&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;3.1.2.Final&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;connector&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;postgresql&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;dbz-avro&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ts_ms&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1751447315595&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;snapshot&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;first&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;db&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;postgres&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Debezium, and any good CDC tool in general, doesn’t just capture the current state of a row; it captures &lt;em&gt;changes&lt;/em&gt;.
Since this is the initial snapshot, we have a blank &lt;code&gt;before&lt;/code&gt; section, the payload in &lt;code&gt;after&lt;/code&gt; (i.e. current state), and then some metadata (&lt;code&gt;source&lt;/code&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You &lt;em&gt;might&lt;/em&gt; want all of this raw change data sent to Iceberg, but more likely is that you just want the current state of the record.
To do this you can use a Kafka Connect Single Message Transformation (SMT).
Both Iceberg and Debezium ship with their own SMTs to do this.
Iceberg has &lt;a href=&#34;https://iceberg.apache.org/docs/nightly/kafka-connect/#debeziumtransform&#34;&gt;&lt;code&gt;DebeziumTransform&lt;/code&gt;&lt;/a&gt; and Debezium &lt;a href=&#34;https://debezium.io/documentation/reference/stable/transformations/event-flattening.html&#34;&gt;&lt;code&gt;ExtractNewRecordState&lt;/code&gt;&lt;/a&gt;.
The differences between them that I can tell are:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The Iceberg one is marked experimental, whilst the Debezium one has been used in production for years&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The Iceberg one adds CDC metadata fields (operation type, offset, etc) along with the record state, whilst to do this with the Debezium one you’d need to include the &lt;a href=&#34;https://debezium.io/documentation/reference/stable/transformations/event-flattening.html#extract-new-record-state-add-fields&#34;&gt;&lt;code&gt;add.fields&lt;/code&gt;&lt;/a&gt; option.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s try the Iceberg one, which we’ll configure as part of the new sink connector itself:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-postgres-clicks&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;dbz-avro.public.clicks&amp;#34;,
    &amp;#34;iceberg.tables&amp;#34;: &amp;#34;rmoff_db.postgres_clicks&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/01/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;transforms&amp;#34;: &amp;#34;dbz&amp;#34;,
    &amp;#34;transforms.dbz.type&amp;#34;: &amp;#34;io.tabular.iceberg.connect.transforms.DebeziumTransform&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the resulting Iceberg table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ describe postgres_clicks;
┌───────────────┬──────────────────────────────────────────────────────────────┬
│  column_name  │                                           column_type        │
│    varchar    │                                             varchar          │
├───────────────┼──────────────────────────────────────────────────────────────┼
│ click_ts      │ VARCHAR                                                      │
│ ad_cost       │ DECIMAL(38,2)                                                │
│ is_conversion │ BOOLEAN                                                      │
│ user_id       │ VARCHAR                                                      │
│ _cdc          │ STRUCT(op VARCHAR, ts TIMESTAMP WITH TIME ZONE,              │
│               │        &amp;#34;offset&amp;#34; BIGINT, source VARCHAR, target VARCHAR)      │
└───────────────┴──────────────────────────────────────────────────────────────┴&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT * FROM postgres_clicks;
┌─────────────────────────────┬───────────────┬───────────────┬──────────────┬[…]
│          click_ts           │    ad_cost    │ is_conversion │   user_id    │[…]
│           varchar           │ decimal(38,2) │    boolean    │   varchar    │[…]
├─────────────────────────────┼───────────────┼───────────────┼──────────────┼[…]
│ 2023-02-01T13:30:25.000000Z │          1.50 │ true          │ 001234567890 │[…]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_data_type_fun_timestamps&#34;&gt;Data Type Fun: Timestamps&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;One data type issue this time—pun intended.
The &lt;code&gt;click_ts&lt;/code&gt; should be a timestamp, but is showing up as a string in Iceberg.
To understand where this is occurring, I’ll start by checking the schema that Debezium wrote to the Schema Registry when it wrote the data to Kafka:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;http http://localhost:8081/subjects/dbz-avro.public.clicks-value/versions/latest | &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    jq &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;.schema | fromjson&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;string&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;connect.version&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;connect.name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;io.debezium.time.ZonedTimestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;],&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;default&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;null&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;},&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Per &lt;a href=&#34;https://debezium.io/documentation/reference/stable/connectors/postgresql.html#postgresql-basic-types&#34;&gt;the docs&lt;/a&gt;, it’s stored as a &lt;code&gt;string&lt;/code&gt;, but using the Kafka Connect logical type &lt;code&gt;io.debezium.time.ZonedTimestamp&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s have a look at the &lt;a href=&#34;https://rmoff.net/2020/12/17/twelve-days-of-smt-day-8-timestampconverter/&#34;&gt;TimestampConverter SMT&lt;/a&gt;.
This will hopefully let us convert the &lt;code&gt;string&lt;/code&gt; type (which holds the timestamp) into a logical &lt;code&gt;Timestamp&lt;/code&gt; type as part of the sink connector.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-postgres-clicks-new&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;dbz-avro.public.clicks&amp;#34;,
    &amp;#34;iceberg.tables&amp;#34;: &amp;#34;rmoff_db.postgres_clicks&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;transforms&amp;#34;: &amp;#34;dbz,convert_ts&amp;#34;, &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &amp;#34;transforms.dbz.type&amp;#34;: &amp;#34;io.tabular.iceberg.connect.transforms.DebeziumTransform&amp;#34;,
    &amp;#34;transforms.convert_ts.type&amp;#34; : &amp;#34;org.apache.kafka.connect.transforms.TimestampConverter&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Value&amp;#34;,
    &amp;#34;transforms.convert_ts.field&amp;#34; : &amp;#34;click_ts&amp;#34;,
    &amp;#34;transforms.convert_ts.format&amp;#34;: &amp;#34;yyyy-MM-dd&amp;#39;T&amp;#39;HH:mm:ss.SSSSSS&amp;#39;Z&amp;#39;&amp;#34;,
    &amp;#34;transforms.convert_ts.target.type&amp;#34;: &amp;#34;Timestamp&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The order of the transformations is important; for the &lt;code&gt;convert_ts&lt;/code&gt; transform to work the &lt;code&gt;click_ts&lt;/code&gt; field needs to have been unnested, which is what the &lt;code&gt;dbz&lt;/code&gt; transform does first.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With the initial &lt;code&gt;postgres_clicks&lt;/code&gt; Iceberg table deleted, and the new version of the connector running (so as to make sure that the table gets recreated with-hopefully—the correct schema), we see this in Iceberg:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ describe postgres_clicks;
┌───────────────┬─────────────────────────────────────────────────────────────────[…]
│  column_name  │                                           column_type           […]
│    varchar    │                                             varchar             […]
├───────────────┼─────────────────────────────────────────────────────────────────[…]
│ click_ts      │ TIMESTAMP WITH TIME ZONE                                        […]
│ ad_cost       │ DECIMAL(38,2)                                                   […]
│ is_conversion │ BOOLEAN                                                         […]
│ user_id       │ VARCHAR                                                         […]
│ _cdc          │ STRUCT(op VARCHAR, ts TIMESTAMP WITH TIME ZONE, &amp;#34;offset&amp;#34; BIGINT,[…]
└───────────────┴─────────────────────────────────────────────────────────────────[…]

🟡◗ select click_ts, ad_cost, is_conversion, user_id from postgres_clicks;
┌──────────────────────────┬───────────────┬───────────────┬──────────────┐
│         click_ts         │    ad_cost    │ is_conversion │   user_id    │
│ timestamp with time zone │ decimal(38,2) │    boolean    │   varchar    │
├──────────────────────────┼───────────────┼───────────────┼──────────────┤
│ 2023-02-01 13:30:25+00   │          1.50 │ true          │ 001234567890 │
└──────────────────────────┴───────────────┴───────────────┴──────────────┘&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Compare the data types and data to the Postgres source:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;postgres=# \d clicks
                           Table &amp;#34;public.clicks&amp;#34;
    Column     |           Type           | Collation | Nullable | Default
---------------+--------------------------+-----------+----------+---------
 click_ts      | timestamp with time zone |           |          |
 ad_cost       | numeric(38,2)            |           |          |
 is_conversion | boolean                  |           |          |
 user_id       | character varying        |           |          |

postgres=# select * from clicks;
        click_ts        | ad_cost | is_conversion |   user_id
------------------------+---------+---------------+--------------
 2023-02-01 13:30:25+00 |    1.50 | t             | 001234567890&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Perfect!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you’re using &lt;code&gt;TIMESTAMP&lt;/code&gt; instead of &lt;code&gt;TIMESTAMP WITH TIME ZONE&lt;/code&gt; in Postgres then Debezium will store this as&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;long&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;connect.version&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;connect.name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;io.debezium.time.MicroTimestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and the Iceberg Kafka Connect sink write it, by default, as a &lt;code&gt;BIGINT&lt;/code&gt; to Iceberg (matching the &lt;code&gt;long&lt;/code&gt; logical type in the schema).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can use the same &lt;code&gt;TimestampConverter&lt;/code&gt; trick as above, instead specifying &lt;code&gt;unix.precision&lt;/code&gt; so that the transform treats the source value as an epoch value, converting it into a timestamp:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms.convert_ts.type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;org.apache.kafka.connect.transforms.TimestampConverter$Value&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms.convert_ts.field&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms.convert_ts.unix.precision&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;microseconds&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms.convert_ts.target.type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Timestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The only problem is that this ends up in Iceberg as a &lt;code&gt;TIMESTAMP WITH TIME ZONE&lt;/code&gt;—i.e. &lt;em&gt;includes&lt;/em&gt; time zone, even though the source doesn’t.&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_schema_evolution&#34;&gt;Schema Evolution&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What happens when we add a column to the source data being sent through the Kafka Connect Iceberg sink?
Let’s try it!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;clicks&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ADD&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;COLUMN&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;campaign_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;character&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;varying&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;

&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;clicks&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;click_ts&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ad_cost&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;is_conversion&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;user_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;campaign_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-07-03 14:30:00+00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;user_12345&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;campaign_summer_2025&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The table now looks like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;postgres=# SELECT * FROM clicks;
        click_ts        | ad_cost | is_conversion |   user_id    |     campaign_id
------------------------+---------+---------------+--------------+----------------------
 2023-02-01 13:30:25+00 |    1.50 | t             | 001234567890 |                          &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
 2025-07-03 14:30:00+00 |    2.50 | t             | user_12345   | campaign_summer_2025&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;This row existed already, so has no value for the new field, &lt;code&gt;campaign_id&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Over in Iceberg, we can see the new row—but no new column:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ select * from postgres_clicks;
┌──────────────────────┬───────────────┬───────────────┬──────────────┬─────────────────────[…]
│       click_ts       │    ad_cost    │ is_conversion │   user_id    │                     […]
│ timestamp with tim…  │ decimal(38,2) │    boolean    │   varchar    │  struct(op varchar, […]
├──────────────────────┼───────────────┼───────────────┼──────────────┼─────────────────────[…]
│ 2025-07-03 15:30:0…  │          2.50 │ true          │ user_12345   │ {&amp;#39;op&amp;#39;: I, &amp;#39;ts&amp;#39;: &amp;#39;202[…]
│ 2023-02-01 13:30:2…  │          1.50 │ true          │ 001234567890 │ {&amp;#39;op&amp;#39;: I, &amp;#39;ts&amp;#39;: &amp;#39;202[…]
└──────────────────────┴───────────────┴───────────────┴──────────────┴─────────────────────[…]

🟡◗ DESCRIBE postgres_clicks;
┌───────────────┬───────────────────────────────────────────────────────────────────────────[…]
│  column_name  │                                           column_type                     […]
│    varchar    │                                             varchar                       […]
├───────────────┼───────────────────────────────────────────────────────────────────────────[…]
│ click_ts      │ TIMESTAMP WITH TIME ZONE                                                  […]
│ ad_cost       │ DECIMAL(38,2)                                                             […]
│ is_conversion │ BOOLEAN                                                                   […]
│ user_id       │ VARCHAR                                                                   […]
│ _cdc          │ STRUCT(op VARCHAR, ts TIMESTAMP WITH TIME ZONE, &amp;#34;offset&amp;#34; BIGINT, source VA[…]
└───────────────┴───────────────────────────────────────────────────────────────────────────[…]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;A quick perusal of &lt;a href=&#34;https://iceberg.apache.org/docs/nightly/kafka-connect/#configuration&#34;&gt;the docs&lt;/a&gt; points us at &lt;code&gt;iceberg.tables.evolve-schema-enabled&lt;/code&gt;, which is &lt;code&gt;false&lt;/code&gt; by default.
As a side note, whilst the docs are good, you can also get a quick look at the configuration options a connector has by looking at the Kafka Connect worker log file for &lt;code&gt;IcebergSinkConfig values&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;[2025-07-03 09:28:58,309] INFO [iceberg-sink-postgres-clicks-new|task-0] IcebergSinkConfig values:
  iceberg.catalog = iceberg
  iceberg.connect.group-id = null
  iceberg.control.commit.interval-ms = 1000
  iceberg.control.commit.threads = 28
  iceberg.control.commit.timeout-ms = 1000
  iceberg.control.group-id = null
  iceberg.control.topic = control-iceberg
  iceberg.hadoop-conf-dir = null
  iceberg.tables = [rmoff_db.postgres_clicks]
  iceberg.tables.auto-create-enabled = true
  iceberg.tables.cdc-field = null
  iceberg.tables.default-commit-branch = null
  iceberg.tables.default-id-columns = null
  iceberg.tables.default-partition-by = null
  iceberg.tables.dynamic-enabled = false
  iceberg.tables.evolve-schema-enabled = false
  iceberg.tables.route-field = null
  iceberg.tables.schema-case-insensitive = false
  iceberg.tables.schema-force-optional = false
  iceberg.tables.upsert-mode-enabled = false&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So, let’s create a new version of this connector and test it out.
I’m going to follow the same pattern as above; create the initial table and add a row, make sure it syncs to a new Iceberg table, then alter the table and add another row and see if that propagates as expected.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-postgres-clicks01&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;dbz-avro.public.clicks01&amp;#34;,
    &amp;#34;iceberg.tables&amp;#34;: &amp;#34;rmoff_db.postgres_clicks01&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;transforms&amp;#34;: &amp;#34;dbz,convert_ts&amp;#34;,
    &amp;#34;transforms.dbz.type&amp;#34;: &amp;#34;io.tabular.iceberg.connect.transforms.DebeziumTransform&amp;#34;,
    &amp;#34;transforms.convert_ts.type&amp;#34; : &amp;#34;org.apache.kafka.connect.transforms.TimestampConverter&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Value&amp;#34;,
    &amp;#34;transforms.convert_ts.field&amp;#34; : &amp;#34;click_ts&amp;#34;,
    &amp;#34;transforms.convert_ts.format&amp;#34;: &amp;#34;yyyy-MM-dd&amp;#39;T&amp;#39;HH:mm:ss.SSSSSS&amp;#39;Z&amp;#39;&amp;#34;,
    &amp;#34;transforms.convert_ts.target.type&amp;#34;: &amp;#34;Timestamp&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This works exactly as I’d hoped.
The Iceberg table has the new field (&lt;code&gt;campaign_id&lt;/code&gt;, after the &lt;code&gt;_cdc&lt;/code&gt; metadata):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ DESCRIBE postgres_clicks01;
┌───────────────┬───────────────────────────────────────────────────────────────────────────[…]
│  column_name  │                                           column_type                     […]
│    varchar    │                                             varchar                       […]
├───────────────┼───────────────────────────────────────────────────────────────────────────[…]
│ click_ts      │ TIMESTAMP WITH TIME ZONE                                                  […]
│ ad_cost       │ DECIMAL(38,2)                                                             […]
│ is_conversion │ BOOLEAN                                                                   […]
│ user_id       │ VARCHAR                                                                   […]
│ _cdc          │ STRUCT(op VARCHAR, ts TIMESTAMP WITH TIME ZONE, &amp;#34;offset&amp;#34; BIGINT, source VA[…]
│ campaign_id   │ VARCHAR                                                                   […]
└───────────────┴───────────────────────────────────────────────────────────────────────────[…]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and the new data is present too:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ select click_ts, ad_cost, is_conversion, user_id, campaign_id from postgres_clicks01;
┌──────────────────────────┬───────────────┬───────────────┬──────────────┬──────────────────[…]
│         click_ts         │    ad_cost    │ is_conversion │   user_id    │     campaign_id  […]
│ timestamp with time zone │ decimal(38,2) │    boolean    │   varchar    │       varchar    […]
├──────────────────────────┼───────────────┼───────────────┼──────────────┼──────────────────[…]
│ 2023-02-01 13:30:25+00   │          1.50 │ true          │ 001234567890 │ NULL             […]
│ 2025-07-03 15:30:00+01   │          2.50 │ true          │ user_12345   │ campaign_summer_2[…]
└──────────────────────────┴───────────────┴───────────────┴──────────────┴──────────────────[…]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_nn_many_to_many_sending_data_from_multiple_topics_to_many_iceberg_tables&#34;&gt;N:N (Many-to-Many / Sending data from multiple topics to many Iceberg tables)&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So far I’ve shown you how to get one Postgres table to one Iceberg table.
Or to be more precise: one Kafka topic to one Iceberg table.
The Kafka Connect Iceberg sink simply reads from a Kafka topic, and that topic can be populated by anything, including Kafka Connect source connectors, or applications directly.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Anyway, what about writing to multiple Iceberg tables.
Does that mean multiple Kafka Connect Iceberg sink instances?
No!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With Kafka Connect you can specify a list of topics with &lt;a href=&#34;https://kafka.apache.org/documentation/#sinkconnectorconfigs_topics&#34;&gt;&lt;code&gt;topics&lt;/code&gt;&lt;/a&gt;, or a regex with &lt;a href=&#34;https://kafka.apache.org/documentation/#sinkconnectorconfigs_topics.regex&#34;&gt;&lt;code&gt;topics.regex&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s try it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’m going to stick with Postgres here for my example to populate the multiple topics that we’ll then read from and send to multiple Postgres tables.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/07/kcpgnn.excalidraw.png&#34; alt=&#34;kcpgnn.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;There are four tables in my schema:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=#&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dt&lt;/span&gt;
           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;List&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;relations&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Schema&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Name&lt;/span&gt;    &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Type&lt;/span&gt;  &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Owner&lt;/span&gt;
&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;--------+-----------+-------+----------&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;europe&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;europe&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;    &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;europe&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;products&lt;/span&gt;  &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;europe&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;shipments&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’ll create a Debezium connector that’s going to pick up all of them (&lt;code&gt;&amp;#34;schema.include.list&amp;#34;: &amp;#34;europe&amp;#34;,&lt;/code&gt;), writing each to its own Kafka topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;postgres-europe&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.debezium.connector.postgresql.PostgresConnector&amp;#34;,
    &amp;#34;database.hostname&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;database.port&amp;#34;: &amp;#34;5432&amp;#34;,
    &amp;#34;database.user&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;database.password&amp;#34;: &amp;#34;Welcome123&amp;#34;,
    &amp;#34;database.dbname&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;schema.include.list&amp;#34;: &amp;#34;europe&amp;#34;,
    &amp;#34;topic.prefix&amp;#34;: &amp;#34;dbz-avro&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With this running, we can see that it’s writing to four Kafka topics, as expected:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl describe connector postgres-europe
Name:       postgres-europe
Type:       &lt;span style=&#34;color: #f8f8f2&#34;&gt;source
&lt;/span&gt;State:      RUNNING
Worker ID:  kafka-connect:8083
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]
Topics:
  dbz-avro.europe.customers
  dbz-avro.europe.orders
  dbz-avro.europe.products
  dbz-avro.europe.shipments&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To send these to Iceberg we need to tell the sink connector to handle multiple source topics.
For it to read from multiple topics we use &lt;code&gt;topics.regex&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;topics.regex&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;dbz-avro.europe.*&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When it comes to specifying the target Iceberg table you have two options:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Use &lt;code&gt;iceberg.tables&lt;/code&gt;.
You can put a comma-separated list of tables here, but as far as I can tell all that will do is write the same source data to each of the target tables (i.e. you end up with multiple Iceberg tables with the same contents).
This won’t work for multiple source topics if they have different schemas.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Set &lt;code&gt;iceberg.tables.dynamic-enabled&lt;/code&gt; to &lt;code&gt;true&lt;/code&gt;, and then specify in &lt;code&gt;iceberg.tables.route-field&lt;/code&gt; the &lt;em&gt;field&lt;/em&gt; within the topic that holds the name of the target Iceberg table to write to.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Using dynamic routing works fine if you’ve got a single source topic that holds this field.
The example in the documentation is a list of events with different &lt;code&gt;type&lt;/code&gt; values, and each event is routed to a different Iceberg table named based on the event type.
For our purpose here though we need to be a bit more imaginative.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The source data itself doesn’t hold any values that we can use for the table name.
For example, in &lt;code&gt;products&lt;/code&gt;, which field name can we use as the target table name?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;postgres=# \d products
                                        Table &amp;#34;europe.products&amp;#34;
     Column     |          Type          | Collation | Nullable |               Default
----------------+------------------------+-----------+----------+--------------------------[…]
 id             | integer                |           | not null | nextval(&amp;#39;products_id_seq&amp;#39;[…]
 product_name   | character varying(255) |           | not null |
 category       | character varying(100) |           |          |
 price          | numeric(10,2)          |           | not null |
 stock_quantity | integer                |           |          | 0&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;None of them.
But what about in the metadata that Debezium provides?
Here’s a snippet of the message that Debezium writes to Kafka:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;before&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;after&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;source&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;version&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;3.1.2.Final&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;connector&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;postgresql&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;dbz-avro&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;schema&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;europe&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;  &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;products&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Table name and schema!&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s try that in the Iceberg connector:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-postgres-europe&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics.regex&amp;#34;: &amp;#34;dbz-avro.europe.*&amp;#34;,
    &amp;#34;iceberg.tables.dynamic-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.route-field&amp;#34;: &amp;#34;source.table&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;transforms&amp;#34;: &amp;#34;dbz&amp;#34;,
    &amp;#34;transforms.dbz.type&amp;#34;: &amp;#34;io.tabular.iceberg.connect.transforms.DebeziumTransform&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;However, this fails:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;org.apache.kafka.connect.errors.DataException: source is not a valid field name&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;After a bit of Googling around I realised that perhaps the &lt;code&gt;route-field&lt;/code&gt; is applied &lt;em&gt;after&lt;/em&gt; the &lt;code&gt;DebeziumTransform&lt;/code&gt; in the sink, and so need to be thinking about the final record schema.
Fortunately we still have a table as part of that data as part of the &lt;code&gt;_cdc&lt;/code&gt; field that the &lt;code&gt;DebeziumTransform&lt;/code&gt; adds.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So let’s try it with &lt;code&gt;&amp;#34;iceberg.tables.route-field&amp;#34;:&amp;#34;_cdc.target&amp;#34;&lt;/code&gt;.
Now we get a different error, and one that looks a bit more hopeful:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;software.amazon.awssdk.services.glue.model.EntityNotFoundException: Database europe not found.&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You might wonder why I say that this is more hopeful :)
That’s because it’s &lt;em&gt;found&lt;/em&gt; the field!
It’s just not happy with it, because it’s taken the schema from Postgres (&lt;code&gt;europe&lt;/code&gt; in our example here) as the Iceberg &lt;em&gt;database&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Fortunately in &lt;a href=&#34;https://iceberg.apache.org/docs/nightly/kafka-connect/#debeziumtransform&#34;&gt;the docs&lt;/a&gt; for the &lt;code&gt;DebeziumTransform&lt;/code&gt; we find the configuration option &lt;code&gt;cdc.target.pattern&lt;/code&gt; which we’re told defaults to &lt;code&gt;{db}.{table}&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s change it to move the schema to a table prefix (separated by an underscore: &lt;code&gt;{db}_{table}&lt;/code&gt;), and hardcode in the database that I want to use, and see what happens:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-postgres-europe&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics.regex&amp;#34;: &amp;#34;dbz-avro.europe.*&amp;#34;,
    &amp;#34;iceberg.tables.dynamic-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.route-field&amp;#34;:&amp;#34;_cdc.target&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;transforms&amp;#34;: &amp;#34;dbz&amp;#34;,
    &amp;#34;transforms.dbz.type&amp;#34;: &amp;#34;io.tabular.iceberg.connect.transforms.DebeziumTransform&amp;#34;,
    &amp;#34;transforms.dbz.cdc.target.pattern&amp;#34;: &amp;#34;rmoff_db.{db}_{table}&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;It works!
Over in Iceberg we have the four tables in the &lt;code&gt;rmoff_db&lt;/code&gt; database and a &lt;code&gt;europe_&lt;/code&gt; prefix:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SHOW TABLES;
┌───────────────────────────┐
│           name            │
│          varchar          │
├───────────────────────────┤
[…]
│ europe_customers          │
│ europe_orders             │
│ europe_products           │
│ europe_shipments          │&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_dynamic_routing_from_topics_without_a_routing_field&#34;&gt;Dynamic routing from topics without a routing field&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The above is neat, but what if we are sending data from Kafka topics that &lt;em&gt;haven’t&lt;/em&gt; been populated by Debezium?
In that case we won’t be able to rely on having the name of a source table to assume as the name for the target Iceberg table.
Consider this Kafka topic, based on the one at the opening of this article:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;title&#34;&gt;orders_json&lt;/div&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;001&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;cust_123&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;product&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;laptop&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;quantity&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;price&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;999.99&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;No target topic name anywhere in the schema.
If it’s just one topic, we can hardcode the &lt;code&gt;iceberg.tables&lt;/code&gt; value.
But what about if we’ve got more topics like this, perhaps &lt;code&gt;products_json&lt;/code&gt; too?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;title&#34;&gt;products_json&lt;/div&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;product_id&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;prod_001&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Gaming Laptop&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Electronics&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;price&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1299.99&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;stock&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We could run two Kafka Connect Iceberg sinks, but that’d be missing the point of the ability of Kafka Connect to work with multiple sources and targets.
We’d also end up with a lot of repeated configuration to align across the sinks.
And what about if we then add another table?
Create another sink?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Ideally we want to do something like this, and pick up &lt;em&gt;all&lt;/em&gt; topics matching a pattern, such as any that end in &lt;code&gt;_json&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;topics.regex&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;.*&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;_json&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But how to route them sensibly to an Iceberg table based on their &lt;em&gt;topic&lt;/em&gt; name, rather than a field within the payload itself (which is what the Iceberg sink’s dynamic routing is based on).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;SMTs to the rescue again!
This time one that’s built into Kafka Connect: &lt;a href=&#34;https://rmoff.net/2020/12/15/twelve-days-of-smt-day-6-insertfield-ii/&#34;&gt;&lt;code&gt;InsertField&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;                         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;insertTopic&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms.insertTopic.type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;org.apache.kafka.connect.transforms.InsertField$Value&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms.insertTopic.topic.field&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;srcTopic&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Putting it together into a Sink connector config looks like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-json-topics&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics.regex&amp;#34;: &amp;#34;.*_json&amp;#34;,
    &amp;#34;iceberg.tables.dynamic-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.route-field&amp;#34;:&amp;#34;srcTopic&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;key.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;value.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;value.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;transforms&amp;#34; : &amp;#34;insertTopic&amp;#34;,
    &amp;#34;transforms.insertTopic.type&amp;#34; : &amp;#34;org.apache.kafka.connect.transforms.InsertField&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Value&amp;#34;,
    &amp;#34;transforms.insertTopic.topic.field&amp;#34; : &amp;#34;srcTopic&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Unfortunately this fails:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;java.lang.IllegalArgumentException: Invalid table identifier: products_json&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;That’s because an Iceberg table needs to be qualified by its database.
There’s no way that I can see in the connector to specify a default database.
There’s also no way in the &lt;code&gt;InsertField&lt;/code&gt; SMT to insert both some static text (the database qualifier) and the dynamic topic name
Argh!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Unless…unless…we change the topic name in-flight &lt;em&gt;first&lt;/em&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;                         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;addDbPrefix&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms.addDbPrefix.type&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;org.apache.kafka.connect.transforms.RegexRouter&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms.addDbPrefix.regex&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;.*&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;transforms.addDbPrefix.replacement&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;rmoff_db.$0&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s chain these together and see.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-json-topics&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics.regex&amp;#34;: &amp;#34;.*_json&amp;#34;,
    &amp;#34;iceberg.tables.dynamic-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.route-field&amp;#34;:&amp;#34;srcTopic&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;key.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;value.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;value.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;transforms&amp;#34; : &amp;#34;addDbPrefix, insertTopic&amp;#34;,
    &amp;#34;transforms.addDbPrefix.type&amp;#34; : &amp;#34;org.apache.kafka.connect.transforms.RegexRouter&amp;#34;,
    &amp;#34;transforms.addDbPrefix.regex&amp;#34; : &amp;#34;.*&amp;#34;,
    &amp;#34;transforms.addDbPrefix.replacement&amp;#34; : &amp;#34;rmoff_db.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$0&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;,
    &amp;#34;transforms.insertTopic.type&amp;#34; : &amp;#34;org.apache.kafka.connect.transforms.InsertField&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Value&amp;#34;,
    &amp;#34;transforms.insertTopic.topic.field&amp;#34; : &amp;#34;srcTopic&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What happened next may surprise you!
It certainly had me scratching my head.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;Caused by: java.lang.IllegalArgumentException: Invalid table identifier: rmoff_db.-zsh&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Wuuuuh… eh?!
Where has &lt;code&gt;-zsh&lt;/code&gt; come from??&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In short, I hadn’t escaped the &lt;code&gt;$&lt;/code&gt; of the &lt;code&gt;$0&lt;/code&gt; in my config, meaning that &lt;code&gt;$0&lt;/code&gt; was interpreted as a &lt;a href=&#34;https://www.gnu.org/software/bash/manual/bash.html#Special-Parameters&#34;&gt;special shell parameter&lt;/a&gt; and replaced with &lt;code&gt;-zsh&lt;/code&gt; &lt;em&gt;when it was passed to kcctl&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We can validate this by looking closely at the &lt;code&gt;kcctl describe connector&lt;/code&gt; output:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl describe connector iceberg-sink-json-topics
Name:       iceberg-sink-json-topics
Type:       sink
State:      RUNNING
Worker ID:  kafka-connect:8083
Config:
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]
  transforms.addDbPrefix.replacement:    rmoff_db.-zsh&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s escape the &lt;code&gt;$&lt;/code&gt; and try again:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-json-topics&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics.regex&amp;#34;: &amp;#34;.*_json&amp;#34;,
    &amp;#34;iceberg.tables.dynamic-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.route-field&amp;#34;:&amp;#34;srcTopic&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;key.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;value.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;value.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;transforms&amp;#34; : &amp;#34;addDbPrefix, insertTopic&amp;#34;,
    &amp;#34;transforms.addDbPrefix.type&amp;#34; : &amp;#34;org.apache.kafka.connect.transforms.RegexRouter&amp;#34;,
    &amp;#34;transforms.addDbPrefix.regex&amp;#34; : &amp;#34;.*&amp;#34;,
    &amp;#34;transforms.addDbPrefix.replacement&amp;#34; : &amp;#34;rmoff_db.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;0&amp;#34;,
    &amp;#34;transforms.insertTopic.type&amp;#34; : &amp;#34;org.apache.kafka.connect.transforms.InsertField&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Value&amp;#34;,
    &amp;#34;transforms.insertTopic.topic.field&amp;#34; : &amp;#34;srcTopic&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;As if by magic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ show tables;
┌───────────────────────────┐
│           name            │
│          varchar          │
├───────────────────────────┤
│ orders_json               │
│ products_json             │
[…]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock warning&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-warning&#34; title=&#34;Warning&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;At this point though, the news isn’t so good.
Whilst the tables are created in the catalog as shown above, only the data files and initial metadata are written to storage; no snapshot is created by the commit process.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws s3 &lt;span style=&#34;color: #f92672&#34;&gt;--recursive&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;ls &lt;/span&gt;s3://rmoff-lakehouse/02
2025-07-03 17:03:11       2232 02/rmoff_db.db/orders_json/data/00001-1751558478326-e7f95114-8e7e-4505-886c-940db4a01835-00001.parquet
2025-07-03 17:01:18       1429 02/rmoff_db.db/orders_json/metadata/00000-c1b90515-019b-4856-a1f0-33e842b700e7.metadata.json
2025-07-03 17:03:11       2341 02/rmoff_db.db/products_json/data/00001-1751558480636-817e3f1d-e7ce-4a1d-a593-648048137863-00001.parquet
2025-07-03 17:01:20       1424 02/rmoff_db.db/products_json/metadata/00000-ad7c28f3-4ce6-4370-a6a2-8b434b4e5348.metadata.json&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’ve &lt;a href=&#34;https://github.com/apache/iceberg/issues/13457&#34;&gt;logged this as a bug (#13457)&lt;/a&gt; that seems to be related to the use of SMTs to populate the field used by &lt;code&gt;iceberg.tables.dynamic-enabled&lt;/code&gt; / &lt;code&gt;iceberg.tables.route-field&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Dynamic routing &lt;strong&gt;does&lt;/strong&gt; work—as I showed above—if you’re using &lt;code&gt;route-field&lt;/code&gt; with &lt;strong&gt;a regular field that already exists in the message&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_n1_fan_in_writing_many_topics_to_one_table&#34;&gt;N:1 (Fan In / Writing many topics to one table)&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s now look at a variation on the above.
Instead of many topics written each to their own table, what about multiple topics writing to the same table?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/07/n1.excalidraw.png&#34; alt=&#34;n1.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is a common requirement when data is sharded across geographies or business units, for example.
I’m using Postgres again as my source example, but this could equally just be any Kafka topic populated by any application.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this example there is an instance of the &lt;code&gt;orders&lt;/code&gt; table across multiple schemas:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;table_schema&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table_name&lt;/span&gt;
&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;--------------+------------&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;asia&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;europe&lt;/span&gt;       &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;us_east&lt;/span&gt;      &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;us_west&lt;/span&gt;      &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With Debezium we capture these into four Kafka topics (by specifying a regex &lt;code&gt;&amp;#34;table.include.list&amp;#34;: &amp;#34;.*orders&amp;#34;&lt;/code&gt;):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;postgres-orders&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.debezium.connector.postgresql.PostgresConnector&amp;#34;,
    &amp;#34;database.hostname&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;database.port&amp;#34;: &amp;#34;5432&amp;#34;,
    &amp;#34;database.user&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;database.password&amp;#34;: &amp;#34;Welcome123&amp;#34;,
    &amp;#34;database.dbname&amp;#34;: &amp;#34;postgres&amp;#34;,
    &amp;#34;table.include.list&amp;#34;: &amp;#34;.*orders&amp;#34;,
    &amp;#34;topic.prefix&amp;#34;: &amp;#34;dbz-avro&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl describe connector postgres-orders
Name:       postgres-orders
Type:       &lt;span style=&#34;color: #f8f8f2&#34;&gt;source
&lt;/span&gt;State:      RUNNING
Worker ID:  kafka-connect:8083
Config:
  connector.class:                      io.debezium.connector.postgresql.PostgresConnector
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]
Topics:
  dbz-avro.asia.orders
  dbz-avro.europe.orders
  dbz-avro.us_east.orders
  dbz-avro.us_west.orders&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we can create a single Iceberg sink which will read from any orders topic (based on our regex), and write to a single &lt;code&gt;orders&lt;/code&gt; Iceberg table.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-postgres-orders&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics.regex&amp;#34;: &amp;#34;dbz-avro..*orders&amp;#34;,
    &amp;#34;iceberg.tables&amp;#34;: &amp;#34;rmoff_db.orders&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;key.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;io.confluent.connect.avro.AvroConverter&amp;#34;,
    &amp;#34;value.converter.schema.registry.url&amp;#34;: &amp;#34;http://schema-registry:8081&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;transforms&amp;#34;: &amp;#34;dbz&amp;#34;,
    &amp;#34;transforms.dbz.type&amp;#34;: &amp;#34;io.tabular.iceberg.connect.transforms.DebeziumTransform&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This works as it should, and we have an &lt;code&gt;orders&lt;/code&gt; table on it with the expected data.
Because we have the &lt;code&gt;_cdc&lt;/code&gt; field we can also get the source table easily:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT _cdc.source AS src_table, id, customer_name, quantity, price
    FROM orders;
┌────────────────┬───────┬──────────────────┬──────────┬───────────────┐
│   src_table    │  id   │  customer_name   │ quantity │     price     │
│    varchar     │ int32 │     varchar      │  int32   │ decimal(38,2) │
├────────────────┼───────┼──────────────────┼──────────┼───────────────┤
│ us_east.orders │     2 │ Bruce Wayne      │        1 │        299.99 │
│ us_west.orders │     1 │ Scott Lang       │        1 │        179.99 │
│ us_west.orders │     3 │ Steve Rogers     │        1 │        249.99 │
│ us_west.orders │     4 │ Wanda Maximoff   │        1 │        199.99 │
│ us_west.orders │     2 │ Natasha Romanoff │        2 │        129.99 │
│ us_west.orders │     5 │ Carol Danvers    │        1 │        399.99 │
│ asia.orders    │     4 │ Luke Cage        │        1 │         69.99 │
│ europe.orders  │     2 │ Barry Allen      │        1 │         79.99 │
│ europe.orders  │     1 │ Arthur Curry     │        1 │        189.99 │
[…]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s check the row counts match too.
Here’s the source, in Postgres:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;all_tables&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;COUNT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ct&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;asia&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;   &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;UNION&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALL&lt;/span&gt;
                    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;COUNT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ct&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;europe&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;UNION&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALL&lt;/span&gt;
                    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;COUNT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ct&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;us_east&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;UNION&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALL&lt;/span&gt;
                    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;COUNT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ct&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;us_west&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SUM&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ct&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;all_tables&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;

 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;sum&lt;/span&gt;
&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;-----&lt;/span&gt;
  &lt;span style=&#34;color: #ae81ff&#34;&gt;20&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and the target Iceberg table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT COUNT(*) from orders;
┌──────────────┐
│ count_star() │
│    int64     │
├──────────────┤
│      20      │
└──────────────┘&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You may notice that in the above example the &lt;code&gt;id&lt;/code&gt; field is no longer unique.
To make it unique you’d need to perhaps use a composite key that included the source table too:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;🟡◗&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;_cdc&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;source&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;src_table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;_cdc&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;source&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;-&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;&amp;#34;unique_id&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_name&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_newer&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ORDER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;price&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;┌────────────────┬───────┬──────────────────┬─────────────────┐&lt;/span&gt;
&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;src_table&lt;/span&gt;    &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt;   &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;unique_id&lt;/span&gt;     &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_name&lt;/span&gt;  &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;
&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2&#34;&gt;varchar&lt;/span&gt;     &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;int32&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2&#34;&gt;varchar&lt;/span&gt;      &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2&#34;&gt;varchar&lt;/span&gt;     &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;
&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;├────────────────┼───────┼──────────────────┼─────────────────┤&lt;/span&gt;
&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;asia&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;    &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;asia&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt;    &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Jessica&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Jones&lt;/span&gt;   &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;
&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;asia&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;    &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;asia&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;    &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Kamala&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Khan&lt;/span&gt;     &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;
&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;us_east&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;us_east&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Clark&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Kent&lt;/span&gt;      &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;
&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;europe&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;  &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;europe&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt;  &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Kara&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Zor&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;El&lt;/span&gt;     &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;│&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Another option is to perform this concatenation in-flight with a custom SMT, or to pre-process the topic using Flink SQL.&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_1n_fan_out_writing_one_topic_to_many_tables&#34;&gt;1:N (Fan Out / Writing one topic to many tables)&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The inverse of the above process is taking one topic and writing it out to multiple Iceberg tables.
This is what the built-in Iceberg &lt;code&gt;route-field&lt;/code&gt; is designed for, and works simply enough.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/07/1n.excalidraw.png&#34; alt=&#34;1n.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Imagine you’ve got a Kafka topic &lt;code&gt;wifi-logs&lt;/code&gt; that holds wifi data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;target&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;wifi-logs&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;2025-07-04T10:30:15Z&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;device_mac&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;aa:bb:cc:dd:ee:01&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ssid&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;HomeNetwork&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;web_browsing&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1024&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;target&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;wifi-logs&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;2025-07-04T10:30:45Z&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;device_mac&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;aa:bb:cc:dd:ee:02&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ssid&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;HomeNetwork&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;video_streaming&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5120&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;target&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;wifi-logs&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;2025-07-04T10:31:12Z&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;device_mac&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;aa:bb:cc:dd:ee:03&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ssid&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;GuestNetwork&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;social_media&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;512&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;target&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;wifi-logs&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;2025-07-04T10:31:33Z&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;device_mac&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;aa:bb:cc:dd:ee:04&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ssid&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;HomeNetwork&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;gaming&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2048&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;target&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;wifi-logs&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;2025-07-04T10:32:01Z&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;device_mac&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;aa:bb:cc:dd:ee:05&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ssid&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;HomeNetwork&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;file_download&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;8192&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we want to send this data to Iceberg, but split it out by network.
To do this we specify the &lt;code&gt;ssid&lt;/code&gt; as the &lt;code&gt;route-field&lt;/code&gt; in the Iceberg sink:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-wifi-logs&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics.regex&amp;#34;: &amp;#34;wifi-logs&amp;#34;,
    &amp;#34;iceberg.tables.dynamic-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.route-field&amp;#34;:&amp;#34;ssid&amp;#34;,
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;key.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;key.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;value.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;value.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Unfortunately this hits the same problem as above; the &lt;code&gt;route-field&lt;/code&gt; value must be a &lt;em&gt;fully qualified table name&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;Caused by: java.lang.IllegalArgumentException: Invalid table identifier: homenetwork&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Whereas above we had data from Debezium and we could fudge the &lt;code&gt;route-field&lt;/code&gt; value to include a database by making use of the &lt;code&gt;DebeziumTransform&lt;/code&gt; configuration, here we don’t have that option.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We need an SMT similar to that mentioned just before in the context of unique field values for a Fan-In scenario: an SMT that will concatenate a field’s value with another (or a static value, in this case).
That, or the option to specify a default database as part of the Iceberg sink configuration.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But, we’ve still got a job to do—so let’s work around the problem.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Turning to Flink SQL, we can map a Flink table to the original Kafka topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;wifi_logs&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;target&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`timestamp`&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;device_mac&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;17&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ssid&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;255&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;category&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`bytes`&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INTEGER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;wifi-logs&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan.startup.mode&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;earliest-offset&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and then populate a new Flink table (writing to a Kafka topic) with the required field:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;wifi_logs_with_db_tb&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;wifi_logs_with_db_tb&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan.startup.mode&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;earliest-offset&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;rmoff_db.&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ssid&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;target_table&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`wifi_logs`&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s a sample message from the resulting topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;target&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;wifi-logs&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;2025-07-04T10:30:15Z&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;device_mac&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;aa:bb:cc:dd:ee:01&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;ssid&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;HomeNetwork&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;web_browsing&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1024&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;target_table&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;rmoff_db.HomeNetwork&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Here’s our new field created for the purpose of the &lt;code&gt;route-field&lt;/code&gt; configuration&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now let’s try it with the Iceberg sink:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-wifi-logs&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;wifi_logs_with_db_tb&amp;#34;,
    &amp;#34;iceberg.tables.dynamic-enabled&amp;#34;: &amp;#34;true&amp;#34;, &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &amp;#34;iceberg.tables.route-field&amp;#34;:&amp;#34;target_table&amp;#34;, &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/02/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;key.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;key.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;value.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;value.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Use dynamic routing&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Use the new &lt;code&gt;target_table&lt;/code&gt; to define the target table to which to write the data&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The tables have been created…&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws glue get-tables &lt;span style=&#34;color: #f92672&#34;&gt;--database-name&lt;/span&gt; rmoff_db &lt;span style=&#34;color: #f92672&#34;&gt;--region&lt;/span&gt; us-east-1 &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--query&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TableList[].Name&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;--output&lt;/span&gt; table

+--------------------+
|      GetTables     |
+--------------------+
|  guestnetwork      |
|  homenetwork       |&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;…and populated 🎉&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT * FROM homenetwork;
┌───────────────────┬───────┬──────────────────────┬─────────────────┬─────────────┬────────[…]
│    device_mac     │ bytes │     target_table     │    category     │    ssid     │  target[…]
│      varchar      │ int64 │       varchar        │     varchar     │   varchar   │  varcha[…]
├───────────────────┼───────┼──────────────────────┼─────────────────┼─────────────┼────────[…]
│ aa:bb:cc:dd:ee:01 │  1024 │ rmoff_db.HomeNetwork │ web_browsing    │ HomeNetwork │ wifi-lo[…]
│ aa:bb:cc:dd:ee:02 │  5120 │ rmoff_db.HomeNetwork │ video_streaming │ HomeNetwork │ wifi-lo[…]
│ aa:bb:cc:dd:ee:04 │  2048 │ rmoff_db.HomeNetwork │ gaming          │ HomeNetwork │ wifi-lo[…]
│ aa:bb:cc:dd:ee:05 │  8192 │ rmoff_db.HomeNetwork │ file_download   │ HomeNetwork │ wifi-lo[…]
└───────────────────┴───────┴──────────────────────┴─────────────────┴─────────────┴────────[…]
Run Time (s): real 2.671 user 0.181888 sys 0.060846

🟡◗ SELECT * FROM guestnetwork;
┌───────────────────┬───────┬───────────────────────┬──────────────┬──────────────┬─────────[…]
│    device_mac     │ bytes │     target_table      │   category   │     ssid     │  target […]
│      varchar      │ int64 │        varchar        │   varchar    │   varchar    │  varchar[…]
├───────────────────┼───────┼───────────────────────┼──────────────┼──────────────┼─────────[…]
│ aa:bb:cc:dd:ee:03 │  512  │ rmoff_db.GuestNetwork │ social_media │ GuestNetwork │ wifi-log[…]
└───────────────────┴───────┴───────────────────────┴──────────────┴──────────────┴─────────[…]
Run Time (s): real 2.544 user 0.108161 sys 0.020404
🟡◗&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_selective_syncing_of_kafka_records_to_iceberg&#34;&gt;Selective syncing of Kafka records to Iceberg&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The last thing I want to show you is using SMT to conditionally send data to the Iceberg sink.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Looking at the same example of &lt;code&gt;wifi-log&lt;/code&gt; data, here’s how you’d create a sink connector to only send records where the &lt;code&gt;ssid&lt;/code&gt; is &lt;code&gt;HomeNetwork&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This uses the &lt;a href=&#34;https://kafka.apache.org/documentation/#org.apache.kafka.connect.transforms.Filter&#34;&gt;&lt;code&gt;Filter&lt;/code&gt;&lt;/a&gt; SMT, combined with an optional &lt;a href=&#34;https://kafka.apache.org/documentation/#connect_predicates&#34;&gt;Predicate&lt;/a&gt; so that &lt;code&gt;Filter&lt;/code&gt; will &lt;em&gt;conditionally&lt;/em&gt; drop records.
The predicate is built using a community plugin called &lt;a href=&#34;https://github.com/denisw/kafka-connect-jmespath&#34;&gt;&lt;code&gt;MatchesJMESPath&lt;/code&gt;&lt;/a&gt;, and provides a way to specify conditional matches against field values.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;iceberg-sink-wifi-logs-HomeNetwork&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;io.tabular.iceberg.connect.IcebergSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;wifi-logs&amp;#34;,
    &amp;#34;iceberg.tables.dynamic-enabled&amp;#34;: &amp;#34;false&amp;#34;,
    &amp;#34;iceberg.tables&amp;#34;:&amp;#34;tmp.wifi_logs_home_network_only&amp;#34;, &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &amp;#34;iceberg.tables.auto-create-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.tables.evolve-schema-enabled&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;iceberg.catalog.catalog-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.glue.GlueCatalog&amp;#34;,
    &amp;#34;iceberg.catalog.warehouse&amp;#34;: &amp;#34;s3://rmoff-lakehouse/05/&amp;#34;,
    &amp;#34;iceberg.catalog.io-impl&amp;#34;: &amp;#34;org.apache.iceberg.aws.s3.S3FileIO&amp;#34;,
    &amp;#34;iceberg.control.commit.interval-ms&amp;#34;: &amp;#34;1000&amp;#34;,
    &amp;#34;key.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;key.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;value.converter&amp;#34;:&amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;value.converter.schemas.enable&amp;#34;:&amp;#34;false&amp;#34;,
    &amp;#34;transforms&amp;#34;: &amp;#34;filterHomeNetwork&amp;#34;, &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
    &amp;#34;transforms.filterHomeNetwork.type&amp;#34;: &amp;#34;org.apache.kafka.connect.transforms.Filter&amp;#34;, &lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;(3)&lt;/b&gt;
    &amp;#34;transforms.filterHomeNetwork.predicate&amp;#34;: &amp;#34;notHomeNetwork&amp;#34;, &lt;i class=&#34;conum&#34; data-value=&#34;4&#34;&gt;&lt;/i&gt;&lt;b&gt;(4)&lt;/b&gt;
    &amp;#34;predicates&amp;#34;: &amp;#34;notHomeNetwork&amp;#34;, &lt;i class=&#34;conum&#34; data-value=&#34;5&#34;&gt;&lt;/i&gt;&lt;b&gt;(5)&lt;/b&gt;
    &amp;#34;predicates.notHomeNetwork.type&amp;#34;: &amp;#34;de.denisw.kafka.connect.jmespath.MatchesJMESPath&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Value&amp;#34;, &lt;i class=&#34;conum&#34; data-value=&#34;6&#34;&gt;&lt;/i&gt;&lt;b&gt;(6)&lt;/b&gt;
    &amp;#34;predicates.notHomeNetwork.query&amp;#34;: &amp;#34;ssid != &amp;#39;HomeNetwork&amp;#39;&amp;#34; &lt;i class=&#34;conum&#34; data-value=&#34;7&#34;&gt;&lt;/i&gt;&lt;b&gt;(7)&lt;/b&gt;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Write the resulting records to the &lt;code&gt;tmp.wifi_logs_home_network_only&lt;/code&gt; table&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;List of transformation names&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Use a &lt;a href=&#34;https://kafka.apache.org/documentation/#org.apache.kafka.connect.transforms.Filter&#34;&gt;Filter transform&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;4&#34;&gt;&lt;/i&gt;&lt;b&gt;4&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Only apply the transform to the current record &lt;em&gt;if&lt;/em&gt; the predicate &lt;code&gt;notHomeNetwork&lt;/code&gt; is true&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;5&#34;&gt;&lt;/i&gt;&lt;b&gt;5&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;List of predicate names&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;6&#34;&gt;&lt;/i&gt;&lt;b&gt;6&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Use the &lt;a href=&#34;https://github.com/denisw/kafka-connect-jmespath&#34;&gt;&lt;code&gt;MatchesJMESPath&lt;/code&gt;&lt;/a&gt; predicate on the Value part of the record (i.e. not the key or header)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;7&#34;&gt;&lt;/i&gt;&lt;b&gt;7&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The predicate is true if the &lt;code&gt;ssid&lt;/code&gt; field does not equal &lt;code&gt;HomeNetwork&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When you run this sink you get an Iceberg table with only the HomeNetwork wifi data in it:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT * FROM wifi_logs_home_network_only;
┌───────────────────┬───────┬─────────────────┬─────────────┬───────────┬──────────────────────┐
│    device_mac     │ bytes │    category     │    ssid     │  target   │      timestamp       │
│      varchar      │ int64 │     varchar     │   varchar   │  varchar  │       varchar        │
├───────────────────┼───────┼─────────────────┼─────────────┼───────────┼──────────────────────┤
│ aa:bb:cc:dd:ee:01 │  1024 │ web_browsing    │ HomeNetwork │ wifi-logs │ 2025-07-04T10:30:15Z │
│ aa:bb:cc:dd:ee:02 │  5120 │ video_streaming │ HomeNetwork │ wifi-logs │ 2025-07-04T10:30:45Z │
│ aa:bb:cc:dd:ee:04 │  2048 │ gaming          │ HomeNetwork │ wifi-logs │ 2025-07-04T10:31:33Z │&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_appendices&#34;&gt;Appendices&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_debugging&#34;&gt;Debugging&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can increase the log level of the Kafka Connect worker for specific components:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http PUT localhost:8083/admin/loggers/org.apache.iceberg.metrics Content-Type:application/json &lt;span style=&#34;color: #f8f8f2&#34;&gt;level&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;TRACE
http PUT localhost:8083/admin/loggers/org.apache.iceberg.aws Content-Type:application/json &lt;span style=&#34;color: #f8f8f2&#34;&gt;level&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;TRACE&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;See &lt;a href=&#34;https://rmoff.net/2020/01/16/changing-the-logging-level-for-kafka-connect-dynamically/&#34;&gt;Changing the Logging Level for Kafka Connect Dynamically&lt;/a&gt; for more detail.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;It can be useful for inspection of SMTs:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;curl &lt;span style=&#34;color: #f92672&#34;&gt;-s&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-X&lt;/span&gt; PUT http://localhost:8083/admin/loggers/org.apache.kafka.connect.runtime.TransformationChain &lt;span style=&#34;color: #f92672&#34;&gt;-H&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;Content-Type:application/json&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-d&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;{&amp;#34;level&amp;#34;: &amp;#34;TRACE&amp;#34;}&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You’ll then see in the logs something like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;Applying transformation io.tabular.iceberg.connect.transforms.DebeziumTransform to
    SinkRecord{kafkaOffset=2, timestampType=CreateTime, originalTopic=dbz-avro.public.clicks_no_tz, originalKafkaPartition=1, originalKafkaOffset=2}
    ConnectRecord{topic=&amp;#39;dbz-avro.public.clicks_no_tz&amp;#39;, kafkaPartition=1, key=null, keySchema=null,
        value=Struct{after=Struct{click_ts=1675258225000000,ad_cost=1.50,is_conversion=true,user_id=001234567890},source=Struct{version=3.1.2.Final,connector=postgresql,name=dbz-avro,ts_ms=1751471423083,snapshot=false,db=postgres,sequence=[&amp;#34;34643256&amp;#34;,&amp;#34;34643544&amp;#34;],ts_us=1751471423083360,ts_ns=1751471423083360000,schema=public,table=clicks_no_tz,txId=780,lsn=34643544},op=c,ts_ms=1751471423553,ts_us=1751471423553059,ts_ns=1751471423553059129},
        valueSchema=Schema{dbz-avro.public.clicks_no_tz.Envelope:STRUCT}, timestamp=1751471423743, headers=ConnectHeaders(headers=)}


Applying transformation org.apache.kafka.connect.transforms.TimestampConverter$Value to
    SinkRecord{kafkaOffset=2, timestampType=CreateTime, originalTopic=dbz-avro.public.clicks_no_tz, originalKafkaPartition=1, originalKafkaOffset=2}
    ConnectRecord{topic=&amp;#39;dbz-avro.public.clicks_no_tz&amp;#39;, kafkaPartition=1, key=null, keySchema=null,
        value=Struct{click_ts=1675258225000000,ad_cost=1.50,is_conversion=true,user_id=001234567890,_cdc=Struct{op=I,ts=Wed Jul 02 15:50:23 GMT 2025,offset=2,source=public.clicks_no_tz,target=public.clicks_no_tz}},
        valueSchema=Schema{dbz-avro.public.clicks_no_tz.Value:STRUCT}, timestamp=1751471423743, headers=ConnectHeaders(headers=)}&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can also use the &lt;a href=&#34;https://github.com/jcustenborder/kafka-connect-simulator/&#34;&gt;kafka-connect-simulator&lt;/a&gt; sink connector to test your SMTs:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;kcctl apply &lt;span style=&#34;color: #f92672&#34;&gt;-f&lt;/span&gt; - &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef&#34;&gt;EOF&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;
{
  &amp;#34;name&amp;#34;: &amp;#34;smt-test&amp;#34;,
  &amp;#34;config&amp;#34;: {
    &amp;#34;connector.class&amp;#34;: &amp;#34;com.github.jcustenborder.kafka.connect.simulator.SimulatorSinkConnector&amp;#34;,
    &amp;#34;topics&amp;#34;: &amp;#34;wifi-logs&amp;#34;,
    &amp;#34;log.entries&amp;#34;: &amp;#34;true&amp;#34;,
    &amp;#34;key.converter&amp;#34;: &amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;key.converter.schemas.enable&amp;#34;: &amp;#34;false&amp;#34;,
    &amp;#34;value.converter&amp;#34;: &amp;#34;org.apache.kafka.connect.json.JsonConverter&amp;#34;,
    &amp;#34;value.converter.schemas.enable&amp;#34;: &amp;#34;false&amp;#34;,
    &amp;#34;transforms&amp;#34;: &amp;#34;addDbPrefix, insertTopic&amp;#34;,
    &amp;#34;transforms.addDbPrefix.type&amp;#34;: &amp;#34;org.apache.kafka.connect.transforms.RegexRouter&amp;#34;,
    &amp;#34;transforms.addDbPrefix.regex&amp;#34;: &amp;#34;.*&amp;#34;,
    &amp;#34;transforms.addDbPrefix.replacement&amp;#34;: &amp;#34;rmoff_db.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;0&amp;#34;,
    &amp;#34;transforms.insertTopic.type&amp;#34;: &amp;#34;org.apache.kafka.connect.transforms.InsertField&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;\$&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;Value&amp;#34;,
    &amp;#34;transforms.insertTopic.topic.field&amp;#34;: &amp;#34;srcTopic&amp;#34;
  }
}
EOF&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When you create this you’ll see in the Kafka Connect worker logs the actual records that a sink will be working with after the SMTs have been applied:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;2025-07-04 09:49:41,542] INFO &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;test2|task-0] record.value&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;={&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;device_mac&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;aa:bb:cc:dd:ee:01, &lt;span style=&#34;color: #f8f8f2&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;1024, &lt;span style=&#34;color: #f8f8f2&#34;&gt;srcTopic&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;rmoff_db.wifi-logs, &lt;span style=&#34;color: #f8f8f2&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;web_browsing, &lt;span style=&#34;color: #f8f8f2&#34;&gt;ssid&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;HomeNetwork, &lt;span style=&#34;color: #f8f8f2&#34;&gt;target&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;wifi-logs, &lt;span style=&#34;color: #f8f8f2&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;2025-07-04T10:30:15Z&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;(&lt;/span&gt;com.github.jcustenborder.kafka.connect.simulator.SimulatorSinkTask:50&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;)&lt;/span&gt;                                                        │
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;2025-07-04 09:49:41,542] INFO &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;test2|task-0] record.value&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;={&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;device_mac&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;aa:bb:cc:dd:ee:02, &lt;span style=&#34;color: #f8f8f2&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;5120, &lt;span style=&#34;color: #f8f8f2&#34;&gt;srcTopic&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;rmoff_db.wifi-logs, &lt;span style=&#34;color: #f8f8f2&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;video_streaming, &lt;span style=&#34;color: #f8f8f2&#34;&gt;ssid&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;HomeNetwork, &lt;span style=&#34;color: #f8f8f2&#34;&gt;target&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;wifi-logs, &lt;span style=&#34;color: #f8f8f2&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;2025-07-04T10:30:45Z&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;(&lt;/span&gt;com.github.jcustenborder.kafka.connect.simulator.SimulatorSinkTask:50&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;)&lt;/span&gt;                                                     │
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;2025-07-04 09:49:41,542] INFO &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;test2|task-0] record.value&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;={&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;device_mac&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;aa:bb:cc:dd:ee:03, &lt;span style=&#34;color: #f8f8f2&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;512, &lt;span style=&#34;color: #f8f8f2&#34;&gt;srcTopic&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;rmoff_db.wifi-logs, &lt;span style=&#34;color: #f8f8f2&#34;&gt;category&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;social_media, &lt;span style=&#34;color: #f8f8f2&#34;&gt;ssid&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;GuestNetwork, &lt;span style=&#34;color: #f8f8f2&#34;&gt;target&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;wifi-logs, &lt;span style=&#34;color: #f8f8f2&#34;&gt;timestamp&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;2025-07-04T10:31:12Z&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;(&lt;/span&gt;com.github.jcustenborder.kafka.connect.simulator.SimulatorSinkTask:50&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;)&lt;/span&gt;                                                        │&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_kafka_connect_version_problems&#34;&gt;Kafka Connect version problems&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I saw this error from the connector:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;java.lang.NoSuchMethodError: &amp;#39;org.apache.kafka.clients.admin.ListConsumerGroupOffsetsOptions org.apache.kafka.clients.admin.ListConsumerGroupOffsetsOptions.requireStable(boolean)&amp;#39;
        at io.tabular.iceberg.connect.channel.CommitterImpl.fetchStableConsumerOffsets(CommitterImpl.java:116)
        at io.tabular.iceberg.connect.channel.CommitterImpl.&amp;lt;init&amp;gt;(CommitterImpl.java:97)
        at io.tabular.iceberg.connect.channel.CommitterImpl.&amp;lt;init&amp;gt;(CommitterImpl.java:70)
        at io.tabular.iceberg.connect.channel.CommitterImpl.&amp;lt;init&amp;gt;(CommitterImpl.java:62)
        at io.tabular.iceberg.connect.channel.TaskImpl.&amp;lt;init&amp;gt;(TaskImpl.java:37)
        at io.tabular.iceberg.connect.IcebergSinkTask.open(IcebergSinkTask.java:56)
        at org.apache.kafka.connect.runtime.WorkerSinkTask.openPartitions(WorkerSinkTask.java:637)
        at org.apache.kafka.connect.runtime.WorkerSinkTask.access$1200(WorkerSinkTask.java:72)&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This happened with cp-kafka-connect &lt;code&gt;7.2.15&lt;/code&gt;.
Switching to 8.0.0 resolved the problem.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_documentation_and_links&#34;&gt;Documentation and Links&lt;/h3&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;GitHub: &lt;a href=&#34;https://github.com/apache/iceberg/tree/main/kafka-connect&#34;&gt;Apache Iceberg - Kafka Connect sink&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Docs: &lt;a href=&#34;https://iceberg.apache.org/docs/nightly/kafka-connect/&#34;&gt;Apache Iceberg - Kafka Connect sink&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Confluent Hub: &lt;a href=&#34;https://www.confluent.io/hub/tabular/iceberg-kafka-connect&#34;&gt;Apache Iceberg sink&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Docs: &lt;a href=&#34;https://kafka.apache.org/documentation/#connect_transforms&#34;&gt;Apache Kafka - Transforms&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;This blog: &lt;a href=&#34;https://rmoff.net/categories/single-message-transform/&#34;&gt;SMT articles&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    <item>
      <title>Interesting links - June 2025</title>
      <link>https://rmoff.net/2025/06/27/interesting-links-june-2025/</link>
      <pubDate>2025-06-27</pubDate>
      
      <guid>https://rmoff.net/2025/06/27/interesting-links-june-2025/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/06/t_IMG_0787.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;Not got time for all this? I’ve marked 🔥 for my top reads of the month&lt;/em&gt; :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_open_table_formats_data_lakehouses&#34;&gt;Open Table Formats / Data Lakehouses&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 Instead of enthusiastically hopping on the Iceberg bandwagon with both webbed feet, DuckDB Labs have been quietly building their own format.
&lt;a href=&#34;https://ducklake.select/&#34;&gt;DuckLake&lt;/a&gt; was &lt;a href=&#34;https://ducklake.select/manifesto/&#34;&gt;announced&lt;/a&gt; at the beginning of the month, and is a replacement for &lt;em&gt;both&lt;/em&gt; an OTF such as Iceberg &lt;em&gt;and&lt;/em&gt; the metadata catalog that an OTF user will invariably need to wire up too.
I had a &lt;a href=&#34;https://rmoff.net/2025/06/02/digging-into-ducklake/&#34;&gt;quick poke around it&lt;/a&gt;, and &lt;a href=&#34;https://tobilg.com/the-age-of-10-dollar-a-month-lakehouses&#34;&gt;Tobias Müller&lt;/a&gt; and &lt;a href=&#34;https://medium.com/@mcgeehan/quacks-stacks-5565069a5ef0&#34;&gt;Thomas F McGeehan V&lt;/a&gt; both went into it in more detail, along with &lt;a href=&#34;https://motherduck.com/blog/ducklake-motherduck/&#34;&gt;MotherDuck&lt;/a&gt; who’ll unsurprisingly be offering it as a managed service.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The catalog space is a vital one for OTFs, and there are various projects springing up alongside the more established Unity and Polaris catalogs.
Some do slightly different things (such as management e.g. compaction) or have a broader ambition (cataloging &lt;em&gt;all&lt;/em&gt; your data, not just OTF):&lt;/p&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/apache/amoro&#34;&gt;apache/amoro&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/nimtable/nimtable&#34;&gt;nimtable&lt;/a&gt; (from RisingWave)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/apache/gravitino&#34;&gt;apache/gravitino&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I’ve written about writing to Iceberg from Kafka with Flink &lt;a href=&#34;https://www.decodable.co/blog/kafka-to-iceberg-with-flink&#34;&gt;before&lt;/a&gt;, but shipped &lt;a href=&#34;https://rmoff.net/2025/06/24/writing-to-apache-iceberg-on-s3-using-flink-sql-with-glue-catalog/&#34;&gt;a new blog this week&lt;/a&gt; that throws AWS Glue Data Catalog into the mix.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Details of the latest Iceberg version &lt;a href=&#34;https://www.databricks.com/blog/iceberg-v3-moving-ecosystem-towards-unification&#34;&gt;Iceberg v3: Moving the Ecosystem Towards Unification&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;In a blog post that makes me nostalgic for &lt;a href=&#34;https://rmoff.net/2010/12/30/data-warehousing-and-statistics-in-oracle-11g-incremental-global-statistics/&#34;&gt;my Oracle days&lt;/a&gt;, Yuval Yogev writes about &lt;a href=&#34;https://medium.com/@yogevyuval/making-sense-of-apache-iceberg-statistics-5a114d8e90d1&#34;&gt;statistics in Iceberg&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Some useful points to think about from Jacek Migdal covering where &lt;a href=&#34;https://quesma.com/blog-detail/apache-iceberg-practical-limitations-2025&#34;&gt;Iceberg might not be the right fit for your requirements&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Vu Trinh has a nice summary of &lt;a href=&#34;https://freedium.cfd/https://blog.det.life/how-did-meta-modernize-their-lakehouse-f2fec45af2f4&#34;&gt;how Meta modernised their lakehouse&lt;/a&gt;, based on &lt;a href=&#34;https://www.cidrdb.org/cidr2023/papers/p77-chattopadhyay.pdf&#34;&gt;a paper from 2023&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Apache Hudi is still kicking around and in use—this blog post from Shiyan Xu details &lt;a href=&#34;https://blog.datumagic.ai/p/apache-hudi-does-xyz-110&#34;&gt;file pruning with multi-modal index&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_kafka_and_event_streaming&#34;&gt;Kafka and Event Streaming&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 LinkedIn, the birthplace of Kafka, have published details of their Kafka replacement, &lt;a href=&#34;https://www.linkedin.com/blog/engineering/infrastructure/introducing-northguard-and-xinfra&#34;&gt;Northguard and Xinfra&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Chris Riccomini has a hot take on &lt;a href=&#34;https://materializedview.io/p/kafka-end-of-beginning&#34;&gt;Kafka: The End of the Beginning&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Responsive’s Almog Gavra has &lt;a href=&#34;https://www.linkedin.com/posts/agavra_ive-improved-kafka-throughput-by-over-20x-activity-7333178297721266176-12pK/&#34;&gt;written about&lt;/a&gt; a new serialisation format with performance benefits in data streaming called &lt;a href=&#34;https://github.com/imprint-serde/imprint&#34;&gt;Imprint&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;If you run Apache Kafka, &lt;a href=&#34;https://kafka.apache.org/cve-list&#34;&gt;this list of CVEs that the project publishes&lt;/a&gt; is worth keeping an eye on. There were three CVEs published earlier this month impacting various versions including up to 3.9.0&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kloia explains &lt;a href=&#34;https://blog.kloia.com/how-we-solved-kafka-event-sequencing-in-our-online-grocery-application-e1420e6b9198&#34;&gt;how they solved Kafka event sequencing&lt;/a&gt; in their online grocery application&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ShareChat migrated away from a multi-AZ deployment of Apache Kafka to Warpstream, and &lt;a href=&#34;https://medium.com/@warpstream/cost-effective-logging-at-scale-sharechats-journey-to-warpstream-2beac9ecd217&#34;&gt;explains why in this post&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Agoda describes how they &lt;a href=&#34;https://medium.com/agoda-engineering/how-agoda-handles-kafka-consumer-failover-across-data-centers-a3edbacef6d0&#34;&gt;handle Kafka consumer failover across data centers&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Expedia Group Tech shares details of &lt;a href=&#34;https://medium.com/expedia-group-tech/preventing-revenue-loss-with-real-time-a-b-test-monitoring-605698817457&#34;&gt;their real-time A/B test monitoring system&lt;/a&gt;, built on Apache Pinot and Kafka.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_stream_processing&#34;&gt;Stream Processing&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Grab have built a bespoke Flink SQL platform that they describe &lt;a href=&#34;https://engineering.grab.com/the-complete-stream-processing-journey-on-flinksql&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Running Flink SQL once you get out of your development environment can be tricky.
The excellently-named DataSQRL have &lt;a href=&#34;https://github.com/DataSQRL/flink-sql-runner/&#34;&gt;published&lt;/a&gt; a companion to the Flink Kubernetes operator to run SQL jobs.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Luthra Sahil has some practical advice for &lt;a href=&#34;https://medium.com/@luthra.sahil.txs/exception-handling-in-kafka-streams-f5c9a82f4a3e&#34;&gt;exception handling in Kafka Streams&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Riskified have written about their &lt;a href=&#34;https://aws.amazon.com/blogs/big-data/unlock-self-serve-streaming-sql-with-amazon-managed-service-for-apache-flink/&#34;&gt;migration from ksqlDB to Flink&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The team at EloElo have been busy, writing a &lt;a href=&#34;https://tech-blogs.eloelo.in/scaling-real-time-processing-with-flink-on-eks-github-ci-cd-and-argocd-700b678ff0a2&#34;&gt;two-part&lt;/a&gt; &lt;a href=&#34;https://tech-blogs.eloelo.in/deploying-apache-flink-on-eks-with-argocd-github-actions-part-2-from-zero-to-real-time-hero-9708d173f3c5&#34;&gt;series&lt;/a&gt; on running Apache Flink in EKS, as well as &lt;a href=&#34;https://tech-blogs.eloelo.in/building-eloelos-data-platform-part-i-our-2-year-journey-to-batch-real-time-lakehouse-on-open-def6c8b79dd4&#34;&gt;details of their batch &amp;amp; realtime data platform&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 Excellent example (as always) from Simon Aubury of using &lt;a href=&#34;https://simonaubury.substack.com/p/when-plans-change-at-500-feet-complex-event-processing-of-ads-b-aviation-data-with-apache-flink-52b6381d6a20?triedRedirect=true&#34;&gt;Complex Event Processing (CEP) in Flink with ADS-B aviation data&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Details of how Swiggy built their &lt;a href=&#34;https://bytes.swiggy.com/rill-state-implementation-937bf51e077f&#34;&gt;streaming data platform&lt;/a&gt; on Flink, and use it for &lt;a href=&#34;https://bytes.swiggy.com/enabling-real-time-business-monitoring-with-klaxon-668fa14c5e38&#34;&gt;real-time business monitoring&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Trade Republic shares how they built a system to calculate bond yield to maturity in real-time &lt;a href=&#34;https://engineering.traderepublic.com/real-time-bond-yield-to-maturity-d1ea4e144951&#34;&gt;using Kafka and Redis&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_ai&#34;&gt;AI&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 I’m so bored of AI already, even though it is revolutionising how we do things.
That said, I did enjoy reading this article: &lt;a href=&#34;https://fly.io/blog/youre-all-nuts/&#34;&gt;My AI Skeptic Friends Are All Nuts&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;An example from the Debezium folks showing &lt;a href=&#34;https://debezium.io/blog/2025/05/19/debezium-as-part-of-your-ai-solution/&#34;&gt;how Debezium, Milvus, and Ollama can work together&lt;/a&gt; to form a Retrieval-Augmented Generation (RAG) pipeline&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pinterest Engineering explains how they use Ray in their &lt;a href=&#34;https://medium.com/pinterest-engineering/scaling-pinterest-ml-infrastructure-with-ray-from-training-to-end-to-end-ml-pipelines-4038b9e837a0&#34;&gt;ML Infrastructure&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_cdc_debezium&#34;&gt;CDC / Debezium&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://www.morling.dev/blog/backfilling-postgres-toast-columns-debezium-change-events/&#34;&gt;Backfilling Postgres TOAST Columns in Debezium Data Change Events&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Some good detail from Mohammad Mahdi Azadjalal on &lt;a href=&#34;https://medium.com/@mm.azadjalal/mastering-cdc-with-postgresql-debezium-and-kafka-connect-challenges-solutions-225368007f69&#34;&gt;setting up CDC with PostgreSQL, Debezium, and Kafka Connect&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/snyk/skemium&#34;&gt;snyk/skemium: Generate and Compare Debezium CDC (Change Data Capture) Avro Schema, directly from your Database&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Kleinanzeigen writes about &lt;a href=&#34;https://medium.com/berlin-tech-blog/handling-user-migration-with-debezium-apache-kafka-and-a-synchronization-algorithm-with-cycle-3c239b32326f&#34;&gt;their approach to a zero-downtime user migration&lt;/a&gt; using Debezium and Kafka.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_data_platforms_architecture&#34;&gt;Data Platforms &amp;amp; Architecture&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Benn Stancil asks the important question: &lt;a href=&#34;https://benn.substack.com/p/which-way-from-here&#34;&gt;which way from here&lt;/a&gt; for the analytics and data industry?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Netflix Engineering introduces their Unified Data Architecture (UDA) with the principle of &lt;a href=&#34;https://netflixtechblog.com/uda-unified-data-architecture-6a6aee261d8d&#34;&gt;Model Once, Represent Everywhere&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I’d be fascinated to know what proportion of companies are still running Hadoop.
Pinterest, for one, are, and they’ve written about the &lt;a href=&#34;https://medium.com/pinterest-engineering/automated-migration-and-scaling-of-hadoop-clusters-69c0967228e4&#34;&gt;automated migration and scaling&lt;/a&gt; of their Hadoop clusters.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Atlassian shares how they are &lt;a href=&#34;https://www.atlassian.com/blog/atlassian-engineering/opensearch-admission-control-resiliency&#34;&gt;enhancing resiliency in their OpenSearch clusters&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Instacart tech talks about &lt;a href=&#34;https://tech.instacart.com/how-instacart-built-a-modern-search-infrastructure-on-postgres-c528fa601d54&#34;&gt;building their modern search infrastructure on Postgres&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Grab Engineering on &lt;a href=&#34;https://engineering.grab.com/counter-service-how-we-rewrote-it-in-rust&#34;&gt;how they rewrote their Counter Service in Rust&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The tech team at Just Eat on &lt;a href=&#34;https://medium.com/justeattakeaway-tech/how-data-products-become-the-promethean-fire-8f837fdac6ef?source=rss----7d57dc194585---4&#34;&gt;How Data Products Become the Promethean Fire&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Uber are prolific in their technical blog posts, and have three for us this month:&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Their &lt;a href=&#34;https://www.uber.com/en-GB/blog/how-uber-migrated-from-hive-to-spark-sql-for-etl-workloads/&#34;&gt;migration from Hive to Spark SQL for ETL workloads&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The &lt;a href=&#34;https://www.uber.com/en-GB/blog/evolution-of-ubers-search-platform/&#34;&gt;evolution of their search platform&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Their approach to &lt;a href=&#34;https://www.uber.com/en-GB/blog/from-archival-to-access/&#34;&gt;Config-Driven Data Pipelines&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_databases_engines_performance&#34;&gt;Databases Engines &amp;amp; Performance&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A look at how &lt;a href=&#34;https://www.pixelstech.net/article/1747708863-openai%3a-scaling-postgresql-to-the-next-level&#34;&gt;OpenAI are scaling PostgreSQL&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I love this kind of &lt;a href=&#34;https://tigerbeetle.com/blog/2025-06-06-fuzzer-blind-spots-meet-jepsen&#34;&gt;well-written, deep dive blog from TigerBeetle&lt;/a&gt; about a bug that &lt;a href=&#34;https://jepsen.io/analyses/tigerbeetle-0.16.11&#34;&gt;Jepsen found&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A deep dive from LanceDB on &lt;a href=&#34;https://blog.lancedb.com/columnar-file-readers-in-depth-repetition-definition-levels/&#34;&gt;Columnar File Readers in Depth: Repetition &amp;amp; Definition Levels&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Two interesting DuckDB extensions, providing &lt;a href=&#34;https://github.com/Query-farm/radio&#34;&gt;real-time support&lt;/a&gt; and &lt;a href=&#34;https://github.com/Query-farm/airport&#34;&gt;support for Apache Arrow&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 Chris Riccomini started &lt;a href=&#34;https://bsky.app/profile/chris.blue/post/3lqvp3hre5226&#34;&gt;a good thread on Bluesky about graph databases&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://livestore.dev/&#34;&gt;LiveStore&lt;/a&gt; is a state management framework and local-first data layer for high-performance apps, based on SQLite and event-sourcing.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Jan Nidzwetzki writes about &lt;a href=&#34;https://jnidzwetzki.github.io/2025/06/03/art-of-query-optimization.html&#34;&gt;The Art of SQL Query Optimization&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;InfluxDB’s Andrew Lamb did a talk on &lt;a href=&#34;https://www.youtube.com/watch?v=74YsJT1-Rdk&#34;&gt;accelerating Apache Parquet with metadata stores and specialized indexes using Apache DataFusion&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Part of Arrow, &lt;a href=&#34;https://arrow.apache.org/docs/format/FlightSql.html&#34;&gt;Flight SQL&lt;/a&gt; is &lt;em&gt;a protocol for interacting with SQL databases using the Arrow in-memory format and the Flight RPC framework&lt;/em&gt;.
&lt;a href=&#34;https://github.com/TFMV/porter&#34;&gt;Porter&lt;/a&gt; implements Flight SQL to provide a server on top of DuckDB or Clickhouse.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_and_finally&#34;&gt;And finally…&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;Nothing to do with data, but stuff that I’ve found interesting or has made me smile.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_human_apis_a_k_a_the_soft_squishy_stuff&#34;&gt;Human APIs (a.k.a The Soft Squishy Stuff)&lt;/h3&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://fs.blog/chestertons-fence/&#34;&gt;Chesterton’s Fence: A Lesson in Thinking&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://medium.com/@royrapoport/that-burning-feeling-when-youre-right-cee8b8d05492&#34;&gt;That Burning Feeling When You’re Right&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://read.developingskills.fyi/p/win-by-giving-in&#34;&gt;Win By Giving In&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://randsinrepose.com/archives/shields-down/&#34;&gt;Shields Down&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.petdance.com/2017/03/31/skip-the-exit-interview-when-you-leave-your-job/&#34;&gt;Skip the exit interview when you leave your job&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_misc&#34;&gt;Misc&lt;/h3&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.nytimes.com/2025/04/29/world/asia/vietnam-war-photography-impact.html&#34;&gt;How Photography From the Vietnam War Changed America&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_geek&#34;&gt;Geek&lt;/h3&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A lovely nerdy example of reverse engineering: &lt;a href=&#34;https://rachelbythebay.com/w/2025/05/22/ssl/&#34;&gt;Why I no longer have an old-school cert on my https site&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://magnus919.com/2025/05/the-xenon-death-flash-how-a-camera-nearly-killed-the-raspberry-pi-2/&#34;&gt;The Xenon Death Flash: How a Camera Nearly Killed the Raspberry Pi 2&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_data_viz&#34;&gt;Data Viz&lt;/h3&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A lovely example of some creativity to illustrate data: &lt;a href=&#34;https://nightingaledvs.com/a-garden-of-sleep/&#34;&gt;A Garden of Sleep: Tracking the Emotional Distance Between Two Bedtimes - Nightingale&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;div class=&#34;title&#34;&gt;Tip&lt;/div&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
If you like these kind of links you might like to read about &lt;a href=&#34;https://rmoff.net/2024/05/22/how-i-try-to-keep-up-with-the-data-tech-world-a-list-of-data-blogs/&#34;&gt;How I Try To Keep Up With The Data Tech World (A List of Data Blogs)&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    <item>
      <title>Writing to Apache Iceberg on S3 using Flink SQL with Glue catalog</title>
      <link>https://rmoff.net/2025/06/24/writing-to-apache-iceberg-on-s3-using-flink-sql-with-glue-catalog/</link>
      <pubDate>2025-06-24</pubDate>
      
      <guid>https://rmoff.net/2025/06/24/writing-to-apache-iceberg-on-s3-using-flink-sql-with-glue-catalog/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/06/t_IMG_0440.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this blog post I’ll show how you can use Flink SQL to write to Iceberg on S3, storing metadata about the Iceberg tables in the &lt;a href=&#34;https://docs.aws.amazon.com/glue/latest/dg/components-overview.html#data-catalog-intro&#34;&gt;AWS Glue Data Catalog&lt;/a&gt;.
First off, I’ll walk through the dependencies and a simple smoke-test, and then put it into practice using it to write data from a Kafka topic to Iceberg.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://iceberg.apache.org&#34;&gt;Apache Iceberg&lt;/a&gt; is a table format that provides a way of storing tabular data on object storage that can be read and written to by lots of different engines.
When you’re using Iceberg you’ll need a &lt;a href=&#34;https://iceberg.apache.org/terms/#catalog&#34;&gt;metadata catalog&lt;/a&gt; so that other users of the data can discover what tables exist and where.
Here I’m using &lt;a href=&#34;https://docs.aws.amazon.com/glue/latest/dg/components-overview.html#data-catalog-intro&#34;&gt;Glue Data Catalog&lt;/a&gt;, but other catalogs that you might use in its place include
&lt;a href=&#34;https://cwiki.apache.org/confluence/display/hive/design#Design-Metastore&#34;&gt;Hive Metastore&lt;/a&gt;,
&lt;a href=&#34;https://polaris.apache.org/&#34;&gt;Apache Polaris&lt;/a&gt;,
&lt;a href=&#34;https://www.unitycatalog.io/&#34;&gt;Unity Catalog&lt;/a&gt;,
and so on.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
You can find the Docker Compose for this article &lt;a href=&#34;https://github.com/rmoff/examples/tree/main/iceberg/flink-kafka-aws&#34;&gt;here&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_dependencies&#34;&gt;Dependencies&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’m using Flink 1.20, since as of the time of writing (2025-06-24) the Iceberg connector doesn’t yet support Flink 2.0 (&lt;a href=&#34;https://lists.apache.org/thread/1ozjw2wj24scj0vspx89nbjrkpz7xovv&#34;&gt;it’s due&lt;/a&gt; with Iceberg 1.10.0).
The dependencies listed below are specifically for this version.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;One of the things that makes Flink SQL &lt;em&gt;so much fun&lt;/em&gt; is doing the JAR dance each time.
I’ve &lt;a href=&#34;https://www.decodable.co/blog/flink-sql-and-the-joy-of-jars&#34;&gt;written&lt;/a&gt; and &lt;a href=&#34;https://talks.rmoff.net/9GpIYA/the-joy-of-jars-and-other-flink-sql-troubleshooting-tales&#34;&gt;spoken&lt;/a&gt; about it &lt;a href=&#34;https://www.decodable.co/blog/troubleshooting-flink-sql-s3-problems&#34;&gt;ad&lt;/a&gt; &lt;a href=&#34;https://www.decodable.co/blog/flink-sql-misconfiguration-misunderstanding-and-mishaps&#34;&gt;nauseam&lt;/a&gt;, so check those links out if you want more background.&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_iceberg&#34;&gt;Iceberg&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’re writing to Iceberg, so need the &lt;a href=&#34;https://iceberg.apache.org/multi-engine-support/#apache-flink&#34;&gt;Flink Iceberg connector&lt;/a&gt;, which is part of the Iceberg project.
The JAR is &lt;a href=&#34;https://repo1.maven.org/maven2/org/apache/iceberg/iceberg-flink-runtime-1.20/1.9.1/iceberg-flink-runtime-1.20-1.9.1.jar&#34;&gt;&lt;code&gt;iceberg-flink-runtime-1.20-1.9.1.jar&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_aws_s3_and_glue&#34;&gt;AWS S3 and Glue&lt;/h3&gt;
&lt;div class=&#34;sect3&#34;&gt;
&lt;h4 id=&#34;_jars&#34;&gt;JARs&lt;/h4&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;AWS has an &lt;a href=&#34;https://iceberg.apache.org/docs/nightly/aws/#flink&#34;&gt;integration for Iceberg&lt;/a&gt; which provides support for both S3 and Glue data catalog.
The JAR is &lt;a href=&#34;https://repo1.maven.org/maven2/org/apache/iceberg/iceberg-aws-bundle/1.9.1/iceberg-aws-bundle-1.9.1.jar&#34;&gt;&lt;code&gt;iceberg-aws-bundle-1.9.1.jar&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect3&#34;&gt;
&lt;h4 id=&#34;_s3_bucket&#34;&gt;S3 bucket&lt;/h4&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You’ll need an S3 bucket to write your Iceberg tables.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect3&#34;&gt;
&lt;h4 id=&#34;_authentication&#34;&gt;Authentication&lt;/h4&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You need to give Flink a way to authenticate to AWS.
There are &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/deployment/filesystems/s3/#configure-access-credentials&#34;&gt;different ways&lt;/a&gt; to do this.
I’ve gone for the very simple—and extremely insecure—method of setting environment variables.
Remember that Flink is a distributed system and &lt;em&gt;each component must have these environment variables set&lt;/em&gt;.
Otherwise you’ll find one thing works (e.g. some table DDL) whilst another doesn’t (e.g. writing data to the table), because different components in Flink come into play at different stages.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In Docker Compose I use this syntax to pass through to the container the value of the variables, that I’ve set locally on the host machine:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;yaml&#34;&gt;    &lt;span style=&#34;color: #a6e22e&#34;&gt;environment&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;AWS_REGION=${AWS_REGION:-us-east-1}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Note that I had to set &lt;code&gt;AWS_REGION&lt;/code&gt;, even though it’s the default one (&lt;code&gt;us-east-1&lt;/code&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_random_jiggling_hadoop_jars&#34;&gt;Random jiggling (Hadoop JARs)&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Some, or all, of these are needed, because &lt;code&gt;$REASONS&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;It’s a list I’ve built up by trial and error.
You can also just get Hadoop itself (lol, remember that?) and add it to the classpath.
If you don’t add these you’ll get various &lt;code&gt;java.lang.ClassNotFoundException&lt;/code&gt; errors.
Feel free to play whack-a-mole and eliminate the redundant ones from the list and let me know which can be scratched off :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;https://repo1.maven.org/maven2/org/apache/commons/commons-configuration2/2.1.1/commons-configuration2-2.1.1.jar
https://repo1.maven.org/maven2/commons-logging/commons-logging/1.1.3/commons-logging-1.1.3.jar
https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-auth/3.3.4/hadoop-auth-3.3.4.jar
https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-common/3.3.4/hadoop-common-3.3.4.jar
https://repo1.maven.org/maven2/org/apache/hadoop/thirdparty/hadoop-shaded-guava/1.1.1/hadoop-shaded-guava-1.1.1.jar
https://repo1.maven.org/maven2/org/codehaus/woodstox/stax2-api/4.2.1/stax2-api-4.2.1.jar
https://repo1.maven.org/maven2/com/fasterxml/woodstox/woodstox-core/5.3.0/woodstox-core-5.3.0.jar
https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-hdfs-client/3.3.4/hadoop-hdfs-client-3.3.4.jar
https://repo1.maven.org/maven2/org/apache/hadoop/hadoop-mapreduce-client-core/3.3.4/hadoop-mapreduce-client-core-3.3.4.jar&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_kafka&#34;&gt;Kafka&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Since I want to read from Kafka in the full example below, we need the &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/connectors/table/kafka/&#34;&gt;Flink SQL Kafka connector&lt;/a&gt;.
The JAR is &lt;a href=&#34;https://repo1.maven.org/maven2/org/apache/flink/flink-sql-connector-kafka/3.4.0-1.20/flink-sql-connector-kafka-3.4.0-1.20.jar&#34;&gt;&lt;code&gt;flink-sql-connector-kafka-3.4.0-1.20.jar&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_jar_location&#34;&gt;JAR location&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I put JARs in subfolders under &lt;code&gt;./lib&lt;/code&gt; to make it easier to organise and see what’s there:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;lib
├── hadoop
│   ├── commons-configuration2-2.1.1.jar
│   ├── commons-logging-1.1.3.jar
│   ├── hadoop-auth-3.3.4.jar
│   ├── hadoop-common-3.3.4.jar
│   ├── hadoop-hdfs-client-3.3.4.jar
│   ├── hadoop-mapreduce-client-core-3.3.4.jar
│   ├── hadoop-shaded-guava-1.1.1.jar
│   ├── stax2-api-4.2.1.jar
│   └── woodstox-core-5.3.0.jar
├── iceberg
│   ├── iceberg-aws-bundle-1.9.1.jar
│   └── iceberg-flink-runtime-1.20-1.9.1.jar
├── kafka
│   └── flink-sql-connector-kafka-3.4.0-1.20.jar&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can also just put them straight under &lt;code&gt;./lib&lt;/code&gt; if you’d rather.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_checkpointing&#34;&gt;Checkpointing&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You need to configure &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/datastream/fault-tolerance/checkpointing/#checkpointing&#34;&gt;checkpointing&lt;/a&gt; in Flink in order for it to write data files.
If you don’t then you’ll see metadata get written, but no actual data.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can configure checkpointing within your SQL session by running:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SET&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;execution.checkpointing.interval&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;30s&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_smoke_testing_icebergs3glue&#34;&gt;Smoke testing Iceberg/S3/Glue&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Before we get data from Kafka into Iceberg, let’s just make sure the Iceberg/S3/Glue component is working.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This will launch a Flink SQL client if you’re using the Docker Compose that &lt;a href=&#34;https://github.com/rmoff/examples/tree/main/iceberg/flink-kafka-aws&#34;&gt;I’ve shared&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-it&lt;/span&gt; jobmanager bash &lt;span style=&#34;color: #f92672&#34;&gt;-c&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;./bin/sql-client.sh&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;There are two ways to write an Iceberg table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;Explicitly, using the Iceberg connector in the table DDL&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Implicitly, by declaring an Iceberg catalog in Flink and creating a table within it&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s check both.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_creating_an_iceberg_table_in_flink_sql_using_the_iceberg_connector&#34;&gt;Creating an Iceberg table in Flink SQL using the Iceberg connector&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This will create a table called &lt;code&gt;test01&lt;/code&gt; in the Glue database &lt;code&gt;my_glue_db&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;test01&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;col1&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;iceberg&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;catalog-name&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;foo&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;catalog-database&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;my_glue_db&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;warehouse&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;s3://rmoff-lakehouse/00/&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;catalog-impl&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;org.apache.iceberg.aws.glue.GlueCatalog&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;ioImpl&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;org.apache.iceberg.aws.s3.S3FileIO&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;code&gt;catalog-name&lt;/code&gt; is a mandatory configuration but as far as I can tell doesn’t have any impact on the written table, and is only used within Flink as part of the operator name.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now write a row of data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;test01&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INFO&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Submitting&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;update&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;the&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;cluster&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;...&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INFO&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;update&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;has&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;been&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;successfully&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;submitted&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;to&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;the&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;cluster&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Job&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ID&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;6742&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;c18db85384825217b75fdb12b784&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock warning&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-warning&#34; title=&#34;Warning&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;At this point, all that’s happened is &lt;em&gt;the job to write the data has been &lt;strong&gt;submitted&lt;/strong&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Don’t assume that because it was successfully &lt;strong&gt;submitted&lt;/strong&gt; it’s been successfully &lt;strong&gt;executed&lt;/strong&gt;!&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Check that the data has been written to the table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;test01&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;col1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------+&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Received&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;6&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;77&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Inspect the object storage:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws s3 &lt;span style=&#34;color: #f92672&#34;&gt;--recursive&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;ls &lt;/span&gt;s3://rmoff-lakehouse/00
2025-06-24 16:44:34        423 00/my_glue_db.db/test01/data/00000-0-a2de3a7d-6075-4d80-a440-fb0e702ec4b8-00001.parquet
2025-06-24 16:44:28        874 00/my_glue_db.db/test01/metadata/00000-9808fb50-5694-4331-afb7-ee02fa7fa8ee.metadata.json
2025-06-24 16:44:36       1995 00/my_glue_db.db/test01/metadata/00001-a74b52b7-7fda-4e35-a044-17c2cae96aef.metadata.json
2025-06-24 16:44:35       6964 00/my_glue_db.db/test01/metadata/79f37e16-6b9d-491f-b96b-d4795b66bac1-m0.avro
2025-06-24 16:44:35       4455 00/my_glue_db.db/test01/metadata/snap-5270520003556673576-1-79f37e16-6b9d-491f-b96b-d4795b66bac1.avro&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you only see &lt;code&gt;.metadata.json&lt;/code&gt; files, it could be that Flink hasn’t checkpointed yet—see above.&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You’ll see the table in the Glue data catalog:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/06/2025-06-24T16-03-21-626Z.webp&#34; alt=&#34;2025 06 24T16 03 21 626Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_creating_a_table_in_flink_sql_within_an_iceberg_catalog&#34;&gt;Creating a table in Flink SQL within an Iceberg catalog&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The other route to creating an Iceberg table is to create a Flink SQL Catalog that is of an Iceberg type, pointing to the Glue data catalog.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;quoteblock&#34;&gt;
&lt;blockquote&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&amp;#34;a Flink SQL Catalog that is of an Iceberg type, pointing to the Glue data catalog&amp;#34;&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;😖 &lt;em&gt;Whuuuhh what does this even mean?&lt;/em&gt;
&lt;em&gt;Find out more in this article that I wrote previously: &lt;a href=&#34;https://www.decodable.co/blog/catalogs-in-flink-sql-a-primer&#34;&gt;Catalogs in Flink SQL—A Primer&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;First create a catalog:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CATALOG&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_iceberg_catalog&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;type&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;iceberg&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;warehouse&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;s3://rmoff-lakehouse/00/&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;catalog-impl&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;org.apache.iceberg.aws.glue.GlueCatalog&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;io-impl&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;org.apache.iceberg.aws.s3.S3FileIO&amp;#39;&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Set the catalog as the active one:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;USE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CATALOG&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_iceberg_catalog&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can now see what Glue databases exist:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SHOW&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;DATABASES&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;database&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_glue_db&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;rmoff_db&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;tmp&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you want, you can create a new database in Glue data catalog:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;DATABASE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;new_glue_db&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now set the database (existing, or new) as the active one:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;USE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_iceberg_catalog&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;new_glue_db&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Finally, create and populate the new table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;test02&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;col1&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;test02&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The end result is the same as above - a table registered in the Glue data catalog, with Iceberg data stored in S3:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;test02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;col1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------+&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Received&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;65&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws glue get-tables &lt;span style=&#34;color: #f92672&#34;&gt;--region&lt;/span&gt; us-east-1 &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--database-name&lt;/span&gt; new_glue_db &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--query&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TableList[].Name&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--output&lt;/span&gt; table

+----------+
| GetTables|
+----------+
|  test02  |
+----------+&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws s3 &lt;span style=&#34;color: #f92672&#34;&gt;--recursive&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;ls &lt;/span&gt;s3://rmoff-lakehouse/00
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]
2025-06-24 17:32:51        423 00/new_glue_db.db/test02/data/00000-0-0c2f7b3e-6b84-44eb-add7-79ff16f7854d-00001.parquet
2025-06-24 17:32:42        679 00/new_glue_db.db/test02/metadata/00000-202c2e5e-db26-42cc-85df-a6e3c8b61b83.metadata.json
2025-06-24 17:32:53       1800 00/new_glue_db.db/test02/metadata/00001-2b15df7b-c93a-4cc8-a755-43e10afbeb44.metadata.json
2025-06-24 17:32:53       6963 00/new_glue_db.db/test02/metadata/6ef46eac-d442-40c8-bfaa-644cb84e5f0e-m0.avro
2025-06-24 17:32:53       4455 00/new_glue_db.db/test02/metadata/snap-4874299872284941836-1-6ef46eac-d442-40c8-bfaa-644cb84e5f0e.avro&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_kafka_iceberg_s3glue&#34;&gt;Kafka → Iceberg (S3/Glue)&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we can put this into practice, and use it to stream data from Kafka to Iceberg on S3, with Glue data catalog.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_define_the_kafka_source&#34;&gt;Define the Kafka source&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s a table that stores its data in Kafka.
I’m creating it outside of the Glue/Iceberg catalog because within it it always writes it as Iceberg.
Note that if you actually use the &lt;code&gt;generic_in_memory&lt;/code&gt; catalog you’ll need to define your tables in every Flink session.
See &lt;a href=&#34;https://www.decodable.co/blog/catalogs-in-flink-sql-a-primer&#34;&gt;Catalogs in Flink SQL—A Primer&lt;/a&gt; for more details.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CATALOG&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;src&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;type&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;generic_in_memory&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;

&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;DATABASE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;src&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;kafka&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;

&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;src&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;kafka&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;kafka_transactions&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;transaction_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;user_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;amount&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;currency&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;merchant&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;transaction_time&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan.startup.mode&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;earliest-offset&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;transactions&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we’ll write some data to it:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;src&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;kafka&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;kafka_transactions&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TXN_001&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USER_123&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;GBP&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Amazon&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-06-23 10:30:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TXN_002&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USER_456&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;12&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;GBP&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Starbucks&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-06-23 10:35:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TXN_003&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USER_789&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;89&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USD&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Shell&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-06-23 10:40:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TXN_004&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USER_123&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;156&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;EUR&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Tesco&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-06-23 10:45:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TXN_005&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USER_321&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;8&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;GBP&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;McDonald&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;s&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-06-23 10:50:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Check the data’s there on the Kafka topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-it&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #f92672&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #f92672&#34;&gt;-C&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-t&lt;/span&gt; transactions &lt;span style=&#34;color: #f92672&#34;&gt;-c5&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;TXN_001&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;USER_123&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;:45.99,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;currency&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;GBP&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;merchant&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;Amazon&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_time&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;2025-06-23 10:30:00&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;TXN_002&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;USER_456&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;:12.5,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;currency&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;GBP&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;merchant&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;Starbucks&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_time&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;2025-06-23 10:35:00&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;TXN_003&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;USER_789&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;:89.99,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;currency&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;USD&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;merchant&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;Shell&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_time&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;2025-06-23 10:40:00&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;TXN_004&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;USER_123&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;:156.75,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;currency&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;EUR&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;merchant&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;Tesco&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_time&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;2025-06-23 10:45:00&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;TXN_005&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;user_id&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;USER_321&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;amount&amp;#34;&lt;/span&gt;:8.99,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;currency&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;GBP&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;merchant&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;McDonald&amp;#39;s&amp;#34;&lt;/span&gt;,&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;transaction_time&amp;#34;&lt;/span&gt;:&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#34;2025-06-23 10:50:00&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_send_kafka_data_to_iceberg_using_this_one_simple_trick&#34;&gt;💡 Send Kafka data to Iceberg using this one simple trick 😉&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we create an Iceberg table, populated by what’s in the Kafka topic.
It’s just a single SQL statement:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_iceberg_catalog&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_glue_db&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;transactions&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;src&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;kafka&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;kafka_transactions&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Flink then reads from the Kafka topic, and writes it to the Iceberg table.
We can see the Iceberg table has been created in Glue data catalog:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws glue get-tables &lt;span style=&#34;color: #f92672&#34;&gt;--region&lt;/span&gt; us-east-1 &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--database-name&lt;/span&gt; my_glue_db &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--query&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TableList[].Name&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #f92672&#34;&gt;--output&lt;/span&gt; table
&lt;span style=&#34;color: #f92672&#34;&gt;------------------&lt;/span&gt;
|    GetTables   |
+----------------+
|  test01        |
|  transactions  |
+----------------+&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and it’s been populated:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/06/2025-06-24T17-05-34-439Z.webp&#34; alt=&#34;2025 06 24T17 05 34 439Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;A Flink SQL &lt;code&gt;CREATE TABLE…AS SELECT&lt;/code&gt; (known as &lt;code&gt;CTAS&lt;/code&gt;) is a continuous query—a job that will run forever until you cancel it, executing the &lt;code&gt;SELECT&lt;/code&gt; query and writing the results to the target table.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;That means that if we add more rows to the source Kafka table (which is just a Kafka topic, and can be populated by any Kafka producer):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;src&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;kafka&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;kafka_transactions&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TXN_006&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USER_456&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;23&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;GBP&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Wayne Enterprises&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-06-23 10:55:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TXN_007&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USER_789&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;67&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;80&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USD&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Stark Industries&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-06-23 11:00:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;TXN_008&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;USER_654&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;EUR&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Daily Planet&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-06-23 11:05:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;we’ll shortly see the same data appear on the Iceberg table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/06/2025-06-24T17-10-32-925Z.webp&#34; alt=&#34;2025 06 24T17 10 32 925Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_insert_overwrite&#34;&gt;INSERT OVERWRITE&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Iceberg tables can be written to using:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://iceberg.apache.org/docs/nightly/flink-writes/#insert-into&#34;&gt;&lt;code&gt;INSERT INTO&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://iceberg.apache.org/docs/nightly/flink-writes/#insert-overwrite&#34;&gt;&lt;code&gt;INSERT OVERWRITE&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://iceberg.apache.org/docs/nightly/flink-writes/#upsert&#34;&gt;&lt;code&gt;UPSERT&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In the examples above we’ve used &lt;code&gt;INSERT INTO&lt;/code&gt;, either explicitly to populate an existing table, or implicitly with the &lt;code&gt;CREATE TABLE…AS SELECT&lt;/code&gt; statement.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can use &lt;code&gt;INSERT OVERWRITE&lt;/code&gt; to overwrite the existing tables contents.
This sounds useful for things like refreshing dimension tables if you don’t want to retain history (a.k.a Slowly Changing Dimension Type 0).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the intial state of the table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;USE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_iceberg_catalog&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;new_glue_db&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim01&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim01&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;foo&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;43&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;bar&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim01&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                            &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;foo&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #ae81ff&#34;&gt;43&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                            &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;bar&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Received&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;19&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;

&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now to overwrite it.
&lt;code&gt;INSERT OVERWRITE&lt;/code&gt; is only available in a batch Flink job, so we set that first:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SET&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;execution.runtime-mode&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;batch&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and then overwrite the data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;OVERWRITE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim01&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;wibble&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim01&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;wibble&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;80&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I wonder if this could also be useful when working with fact data that’s partitioned by date, and you want to refresh an entire partition—perhaps with data that was late and you now have a complete picture of the day.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;-- Create a partitioned table&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;amount&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;PARTITIONED&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;

&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;-- Populate it&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-06-24&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;200&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-06-24&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;150&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-06-25&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With the table populated you’ll see the data is physically partitioned on disk, with the data files under a folder path that includes the partition value (e.g. &lt;code&gt;/order_date=2024-06-24/&lt;/code&gt;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;$ &lt;/span&gt;aws s3 &lt;span style=&#34;color: #f92672&#34;&gt;--recursive&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;ls &lt;/span&gt;s3://rmoff-lakehouse/00/my_glue_db.db/orders/
2025-06-25 11:07:24       1020 00/my_glue_db.db/orders/data/order_date&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;2024-06-24/00000-0-9a3c536e-cf26-43ad-940f-dde15931e3c1-00001.parquet
2025-06-25 11:07:24        985 00/my_glue_db.db/orders/data/order_date&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;2024-06-25/00000-0-9a3c536e-cf26-43ad-940f-dde15931e3c1-00002.parquet
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;[&lt;/span&gt;…]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Query the table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2024&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;24&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;200&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2024&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;24&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;150&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2024&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;76&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now let’s replace the data for &lt;code&gt;2024-06-24&lt;/code&gt;, leaving &lt;code&gt;2024-06-25&lt;/code&gt; untouched:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;OVERWRITE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PARTITION&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-06-24&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;200&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;43&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;21&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;150&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2024&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2024&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;24&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;200&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2024&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;24&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2024&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;24&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;7&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #ae81ff&#34;&gt;43&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;21&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2024&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;24&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;79&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Note that Flink enforces something to stop you being stupid; you can’t specify the partition value in the &lt;code&gt;INSERT&lt;/code&gt; values because you’d risk ending up with inconsistent data.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;OVERWRITE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PARTITION&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-06-24&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-06-23&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;200&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-06-24&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-06-27&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;43&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;21&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-06-24&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ERROR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Could&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;execute&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Reason&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;flink&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;api&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ValidationException&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Column&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;types&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;result&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;and&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;sink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;my_iceberg_catalog.my_glue_db.orders&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;match&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Cause&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Different&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;number&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;columns&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;

&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;schema&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;EXPR&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;EXPR&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;EXPR&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;EXPR&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Sink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;schema&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_upsert&#34;&gt;UPSERT&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Whereas &lt;code&gt;INSERT OVERWRITE&lt;/code&gt; says &amp;#34;&lt;em&gt;write this data over whatever may be there already&lt;/em&gt;&amp;#34;, an &lt;code&gt;UPSERT&lt;/code&gt; is a more courteous operation, telling Flink to &amp;#34;&lt;em&gt;write this data, and if the key exists already update it, and if not, insert it&lt;/em&gt;&amp;#34;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s see it in action.
To start with, you need a key on your table—since the whole point of an &lt;code&gt;UPSERT&lt;/code&gt; is that it’ll match on the key to determine whether it’s an &lt;code&gt;UPDATE&lt;/code&gt; (the key exists already) or an &lt;code&gt;INSERT&lt;/code&gt; (it doesn’t).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;inventory&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;product_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;product_name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;quantity&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;product_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;

&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;inventory&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;101&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Running shoes&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;102&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;GPS watch&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;103&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Gels&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;inventory&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------+---------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;product_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;product_name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;quantity&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------+---------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;102&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;GPS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;watch&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;103&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Gels&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;101&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Running&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;shoes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------+---------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To use &lt;code&gt;UPSERT&lt;/code&gt; it’s the same &lt;code&gt;INSERT INTO&lt;/code&gt; syntax, but &lt;code&gt;UPSERT&lt;/code&gt; is set as a &lt;a href=&#34;https://iceberg.apache.org/docs/latest/flink-configuration/#write-options&#34;&gt;configuration&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This can be at the query level, using a query hint:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;inventory&lt;/span&gt;
    &lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;/*+ OPTIONS(&amp;#39;upsert-enabled&amp;#39;=&amp;#39;true&amp;#39;) */&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;102&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;GPS watch ⌚&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Upsert query hint&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;inventory&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------+---------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;product_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;product_name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;quantity&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------+---------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;102&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;GPS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;watch&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;⌚&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;103&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Gels&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;101&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Running&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;shoes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------+---------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;40&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can also configure a table to use &lt;code&gt;UPSERT&lt;/code&gt; always:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;inventory&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SET&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;write.upsert.enabled&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;true&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;inventory&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;103&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Gels 🍫&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;28&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;inventory&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------+---------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;product_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;product_name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;quantity&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------+---------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;103&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Gels&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;🍫&lt;/span&gt;  &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;28&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;102&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;GPS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;watch&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;⌚&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;101&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Running&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;shoes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;------------+---------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;61&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_examining_iceberg_metadata&#34;&gt;Examining Iceberg metadata&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The &lt;a href=&#34;https://iceberg.apache.org/docs/latest/flink/&#34;&gt;Iceberg docs for Flink&lt;/a&gt; are pretty comprehensive.
Something else that caught my eye when perusing them was the metadata tables.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Each Iceberg table has a bunch of metadata associated with it, covering things like physical data file locations, snapshots, manifests, and so on.
For my RDBMS readers, you can think of these as the equivalent of &lt;code&gt;V$&lt;/code&gt; tables in Oracle, &lt;code&gt;pg_*&lt;/code&gt; tables in Postgres, etc.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can find details of the tables in &lt;a href=&#34;https://iceberg.apache.org/docs/latest/flink-queries/#inspecting-tables&#34;&gt;the Iceberg docs&lt;/a&gt;.
The tables themselves are a suffix that you append to your actual table name.
So if you want to see the list of files for a table called &lt;code&gt;foo&lt;/code&gt;, you’d query table &lt;code&gt;foo$files&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s a list of the tables/suffixes:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$history&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$metadata_log_entries&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$snapshots&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$files&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$manifests&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$partitions&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$all_data_files&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$all_manifests&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$refs&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;For example, to look at the snapshots associated with the &lt;code&gt;dim01&lt;/code&gt; table above:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;DESCRIBE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim01&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;snapshots&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;---------------+---------------------------------------+-------+-----+--------+-----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                                  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;extras&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;watermark&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;---------------+---------------------------------------+-------+-----+--------+-----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;committed_at&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;TIMESTAMP_LTZ&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;6&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FALSE&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;snapshot_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                                &lt;span style=&#34;color: #f8f8f2&#34;&gt;BIGINT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FALSE&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;parent_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                                &lt;span style=&#34;color: #f8f8f2&#34;&gt;BIGINT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;operation&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;manifest_list&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;summary&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;MAP&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;---------------+---------------------------------------+-------+-----+--------+-----------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;committed_at&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;snapshot_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;operation&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;summary&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim01&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;snapshots&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----------------------------+---------------------+-----------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;committed_at&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;snapshot_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;operation&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;summary&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----------------------------+---------------------+-----------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;390000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1088585618716047739&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;append&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;flink&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;operator&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;90&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;bea66d&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;...&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;12&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;844000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;8184558532161473513&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;overwrite&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;flink&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;operator&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;90&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;bea66d&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;...&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----------------------------+---------------------+-----------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;seconds&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_appendix_troubleshooting&#34;&gt;Appendix: Troubleshooting&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_a_managed_table_factory_that_implements_org_apache_flink_table_factories_managedtablefactory_is_not_in_the_classpath&#34;&gt;A managed table factory that implements org.apache.flink.table.factories.ManagedTableFactory is not in the classpath.&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Can you spot the error here?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CATALOG&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_iceberg_catalog&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;type&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;iceberg&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;warehouse&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;s3://rmoff-lakehouse/00/&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;catalog-impl&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;org.apache.iceberg.aws.glue.GlueCatalog&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;io-impl&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;org.apache.iceberg.aws.s3.S3FileIO&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INFO&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Execute&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;succeeded&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;

&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim01&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ERROR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Could&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;execute&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Reason&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;flink&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;api&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ValidationException&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;options&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;do&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;contain&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;an&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;option&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;discovering&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;connector&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Therefore&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;assumes&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;managed&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;However&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;a&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;managed&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;factory&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;that&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;implements&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;flink&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;factories&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ManagedTableFactory&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;is&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;the&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;classpath&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’ve created the Iceberg catalog, and then the table within it.
Except I didn’t!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I created the Iceberg catalog, and then created a table in the &lt;em&gt;current catalog and database&lt;/em&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SHOW&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CURRENT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CATALOG&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;current&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;catalog&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;default_catalog&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt;


&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SHOW&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CURRENT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;DATABASE&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;-----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;current&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;database&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;-----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;default_database&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;-----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;set&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Before creating the table I need to either fully qualify the table name:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_iceberg_catalog&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_glue_db&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim01&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INFO&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Execute&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;succeeded&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;or&lt;/em&gt; change the current catalog and database for the session first:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;USE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_iceberg_catalog&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_glue_db&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INFO&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Execute&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;succeeded&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;

&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dim02&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INFO&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Execute&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;succeeded&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    <item>
      <title>Digging into Ducklake</title>
      <link>https://rmoff.net/2025/06/02/digging-into-ducklake/</link>
      <pubDate>2025-06-02</pubDate>
      
      <guid>https://rmoff.net/2025/06/02/digging-into-ducklake/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/06/t_IMG_0251.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;After a week’s holiday (&amp;#34;vacation&amp;#34;, for y’all in the US) without a glance at anything work-related, what joy to return and find that the DuckDB folk have been busy, not only with &lt;a href=&#34;https://duckdb.org/2025/05/21/announcing-duckdb-130.html&#34;&gt;the recent 1.3.0 DuckDB release&lt;/a&gt;, but also a brand new project called &lt;a href=&#34;https://github.com/duckdb/ducklake&#34;&gt;DuckLake&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here are my brief notes on DuckLake.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_getting_our_ducks_in_a_row&#34;&gt;Getting our ducks in a row&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s be clear: Naming things is hard.
Even so, the DuckLake name is confusing because it implies a tight-coupling to DuckDB where there is none (other than the ownership of the project).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;DuckLake in its most abstract form is a &lt;a href=&#34;https://ducklake.select/docs/stable/specification/introduction.html&#34;&gt;&lt;em&gt;specification&lt;/em&gt;&lt;/a&gt; for a way to store and catalog data.&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;An implementation of that specification is available in &lt;a href=&#34;https://ducklake.select/docs/stable/duckdb/introduction&#34;&gt;a DuckDB extension&lt;/a&gt;, but in theory any engine could support it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this blog post, unless I say otherwise I’m going to be talking about DuckLake the specification.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_ok_so_what_is_ducklake&#34;&gt;OK, so what &lt;em&gt;is&lt;/em&gt; DuckLake?&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;title&#34;&gt;Where does this fit in my data engineering toolbox?&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Conceptually, &lt;strong&gt;DuckLake is an open table format (OTF) &lt;em&gt;plus&lt;/em&gt; a catalog&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So it’s (&lt;strong&gt;Iceberg + Polaris&lt;/strong&gt;), it’s (&lt;strong&gt;Delta Lake + Unity&lt;/strong&gt;), etc.&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Physically, DuckLake is data stored as parquet files on object storage, and metadata about those files held in a SQL database.
Storing the metadata in a SQL database is a core design decision.
It means that you don’t need a catalog (because the metadata store &lt;em&gt;becomes&lt;/em&gt; the catalog), as well as resulting in various performance improvements and the removal of metadata file compaction requirements.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;👉 &lt;a href=&#34;https://ducklake.select/manifesto/&#34;&gt;The DuckLake manifesto&lt;/a&gt; does a good job of outlining the current state of OTFs and challenges, and positioning DuckLake within that.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;One bit that caught my eye was the nascent support for &lt;a href=&#34;https://ducklake.select/docs/stable/duckdb/advanced_features/data_inlining.html&#34;&gt;inlined data updates&lt;/a&gt;, in which the SQL database (currently only DuckDB itself) is also used to hold small bits of data (imagine that! in a database!) instead of directly writing individual changes to a parquet file.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_dlf_vs_otfwtf&#34;&gt;DLF vs OTF—WTF?&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The last few years in data engineering have been marked by numerous explainers on Open Table Formats (OTF), such that we’re fairly comfortable with what they are now.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;DuckLake rips this back open, by introducing the &amp;#34;Data Lakehouse Format&amp;#34; (DLF) term.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;It makes sense because DuckLake isn’t [just] a open table format, because it bundles the catalog too.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_sounds_complicated_isnt_this_just_more_moving_parts&#34;&gt;Sounds complicated. Isn’t this just more moving parts?&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Yes, but no.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you’re using an OTF (Iceberg/Delta Lake/Hudi) for any kind of task beyond a local sandbox and a single user, you’ll need a catalog.
DuckLake just wraps these two things together.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Instead of managing object storage + catalog, you manage object storage + SQL database.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Looking at it this way, it’s actually a better option from an operations point of view; catalogs are relatively new technology, whilst DBAs have been feeding and watering SQL databases for decades.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_relationship_to_motherduck&#34;&gt;Relationship to Motherduck&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Motherduck wrote &lt;a href=&#34;https://motherduck.com/blog/ducklake-motherduck/&#34;&gt;a blog post about DuckLake&lt;/a&gt; with their own take on the manifesto and positioning of DuckLake.
They’re offering to provide the SQL catalog for DuckLake along with the data storage too, optionally.
They’ll also do the housekeeping on the data files—remember, even if the &lt;em&gt;metadata&lt;/em&gt; files are now in a SQL catalog, there could still be potentially the problem of small &lt;em&gt;data&lt;/em&gt; files that need compacting in order for optimal performance.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_what_about_iceberg&#34;&gt;What about Iceberg?&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;DuckDB’s lack of comprehensive support for Iceberg has been notable for a while, and DuckLake doesn’t do anything to fix that unfortunately.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;DuckLake and Iceberg are completely unrelated in terms of interaction.
If you use Iceberg, you use Iceberg.
DuckLake would replace Iceberg (plus its catalog).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In the above blog post, Motherduck position DuckLake as &lt;a href=&#34;https://motherduck.com/blog/ducklake-motherduck/#the-iceberg-hedge&#34;&gt;a &amp;#34;hedge&amp;#34; against problems with Iceberg&lt;/a&gt;, saying that DuckLake has planned support for import and export to Iceberg.
To me this is pretty ironic; why would you adopt a technology that’s entirely unproven and states that it’s not production ready, over one which is being widely adopted and successfully used in scale at production for several years?
That’s not to say Iceberg doesn’t have its challenges and maybe one day will be a distant memory as DuckLake takes over the world—but the &amp;#39;hedge&amp;#39; argument today is somewhat flawed.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_governance&#34;&gt;Governance&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;All the OTFs, and the &amp;#34;DLF&amp;#34; DuckLake are open source licenced.
Licensing is just one element of &amp;#34;open&amp;#34; to consider though; the other is how the project is &lt;em&gt;governed&lt;/em&gt;.
This can impact how easy it is to submit bug fixes, add new features, or even make breaking changes.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Apache Iceberg and Apache Hudi are governed by the Apache Software Foundation.
Changes and developments are managed by the PMC, made up of contributors from different companies.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Delta Lake is owned by the Linux Foundation, but in practice is a Databricks project.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;DuckLake is owned by the &lt;a href=&#34;https://duckdb.org/foundation/&#34;&gt;DuckDB Foundation&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_sounds_fun_lets_try_it&#34;&gt;Sounds fun, let’s try it!&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;admonitionblock warning&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-warning&#34; title=&#34;Warning&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
Be aware that DuckLake’s &lt;a href=&#34;https://ducklake.select/faq#ducklake-in-operation&#34;&gt;not recommended for production use yet&lt;/a&gt;.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;At the moment the only implementation of DuckLake is in the form of an extension for DuckDB.
There are some good examples at the end of &lt;a href=&#34;https://duckdb.org/2025/05/27/ducklake.html&#34;&gt;the DuckLake announcement blog&lt;/a&gt; of its use.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I put together &lt;a href=&#34;https://github.com/rmoff/examples/blob/main/ducklake/docker-compose.yml&#34;&gt;a Docker Compose&lt;/a&gt; to run DuckDB (DuckLake engine) and Postgres (metadata catalog) together, using local file system for data.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;First off, install the DuckLake and Postgres extensions in DuckDB:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INSTALL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INSTALL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Then create a DuckLake database using Postgres for metadata and local filesystem (&lt;code&gt;/data&lt;/code&gt;) for the data files.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ATTACH&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;ducklake:postgres:dbname=postgres host=postgres user=postgres password=Welcome123&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_ducklake&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;DATA_PATH&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;/data/&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;

&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;USE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;my_ducklake&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now create a table and add some data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;🟡◗&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;test_data&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INTEGER&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;email&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;age&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INTEGER&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;registration_date&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;score&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DOUBLE&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;is_active&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;BOOLEAN&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;

&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;🟡◗&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;test_data&lt;/span&gt;
  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;generated_data&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
      &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;
          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;row_number&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;OVER&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
          &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;User_&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;row_number&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;OVER&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;())::&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
          &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;user&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;row_number&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;OVER&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;())::&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;VARCHAR&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;||&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;@example.com&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;email&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
          &lt;span style=&#34;color: #ae81ff&#34;&gt;18&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;random&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)::&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;INTEGER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;age&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
          &lt;span style=&#34;color: #f8f8f2&#34;&gt;DATE&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2024-01-01&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;random&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;365&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)::&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;INTEGER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;registration_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;round&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;random&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;100&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;score&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;random&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;is_active&lt;/span&gt;
      &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;range&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1000&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;generated_data&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Check the data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code&gt;🟡◗ SELECT COUNT(*) FROM test_data;
┌──────────────┐
│ count_star() │
│    int64     │
├──────────────┤
│     1000     │
└──────────────┘

🟡◗ SELECT * FROM test_data LIMIT 1;
┌───────┬─────────┬────────────────────┬───────┬───────────────────┬────────┬───────────┐
│  id   │  name   │       email        │  age  │ registration_date │ score  │ is_active │
│ int32 │ varchar │      varchar       │ int32 │       date        │ double │  boolean  │
├───────┼─────────┼────────────────────┼───────┼───────────────────┼────────┼───────────┤
│     1 │ User_1  │ user1@example.com  │    64 │ 2024-09-10        │   4.29 │ false     │
├───────┴─────────┴────────────────────┴───────┴───────────────────┴────────┴───────────┤
│ 1 row                                                                       7 columns │
└───────────────────────────────────────────────────────────────────────────────────────┘&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Over in Postgres is the metadata:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=#&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dt&lt;/span&gt;
                         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;List&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;of&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;relations&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Schema&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Name&lt;/span&gt;                  &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Type&lt;/span&gt;  &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Owner&lt;/span&gt;
&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;--------+---------------------------------------+-------+----------&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_column&lt;/span&gt;                       &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_column_tag&lt;/span&gt;                   &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_data_file&lt;/span&gt;                    &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_delete_file&lt;/span&gt;                  &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_file_column_statistics&lt;/span&gt;       &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_file_partition_value&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_files_scheduled_for_deletion&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_inlined_data_tables&lt;/span&gt;          &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_metadata&lt;/span&gt;                     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_partition_column&lt;/span&gt;             &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_partition_info&lt;/span&gt;               &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_schema&lt;/span&gt;                       &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_snapshot&lt;/span&gt;                     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_snapshot_changes&lt;/span&gt;             &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_table&lt;/span&gt;                        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_table_column_stats&lt;/span&gt;           &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_table_stats&lt;/span&gt;                  &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_tag&lt;/span&gt;                          &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
 &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_view&lt;/span&gt;                         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;19&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;rows&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Including the table:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=#&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;table_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;table_uuid&lt;/span&gt;              &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;begin_snapshot&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;end_snapshot&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;schema_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table_name&lt;/span&gt;
&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----------+--------------------------------------+----------------+--------------+-----------+------------&lt;/span&gt;
        &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;0197314&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;e&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;9389&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;7111&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;a705&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;f8341df299c&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;test_data&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and information about the data file:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;postgres&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=#&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake_data_file&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
 &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;data_file_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;table_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;begin_snapshot&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;end_snapshot&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;file_order&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;path&lt;/span&gt;                          &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;path_is_relative&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;file_format&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;record_count&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;file_size_bytes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;footer_size&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;row_id_start&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;partition_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;encryption_key&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;partial_file_info&lt;/span&gt;
&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;--------------+----------+----------------+--------------+------------+-------------------------------------------------------+------------------+-------------+--------------+-----------------+-------------+--------------+--------------+----------------+-------------------&lt;/span&gt;
            &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ducklake&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;0197314&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;e&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;c237&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;e2d&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;9&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;aee&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;6&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;a954d82401e&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;parquet&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;t&lt;/span&gt;                &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;parquet&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #ae81ff&#34;&gt;1000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #ae81ff&#34;&gt;36279&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #ae81ff&#34;&gt;809&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This corresponds to the data file on disk on the DuckDB container:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;docker compose &lt;span style=&#34;color: #f8f8f2&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-it&lt;/span&gt; duckdb &lt;span style=&#34;color: #f8f8f2&#34;&gt;ls&lt;/span&gt; &lt;span style=&#34;color: #f92672&#34;&gt;-l&lt;/span&gt; /data
total 36
&lt;span style=&#34;color: #f92672&#34;&gt;-rw-r--r--&lt;/span&gt; 1 root root 36279 Jun  2 15:42 ducklake-0197314e-c237-7e2d-9aee-6a954d82401e.parquet&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_watch_this_space&#34;&gt;Watch this space&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I can see three posibilities for DuckLake:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;It thrives, but only really in the DuckDB world.
Having a way to store data with multi-user access is a pretty nice idea, and I can see folk building some good data platforms around DuckDB and DuckLake.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It finds limited adoption, perhaps amongst Motherduck customers who want a fully-hosted service.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It gains broader adoption outside of the DuckDB ecosystem.
For this there’d need to be some serious implementations of it in popular engines so that it’s not just the DuckDB fan club who use it.
For example, with JDBC support in DuckDB there are some &lt;a href=&#34;https://github.com/duckdb/ducklake/issues/78&#34;&gt;workarounds to access DuckLake from Spark&lt;/a&gt;, but it needs to be first-class support in Spark, Trino, etc.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_more_reading&#34;&gt;More reading&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://ducklake.select/faq&#34;&gt;DuckLake FAQ&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Running &lt;a href=&#34;https://tobilg.com/the-age-of-10-dollar-a-month-lakehouses&#34;&gt;DuckLake on Cloudflare&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Join the &lt;code&gt;#ducklake&lt;/code&gt; channel on the &lt;a href=&#34;https://discord.duckdb.org/&#34;&gt;DuckDB Discord server&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ElReg&lt;/p&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.theregister.com/2025/05/28/duckdb_flips_lakehouse_model_with/&#34;&gt;DuckDB flips lakehouse model with bring-your-own compute and metadata RDBMS&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.theregister.com/2025/06/05/ducklake_db_industry_reacts/&#34;&gt;Industry reacts to DuckDB’s radical rethink of Lakehouse architecture&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    <item>
      <title>Interesting links - May 2025</title>
      <link>https://rmoff.net/2025/05/23/interesting-links-may-2025/</link>
      <pubDate>2025-05-23</pubDate>
      
      <guid>https://rmoff.net/2025/05/23/interesting-links-may-2025/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/05/t_IMG_9832.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;Not got time for all this? I’ve marked 🔥 for my top reads of the month&lt;/em&gt; :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_data_engineering&#34;&gt;Data Engineering&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 Amongst all the background noise of &lt;em&gt;ETL vs ELT vs ZeroETL&lt;/em&gt;, &lt;a href=&#34;https://seattledataguy.substack.com/p/understanding-the-t-in-etl-a-back&#34;&gt;this primer from Ben Rogojan&lt;/a&gt; (a.k.a. &amp;#34;The Seattle Data Guy&amp;#34;) is a great reminder of the actual &amp;#39;T&amp;#39; that needs doing to our data, wherever it is that we do it.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Ask ten engineers in the data space the difference between job titles and you’ll get a dozen opinions.
In a sense this doesn’t matter, but &lt;a href=&#34;https://towardsdatascience.com/data-analyst-or-data-engineer-or-analytics-engineer-or-bi-engineer/&#34;&gt;this post&lt;/a&gt; is useful for laying out a common understanding of the breakdown of the tasks involved in the different &amp;#39;buckets&amp;#39;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://aws.amazon.com/blogs/big-data/melting-the-ice-how-natural-intelligence-simplified-a-data-lake-migration-to-apache-iceberg/&#34;&gt;Details of a migration&lt;/a&gt; from a Hive-based data warehouse to one on Apache Iceberg.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://arturastutkus.substack.com/p/we-shut-down-snowflake-and-heres?r=3nzb0&amp;amp;triedRedirect=true&#34;&gt;A good look from Kayak at realworld design choices and their implications&lt;/a&gt;, including the impact of not using schemas in Kafka, and why they ultimately moved away from Snowflake to Trino instead.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/boringdata/boring-catalog&#34;&gt;Boring catalog&lt;/a&gt; is a new file-based catalog for Apache Iceberg, with a write-up &lt;a href=&#34;https://juhache.substack.com/p/boring-iceberg-catalog&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;More good content from Joe Reis&amp;#39; upcoming book on data modeling:&lt;/p&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://practicaldatamodeling.substack.com/p/the-traditional-levels-of-data-modeling&#34;&gt;The Traditional Levels of Data Modeling&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://practicaldatamodeling.substack.com/p/example-building-a-traditional-data&#34;&gt;Example - Building a Traditional Data Model&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://practicaldatamodeling.substack.com/p/we-dont-have-time-for-data-modeling&#34;&gt;&amp;#34;We Don’t Have Time For Data Modeling&amp;#34;&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Good writeup of some of the more gnarly challenges of &lt;a href=&#34;https://medium.com/vimeo-engineering-blog/behind-viewer-retention-analytics-at-scale-8dbbb5ae7ae2&#34;&gt;modelling and aggregating user interactions at Vimeo in Clickhouse&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 Sean Falconer writes about &lt;a href=&#34;https://medium.com/snowflake/how-to-clean-and-enrich-data-before-it-lands-in-snowflake-5bc937486b82&#34;&gt;How to Clean and Enrich Data Before It Lands in Snowflake.&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_kafka_and_event_streaming&#34;&gt;Kafka and Event Streaming&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 Gunnar Morling had an interesting thought experiment that the internet liked: &lt;a href=&#34;https://www.morling.dev/blog/what-if-we-could-rebuild-kafka-from-scratch/&#34;&gt;What If We Could Rebuild Kafka From Scratch?&lt;/a&gt; (&lt;a href=&#34;https://news.ycombinator.com/item?id=43790420&#34;&gt;HN&lt;/a&gt;, &lt;a href=&#34;https://lobste.rs/s/8s6cxz/what_if_we_could_rebuild_kafka_from&#34;&gt;lobst.rs&lt;/a&gt;).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;LinkedIn &lt;a href=&#34;https://www.youtube.com/watch?v=RDV6-MUVEbQ&amp;amp;t=2053s&#34;&gt;talked about their new Northguard project&lt;/a&gt;, slated to be a replacement for Kafka.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Platformatic released a &lt;a href=&#34;https://github.com/platformatic/kafka&#34;&gt;new node.js Kafka client&lt;/a&gt; and an &lt;a href=&#34;https://blog.platformatic.dev/why-we-created-another-kafka-client-for-nodejs&#34;&gt;accompanying blog&lt;/a&gt; explaining why.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A useful look at &lt;a href=&#34;https://medium.com/@katyagorshkova/understanding-kafka-kraft-how-controllers-and-brokers-talk-in-the-zookeeper-less-world-a5e05a063f34&#34;&gt;how brokers and controllers communicate&lt;/a&gt; when you deploy Kafka using KRaft.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A good introductory article from Vu Trinh: &lt;a href=&#34;https://vutr.substack.com/p/if-youre-learning-kafka-this-article&#34;&gt;If you’re learning Kafka, this article is for you&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Details of &lt;a href=&#34;https://s2.dev/blog/timestamping&#34;&gt;how S2 handles time&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_stream_processing&#34;&gt;Stream Processing&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 I published a second blog about Flink SQL, covering &lt;a href=&#34;https://rmoff.net/2025/05/20/exploring-joins-and-changelogs-in-flink-sql/&#34;&gt;joins and changelogs&lt;/a&gt;.
If you missed last month’s, check it out at &lt;a href=&#34;https://rmoff.net/2025/04/25/its-time-we-talked-about-time-exploring-watermarks-and-more-in-flink-sql/&#34;&gt;It’s Time We Talked About Time: Exploring Watermarks (And More) In Flink SQL&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A &lt;a href=&#34;https://www.streamingdata.tech/p/streaming-challenges-part-1&#34;&gt;couple&lt;/a&gt; of &lt;a href=&#34;https://www.streamingdata.tech/p/streaming-challenges-part-2&#34;&gt;interesting posts&lt;/a&gt; from Yaroslav Tkachenko about challenges in data streaming.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Details of Flink’s new Materialized Tables feature in &lt;a href=&#34;https://www.alibabacloud.com/blog/flink-materialized-table-building-unified-stream-and-batch-etl_602184&#34;&gt;this blog from Alibaba&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GetInData wrote up an article looking at the considerations to make if &lt;a href=&#34;https://medium.com/@getindatatechteam/making-the-right-choice-flink-or-kafka-streams-a84979cc3646&#34;&gt;choosing between Kafka Streams and Apache Flink&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 An excellent talk given by Adi Polak at QCon: &lt;a href=&#34;https://www.infoq.com/presentations/streaming-patterns/&#34;&gt;Streaming All the Things — Patterns of Effective Data Stream Processing&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_ai&#34;&gt;AI&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Agoda published a &lt;a href=&#34;https://medium.com/agoda-engineering/how-agoda-uses-gpt-to-optimize-sql-stored-procedures-in-ci-cd-29caf730c46c&#34;&gt;good blog post&lt;/a&gt; with details of how they’re using GPT to optimise stored procedures, with some impressive results.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 Thoughtful article from Joe Reis on &lt;a href=&#34;https://joereis.substack.com/p/what-does-ai-do-to-the-craft-of-software&#34;&gt;What Does AI Do to The Craft of Software and Data Engineering?&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_general_data_stuff&#34;&gt;General Data Stuff&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Synadia and CNCF has a dust-up over the &lt;a href=&#34;https://www.cncf.io/blog/2025/05/01/protecting-nats-and-the-integrity-of-open-source-cncfs-commitment-to-the-community/&#34;&gt;ownership&lt;/a&gt; of the &lt;a href=&#34;https://www.synadia.com/blog/synadia-response-to-cncf&#34;&gt;NATS trademark&lt;/a&gt;, followed by a &lt;a href=&#34;https://www.cncf.io/announcements/2025/05/01/cncf-and-synadia-align-on-securing-the-future-of-the-nats-io-project/&#34;&gt;public&lt;/a&gt; &lt;a href=&#34;https://www.synadia.com/blog/nats-server-next-steps&#34;&gt;reconciliation&lt;/a&gt;.
El Reg has a &lt;a href=&#34;https://www.theregister.com/2025/05/02/cncf_synadia_nats/&#34;&gt;summary of it here&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RedMonk are my favourite analyst firm, keeping things very real and grounded in their writing. They have &lt;a href=&#34;https://redmonk.com/sogrady/2025/05/06/oss-forward-back/&#34;&gt;a nice article about OSS here&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I played around with Confluent’s new Tableflow feature, looking at &lt;a href=&#34;https://www.confluent.io/blog/building-streaming-data-pipelines-part-1/&#34;&gt;how it could be useful for initial data exploration in a project&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 A really good podcast/video in which Kris Jenkins &lt;a href=&#34;https://www.youtube.com/watch?v=8QNNCr8WfDM&#34;&gt;talks to Andrew Lamb about Apache DataFusion&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://spiraldb.com/post/towards-vortex-10&#34;&gt;Details from SpiralDB of plans for Vortex v1.0&lt;/a&gt;, a new columnar file format.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Details of &lt;a href=&#34;https://www.uber.com/en-GB/blog/migrating-ubers-compute-platform-to-kubernetes-a-technical-journey/&#34;&gt;how Uber migrated from Mesos to Kubernetes&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.alibabacloud.com/blog/introducing-fluss-streaming-storage-for-real-time-analytics_601921&#34;&gt;Fluss&lt;/a&gt;, from the team at Alibaba, has been &lt;a href=&#34;https://lists.apache.org/thread/osg23opm9x95xm318160808r984k0wk9&#34;&gt;proposed as an Apache Incubator project&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_data_in_action&#34;&gt;Data in Action&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://netflixtechblog.com/behind-the-scenes-building-a-robust-ads-event-processing-pipeline-e4e86caf9249&#34;&gt;Details&lt;/a&gt; of how Netflix use Kafka, Flink, and Druid in their Ads platform.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Lyft’s &lt;a href=&#34;https://eng.lyft.com/real-time-spatial-temporal-forecasting-lyft-fa90b3f3ec24&#34;&gt;Real-Time Spatial Temporal Forecasting&lt;/a&gt;, built with tools including Kafka, ClickHouse, and Beam/Flink.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Nice detail of &lt;a href=&#34;https://blog.zomato.com/eliminating-bottlenecks-in-real-time-data-streaming-a-zomato-ads-flink-journey&#34;&gt;how Zomato use Flink SQL&lt;/a&gt; in their real-time ads platform (they also wrote about &lt;a href=&#34;https://blog.zomato.com/apache-flink-journey-zomato-from-inception-to-innovation&#34;&gt;their Flink adoption&lt;/a&gt; previously).&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Three deep-dive blogs from Kakao on &lt;a href=&#34;https://tech.kakao.com/posts/681&#34;&gt;their adoption of Flink CDC&lt;/a&gt; to &lt;a href=&#34;https://tech.kakao.com/posts/668&#34;&gt;get data into Iceberg&lt;/a&gt;, and &lt;a href=&#34;https://tech.kakao.com/posts/695&#34;&gt;their experience operating Iceberg&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Picnic &lt;a href=&#34;https://blog.picnic.nl/building-a-real-time-analytics-platform-for-picnic-fefc094807ec&#34;&gt;describe their realtime analytics platform&lt;/a&gt; built with Kafka for ingest, and Clickhouse for processing (via refreshable materialized views) and serving.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;It’s one thing building a BI platform—but the journey doesn’t stop there; you need to also see how people are using it, which is what &lt;a href=&#34;https://blogs.halodoc.io/optimizing-analytics-visualizing-metabase-and-looker-usage-patterns/&#34;&gt;Halodoc built a system to analyse&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_and_finally&#34;&gt;And finally…&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;Nothing to do with data, but stuff that I’ve found interesting or has made me smile.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://neal.fun/internet-artifacts/&#34;&gt;Internet Artifacts&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.pragmaticengineer.com/stack-overflow-is-almost-dead/&#34;&gt;Stack Overflow is almost dead&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.dreamsongs.com/RiseOfWorseIsBetter.html&#34;&gt;The Rise of Worse is Better&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://stkbailey.substack.com/p/worlds-are-narrative-scaffolds&#34;&gt;Worlds are story scaffolds&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;div class=&#34;title&#34;&gt;Tip&lt;/div&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
If you like these kind of links you might like to read about &lt;a href=&#34;https://rmoff.net/2024/05/22/how-i-try-to-keep-up-with-the-data-tech-world-a-list-of-data-blogs/&#34;&gt;How I Try To Keep Up With The Data Tech World (A List of Data Blogs)&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    <item>
      <title>Exploring Joins and Changelogs in Flink SQL</title>
      <link>https://rmoff.net/2025/05/20/exploring-joins-and-changelogs-in-flink-sql/</link>
      <pubDate>2025-05-20</pubDate>
      
      <guid>https://rmoff.net/2025/05/20/exploring-joins-and-changelogs-in-flink-sql/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/05/t_IMG_9676.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;SQL&lt;/strong&gt;. Three simple letters.
&lt;em&gt;Ess Queue Ell&lt;/em&gt;.
&lt;code&gt;/ˌɛs kjuː ˈɛl/&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In the data world they bind us together, yet separate us.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;As the saying goes, England and America are two countries divided by the same language, and the same goes for the batch and streaming world and some elements of SQL.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In Flink SQL all objects are tables.
So how does Flink SQL deal with the idea of a &amp;#39;table&amp;#39; that in the RDBMS world is a static lump of data (a.k.a. &amp;#39;bounded&amp;#39;), but in Flink’s world can be either bounded or &lt;em&gt;unbounded&lt;/em&gt; (streaming)?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The answer is what the Flink docs call &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/concepts/dynamic_tables/#dynamic-tables&#34;&gt;&lt;strong&gt;Dynamic Tables&lt;/strong&gt;&lt;/a&gt; and &lt;em&gt;changelogs&lt;/em&gt;.
Some of this will be visible to you, and some of it won’t unless you go poking around for it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
Bear in mind that &lt;strong&gt;a table is a table in Flink SQL&lt;/strong&gt;; you don’t go and declare a &amp;#34;dynamic table&amp;#34;; it’s a conceptual thing.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this blog post I’m going to start with a simple &lt;code&gt;SELECT * FROM&lt;/code&gt; and build up from there, looking at the changelog implications at each stage along the way.
In particular, I’m going to learn the hard way what happens when you take a &lt;code&gt;LEFT OUTER JOIN&lt;/code&gt; from a regular RDBMS and chuck it into Flink SQL without understanding the implications…&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_getting_started&#34;&gt;Getting Started&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’m using a local Apache Flink 2.0 environment running under Docker Compose that you can spin up from &lt;a href=&#34;https://github.com/rmoff/flink-examples/tree/main/flink-kafka&#34;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;First we’ll create a simple &lt;code&gt;orders&lt;/code&gt; fact table and &lt;code&gt;customers&lt;/code&gt; dimension table, using Kafka to hold the data.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;orders&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;

&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;customers&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;I’m using the &lt;code&gt;upsert-kafka&lt;/code&gt; connector here, which has implications for the changelog.
For a fact (append-only) table you’d typically use the &lt;code&gt;kafka&lt;/code&gt; connector instead, and use the &lt;code&gt;upsert-kafka&lt;/code&gt; connector for dimensional data that may change.
I get into this detail later in the post.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we’ll populate both tables with a light sprinkling of data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1001&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-09 14:30:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1002&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-9012&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-09 15:45:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1003&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-09 16:15:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-3456&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Yelena Belova&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Bucky Barnes&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-9012&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Valentina Allegra de Fontaine&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_what_could_be_more_simple_than_a_select&#34;&gt;What could be more simple than a SELECT?&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This gives us this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/query02.gif&#34; alt=&#34;query02&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Notice how the &lt;code&gt;Updated:&lt;/code&gt; keeps changing?
That’s because it’s a streaming query, and if I add another row to the table, it’ll appear in the results.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What about if we switch the &lt;code&gt;result-mode&lt;/code&gt; from the default &lt;code&gt;table&lt;/code&gt; to &lt;code&gt;tableau&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SET&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;sql-client.execution.result-mode&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;tableau&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/query01.gif&#34; alt=&#34;query01&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we get a new column, &lt;code&gt;op&lt;/code&gt;—short for &amp;#34;operation&amp;#34;.
This shows us the changelog view of what’s going on when the query is executing.
In this case the three rows are all &lt;code&gt;+I&lt;/code&gt; for &lt;code&gt;INSERT&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Probably the simplest example of a changelog other than just &lt;code&gt;+I&lt;/code&gt; (i.e. append-only) is an aggregate, in which the value changes as new data is read:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;COUNT&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_ct&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;             &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_ct&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The first order is read and so the count is 1, which is &lt;code&gt;+I&lt;/code&gt; to the query output.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;When the next order is read the count becomes two.
For the purposes of the changelog, this is first a &lt;code&gt;-U&lt;/code&gt; operation to remove the existing value, and then a &lt;code&gt;+U&lt;/code&gt; to replace it.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
You can learn more about &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/concepts/dynamic_tables/#dynamic-tables-amp-continuous-queries&#34;&gt;continuous queries&lt;/a&gt; and &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/concepts/overview/#stateful-operators&#34;&gt;stateful operators and pipelines&lt;/a&gt; in the docs.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The different operations have terms that you can find mentioned &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/api/java/org/apache/flink/types/RowKind.html&#34;&gt;in the Flink docs&lt;/a&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;table class=&#34;tableblock frame-all grid-all stretch&#34;&gt;
&lt;colgroup&gt;
&lt;col style=&#34;width: 25%;&#34;/&gt;
&lt;col style=&#34;width: 75%;&#34;/&gt;
&lt;/colgroup&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th class=&#34;tableblock halign-left valign-top&#34;&gt;Operation&lt;/th&gt;
&lt;th class=&#34;tableblock halign-left valign-top&#34;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;+I&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;INSERT&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;-U&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;UPDATE_BEFORE&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;+U&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;UPDATE_AFTER&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;-D&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;DELETE&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Update operations don’t have to be for an aggregate.
Here’s another example in which an &lt;code&gt;UPDATE_AFTER&lt;/code&gt; is used to remove a row that no longer matches a query predicate.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the original &lt;code&gt;orders&lt;/code&gt; query, now with a predicate:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WHERE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;70&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;9012&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The &lt;code&gt;total_amount&lt;/code&gt; for order &lt;code&gt;1003&lt;/code&gt; is 75.25 and thus meets the predicate &lt;code&gt;total_amount &amp;gt;70&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Leaving this query running, in a second Flink SQL session I add another row to the &lt;code&gt;orders&lt;/code&gt; table for an existing value of the primary key (&lt;code&gt;order_id&lt;/code&gt;), order &lt;code&gt;1003&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1003&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-09 16:15:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;65&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The &lt;code&gt;total_amount&lt;/code&gt; value is now outside the predicate.
The output from the &lt;code&gt;SELECT&lt;/code&gt; is updated to retract this record.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WHERE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;70&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_changelogs_in_joins&#34;&gt;Changelogs in JOINs&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What about when we do a &lt;code&gt;JOIN&lt;/code&gt;?
This is where it gets interesting!
(&lt;code&gt;interesting&lt;/code&gt;, as in the curse, &amp;#34;&lt;em&gt;may you live in interesting times&lt;/em&gt;&amp;#34;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s join the &lt;code&gt;orders&lt;/code&gt; to the &lt;code&gt;customers&lt;/code&gt; to find out the name of the customer who placed the respective order.
Anyone with half a background in RDBMS will probably write a SQL query that looks something like this (&lt;em&gt;give or take some tabs/spaces, and capitalisation or otherwise of keywords…&lt;/em&gt;):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WHERE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1001&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is a &lt;code&gt;LEFT OUTER JOIN&lt;/code&gt;.
You’ll sometimes see it written as &lt;code&gt;LEFT JOIN&lt;/code&gt;; it means that it’ll always return the row on the &lt;strong&gt;left&lt;/strong&gt; (based on the order of the &lt;code&gt;ON&lt;/code&gt; predicate), and if there is a match the value on the right, and if not a &lt;code&gt;NULL&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
To learn more about the different types of &lt;code&gt;JOIN&lt;/code&gt; see &lt;a href=&#34;https://dataschool.com/how-to-teach-people-sql/left-right-join-animated/&#34;&gt;these&lt;/a&gt; &lt;a href=&#34;https://learnsql.com/blog/sql-joins-types-explained/#left-join&#34;&gt;articles&lt;/a&gt; (and &lt;a href=&#34;https://medium.com/data-science/can-we-stop-with-the-sql-joins-venn-diagrams-insanity-16791d9250c3&#34;&gt;learn why you shouldn’t use Venn diagrams&lt;/a&gt; to represent the different &lt;code&gt;JOIN&lt;/code&gt; types).
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What’s really cool with the changelog view is that we get an insight into &lt;em&gt;how&lt;/em&gt; the query gets run:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;(3)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The &lt;code&gt;orders&lt;/code&gt; row is first emitted with only the left side of the join; the &lt;code&gt;order_id&lt;/code&gt; and &lt;code&gt;total_amount&lt;/code&gt;, with no match for &lt;code&gt;customers&lt;/code&gt; so a &lt;code&gt;&amp;lt;NULL&amp;gt;&lt;/code&gt; in &lt;code&gt;name&lt;/code&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The &lt;code&gt;customers&lt;/code&gt; source catches up and is matched, so Flink retracts the &lt;code&gt;&amp;lt;NULL&amp;gt;&lt;/code&gt; with a &lt;code&gt;-D&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Flink restates the record with a &lt;code&gt;+I&lt;/code&gt; that includes the full record value this time&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_what_happens_if_you_update_the_customer_data&#34;&gt;What happens if you update the customer data?&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Out of interest, I added a couple of new records to the &lt;code&gt;customers&lt;/code&gt; table, using the same &lt;code&gt;customer_id&lt;/code&gt; and thus representing a logical update to the record.
Here’s what happened:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------------------------+--------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------------------------+--------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Fred&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flintstone&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;(3)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;First, the existing record is replaced with a &lt;code&gt;&amp;lt;NULL&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Then the &lt;code&gt;&amp;lt;NULL&amp;gt;&lt;/code&gt; is removed (with a &lt;code&gt;-D&lt;/code&gt;, compared to a &lt;code&gt;-U&lt;/code&gt; above)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The new value is written&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So each time the &lt;em&gt;customer&lt;/em&gt; data changes, the &lt;em&gt;order&lt;/em&gt; is re-emitted with the updated customer information.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This pattern continued for as long as I continued making changes to the relevant record on &lt;code&gt;customers&lt;/code&gt;, which got me to thinking: how long is Flink holding these values from each side of the join in order to emit an updated join result if one changes?&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_staying_regular&#34;&gt;Staying Regular&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The above join, a humble &lt;code&gt;LEFT OUTER JOIN&lt;/code&gt; (or &lt;code&gt;LEFT JOIN&lt;/code&gt; if you prefer brevity), is what’s known as a &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/sql/queries/joins/#regular-joins&#34;&gt;&lt;em&gt;regular join&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In Flink SQL regular joins have particular execution characteristics.
Per &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql/queries/joins/#regular-joins&#34;&gt;the docs&lt;/a&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;quoteblock&#34;&gt;
&lt;blockquote&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;it requires to keep both sides of the join input in Flink state forever.
Thus, &lt;strong&gt;the required state for computing the query result might grow infinitely&lt;/strong&gt; depending on the number of distinct input rows of all input tables and intermediate join results&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;💥 Here’s the batch-based SQL world meeting the streaming one!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In batch, we resolve the join once and once only, because we have a bounded set of data.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In the streaming world the data is unbounded and so we need to decide what to do if a join’s results are changed by the arrival of a new record on either side.
&lt;strong&gt;Using the standard SQL &lt;code&gt;JOIN&lt;/code&gt; syntax you get an updated result from the &lt;code&gt;JOIN&lt;/code&gt; any time a new row arrives that impacts the result.&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you’ve got big volumes of data coming through your pipeline, this might cause problems.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/now-your-state-will-explode.webp&#34; alt=&#34;You keep using regular joins. Now your state will explode.&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_the_yolo_approach_discarding_state_in_regular_joins&#34;&gt;The YOLO approach: discarding state in regular joins&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;One way to avoid this, &lt;em&gt;assuming you don’t want to get updated results&lt;/em&gt;, is to tell Flink to &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/config/#table-exec-state-ttl&#34;&gt;discard the state after a period of time&lt;/a&gt;.
You configure this by setting a &amp;#39;time to live&amp;#39; (TTL) for the state:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SET&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;table.exec.state.ttl&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5sec&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Any new &lt;code&gt;customers&lt;/code&gt; records arriving after this time &lt;em&gt;will not&lt;/em&gt; cause a new join result to be issued. New records on &lt;code&gt;orders&lt;/code&gt; will continue to be emitted as they arrive, joining to the latest result on &lt;code&gt;customers&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;However, this is a relatively crude—if effective—approach that can end up with different results each time you run it depending on when records arrive.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Imagine you have a pipeline in which a customer update arrives after the TTL has expired.
Flink will ignore it, per the configuration.
The order(s) it relates to therefore only be passed downstream with the &lt;em&gt;original&lt;/em&gt; customer details.
Now we re-run the pipeline, and since the customer update has already arrived, will be processed by Flink &lt;em&gt;within the 5 second TTL timeout&lt;/em&gt;, and now the same orders get joined to the &lt;em&gt;newer version of the customer data&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Perhaps this is what you want, or a tolerable compromise to make.
But it’s very important to be aware of it because you’re changing the data that’s being passed downstream.
Flink will do exactly what you tell it to, including sending &amp;#34;wrong&amp;#34; data if you tell it to.
Only you can decide if it’s &amp;#34;wrong&amp;#34; though, per the business requirements of the system.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In short, we’re relying on execution logic and the vagaries of when a record might arrive to implement what is business logic (&lt;em&gt;which version of customer data should we use to join to the order; should we wait for any changes to that data and if so for how long&lt;/em&gt;).
The rest of the business logic resides in the SQL; let’s see how we can do this for the join logic too.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_temporal_joins&#34;&gt;Temporal joins&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If we’re going to really adopt SQL in the streaming world we need to break free from the training wheels of regualar joins, and instead embrace &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/sql/queries/joins/#temporal-joins&#34;&gt;temporal joins&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/regular-vs-temporal-join.webp&#34; alt=&#34;Regular vs Temporal Joins&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;As the name suggests, a temporal join uses time as an element in evaluating the join.
This way we can encode in the SQL statement what logic we actually want to use in the join.
Combined with &lt;a href=&#34;https://rmoff.net/2025/04/25/its-time-we-talked-about-time-exploring-watermarks-and-more-in-flink-sql/&#34;&gt;watermarks&lt;/a&gt; Flink gives us a powerful way to express if, and for how long, we want to continue to wait for a match or update in the join result.
This avoids the exploding state problem, whilst also formalising the expected results from a query.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Temporal joins are enabled through Flink’s &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/concepts/versioned_tables/&#34;&gt;versioned tables&lt;/a&gt; feature.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the same query as above but with a temporal join.
Flink will use the event time (&lt;code&gt;order_date&lt;/code&gt;) and look at the state of &lt;code&gt;customers&lt;/code&gt; at that time to determine the value of the corresponding record (if there is one).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Ahoy there, temporal join!&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Before we can do it we need to update the definitions of the tables, otherwise we get:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;flink&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;api&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ValidationException&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Temporal&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;join&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;currently&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;only&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;supports&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;FOR SYSTEM_TIME AS OF&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;left&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;s time attribute field&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The &lt;code&gt;left table&lt;/code&gt; is &lt;code&gt;orders&lt;/code&gt;, which &lt;em&gt;does&lt;/em&gt; have &lt;code&gt;order_date&lt;/code&gt; but &lt;em&gt;not defined as a time attribute field&lt;/em&gt;.
This is what caught me out with watermarks the first time round too; &lt;a href=&#34;https://rmoff.net/2025/04/25/its-time-we-talked-about-time-exploring-watermarks-and-more-in-flink-sql/#_time_in_apache_flink&#34;&gt;read this bit here of my blog&lt;/a&gt; to understand more about &lt;strong&gt;time attribute fields&lt;/strong&gt; in Flink SQL if you need to.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ll add an &lt;em&gt;event time attribute&lt;/em&gt; to &lt;code&gt;orders&lt;/code&gt; using the &lt;code&gt;order_date&lt;/code&gt; field and a five second lag in the watermark strategy, to allow for out of order records to arrive within that time frame:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ADD&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`order_date`&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`order_date`&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SECONDS&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Having done that, we still get an error when we try the temporal join query again:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;flink&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;api&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ValidationException&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Event&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2&#34;&gt;Time&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Temporal&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Join&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;requires&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;both&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;primary&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;and&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;time&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;attribute&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;versioned&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;but&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;no&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;row&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;time&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;attribute&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;can&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;be&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;found&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In short, we’ve added a time attribute to &lt;code&gt;orders&lt;/code&gt; but not &lt;code&gt;customers&lt;/code&gt;, and if we’re joining based on time, we need one.
But whilst &lt;code&gt;orders&lt;/code&gt; has the obvious &lt;code&gt;order_date&lt;/code&gt; event time column, &lt;code&gt;customers&lt;/code&gt; doesn’t.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We could use a standard data modelling technique—which is good practice anyway—and have a &lt;code&gt;valid_from&lt;/code&gt; / &lt;code&gt;valid_to&lt;/code&gt; set of columns on the &lt;code&gt;customers&lt;/code&gt; table.
That way we can report on order data based on the customer value at the time of the order.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What we’re going to do here is simpler.
We’ll just take the timestamp of the Kafka records that &lt;code&gt;customers&lt;/code&gt; is built from and use that as the &lt;strong&gt;event time attribute&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ADD&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`record_time`&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;METADATA&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;timestamp&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;

&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ADD&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`record_time`&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`record_time`&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now when we run the query we get… nothing:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/query03.gif&#34; alt=&#34;query03&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Why?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/watermarks.webp&#34; alt=&#34;Wait&#34; width=&#34;it was watermarks? Always has been&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;Watermarks.&lt;/strong&gt;
&lt;em&gt;It’s always watermarks.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Looking at the Apache Flink dashboard we can see the &lt;code&gt;orders&lt;/code&gt; source is producing a watermark, whilst the &lt;code&gt;customers&lt;/code&gt; source isn’t.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/watermark01.webp&#34; alt=&#34;watermark01&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this case it’s our friend the &lt;a href=&#34;https://rmoff.net/2025/04/25/its-time-we-talked-about-time-exploring-watermarks-and-more-in-flink-sql/#_idle_partitions&#34;&gt;idle partition&lt;/a&gt;.
We can verify this by looking at the topic partitions in which the customer data resides.
Since Flink doesn’t store the data per se, but is just reading it from a Kafka topic, I’m going to create a second Flink table over the same &lt;code&gt;customers&lt;/code&gt; topic in order to examine the partitions, whilst leaving the current &lt;code&gt;customers&lt;/code&gt; unchanged:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_tmp&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;METADATA&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;partition&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #f8f8f2&#34;&gt;`record_time`&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;METADATA&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;timestamp&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`record_time`&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`record_time`&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENFORCED&lt;/span&gt;
            &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
                &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;customers&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;
            &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;

&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_tmp&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3456&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;9012&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Since there’s no record in partition 0, the &lt;code&gt;customers&lt;/code&gt; operator won’t generate a watermark.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But why does a lack of a watermark on &lt;code&gt;customers&lt;/code&gt; stop the join from working?
At this point we need to handle two separate paths of logic when mentally evaluating this &lt;code&gt;LEFT OUTER JOIN&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;Just as in an RDBMS batch world, what are the rows of data on the left of the join, and are there any matching to return as part of a &lt;code&gt;LEFT OUTER JOIN&lt;/code&gt;?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Since the processing is time-based, &lt;strong&gt;for what point in time does Flink consider each source to be complete&lt;/strong&gt;?&lt;/p&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is defined by the current watermark, and watermarks are generated by each source and allow for any records that may have arrived out of order (as defined by the watermark generation stategy).
In the case of &lt;code&gt;customers&lt;/code&gt; we’re not allowing for that (&lt;code&gt;WATERMARK FOR record_time AS record_time&lt;/code&gt;) and on &lt;code&gt;orders&lt;/code&gt; we are allowing a five second grace (&lt;code&gt;WATERMARK FOR order_date AS order_date - INTERVAL &amp;#39;5&amp;#39; SECONDS&lt;/code&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To determine the watermark for the join operator Flink will take the watermarks from the two source operators (&lt;code&gt;orders&lt;/code&gt; and &lt;code&gt;customers&lt;/code&gt;) and choose the earlier of the two.
If either is null, then the watermark for the join operator will also be null.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The watermark on the join operator defines the point in time at which Flink considers data to have arrived for both sides of the join, and thus ready to be emitted, based on the &lt;code&gt;LEFT OUTER JOIN&lt;/code&gt; conditions (per point (1) above).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;If the watermark is null (or earlier than the records in the tables being joined)&lt;/strong&gt;, then the join operator won’t emit records because Flink can’t be sure that there might not be out of order records still to arrive.&lt;/p&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this instance, Flink hasn’t got a watermark from the &lt;code&gt;customers&lt;/code&gt; source (because of the idle partition), and thus the join operator doesn’t have a watermark, meaning that it cannot emit any rows yet because logically it doesn’t know if there may be more to arrive before considering that point in time complete.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To fix this we’ll configure the &lt;code&gt;customers&lt;/code&gt; table to ignore partitions that are idle for longer than five seconds:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SET&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5 sec&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now when we re-run the same query, we get a watermark generated by the &lt;code&gt;customers&lt;/code&gt; operator:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/2025-05-15T10-19-25-773Z.webp&#34; alt=&#34;2025 05 15T10 19 25 773Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;BUT&lt;/strong&gt; we still don’t get any query results!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you look closely at the screenshot above you’ll see that the &lt;strong&gt;Records Sent&lt;/strong&gt; for each source operator is 3 (three orders, three customers), and the join operator has &lt;em&gt;received&lt;/em&gt; six records (2x3 = 6).
However, our query is still stubbornly stuck showing no results from the join:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/query03.gif&#34; alt=&#34;query03&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Why?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/old-man-yells-at-watermarks.webp&#34; alt=&#34;old man yells at watermarks&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;Watermarks&lt;/strong&gt;!! 🤪 😭&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/2025-05-15T10-25-03-925Z.webp&#34; alt=&#34;2025 05 15T10 25 03 925Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This time it’s not the absence of a watermark (as above), it’s the fact that the watermark on the join operator exists, &lt;em&gt;and is earlier than any of the records received&lt;/em&gt;.
Since the watermark is earlier, then Flink will not emit the records.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;A quick aside; why is the watermark &lt;code&gt;09/05/2025, 14:29:55&lt;/code&gt;?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s look at the operator watermarks in the Flink UI (I’ve overlaid the translation from epoch milliseconds to make it easier to follow):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/watermark03.webp&#34; alt=&#34;watermark03&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The downstream operator (in this case, the join operator) will take the &lt;em&gt;earliest of the upstream watermarks&lt;/em&gt;. The &lt;code&gt;orders&lt;/code&gt; watermark is thus used.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;From &lt;code&gt;customers&lt;/code&gt; we have a watermark that reflects when the records were written to Kafka, and is several days later than the &lt;code&gt;order_date&lt;/code&gt; on the &lt;code&gt;orders&lt;/code&gt; records.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;To understand why the &lt;code&gt;orders&lt;/code&gt; watermark is the value it is, let’s break it down.&lt;/p&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The watermark for &lt;code&gt;orders&lt;/code&gt; is based on the &lt;strong&gt;latest value&lt;/strong&gt; of the data in &lt;em&gt;each partition&lt;/em&gt;, and then the overall watermark is the &lt;strong&gt;earliest of those values&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The &lt;code&gt;orders&lt;/code&gt; topic happens to have three partitions, and it happens that each order record is a different partition.
I’ll do the same as I did above, and create a new table on top of the existing &lt;code&gt;orders&lt;/code&gt; topic to inspect the topic partition assignments:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_tmp&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;METADATA&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;partition&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;orders&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this query we can also calculate what we expect the watermark to be for each row (based on &lt;code&gt;order_date&lt;/code&gt; minus 5 seconds, per our watermark generation strategy declared on the &lt;code&gt;orders&lt;/code&gt; table):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SECONDS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;expected_watermark&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_tmp&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------------+-----------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;expected_watermark&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------------+-----------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;29&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;This is the earliest watermark, and it’s what we indeed see as the current watermark of the &lt;code&gt;orders&lt;/code&gt; operator in the Flink UI.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_fixing_the_stuck_watermark&#34;&gt;Fixing the stuck watermark&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To advance the watermark, we need to give Flink another record with an event time later than the current watermark.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1042&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-09 15:50:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But the watermark stays stuck and still no data. This is because my Kafka topic is partitioned, and whilst I’ve moved the watermark on for partition 0 (where the new order, &lt;code&gt;1042&lt;/code&gt;, happened to end up) the overall watermark for the &lt;code&gt;orders&lt;/code&gt; operator remains the same (&lt;code&gt;2025-05-09 14:29:55.000&lt;/code&gt;):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------------+-----------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;expected_watermark&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------------+-----------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1042&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;29&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;New record sets the watermark for partition 0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Existing record in partition 1 is still the lowest across the watermarks of the three partitions&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;At this point we &lt;em&gt;could&lt;/em&gt; keep firing records into the &lt;code&gt;orders&lt;/code&gt; table until we manage to tip each partition’s watermark forward. However, a more sensible approach would be to configure an idle timeout, since that’s what in effect is hitting here; partitions 1 and 2 are idle but Flink is still using their watermarks instead of ignoring them.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SET&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5 sec&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
If you’re running these queries in multiple windows, remember that the table definition is local to the session only, so you need to run the &lt;code&gt;ALTER&lt;/code&gt; on each session.
Guess how I discovered this ;)
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This itself doesn’t trigger any change in the query results (which are still running in a separate session), because there’s no new data to trigger the watermark generation. And when I run the query again…&lt;em&gt;still no results&lt;/em&gt;. Why? Because the idle timeout is based on the &lt;strong&gt;wallclock&lt;/strong&gt;. That means that when I re-ran the query the data was consumed from all three partitions, meaning that none of them are &amp;#34;idle&amp;#34; (because all provide data), and thus the watermark remains &amp;#39;stuck&amp;#39; as it was before.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But now that I’ve configured an idle timeout, and the query is still running, &lt;em&gt;this time&lt;/em&gt; when I add a new row, it should advance the watermark.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1043&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-09 15:51:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;✨ And now we get results from the join!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+-------------------------+--------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+-------------------------+--------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1042&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Over in the Flink UI we can see that the watermark has advanced&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/watermark04.webp&#34; alt=&#34;watermark04&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The watermark is now &lt;code&gt;09/05/2025, 15:50:55&lt;/code&gt;, which is generated from &lt;code&gt;order_date&lt;/code&gt; minus 5 seconds of the order &lt;code&gt;1043&lt;/code&gt; that we inserted.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Where is order &lt;code&gt;1003&lt;/code&gt;?
That has an &lt;code&gt;order_date&lt;/code&gt; of &lt;code&gt;2025-05-09 16:15:00.000&lt;/code&gt; which is &lt;em&gt;after&lt;/em&gt; the watermark and so won’t be emitted.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;title&#34;&gt;🙋 So I need to insert a new row each time to advance the watermark?&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Yes.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Idle timeouts, whether defined on the table, or as a global setting for the session (using &lt;code&gt;SET &amp;#39;table.exec.source.idle-timeout&amp;#39; = &amp;#39;5 sec&amp;#39;&lt;/code&gt;) only apply &lt;em&gt;at the point at which a watermark is generated&lt;/em&gt;.
And watermark generation in Flink SQL is only triggered by &lt;em&gt;the arrival of a new record from the source&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;No new record, no watermark generation.&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_back_to_the_join&#34;&gt;Back to the join&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To recap, we’ve run a temporal join:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and got some data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+-------------------------+--------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+-------------------------+--------------+----------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1042&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now the question is: why am I getting a &lt;code&gt;&amp;lt;NULL&amp;gt;&lt;/code&gt; in my join output?
Let’s look at order 1001 and just consider it on its own for now.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here are the respective records that in a regular ole&amp;#39; batch query would be a simple match.
On the left of the join, we have the &lt;code&gt;orders&lt;/code&gt; row:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;  &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WHERE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1001&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------------------------+--------------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------------------------+--------------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;On the right is &lt;code&gt;customers&lt;/code&gt;, which holds the following for &lt;code&gt;CUST-5678&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WHERE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------------------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------------------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Given that we’ve got a valid record for &lt;code&gt;CUST-5678&lt;/code&gt;, why does the &lt;code&gt;JOIN&lt;/code&gt; above emit a &lt;code&gt;&amp;lt;NULL&amp;gt;&lt;/code&gt;?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Looking at our join logic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;(3)&lt;/b&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;4&#34;&gt;&lt;/i&gt;&lt;b&gt;(4)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Do a left join from &lt;code&gt;orders&lt;/code&gt; to &lt;code&gt;customers&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Based on the state of &lt;code&gt;customers&lt;/code&gt; as it was at…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;…the value of &lt;code&gt;order_date&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;4&#34;&gt;&lt;/i&gt;&lt;b&gt;4&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Using the FK/PK relationship&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Perhaps we now see the problem.
On 9th May, &lt;strong&gt;there was no entry on &lt;code&gt;customers&lt;/code&gt; for &lt;code&gt;CUST_5678&lt;/code&gt;&lt;/strong&gt;.
The first entry for this customer is 15th May:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;record_time&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WHERE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------------------+--------------------------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;             &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;record_time&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------------------+--------------------------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;13&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;615&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So since there was in effect no entry for the join to match to, we get a &lt;code&gt;&amp;lt;NULL&amp;gt;&lt;/code&gt;, just as we would in an outer join if there was no match on &lt;code&gt;customer_id&lt;/code&gt; in a regular batch query.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s prove this out, by creating an order for this customer with an &lt;code&gt;order_date&lt;/code&gt; that &lt;em&gt;does&lt;/em&gt; fall within the times for which we have an entry.
Since we’ll be added an &lt;code&gt;orders&lt;/code&gt; record with a newer timestamp than any of the others we’ll need to advance the watermark too, so I’m going to add a second order to do this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1044&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-15 09:14:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
            &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;dummy&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;watermark yo&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-15 09:14:05&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The trouble is I was trying to be too clever, and Flink is more cleverer than me.
Here’s the &lt;code&gt;orders&lt;/code&gt; table now:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------------+-----------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;expected_watermark&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------------+-----------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1042&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1043&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;51&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;29&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1044&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;13&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;55&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dummy&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;(3)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Partition 0 will be idle, since nothing’s been read from it for more than five seconds&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Here’s our record that we’d like to see in the join output.
It’s setting the watermark for partition 1 to &lt;code&gt;2025-05-15 09:13:55.000&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;This was the clever idea that wasn’t.
It’s advanced the watermark but only for partition 2.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Flink takes the &lt;em&gt;earliest&lt;/em&gt; of the three watermarks across the partitions.
Partition 0 is idle; and of partitions 1 and 2 partition 1 has the earlier watermark.
Thus the overall watermark doesn’t advance 🤦&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What we need to do instead is insert our dummy record &lt;em&gt;long enough after the real record, so that its partition has fallen idle&lt;/em&gt;.
Long enough, say, since I’ve been typing this :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;me dummy&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;watermark yo, again&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-15 09:14:05&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;And there it is!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+-------------------------+--------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+-------------------------+--------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1042&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1043&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;51&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1044&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Yay🎉 The order we were expecting—and with a successful join to customers!&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_so_the_temporal_join_worked_what_now&#34;&gt;So the temporal join worked. What now?&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s see what happens if we add an order with a time &lt;em&gt;after&lt;/em&gt; the &lt;code&gt;customers&lt;/code&gt; watermark.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;As a reminder, here is the &lt;code&gt;customers&lt;/code&gt; data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;record_time&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_tmp&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------------------+-----------------+-------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;             &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;record_time&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-------------------------+-----------------+-------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;13&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;615&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;13&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;614&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3456&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Yelena&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Belova&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;13&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;615&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;9012&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Valentina&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Allegra&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;de&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Fontaine&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;&lt;code&gt;2025-05-15 09:13:46.615&lt;/code&gt; is the latest record time across the two (of three) populated partitions, so Flink will use the lowest of these (but they’re the same), making this time the watermark for &lt;code&gt;customers&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the &lt;code&gt;INSERT&lt;/code&gt;, using a time of &lt;code&gt;2025-05-16 10:43:00.000&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1045&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-9012&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-16 10:43:00.000&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;23&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;(plus a second &lt;code&gt;INSERT&lt;/code&gt; more than five seconds later for a dummy record to advance the watermark)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Removing the earlier records, plus the &lt;code&gt;dummy&lt;/code&gt; ones, we’ve now got these results:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+-------------------------+--------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+-------------------------+--------------+--------------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1044&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1045&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;43&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;23&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Valentina&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Allegra&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;de&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Fontaine&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Different customer name is the match for &lt;code&gt;CUST-9012&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is good, but the bit that &lt;em&gt;doesn’t&lt;/em&gt; make sense to me though is this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/watermark05.webp&#34; alt=&#34;watermark05&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If the watermark on the join operator is &lt;code&gt;2025-05-15 09:13:46&lt;/code&gt;, how is an order record with timestamp &lt;code&gt;2025-05-16 10:43:00&lt;/code&gt; able to be emitted?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;My &lt;em&gt;guess&lt;/em&gt; here is that the Flink UI is misleading.
My &lt;em&gt;guess&lt;/em&gt; is that even though the &lt;code&gt;customers&lt;/code&gt; watermark is earlier than the &lt;code&gt;orders&lt;/code&gt; one and thus would normally be used by the join operator, it’s actually marking the &lt;code&gt;customers&lt;/code&gt; source as idle (since we did configure &lt;code&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;=&amp;#39;5 sec&amp;#39;&lt;/code&gt; on it), and thus uses the &lt;code&gt;orders&lt;/code&gt; watermark.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The Flink UI renders data from Flink’s &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/ops/metrics/&#34;&gt;metrics&lt;/a&gt;, amongst which we find that there are &lt;em&gt;MOAR&lt;/em&gt; watermark metrics than the Flink UI is necessarily showing us.
You can access watermarks directly using the &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/ops/metrics/#rest-api-integration&#34;&gt;REST API&lt;/a&gt;, or by adding them through the &lt;strong&gt;Metrics&lt;/strong&gt; tab in the Flink UI once you’ve selected an operator.
When we do this, things start to make more sense; the &lt;code&gt;orders&lt;/code&gt; watermark is indeed the one we see as the &lt;code&gt;currentOutputWatermark&lt;/code&gt; of the join operator:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/watermark06.webp&#34; alt=&#34;watermark06&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Am I simply fitting what I can find in the UI to match what I’m observing in the query output?
Heck yeah!
Can you tell me where I’m wrong?
I’d love to be corrected :)&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_avoiding_nulls_in_temporal_joins_to_reference_data&#34;&gt;Avoiding NULLs in Temporal joins to reference data&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s claw our way back up into daylight, and look at fixing the problem we saw above: NULLs in the join results caused by the fact (order) having an event time newer than the reference (customer).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In the very verbose example above, I used the &lt;em&gt;event time attribute&lt;/em&gt; of &lt;code&gt;order_date&lt;/code&gt; when joining &lt;code&gt;orders&lt;/code&gt; to &lt;code&gt;customers&lt;/code&gt;, using this to lookup matches on &lt;code&gt;customers&lt;/code&gt; &lt;em&gt;as the state of the table was at that time&lt;/em&gt;.
The time on &lt;code&gt;customers&lt;/code&gt; I defined as &lt;code&gt;record_time&lt;/code&gt;, which came from the Kafka record timestamp.
Kafka record timestamps &lt;em&gt;can&lt;/em&gt; be set by the producer to be an event time, but they are often just the time at which the broker wrote the message to disk.
If that’s the case, then the timestamp for the reference data is going to bear no relation to the fact data for which its related.
It could have been written a year or a second ago.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We saw that where &lt;code&gt;order_date&lt;/code&gt; &amp;gt; &lt;code&gt;record_time&lt;/code&gt; for a matching record, a &lt;code&gt;NULL&lt;/code&gt; was returned, because in effect this record didn’t exist at the time of the order.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What if we want to tell Flink &lt;em&gt;just join to the record on &lt;code&gt;customers&lt;/code&gt;, I don’t care when it was created&lt;/em&gt;?
In other words, take the state of &lt;code&gt;customers&lt;/code&gt; as you find it, and join if you can.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We could use a &lt;em&gt;regular join&lt;/em&gt; like we saw originally, but this has the issue of growing state and re-emitting orders if new data is received for the customer.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Instead, we’ll still use a temporal join, but fudge things a little.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;epoch_ts&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;TO_TIMESTAMP&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;FROM_UNIXTIME&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)),&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;epoch_ts&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;epoch_ts&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;         &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;customers&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5 sec&amp;#39;&lt;/span&gt;     &lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;(3)&lt;/b&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Create a timestamp column hardcoded with the value of the UNIX epoch (&lt;code&gt;Jan 01 1970 00:00:00 GMT&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Set this as the event time attribute for the table, and use it as the watermark generation strategy&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Set a watermark idle timeout, as before&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The &lt;code&gt;orders&lt;/code&gt; configuration stays exactly as before:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`order_date`&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`order_date`&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SECONDS&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;  &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;orders&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5 sec&amp;#39;&lt;/span&gt;                               &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Set &lt;code&gt;order_date&lt;/code&gt; as the event time attribute, and define a watermark generation strategy&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Define idle timeout for the watermark&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now when we run our join, any matching records for the join (&lt;code&gt;orders.customer_id = customers.customer_id&lt;/code&gt;) will never fail on the state of &lt;code&gt;customers&lt;/code&gt; at the time of &lt;code&gt;order_date&lt;/code&gt; not having the row—not unless &lt;code&gt;orders&lt;/code&gt; come in before 1970, anyway :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Testing this out using the same process as above, we get a nice match on the orders, as we’d hoped.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;epoch_ts&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+-------------------------+--------------+--------------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;epoch_ts&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+-------------------------+--------------+--------------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1042&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1970&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1970&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1970&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Valentina&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Allegra&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;de&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Fontaine&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;1970&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_implementing_slowly_changing_dimension_scd_type_2_with_temporal_joins&#34;&gt;Implementing Slowly Changing Dimension (SCD) type 2 with Temporal Joins&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When we joined to the &lt;code&gt;customers&lt;/code&gt; table using the epoch as event time attribute, it meant that Flink would end up using the latest value of the record for a given customer.
This is a &lt;a href=&#34;https://www.kimballgroup.com/data-warehouse-business-intelligence-resources/kimball-techniques/dimensional-modeling-techniques/type-1/&#34;&gt;SCD type 1&lt;/a&gt; approach.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://www.kimballgroup.com/data-warehouse-business-intelligence-resources/kimball-techniques/dimensional-modeling-techniques/type-2/&#34;&gt;SCD type 2&lt;/a&gt; is where we join the fact to the dimension based on &lt;em&gt;&lt;a href=&#34;https://www.ssp.sh/brain/slowly-changing-dimension-type-2&#34;&gt;the state of the dimension at the time of the fact&lt;/a&gt;&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Consider a customer who moves house, and we want to report on sales by customer location.
If we use SCD type 1 we’ll find out sales based on &lt;strong&gt;where customers live now&lt;/strong&gt;.
Contrast this to SCD type 2; that tells us sales based on &lt;strong&gt;where the customer lived at the time of the sale&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;As with so much of SQL logic, there is not a &amp;#34;right&amp;#34; or &amp;#34;wrong&amp;#34;, only a business requirement for particular logic.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To implement SCD type 2 you’ll need a field on the dimension table that holds the date from which the record is valid.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s redefine our customers table thus:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;                        &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;         &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;customers&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5 sec&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;This is the field for the SCD type 2 logic&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;We need to set &lt;code&gt;valid_from&lt;/code&gt; as the event time attribute for the table, and define a watermark generation strategy for it.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;and add some data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-3456&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Yelena Belova&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;New York&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-01-01 00:00:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Bucky Barnes&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Brooklyn&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-01-02 00:00:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;  &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-9012&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Valentina Allegra de Fontaine&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Moscow&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-01-01 00:00:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Bucky Barnes&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;Bucharest&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-10 00:00:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Bucky starts off in Brooklyn&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Bucky is now in Bucharest&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Which gives us this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------+--------------------------------+------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------+--------------------------------+------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;(3)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3456&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;                  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Yelena&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Belova&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;New&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;York&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;9012&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Valentina&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Allegra&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;de&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Fontaine&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Moscow&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Original record for &lt;code&gt;CUST-5678&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;New record comes in so existing one is negated (&lt;code&gt;-U&lt;/code&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;New record for &lt;code&gt;CUST-5678&lt;/code&gt; is inserted&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we’ll set up the orders, using the same table definition as above.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`order_date`&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;`order_date`&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SECONDS&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;orders&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;5 sec&amp;#39;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The orders data is slightly different, to include a second order for &lt;code&gt;CUST-5678&lt;/code&gt; at a later date:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INSERT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;INTO&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;VALUES&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1001&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-09 14:30:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1002&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-3456&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-09 15:45:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1003&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-09 16:15:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1004&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;CUST-5678&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2&#34;&gt;TIMESTAMP&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;2025-05-14 11:02:00&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This looks like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3456&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Expected &lt;code&gt;city&lt;/code&gt; value in the join is &lt;code&gt;Brooklyn&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Expected &lt;code&gt;city&lt;/code&gt; value in the join is &lt;code&gt;Bucharest&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s run the join:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;After adding a new row to &lt;code&gt;orders&lt;/code&gt; to advance the watermark, we get succesful join results!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+---------------------+--------------+---------------+------------+---------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+----------+---------------------+--------------+---------------+------------+---------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Yelena&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Belova&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Moscow&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Bucky was in &lt;code&gt;Brooklyn&lt;/code&gt; for the two orders (&lt;code&gt;1001&lt;/code&gt;, &lt;code&gt;1003&lt;/code&gt;) placed on 2025-05-09&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Bucky then moved to &lt;code&gt;Bucharest&lt;/code&gt; on 2025-05-10, meaning that the order &lt;code&gt;1004&lt;/code&gt; on 2025-05-14 correctly shows his city &lt;em&gt;at the time of the order&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_temporal_joins_tldr&#34;&gt;Temporal joins? tl;dr!&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s wrap this section up before we get back to the original subject at hand: changelogs.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;For a temporal join to work you need to:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Understand &lt;a href=&#34;https://rmoff.net/2025/04/25/its-time-we-talked-about-time-exploring-watermarks-and-more-in-flink-sql/&#34;&gt;watermarks&lt;/a&gt;!&lt;/p&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Define idle partition/source timeouts as needed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Understand that records won’t be emitted if the watermark hasn’t advanced past the record timestamp.&lt;/p&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Have an &lt;a href=&#34;https://rmoff.net/2025/04/25/its-time-we-talked-about-time-exploring-watermarks-and-more-in-flink-sql/#_time_in_kafka_in_flink&#34;&gt;event time attribute&lt;/a&gt; on both tables.&lt;/p&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Remember that the time attribute defines the logic of the join; don’t just stick a column on assuming it can be anything.
The example above of &lt;code&gt;record_time&lt;/code&gt; vs &lt;code&gt;epoch_ts&lt;/code&gt; demonstrates the impact that it can have.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;On the left of the join, the time attribute is used to lookup the state of the right-hand table as of that time&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;On the right of the join, the time attribute defines the time on the table to consider for this state&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Use the &lt;code&gt;JOIN…FOR SYSTEM_TIME AS OF&lt;/code&gt; syntax to declare it as a temporal join:&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;                             &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;                            &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;                     &lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;(3)&lt;/b&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;                           &lt;i class=&#34;conum&#34; data-value=&#34;4&#34;&gt;&lt;/i&gt;&lt;b&gt;(4)&lt;/b&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt;           &lt;i class=&#34;conum&#34; data-value=&#34;5&#34;&gt;&lt;/i&gt;&lt;b&gt;(5)&lt;/b&gt;
        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;                    &lt;i class=&#34;conum&#34; data-value=&#34;6&#34;&gt;&lt;/i&gt;&lt;b&gt;(6)&lt;/b&gt;
        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;                            &lt;i class=&#34;conum&#34; data-value=&#34;7&#34;&gt;&lt;/i&gt;&lt;b&gt;(7)&lt;/b&gt;
    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;    &lt;i class=&#34;conum&#34; data-value=&#34;8&#34;&gt;&lt;/i&gt;&lt;b&gt;(8)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Left-hand table&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Optional alias for left-hand table&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;3&#34;&gt;&lt;/i&gt;&lt;b&gt;3&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Type of join&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;4&#34;&gt;&lt;/i&gt;&lt;b&gt;4&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Right-hand table&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;5&#34;&gt;&lt;/i&gt;&lt;b&gt;5&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Join to the state of the right-hand table as of a given time&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;6&#34;&gt;&lt;/i&gt;&lt;b&gt;6&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Event time attribute of left-hand table to use in the temporal join&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;7&#34;&gt;&lt;/i&gt;&lt;b&gt;7&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Optional alias for right-hand table&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;8&#34;&gt;&lt;/i&gt;&lt;b&gt;8&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Join predicate condition (typically foreign key/primary key relationship)
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can read &lt;code&gt;FOR SYSTEM_TIME&lt;/code&gt; as meaning &amp;#34;for the state of the right-hand table as defined by its event time attribute column&amp;#34;&lt;/p&gt;
&lt;/div&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_joins_and_changelogs&#34;&gt;Joins and Changelogs&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I started off writing about changelogs, and then got somewhat waylaid into regular and temporal joins.
Let’s see how these two different types of join reflect themselves in a changelog.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;First though, a note about the Kafka connector.
There are two Kafka connectors in Flink:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/connectors/table/kafka/&#34;&gt;Kafka&lt;/a&gt; (&lt;code&gt;&amp;#39;connector&amp;#39;=&amp;#39;kafka&amp;#39;&lt;/code&gt;)&lt;/p&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The &lt;strong&gt;Kafka&lt;/strong&gt; connector does not support primary keys and is for reading and writing append-only data.
When reading data from a table using the Kafka connector you’ll only get &lt;code&gt;+I&lt;/code&gt; changelog operations.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/connectors/table/upsert-kafka/&#34;&gt;Upsert Kafka&lt;/a&gt; (&lt;code&gt;&amp;#39;connector&amp;#39;=&amp;#39;upsert-kafka&amp;#39;&lt;/code&gt;)&lt;/p&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The &lt;strong&gt;Kafka Upsert&lt;/strong&gt; connector supports primary keys and interprets messages on a Kafka topic for the same key as updates to that key.
As a result you’ll see an update changelog from this connector (&lt;code&gt;+I&lt;/code&gt;, &lt;code&gt;-D&lt;/code&gt;, &lt;code&gt;-U&lt;/code&gt;, &lt;code&gt;+U&lt;/code&gt;).&lt;/p&gt;
&lt;div class=&#34;exampleblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;div class=&#34;quoteblock&#34;&gt;
&lt;blockquote&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The open source &lt;code&gt;upsert-kafka&lt;/code&gt; connector produces an upsert stream, and it only contains events of types &lt;code&gt;+U&lt;/code&gt; and &lt;code&gt;-D&lt;/code&gt;.
The reason why are you seeing the full set of types when you do &lt;code&gt;SELECT * FROM customers_upsert&lt;/code&gt; is that changelog normalization has been applied to the upsert stream, converting it to a retract stream.
Currently, Flink SQL always applies changelog normalization to upsert sources.
This will change in Flink 2.1, thanks to &lt;a href=&#34;https://cwiki.apache.org/confluence/display/FLINK/FLIP-510%3A+Drop+ChangelogNormalize+for+operations+which+don%27t+need+it&#34;&gt;FLIP-510&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;—David Anderson&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Both connectors can read from a Kafka topic.
The difference between them is primarily the semantic interpretation of the records.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s an example of &lt;code&gt;kafka&lt;/code&gt; [&lt;em&gt;append&lt;/em&gt;] vs &lt;code&gt;upsert-kafka&lt;/code&gt; [&lt;em&gt;upsert&lt;/em&gt;], reading from the same Kafka topic.
On the topic there are two orders, one of which—&lt;code&gt;1001&lt;/code&gt;— has an update made to it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;First off, the state that Flink builds (viewed using the &lt;code&gt;table&lt;/code&gt; SQL client output mode).
The &lt;code&gt;upsert-kafka&lt;/code&gt; connector pushes the update through into the state:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_upsert&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;

   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The order has been updated to hold the latest &lt;code&gt;total_amount&lt;/code&gt; value&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Whilst the append connector just adds the update as another record:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_append&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;

   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The order first has the &lt;code&gt;total_amount&lt;/code&gt; value of 199.99&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The same order has a second entry when the value is 49.99&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now the changelog for each:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_upsert&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;First instance of the order&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Order is updated&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Compare this to the append changelog from the &lt;code&gt;kafka&lt;/code&gt; connector:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_append&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s look at the &lt;code&gt;customers&lt;/code&gt; data.
I’ve stripped it down to just one record, which has an update on &lt;code&gt;city&lt;/code&gt; and &lt;code&gt;valid_from&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_upsert&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;

    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_append&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;

    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the changelog for the two versions of the table too, following the same patterns as above—only &lt;code&gt;+I&lt;/code&gt; for append, vs &lt;code&gt;+I&lt;/code&gt;, &lt;code&gt;-U&lt;/code&gt;, &lt;code&gt;+U&lt;/code&gt; for upsert:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_upsert&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------+---------------+------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------+---------------+------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_append&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------+---------------+------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+--------------+---------------+------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now, what happens when we join these differenct versions of the tables?
Bear in mind, there are two different joins we’re looking at—regular, and temporal.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
In the following sections, I’m not showing the impact of watermarks, and am adding records when I need to advance the watermark in order to have the relevant rows output.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_temporal_join_append_to_append&#34;&gt;Temporal join: append to append&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Nope, not happening!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_append&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_append&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ERROR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Could&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;execute&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Reason&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;flink&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;api&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ValidationException&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Temporal&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Join&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;requires&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;primary&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;versioned&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;but&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;no&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;primary&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;can&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;be&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;found&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;The&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;physical&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;plan&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;is&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;FlinkLogicalJoin&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;condition&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AND&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;__INITIAL_TEMPORAL_JOIN_CONDITION&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;7&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;__TEMPORAL_JOIN_LEFT_KEY&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;__TEMPORAL_JOIN_RIGHT_KEY&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;4&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)))],&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;joinType&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;left&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;])&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;FlinkLogicalTableSourceScan&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;default_catalog&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;default_database&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_append&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;watermark&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;5000&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SECOND&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)],&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;idletimeout&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5000&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;],&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;watermarkEmitStrategy&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;on&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;periodic&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]]],&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;fields&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;])&lt;/span&gt;
  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;FlinkLogicalSnapshot&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;period&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #960050;background-color: #1e0010&#34;&gt;$&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;cor0&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;])&lt;/span&gt;
    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;FlinkLogicalTableSourceScan&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;default_catalog&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;default_database&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_append&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;watermark&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;],&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;idletimeout&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5000&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;],&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;watermarkEmitStrategy&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;on&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;periodic&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]]],&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;fields&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;valid_from&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;])&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this error:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Temporal&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Join&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;requires&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;primary&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;versioned&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;but&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;no&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;primary&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;can&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;be&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;found&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;the &lt;code&gt;versioned table&lt;/code&gt; is the right-hand table, i.e. &lt;code&gt;customers&lt;/code&gt;, and because it’s an append table it doesn’t have a PK.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So let’s try joining to the upsert version:&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_temporal_join_append_to_upsert&#34;&gt;Temporal join: append to upsert&lt;/h3&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_append&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_upsert&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;From this we can see that the output is also an append log.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_temporal_join_upsert_to_upsert&#34;&gt;Temporal join: upsert to upsert&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is what we were doing in the article above, and gives us this output where the changed record with a new &lt;code&gt;total_amount&lt;/code&gt; for order &lt;code&gt;1001&lt;/code&gt; is re-emitted (&lt;code&gt;-U&lt;/code&gt; → &lt;code&gt;+I&lt;/code&gt;).
Note also that the &lt;code&gt;city&lt;/code&gt; is correct based on the time of the order.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_upsert&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_upsert&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_temporal_join_upsert_to_append&#34;&gt;Temporal join: upsert to append&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;We know we can’t do this because it’s a version of what we tried above.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_upsert&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_append&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ERROR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;]&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Could&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;not&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;execute&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;statement&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Reason&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;
&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;org&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;apache&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;flink&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;api&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;ValidationException&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Temporal&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Join&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;requires&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;primary&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;versioned&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;but&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;no&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;primary&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;can&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;be&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;found&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_regular_join_append_to_append&#34;&gt;Regular join: append to append&lt;/h3&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_append&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_append&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You’ll notice here the use of &lt;code&gt;-D&lt;/code&gt; rather than &lt;code&gt;-U&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The nett result is almost certainly what you would not want; a cartesian of every order update with every customer update:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;

   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;I’ve manually sorted the orders to make it easier to understand the results&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_regular_join_append_to_upsert&#34;&gt;Regular join: append to upsert&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This one has an even more noisy changelog:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_append&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_upsert&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;However the nett state is more useful than the dumb cartesian in the previous section.
It shows each order entry but updated for the &lt;em&gt;current customers value&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;                &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;

   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_regular_join_upsert_to_upsert&#34;&gt;Regular join: upsert to upsert&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This one behaved a bit odd when I ran it; I saw a different changelog depending on whether I included a predicate on one order:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_upsert&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_upsert&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+----------------+-------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+----------------+-------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dummy&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This gives the &amp;#34;correct&amp;#34; view of the data from each side of the join if you want to see the current value for both order and customer reflected in the state:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;                &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;

   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_regular_join_upsert_to_append&#34;&gt;Regular join: upsert to append&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You might be able guess this one now; it’s going to be the latest version of the order, with a new instance of it added for each customer change:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders_upsert&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers_append&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;             &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;         &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dummy&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;                &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Query&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Result&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;Table&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;

   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt;
      &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;dummy&lt;/span&gt;         &lt;span style=&#34;color: #ae81ff&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;         &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt;
       &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;49&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_joins_and_changelogssummary&#34;&gt;Joins and Changelogs—Summary&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Above I showed just what happens with different invocations of a &lt;code&gt;LEFT OUTER JOIN&lt;/code&gt;.
Here’s what I observed for all the different permutations of join types and input changelog types:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/05/flink-joins.webp&#34; alt=&#34;flink joins&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
For a full set of test statements with which you can experiment yourself, see &lt;a href=&#34;https://github.com/rmoff/flink-examples/tree/main/flink-kafka/data/queries&#34;&gt;the GitHub repo&lt;/a&gt;.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;If you want an an &lt;em&gt;append log&lt;/em&gt; from your join&lt;/strong&gt; there are four options:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A &lt;strong&gt;regular&lt;/strong&gt; append-append &lt;strong&gt;INNER&lt;/strong&gt; or &lt;strong&gt;RIGHT OUTER&lt;/strong&gt; JOIN&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A &lt;strong&gt;temporal&lt;/strong&gt; append-upsert &lt;strong&gt;INNER&lt;/strong&gt; or &lt;strong&gt;LEFT OUTER&lt;/strong&gt; JOIN&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_what_if_you_need_an_append_log_but_want_a_different_join_type_a_k_a_how_do_you_convert_an_upsert_log_to_an_append_log&#34;&gt;What if you &lt;em&gt;need&lt;/em&gt; an append log, but want a different join type? (a.k.a. how do you convert an upsert log to an append log)&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Per the above table, you only have a few permutations that will give you an append log.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here we’re going to take two &lt;strong&gt;upsert&lt;/strong&gt; tables to which we want to apply a &lt;code&gt;LEFT OUTER JOIN&lt;/code&gt;.
Done as a regular join, or keeping both tables as upsert, will result in an upsert changelog:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
                &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
                &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;WHERE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1001&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+---------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;D&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ll change two things in this join:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Make it temporal (so that Flink doesn’t hold state for the left table and issue updates when the right-hand table changes)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Convert the left-hand table into an append changelog&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To convert the left-hand table to an append log we’ll use a &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql/queries/window-tvf/#tumble&#34;&gt;tumbling window function&lt;/a&gt; with a &lt;code&gt;GROUP BY&lt;/code&gt;.
In effect, this introduces a buffer: instead of an upsert changelog for every single state change, the state is buffered within Flink.
Flink then outputs the state as it exists as defined by the window size.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Because it is only emitting it at this final point of the window (and because the watermark will have advanced past the end of the window), it knows that logically the data can’t change, and thus it’s an &lt;em&gt;append log&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;DATA&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;               &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
                        &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;TIMECOL&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;  &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SIZE&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;MINUTES&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;       &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;GROUP&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;  &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;    &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;30&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;3456&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;09&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;16&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;I’ve included the parameter names here just to aid comprehension; it’s also valid to write it like this:
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
       &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;MINUTES&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;The &lt;code&gt;GROUP BY&lt;/code&gt; on the window start/end is what forces Flink to emit an append changelog once and only once the window is closed&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we’ll join this to the existing upsert table (&lt;code&gt;customers&lt;/code&gt;):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt;
            &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FROM&lt;/span&gt;    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;
                                    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;DATA&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;TIMECOL&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;),&lt;/span&gt;
                                    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SIZE&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;MINUTES&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;GROUP&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;,&lt;/span&gt;
                                &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;
                    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;LEFT&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OUTER&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;JOIN&lt;/span&gt;
                    &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customers&lt;/span&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;SYSTEM_TIME&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;OF&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt;
                        &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;
                    &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;ON&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;o&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;c&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+----------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;city&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+--------------+----------------+------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1001&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;199&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;99&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;(1)&lt;/b&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1002&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;color: #ae81ff&#34;&gt;349&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;50&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Yelena&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Belova&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;New&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;York&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1003&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;75&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Brooklyn&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucky&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Barnes&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Bucharest&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;(2)&lt;/b&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;colist arabic&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;1&#34;&gt;&lt;/i&gt;&lt;b&gt;1&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;Note the customer’s &lt;code&gt;city&lt;/code&gt; is as of the time of &lt;code&gt;order_date&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;i class=&#34;conum&#34; data-value=&#34;2&#34;&gt;&lt;/i&gt;&lt;b&gt;2&lt;/b&gt;&lt;/td&gt;
&lt;td&gt;This shows the &lt;em&gt;latest state&lt;/em&gt; of the order &lt;code&gt;1004&lt;/code&gt;, it having gone through several updates on the source:
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;select&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;from&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;orders&lt;/span&gt; &lt;span style=&#34;color: #66d9ef;font-weight: bold&#34;&gt;where&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #e6db74&#34;&gt;&amp;#39;1004&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+-------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;order_date&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #75715e;font-style: italic&#34;&gt;----+-----------+-------------+-------------------------+--------------+&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;42&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;02&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;U&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;color: #ae81ff&#34;&gt;1004&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;CUST&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;5678&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;05&lt;/span&gt;&lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;color: #ae81ff&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #ae81ff&#34;&gt;47&lt;/span&gt;&lt;span style=&#34;color: #f8f8f2;background-color: #49483e&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #ae81ff&#34;&gt;00&lt;/span&gt; &lt;span style=&#34;color: #f92672;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_references&#34;&gt;References&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/concepts/overview/&#34;&gt;Streaming Concepts—State Management&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/concepts/dynamic_tables/&#34;&gt;Dynamic Tables&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/concepts/determinism/&#34;&gt;Determinism In Continuous Queries&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-release-2.0/docs/dev/table/concepts/versioned_tables/&#34;&gt;Versioned Tables&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    <item>
      <title>🏃🚶 The unofficial Current London 2025 Run/Walk 🏃🚶</title>
      <link>https://rmoff.net/2025/05/02/the-unofficial-current-london-2025-run/walk/</link>
      <pubDate>2025-05-02</pubDate>
      
      <guid>https://rmoff.net/2025/05/02/the-unofficial-current-london-2025-run/walk/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/05/t_IMG_4313.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;Another year, another Current—another 5k run/walk for anyone who’d like to join!&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is a tradition that started back at Kafka Summit San Francisco in 2019 &lt;a href=&#34;https://twitter.com/rmoff/status/1179047181891883008&#34;&gt;over the Golden Gate Bridge&lt;/a&gt; and has continued since then.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
London’s Docklands offer up what would charitably be described as not the most…picturesque of routes—but with a group of similar minded people, what could be a better way to start day 1 of Current 2025 London than a 5k run or walk :) Plus, it’s flat! 🙌
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_who_what_where_when&#34;&gt;Who? What? Where? When?&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;Who&lt;/em&gt;:  Anyone who would like to is very welcome :)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;What&lt;/em&gt;: A 5k (3.1 miles) run or walk&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;Where&lt;/em&gt;: Starting from the Aloft Hotel (next to the ExCeL centre), heading clockwise around the quayside at ExCeL, and taking in some of the Parkrun route.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;em&gt;When&lt;/em&gt;: &lt;strong&gt;Tuesday 20th May at 07:00 BST&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ll &lt;strong&gt;meet at 07:00&lt;/strong&gt; in the carpark in front of the hotel. That’ll give us time to congregate and take some &lt;a href=&#34;https://twitter.com/search?q=%23streamingselfie%20%23kafkasummit%20until%3A2020-03-01&amp;amp;src=typed_query&amp;amp;f=live&#34;&gt;&lt;code&gt;#streamingselfie&lt;/code&gt;&lt;/a&gt;s if you want them, before setting off at 07:05 sharp to make our way around the &lt;a href=&#34;https://www.strava.com/clubs/1039355/group_events/2028172&#34;&gt;the 5k route&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;strava-embed-placeholder&#34; data-embed-type=&#34;route&#34; data-embed-id=&#34;3353393981409439428&#34; data-full-width=&#34;true&#34; data-style=&#34;standard&#34; data-terrain=&#34;2d&#34; data-map-hash=&#34;13.68/51.50617/0.02838&#34; data-club-id=&#34;1039355&#34; data-from-embed=&#34;true&#34;&gt;&lt;/div&gt;&lt;script src=&#34;https://strava-embeds.com/embed.js&#34;&gt;&lt;/script&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Go at your own pace; this isn’t a race. You can run, or walk. Or skip, if you prefer. You can &lt;a href=&#34;https://rmoff.net/files/current-london-2025-5k.gpx&#34;&gt;download the route&lt;/a&gt; to follow at your leisure. In fact, it’s a good idea to do so because this is not an organised event, so it’s your responsibility not to get lost :-D&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you Strava, feel free to join the &lt;a href=&#34;https://www.strava.com/clubs/1039355&#34;&gt;Strava Club&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_cool_where_do_i_register&#34;&gt;Cool, where do I register?&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Register at &lt;code&gt;/dev/null&lt;/code&gt; ;-)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is an entirely unofficial, barely-organised, thing. Turn up and run, if you want. Don’t, if you don’t. Fully intend to but sleep in from the jetlag and miss it, that’s completely fine 😁&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    <item>
      <title>It&#39;s Time We Talked About Time: Exploring Watermarks (And More) In Flink SQL</title>
      <link>https://rmoff.net/2025/04/25/its-time-we-talked-about-time-exploring-watermarks-and-more-in-flink-sql/</link>
      <pubDate>2025-04-25</pubDate>
      
      <guid>https://rmoff.net/2025/04/25/its-time-we-talked-about-time-exploring-watermarks-and-more-in-flink-sql/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/04/t_IMG_8625.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Whether you’re processing data in batch or as a stream, the concept of time is an important part of accurate processing logic.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Because we process data after it happens, there are a minimum of two different types of time to consider:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;When it happened&lt;/strong&gt;, known as &lt;strong&gt;Event Time&lt;/strong&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;When we process it&lt;/strong&gt;, known as &lt;strong&gt;Processing Time&lt;/strong&gt; (or &lt;em&gt;system time&lt;/em&gt; or &lt;em&gt;wall clock time&lt;/em&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In the days of yore, event time could be different from processing time by many hours.
At 9am a supermarket opens and I buy a tin of baked beans.
At 6pm the store closes, the end-of-day runs on the in-store PoS, and sends the data back to head office.
Perhaps at 10pm all the data from all the stores has been received and processing starts.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In the modern age, many platforms will be much lower latency.
PoS systems would be sending information about my tin of baked beans purchase back to a central system (probably using Apache Kafka…) as soon as it happened.
But even then, times can differ.
There’s the natural latency on which the speed of light has a strong opinion, on top of which is any other processing or batching that might be introduced along the way.
Then there are power outages and network blips and gremlins that can mean records can be significantly delayed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Then there’s a whole category of data that wasn’t a significant thing in the past—data that’s generated from mobile devices.
Even with improving cellular coverage and in-flight wifi, data can still be delayed by minutes or hours.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So that’s event time and processing time. But there are other types of time too:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;The time the record was written in the system&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The time a record was first created&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The time a record was last updated&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Arbitrary time fields on a record, such as an order record with times that the order was place, fulfilled, and shipped&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’ll come back to these in detail later.
For now, just keep in mind that there is no single &amp;#34;correct&amp;#34; time to use.
It depends on what your processing is supposed to be doing.
If you are trying to calculate how many orders were shipped in the last hour, then using the time that the order was created or that it landed in the processing system would give you &lt;em&gt;an&lt;/em&gt; answer—it would just be the wrong one.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this article I’m going to look at how we deal with time when it comes to using it in event-based systems such as Kafka and Apache Flink.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;a href=&#34;https://www.oreilly.com/radar/the-world-beyond-batch-streaming-101/&#34;&gt;This seminal article from Tyler Akidau&lt;/a&gt; is nearly ten years old, but is still a highly relevant and excellent read and covers a lot of what you need to know about time in stream processing.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_time_in_apache_kafka&#34;&gt;Time in Apache Kafka&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Each Kafka message is made up of &lt;a href=&#34;https://kafka.apache.org/documentation/#record&#34;&gt;several parts&lt;/a&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;Key&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Value (the payload)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Header&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Timestamp&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s an example record.
The value is in JSON, which I’ve pretty-printed to make it easier to follow:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;Key&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;):&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;Value&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;205&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;):&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;1001&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;149.99&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;status&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;pending&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2025-04-25 09:44:25&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;shipped_at&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;shipping_address&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;221B Baker Street, London&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;payment_method&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Credit Card&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #990000;font-weight: bold&#34;&gt;Timestamp&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;1745587589625&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;There are two times here:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;The &lt;em&gt;event time&lt;/em&gt; which we’ll take as &lt;code&gt;created_at&lt;/code&gt; from the value: &lt;code&gt;2025-04-25 09:44:25&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The timestamp of the Kafka message: &lt;code&gt;1745587589625&lt;/code&gt;.
This is the milliseconds since the epoch, and &lt;a href=&#34;https://www.epochconverter.com/&#34;&gt;converts&lt;/a&gt; to &lt;code&gt;2025-04-25 13:26:29.625&lt;/code&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The timestamp of a Kafka message can be set explicitly &lt;a href=&#34;https://kafka.apache.org/40/javadoc/org/apache/kafka/clients/producer/ProducerRecord.html&#34;&gt;by the producer&lt;/a&gt;.
If it’s not set explicitly then the producer sets the timestamp to the current time when it sends the message to the broker.
The timestamp that’s included in the message written by the broker depends on the &lt;a href=&#34;https://kafka.apache.org/documentation/#topicconfigs_message.timestamp.type&#34;&gt;&lt;code&gt;message.timestamp.type&lt;/code&gt; topic configuration&lt;/a&gt;.
If this is set to &lt;code&gt;CreateTime&lt;/code&gt; then it uses the time from the producer (either explicit or implicitly set), or it can use the time on the broker when the record is written (&lt;code&gt;LogAppendTime&lt;/code&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In theory you could use the Timestamp field of the Kafka message to hold the event time; the data is being stored anyway, so why not optimise by not holding it twice?
The disadvantage of this comes if you’re using a system which doesn’t expose the timestamp metadata of a message, so if in doubt, keep it simple :)
Plus, it might also be useful to have both these values as it would tell you the delay between creation of events and ingesting them into Kafka (assuming you’re using &lt;code&gt;LogAppendTime&lt;/code&gt;) if you needed this information for performance troubleshooting.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_time_in_apache_flink&#34;&gt;Time in Apache Flink&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The longer you’ve been working with Flink, the higher the chances are that you’ve heard the word &amp;#34;Watermark&amp;#34;.
I must profess to having spent the last 18 months—since I started working with Flink—with my head in the sand, somewhat ostrich-like, when it comes to Watermarks.
They’re spoken of in hushed tones and with great reverence.
They seem to cause great wailing and gnashing of teeth.
Conference talks are written about them.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In a very rough nut-shell, watermarks define where on the sliding scale between data completeness and data freshness you want your Flink processing to be.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I am going to write about watermarks in this article…just not &lt;em&gt;quite&lt;/em&gt; yet.
That’s because I want to first look at one of the underlying building blocks for watermarks, and that is the concept of a &lt;strong&gt;Time Attribute&lt;/strong&gt; in Flink.
There are two types of time attribute:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Event Time&lt;/p&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
✨ If you don’t care about event time, you can also forget about watermarks.
&lt;strong&gt;Watermarks are an event-time only thing&lt;/strong&gt; ✨
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Processing Time&lt;/p&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;a.k.a. Wall Clock&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Both of these map to the explanations above; when something &lt;em&gt;happened&lt;/em&gt; (event time) and when it was &lt;em&gt;processed&lt;/em&gt; (…erm, processing time!).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The Flink documentation has some good reference pages on this topic, including &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/concepts/time/#notions-of-time-event-time-and-processing-time&#34;&gt;📖 Notions of Time: Event Time and Processing Time&lt;/a&gt; and &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/concepts/time_attributes/#introduction-to-time-attributes&#34;&gt;📖 Introduction to Time Attributes&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Time attributes are used when doing certain processing with Flink that has a time element to it.
If you don’t have one you’ll get errors like:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code&gt;The window function requires the timecol is a time attribute type&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Just because a column is a timestamp, it doesn’t mean that it’s a &lt;strong&gt;time attribute&lt;/strong&gt;.
A &lt;strong&gt;time attribute&lt;/strong&gt; is a specific characteristic in a Flink SQL table, and you need to explicitly declare it:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;An &lt;strong&gt;event time&lt;/strong&gt; column is denoted implicitly as a time attribute by assigning a &lt;code&gt;WATERMARK FOR&lt;/code&gt; statement to it in the table DDL.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;To add a time attribute for &lt;strong&gt;processing time&lt;/strong&gt; to a table use a computed column with the &lt;code&gt;PROCTIME()&lt;/code&gt; function.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s look at this in practice, using a table defined over an existing Kafka topic.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_time_in_kafka_in_flink&#34;&gt;Time in Kafka in Flink&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s our Kafka message from above:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;Key&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;14&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;):&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;Value&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;205&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;bytes&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;):&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;customer_id&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;1001&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;total_amount&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;149.99&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;status&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;pending&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2025-04-25 09:44:25&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;shipped_at&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;null&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;shipping_address&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;221B Baker Street, London&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;payment_method&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Credit Card&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #990000;font-weight: bold&#34;&gt;Timestamp&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;1745488756689&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s now create a Flink table for this Kafka topic and explore time attributes.
We’ll start off with no declared time attributes:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;status&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;shipped_at&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;shipping_address&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;payment_method&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;STRING&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;orders_cdc&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here, we only see the event time column that we defined in the schema (&lt;code&gt;created_at&lt;/code&gt;):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code&gt;+----+-------------+-------------+--------------+------------+-------------------------+[…]
| op |    order_id | customer_id | total_amount |     status |              created_at |[…]
+----+-------------+-------------+--------------+------------+-------------------------+[…]
| +I |           1 |        1001 |       149.99 |    pending | 2025-04-25 09:44:25.000 |[…]&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We can access the timestamp of the Kafka message if we add a metadata column:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ADD&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`kafka_record_ts`&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TIMESTAMP_LTZ&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;METADATA&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;timestamp&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This metadata column looks like this in the schema:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIBE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;------------------+------------------+-------+---------------+---------------------------+-----------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;             &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;             &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;extras&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;watermark&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;------------------+------------------+-------+---------------+---------------------------+-----------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FALSE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;PRI&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;color: #0086B3&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;status&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #0086B3&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;shipped_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;color: #0086B3&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;shipping_address&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;payment_method&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;kafka_record_ts&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TIMESTAMP_LTZ&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;METADATA&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;timestamp&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;------------------+------------------+-------+---------------+---------------------------+-----------+&lt;/span&gt;
&lt;span style=&#34;color: #009999&#34;&gt;9&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;set&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we can query it:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;kafka_record_ts&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;kafka_record_ts&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;13&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;26&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;29&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;625&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This matches the timestamps above that we observed in the raw Kafka message—except the &lt;code&gt;kafka_record_ts&lt;/code&gt; is displayed here in UTC whereas the conversion that I did above gave it in BST (UTC+1).
Aren’t timestamps fun!? ;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If we want the &lt;strong&gt;processing time attribute&lt;/strong&gt; in Flink we need another special column:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ADD&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`flink_proc_time`&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;PROCTIME&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;();&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we have three timestamps :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;kafka_record_ts&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;flink_proc_time&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;kafka_record_ts&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;flink_proc_time&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;13&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;26&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;29&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;625&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;57&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;349&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If I re-run the query I get this: (&lt;em&gt;note that the &lt;code&gt;flink_proc_time&lt;/code&gt; changes whilst the others don’t&lt;/em&gt;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;kafka_record_ts&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;flink_proc_time&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;13&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;26&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;29&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;625&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;743&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The &lt;strong&gt;processing time attribute&lt;/strong&gt; is literally just the time at which the data is passing through Flink.
You may have figured already by now, but since the processing time is just the wall clock, queries using processing time are going to be non-deterministic.
Contrast that to &lt;strong&gt;event time attribute&lt;/strong&gt; in which it’s part of the actual data, making the queries &lt;em&gt;less non-deterministic&lt;/em&gt;… 😁.
That is, when you re-run the query, you’re more likely to get the same results.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;🫣 There isn’t such a thing as &amp;#34;less non-deterministic&amp;#34;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Whilst processing-time based queries are going to by definition be non-deterministic (because the processing time i.e. wall clock time will be different each time), &lt;em&gt;event time&lt;/em&gt; based queries can be deterministic &lt;em&gt;only if&lt;/em&gt; the watermark is generated after each event.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In reality, watermarks are generated &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/concepts/time_attributes/#i-configure-watermark-emit-strategy&#34;&gt;periodically&lt;/a&gt; when data arrives—by default, every 200ms.
You can change this interval, as well as configure watermarks to be generated per-event (&lt;code&gt;&amp;#39;scan.watermark.emit.strategy&amp;#39;=&amp;#39;on-event&amp;#39;&lt;/code&gt;).
Only the latter will result in truly deterministic processing.&lt;/p&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_its_time&#34;&gt;It’s time…&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s now actually run a query in Flink that relies on time.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;I’ve added another row of data to the Kafka topic, meaning that the data in Flink now looks like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;kafka_record_ts&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;flink_proc_time&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code&gt;+----+-------------+-------------------------+-------------------------+-------------------------+
| op |    order_id |              created_at |         kafka_record_ts |         flink_proc_time |
+----+-------------+-------------------------+-------------------------+-------------------------+
| +I |           1 | 2025-04-25 09:44:25.000 | 2025-04-25 13:26:29.625 | 2025-04-25 15:10:09.743 |
| +I |           2 | 2025-04-25 09:44:28.000 | 2025-04-25 13:26:35.928 | 2025-04-25 15:10:09.743 |&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ll count how many orders were placed every minute.
For this we can use a &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql/queries/window-tvf/#tumble&#34;&gt;tumbling window&lt;/a&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;COUNT&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;event_count&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
                &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;MINUTE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;GROUP&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we hit our first problem:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code&gt;[ERROR] Could not execute SQL statement. Reason:
org.apache.flink.table.api.ValidationException:
The window function requires the timecol is a time attribute type, but is TIMESTAMP(3).&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The &lt;code&gt;timecol&lt;/code&gt; in this message means the time column that we specified in the query as the one to use in the time-based aggregated—&lt;code&gt;created_at&lt;/code&gt;.
But even though &lt;code&gt;created_at&lt;/code&gt; is a timestamp, it’s not a &lt;strong&gt;time attribute&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Recall that above we detailed the two types of time attribute in Flink:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Event Time&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Processing Time (a.k.a. Wall Clock)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We do have a time attribute on the table—&lt;code&gt;flink_proc_time&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;Flink&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SQL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIBE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;------------------+-----------------------------+-------+---------------+---------------------------+-----------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;             &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;name&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                        &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;null&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;key&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;extras&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;watermark&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;------------------+-----------------------------+-------+---------------+---------------------------+-----------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;         &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                         &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FALSE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;PRI&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;customer_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                         &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;     &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;total_amount&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;color: #0086B3&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;status&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                &lt;span style=&#34;color: #0086B3&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;shipped_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                &lt;span style=&#34;color: #0086B3&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;shipping_address&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;   &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;payment_method&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                      &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;STRING&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;kafka_record_ts&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TIMESTAMP_LTZ&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TRUE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;METADATA&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;timestamp&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;flink_proc_time&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TIMESTAMP_LTZ&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;PROCTIME&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;*&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FALSE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`PROCTIME`&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;()&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;------------------+-----------------------------+-------+---------------+---------------------------+-----------+&lt;/span&gt;
&lt;span style=&#34;color: #009999&#34;&gt;10&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;rows&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;in&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;set&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So let’s use that in the query and see what happens:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;COUNT&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;event_count&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;flink_proc_time&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
                &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;MINUTE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;GROUP&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;At first, we get nothing:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------------------+-------------------------+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;event_count&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------------------+-------------------------+----------------------+&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;That’s because Flink waits for the window to close before issuing the result:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------------------+-------------------------+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;event_count&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------------------+-------------------------+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;I&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;11&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;15&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;12&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s look closely at the window timestamp though: &lt;code&gt;2025-04-25 15:11&lt;/code&gt; - &lt;code&gt;2025-04-25 15:12&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Compare that to the timestamps on the record:&lt;/p&gt;
&lt;/div&gt;
&lt;table class=&#34;tableblock frame-all grid-all stretch&#34;&gt;
&lt;colgroup&gt;
&lt;col style=&#34;width: 50%;&#34;/&gt;
&lt;col style=&#34;width: 50%;&#34;/&gt;
&lt;/colgroup&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;order_id&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;1&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;created_at&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;2025-04-25 09:44:25.000&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;kafka_record_ts&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;td class=&#34;tableblock halign-left valign-top&#34;&gt;&lt;p class=&#34;tableblock&#34;&gt;&lt;code&gt;2025-04-25 13:26:29.625&lt;/code&gt;&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The window (&lt;code&gt;15:11&lt;/code&gt;) doesn’t encompass either &lt;code&gt;created_at&lt;/code&gt; (&lt;code&gt;09:44&lt;/code&gt;) nor &lt;code&gt;kafka_record_ts&lt;/code&gt; (&lt;code&gt;13:26&lt;/code&gt;).
Instead, it’s the time at which we ran it—somewhere between &lt;code&gt;15:11&lt;/code&gt; and &lt;code&gt;15:12&lt;/code&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The question we’ve answered here is &lt;em&gt;how many records were processed each minute&lt;/em&gt;.
What it definitely doesn’t tell us is &lt;em&gt;how many orders were placed each minute&lt;/em&gt; (which is what we were trying to answer originally).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;For that we need to build a window using a different time field; &lt;code&gt;created_at&lt;/code&gt;.
(If we wanted to know &lt;em&gt;how many orders were written to Kafka each minute&lt;/em&gt; we’d use &lt;code&gt;kafka_record_ts&lt;/code&gt;, if we wanted to know &lt;em&gt;how many orders shipped each minute&lt;/em&gt; we’d use &lt;code&gt;shipped_at&lt;/code&gt;, and so on).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We saw above already that we can’t just pass a timestamp column to the window aggregation; it has to be a column that has been marked as a &lt;strong&gt;time attribute&lt;/strong&gt;.
We don’t want to use a &lt;strong&gt;processing time attribute&lt;/strong&gt; because that doesn’t answer our question; we need to use an &lt;strong&gt;event time attribute&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In my mind here is some pseudo-SQL that I’d like to run to define a column as an event time attribute, but &lt;strong&gt;is not correct Flink SQL&lt;/strong&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-- ⚠️ This is not valid Flink SQL.&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;COLUMN&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`created_at`&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TIMESTAMP_LTZ&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;EVENT_TIME&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;or something like that.
The point being, &lt;strong&gt;we never explicitly say &lt;code&gt;this field is the event time attribute&lt;/code&gt;&lt;/strong&gt;.
What we actually do is &lt;strong&gt;&lt;em&gt;implicitly&lt;/em&gt; mark it as the event time attribute by defining the watermark&lt;/strong&gt;.
Since there’s a watermark, the column on which the watermark is defined must be the event time.
Obvious, right?!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To mark a column as an &lt;strong&gt;event time attribute&lt;/strong&gt; we need to use the &lt;code&gt;WATERMARK&lt;/code&gt; statement.
This is where I think things get a bit confusing until you understand it, and then it’s just… &lt;em&gt;shrugs&lt;/em&gt; how Flink is.
Let me explain…&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_watermarks_in_flink_sql&#34;&gt;💧 Watermarks in Flink SQL&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When you run a &lt;em&gt;batch&lt;/em&gt; query the engine doing the processing knows when it’s read all of the data.
Life is simple.
Contrast that to a streaming query in which, by definition, the source of the data is unbounded—so there’s no such thing as having &amp;#34;read all the data&amp;#34;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks01.excalidraw.svg&#34; alt=&#34;watermarks01.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Not only is the source unbounded, but the data may arrive out of order, late, or not at all.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks03.excalidraw.svg&#34; alt=&#34;watermarks03.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s consider what happens if we want to do some time-based processing based on when the event happened, such as an count of events per minute.
For this we’ll need a window for each minute, and then count how many events are in that window.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks04.excalidraw.svg&#34; alt=&#34;watermarks04.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the complication.
How long do we wait for data until we can consider this window closed?
Here’s the first event in the window:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks05.excalidraw.svg&#34; alt=&#34;watermarks05.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s say we’ll wait &lt;strong&gt;five seconds&lt;/strong&gt;.
If we do that then when the next event arrives (and happens to be out of order) it will be included in the window:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks06.excalidraw.svg&#34; alt=&#34;watermarks06.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The next event has a time of 10:00:06.
If we take the five seconds (that we decided was how long we’d wait for data before closing the window) that gives us 10:00:01, which is after the 10:00:00 window close time, and thus we can close the window:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks07.excalidraw.svg&#34; alt=&#34;watermarks07.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This event is not just out of order, but it is LATE because it arrived for processing AFTER the window in which it belongs was closed.
In Flink SQL a late record will be discarded from processing.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks08.excalidraw.svg&#34; alt=&#34;watermarks08.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So, how do we implement in theory, so that we’re not reliant on wall clock to determine how late is too late to include an out of order record in a window?
How do we decide when to close a window, instead of storing it as state until the end of eternity?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Watermarks&lt;/em&gt;&lt;/strong&gt; are a clever idea that tell the processing engine when it’s OK to consider a passage of time as complete.
In other words, a watermark tells Flink what the &lt;strong&gt;latest time&lt;/strong&gt; is that we can consider as having seen, allowing for our arbitrary five second delay.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks09.excalidraw.svg&#34; alt=&#34;watermarks09.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When the out of order event arrives, the watermark doesn’t change because the event time is earlier than the latest that we’ve seen so far&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks10.excalidraw.svg&#34; alt=&#34;watermarks10.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When the event with event time of &lt;code&gt;10:00:06&lt;/code&gt; arrives the watermark advances to five seconds prior to the event time since this is later than the previous watermark.
Because this is now after the end time of the previous window this causes that window to close.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks11.excalidraw.svg&#34; alt=&#34;watermarks11.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Because the window has closed the record with event time &lt;code&gt;09:59:51&lt;/code&gt; is classed as late.
In Flink SQL that means it will be discarded.
The watermark remains unchanged.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/watermarks12.excalidraw.svg&#34; alt=&#34;watermarks12.excalidraw&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
The above diagrams are, as is the case with these things, simplified to try and cover the broader point.
In practice a watermark is not generated per-event unless Flink is configured to do so.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is why when we create a table in Flink SQL we can’t just define a column as an &lt;strong&gt;event time attribute&lt;/strong&gt; on its own; we need to define the watermark generation strategy that goes with it so that Flink knows when to have considered all data as having been read for a given period of that event time.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;Where we set the watermark is up to us&lt;/strong&gt;.
Set a watermark too short and whilst you’ll get your final result quicker you’re much more likely to have incomplete data because anything arriving late will be ignored.
Then again, set the watermark too long you’ll increase the chances of getting a complete set of data, but at the expense of the result taking longer to finalise.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Which is right? That depends on you and your business process :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To learn more about watermarks in detail check out these excellent resources:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=sdhwpUAjqaI&#34;&gt;Event Time and Watermarks—David Anderson&lt;/a&gt; (video)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=PWLjEyJxhg0&#34;&gt;Watermarks in Flink SQL—David Anderson&lt;/a&gt; (video)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.oreilly.com/radar/the-world-beyond-batch-streaming-101/&#34;&gt;Streaming 101: The world beyond batch—Tyler Akidau&lt;/a&gt; (article)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://current.confluent.io/2024-sessions/timing-is-everything-understanding-event-time-processing-in-flink-sql&#34;&gt;Timing is Everything: Understanding Event-Time Processing in Flink SQL—Sharon Xie&lt;/a&gt; (conference talk)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;One thing to be aware of is that &lt;strong&gt;there is a difference between records that are &lt;em&gt;late&lt;/em&gt; and those that are &lt;em&gt;out of order&lt;/em&gt;&lt;/strong&gt;.
In Flink SQL if a record is &lt;em&gt;late&lt;/em&gt; then it is discarded, whilst if it is just &lt;em&gt;out of order&lt;/em&gt; then it means it arrived after an earlier record, but is still included in processing.
This is where the watermark generation strategy comes in; if you generate watermarks too quickly (in order to cause a window to close sooner) you slide the scale away from completeness and potentially more records are classed as &lt;strong&gt;late&lt;/strong&gt; and thus discarded.
If the watermark period is longer, those same records arriving at the same point in the stream would instead be &lt;strong&gt;out of order&lt;/strong&gt; and thus your completeness is higher (at the expense of latency).
The video linked to above explains this difference well; &lt;a href=&#34;https://youtu.be/PWLjEyJxhg0?feature=shared&amp;amp;t=211&#34;&gt;skip to 3:29&lt;/a&gt; if you just want the bit about late vs out of order.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So, watermarks are a thing—and we need to configure them.
If we’re going to be pernickity about terminology, we’re not defining the watermark per se, but the &lt;em&gt;watermark generation strategy&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ADD&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`created_at`&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`created_at`&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;5&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SECOND&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This &lt;em&gt;basically&lt;/em&gt; tells Flink that it needs to give a five-second leeway when processing &lt;code&gt;created_at&lt;/code&gt; for any out of order records to arrive on the stream.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
There is actually a lot more nuance to how it works, and complexities if you have partitioned input too. &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/concepts/time_attributes/#advanced-watermark-features&#34;&gt;The Flink docs&lt;/a&gt; cover these well, as do &lt;a href=&#34;https://www.youtube.com/watch?v=sdhwpUAjqaI&#34;&gt;these&lt;/a&gt; &lt;a href=&#34;https://www.youtube.com/watch?v=PWLjEyJxhg0&#34;&gt;videos&lt;/a&gt;.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With the event time attribute defined on the table (by virtue of us having set the &lt;code&gt;WATERMARK&lt;/code&gt;), let’s try our windowed aggregation again, reverting to using &lt;code&gt;created_at&lt;/code&gt; by which the aggregate is generated:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;COUNT&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;event_count&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
                &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;MINUTE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;GROUP&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But this happens…&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------------------+-------------------------+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;op&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;event_count&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----+-------------------------+-------------------------+----------------------+&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;No rows get emitted.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://media1.giphy.com/media/Xs2ry2K0ADD7G/giphy.gif&#34; alt=&#34;giphy&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We can start to debug this by removing the aggregation and looking at the columns that the table valued function (TVF) return about the window, and also add the &lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; detail:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
                    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;MINUTE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;);&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-------------------------+-------------------------+-------------------------+-------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-------------------------+-------------------------+-------------------------+-------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;28&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So we can see that the orders are being bucketed into the correct time window based on &lt;code&gt;created_at&lt;/code&gt;; but &lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; is &lt;code&gt;NULL&lt;/code&gt;, which I’m guessing is why I don’t get any rows emitted for my aggregate.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Why is there no watermark (i.e. &lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; is &lt;code&gt;NULL&lt;/code&gt;)?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Well, the devil is in the detail, and there are two factors at play here.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_idle_partitions&#34;&gt;Idle partitions&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you’re working with Kafka as a source to Flink, it’s vital to be aware of what’s known as the &amp;#34;idle stream problem&amp;#34;.
This is expertly described &lt;a href=&#34;https://youtu.be/sdhwpUAjqaI?feature=shared&amp;amp;t=403&#34;&gt;here&lt;/a&gt;.
In short, it occurs when the Kafka source hasn’t sent a watermark from &lt;strong&gt;each and every partition&lt;/strong&gt; yet.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/2025-04-17T16-12-25-913Z.png&#34; alt=&#34;2025 04 17T16 12 25 913Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The watermark at each stage of the execution (known as an &amp;#39;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/concepts/glossary/#operator&#34;&gt;operator&lt;/a&gt;&amp;#39;) is the &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/concepts/time/#watermarks-in-parallel-streams&#34;&gt;&lt;em&gt;minimum of the watermarks across the source partitions&lt;/em&gt;&lt;/a&gt;.
The crucial point here is that if there is no data flowing through one (or more) partitions, that means that no watermark is generated by them either.
This means that the watermark for the operator is not updated.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
🎥 To learn more about how a query gets executed, the concept of operators, and logical job graphs, check out &lt;a href=&#34;https://youtu.be/QLzHeqzDnbM?si=LRMQSqlC7sYdwbCg&amp;amp;t=1349&#34;&gt;this excellent talk from Danny Cranmer&lt;/a&gt;.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To see how this impacts our situation let’s first check the number of partitions on the source topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;$ &lt;/span&gt;docker compose &lt;span style=&#34;color: #0086B3&#34;&gt;exec&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;-it&lt;/span&gt; kcat kcat &lt;span style=&#34;color: #000080&#34;&gt;-b&lt;/span&gt; broker:9092 &lt;span style=&#34;color: #000080&#34;&gt;-L&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code&gt;Metadata for all topics (from broker 1: broker:9092/1):
 1 brokers:
  broker 1 at broker:9092 (controller)
 1 topics:
  topic &amp;#34;orders_cdc&amp;#34; with 3 partitions:
    partition 0, leader 1, replicas: 1, isrs: 1
    partition 1, leader 1, replicas: 1, isrs: 1
    partition 2, leader 1, replicas: 1, isrs: 1&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This shows that there are three partitions.
To check if we are getting data from each of them we can bring the partition in as a metadata column (like we did for the message timestamp above):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ADD&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;METADATA&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;partition&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;And now run the same query, but showing the partitions for each row to check the message partition assignments:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
                    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;MINUTE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                 &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;28&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                 &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This shows that there’s no messages on partition 1, and thus no watermark is getting generated for the operator.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;One option here is just to add data to the partition and thus cause a watermark to be generated.
The partition is set based on the key of the Kafka message, which is &lt;code&gt;order_id&lt;/code&gt;.
If we add more orders (causing &lt;code&gt;order_id&lt;/code&gt; to change), then we should soon end up with an order on partition 1.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What I see after adding a row to the partition is this—even though it’s in partition 1, still no watermark (based on &lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; being NULL)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;      &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #a61717;background-color: #e3d2d2&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #009999&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;01&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                 &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;47&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When I add &lt;em&gt;another&lt;/em&gt; row, I then get a watermark:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #a61717;background-color: #e3d2d2&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;]&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #009999&#34;&gt;6&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;20&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;47&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ll come back to this point (that is, why we only see &lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; after a second insert) shortly.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;First though, we’ve seen that the reason we weren’t getting a watermark generated was an idle partition; there was no record in partition 1, and so no watermark passed downstream to the watermark for the operator.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To deal with this we can &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/concepts/time_attributes/#ii-configure-the-idle-timeout-of-source-table&#34;&gt;configure an &lt;strong&gt;idle timeout&lt;/strong&gt;&lt;/a&gt; which tells the downstream watermark generator to ignore any missing watermarks after the amount of time specified.
The configuration property is &lt;code&gt;scan.watermark.idle-timeout&lt;/code&gt; and can be set as a query hint, or a table property:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SET&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;5sec&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To test this out I reset the source topic, and added rows afresh, one by one.
First, no watermark:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;but then, a watermark (note that there’s only data on two of the three partitions; this is the &lt;code&gt;scan.watermark.idle-timeout&lt;/code&gt; taking effect):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;       &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;----------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                  &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;        &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;28&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;20&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s now look at why &lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; isn’t being set on the first row—and in the example above, why it took a second row being added to partition 1 for &lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; to be set.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_when_does_a_watermark_get_generated_in_flink&#34;&gt;When does a watermark get generated in Flink?&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;As described &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/datastream/event-time/generating_watermarks/#watermark-strategies-and-the-kafka-connector&#34;&gt;here&lt;/a&gt;, the watermark is &lt;em&gt;generated by the source&lt;/em&gt; (the Kafka connector, in this case).
It’s generated based on &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql/create/#watermark&#34;&gt;the &lt;em&gt;watermark generation strategy&lt;/em&gt; specified in the DDL&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ve specified our watermark generation strategy as a &lt;em&gt;bounded out of orderness&lt;/em&gt; one.
That is, events might be out of order, but we’re specifying a bound to how long we will wait for late events:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;`created_at`&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;5&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SECOND&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This means that the watermark is generated based on the value of &lt;code&gt;created_at&lt;/code&gt; that’s read by the source, minus five seconds.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The wrinkle here is that by default the watermark is not created immediately when the first row of data is read.
Per &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/concepts/time_attributes/#i-configure-watermark-emit-strategy&#34;&gt;the docs&lt;/a&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;quoteblock&#34;&gt;
&lt;blockquote&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;For sql tasks, watermark is emitted periodically by default, with a default period of 200ms, which can be changed by the parameter pipeline.auto-watermark-interval&lt;/p&gt;
&lt;/div&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Since the &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/functions/systemfunctions/&#34;&gt;&lt;code&gt;CURRENT_WATERMARK&lt;/code&gt;&lt;/a&gt; function in a query returns the watermark &lt;em&gt;at the time that the row is emitted to the query output&lt;/em&gt;, and thus if it’s the very beginning of the execution &lt;em&gt;can mean that a watermark hasn’t been generated yet&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;There is a cleaner way to look at the current watermark; through the Flink UI:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/2025-04-24T10-41-31-985Z.png&#34; alt=&#34;2025 04 24T10 41 31 985Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If there is no watermark then it looks like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/2025-04-24T11-51-36-724Z.png&#34; alt=&#34;2025 04 24T11 51 36 724Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_putting_it_into_practice&#34;&gt;Putting it into practice&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;These two &amp;#39;nuances&amp;#39; to Flink watermarking (idle partitions, and observing the current watermark/&lt;code&gt;auto-watermark-interval&lt;/code&gt;) are somewhat circularly interlinked.
Now that we’ve considered each on their own, let’s apply it to the problems we saw above.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the same query as above, with no idle timeout set, and as we saw before &lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; is &lt;code&gt;NULL&lt;/code&gt; which is what we’d expect.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
                    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;MINUTE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code&gt;+-------------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+
|    order_id | topic_partition |              created_at |       CURRENT_WATERMARK |            window_start |              window_end |
+-------------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+
|           2 |               2 | 2025-04-25 09:44:28.000 |                  &amp;lt;NULL&amp;gt; | 2025-04-25 09:44:00.000 | 2025-04-25 09:45:00.000 |
|           1 |               0 | 2025-04-25 09:44:25.000 |                  &amp;lt;NULL&amp;gt; | 2025-04-25 09:44:00.000 | 2025-04-25 09:45:00.000 |&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The idle timeout can be set as a table property, but also through a query hint.
This has the benefit of proving the difference without needing to change the table definition.
In theory it could be that you want to use a different watermark configuration for different uses of the table too.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the same query, with a hint:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;/*+ OPTIONS(&amp;#39;scan.watermark.idle-timeout&amp;#39;=&amp;#39;5sec&amp;#39;) */&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;CURRENT_WATERMARK&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
                    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;MINUTE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The results in the SQL client look the same:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code&gt;+-------------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+
|    order_id | topic_partition |              created_at |       CURRENT_WATERMARK |            window_start |              window_end |
+-------------+-----------------+-------------------------+-------------------------+-------------------------+-------------------------+
|           2 |               2 | 2025-04-25 09:44:28.000 |                  &amp;lt;NULL&amp;gt; | 2025-04-25 09:44:00.000 | 2025-04-25 09:45:00.000 |
|           1 |               0 | 2025-04-25 09:44:25.000 |                  &amp;lt;NULL&amp;gt; | 2025-04-25 09:44:00.000 | 2025-04-25 09:45:00.000 |&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But crucially, over in the Flink UI we can inspect the actual watermark for each operator:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/2025-04-25T15-19-17-493Z.png&#34; alt=&#34;2025 04 25T15 19 17 493Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The watermark rendered locally in my browser is &lt;code&gt;25/04/2025, 10:44:20&lt;/code&gt;, which is in BST (UTC+1).
This comes from the lowest of the upstream watermarks, of which there are two.
These watermarks are the highest value of &lt;code&gt;created_at&lt;/code&gt; for each partition, with the &lt;strong&gt;watermark generation strategy&lt;/strong&gt; applied, which was&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;`created_at`&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;5&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SECOND&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Thus partition 0’s watermark (&lt;code&gt;09:44:25&lt;/code&gt; minus 5 seconds) is used: &lt;code&gt;2025-04-25 09:44:20.000&lt;/code&gt; UTC&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_so_back_to_where_we_were_a_tumbling_time_window&#34;&gt;So back to where we were: a tumbling time window&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;From the above we’ve learnt two things:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;We need to understand the impact of an idle partition on the watermark that’s generated for each operator.
By setting &lt;code&gt;scan.watermark.idle-timeout&lt;/code&gt; as a query hint we can see if it resolves the problem, and if it does, modify the table’s properties:&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;ALTER&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SET&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;30 sec&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; is useful but only once a query is &amp;#39;warmed up&amp;#39;; at the beginning, or for a very sparse number of records, the row it is emitted with in a query may not reflect the watermark that follows from the logical implications of the row itself.
For example, even if the row emitted is for a previously-idle partition and thus a watermark would be expected, it may not be reflected in &lt;code&gt;CURRENT_WATERMARK&lt;/code&gt; &lt;em&gt;in that row&lt;/em&gt;.&lt;/p&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;In this situation a more reliable way to examine the watermark can be through the Flink UI as this is updated continually and does not rely on a row being emitted from the query itself.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/2025-04-24T10-41-31-985Z.png&#34; alt=&#34;2025 04 24T10 41 31 985Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the current state of the table’s definition; we’ve marked the &lt;code&gt;created_at&lt;/code&gt; column as an &lt;strong&gt;event time attribute&lt;/strong&gt; by virtue of having defined a &lt;em&gt;watermark generation strategy&lt;/em&gt; on it (&lt;code&gt;`created_at` AS &lt;code&gt;created_at&lt;/code&gt; - INTERVAL &amp;#39;5&amp;#39; SECOND&lt;/code&gt;), and we’ve configure a timeout to avoid an idle partition blocking a watermark from being generated.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;CREATE&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`orders_kafka`&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;`order_id`&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NULL&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;`customer_id`&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;`total_amount`&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;DECIMAL&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;10&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;`status`&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;2147483647&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;`created_at`&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;`shipped_at`&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;TIMESTAMP&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;`shipping_address`&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;2147483647&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;`payment_method`&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;2147483647&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;`topic_partition`&lt;/span&gt; &lt;span style=&#34;color: #0086B3&#34;&gt;INT&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;METADATA&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;partition&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;WATERMARK&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FOR&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`created_at`&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;AS&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`created_at`&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;5&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SECOND&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;CONSTRAINT&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;`PK_order_id`&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;PRIMARY&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;KEY&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;`order_id`&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;NOT&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;ENFORCED&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;WITH&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;properties.bootstrap.servers&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;broker:9092&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;connector&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;upsert-kafka&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;value.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;key.format&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;json&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;topic&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;orders_cdc&amp;#39;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;scan.watermark.idle-timeout&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;30 sec&amp;#39;&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now for our original tumbling window query, to answer the question: how many orders have been created each minute?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;COUNT&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;as&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;event_count&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
                &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;MINUTE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;GROUP&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;BY&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But…still nothing&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/CleanShot%202025-04-25%20at%2016.20.12.gif&#34; alt=&#34;CleanShot 2025 04 25 at 16.20.12&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This time (sorry…) though, I know why!
Or at least, I &lt;em&gt;think&lt;/em&gt; I do.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here are the two rows of data currently in the source topic:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;SELECT&lt;/span&gt;  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;FROM&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;TUMBLE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;TABLE&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;orders_kafka&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;DESCRIPTOR&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;),&lt;/span&gt;
                    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;INTERVAL&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;1&amp;#39;&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;MINUTE&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;)&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code&gt;+-------------+-----------------+-------------------------+-------------------------+-------------------------+
|    order_id | topic_partition |              created_at |            window_start |              window_end |
+-------------+-----------------+-------------------------+-------------------------+-------------------------+
|           2 |               2 | 2025-04-25 09:44:28.000 | 2025-04-25 09:44:00.000 | 2025-04-25 09:45:00.000 |
|           1 |               0 | 2025-04-25 09:44:25.000 | 2025-04-25 09:44:00.000 | 2025-04-25 09:45:00.000 |&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;There is a window that we’re expecting to get emitted in our query.
It starts at &lt;code&gt;09:44&lt;/code&gt; and ends a minute later (defined by &lt;code&gt;INTERVAL &amp;#39;1&amp;#39; MINUTE&lt;/code&gt; in the &lt;code&gt;TUMBLE&lt;/code&gt; part of the query) at &lt;code&gt;09:45&lt;/code&gt;.
The window will get emitted once it’s considered &amp;#39;closed&amp;#39;; that is, the watermark has passed the &lt;code&gt;window_end&lt;/code&gt; time.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;It’s worth reiterating here because it’s so crucial to understanding what’s going on: the query emits results based on the &lt;strong&gt;watermark&lt;/strong&gt;.
The watermark is driven by &lt;strong&gt;event time&lt;/strong&gt; and &lt;em&gt;not wall clock&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So whilst I’ve just inserted these two rows of data, I can wait until kingdom come; just because a minute has passed on the wallclock, &lt;strong&gt;nothing is getting emitted until the watermark moves on past the end of the window&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What’s the current watermark?
It should be the lower of the watermarks across the partitions, which as we can see from the table of data here is going to be &lt;code&gt;2025-04-25 09:44:25.000&lt;/code&gt; minus five seconds (which is our declared watermark generation strategy), thus &lt;code&gt;2025-04-25 09:44:20.000&lt;/code&gt;.
If that &lt;em&gt;is&lt;/em&gt; the case, then the watermark of the operator (&lt;code&gt;09:44:20&lt;/code&gt;) will not be later than the window end time (&lt;code&gt;09:45:00&lt;/code&gt;), and thus nothing can be emitted yet.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s check what the current watermark is to determine if my &lt;del&gt;wild guess&lt;/del&gt;educated reasoning is correct:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/2025-04-25T13-29-08-469Z.png&#34; alt=&#34;2025 04 25T13 29 08 469Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;😓 Oh no! I was wrong…or was I?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;😅 Because just a short while (roughly 30 seconds) later what do I see but this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/04/2025-04-25T13-29-49-258Z.png&#34; alt=&#34;2025 04 25T13 29 49 258Z&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Taking into account the timezone offset (UTC+1) I was right! The current watermark is &lt;code&gt;25/04/2025, 09:44:20&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;Why the delay?&lt;/strong&gt;
Because the watermark is only generated after the idle timeout period (30 seconds) has passed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://media4.giphy.com/media/3WCNY2RhcmnwGbKbCi/giphy.gif&#34; alt=&#34;Ted Lasso - Yes!&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_monitoring_the_watermark&#34;&gt;Monitoring the watermark&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s a trick for monitoring the watermark—use the REST API.
This is what the Flink UI is built on, and is also &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/ops/rest_api/#jobs-jobid-vertices-vertexid-watermarks&#34;&gt;documented&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can get the REST call from the Flink UI (use DevTools to copy the /watermarks call made when you click on the subtask).
You can also construct it by figuring out the job and operator (&amp;#34;vertex&amp;#34;) ID from the &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/ops/rest_api/#jobs-jobid&#34;&gt;/jobs API endpoint&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The REST call using &lt;a href=&#34;https://httpie.io/&#34;&gt;httpie&lt;/a&gt; will look like this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;$ &lt;/span&gt;http http://localhost:8081/jobs/e79bb1ffe31e359a8152278c43ce81c7/vertices/19843528532cdce10b652a1bfda378b5/watermarks
HTTP/1.1 200 OK
access-control-allow-origin: &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;*&lt;/span&gt;
connection: keep-alive
content-length: 58
content-type: application/json&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;;&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;charset&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;UTF-8
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;[&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;0.currentInputWatermark&amp;#34;&lt;/span&gt;,
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;: &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;1745574260000&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With some &lt;code&gt;jq&lt;/code&gt; magic we can wrap it in a &lt;code&gt;watch&lt;/code&gt; statement to update automagically:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;$ &lt;/span&gt;watch http &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;http://localhost:8081/jobs/e79bb1ffe31e359a8152278c43ce81c7/vertices/19843528532cdce10b652a1bfda378b5/watermarks &lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;
            | jq &amp;#39;.[].value |= (tonumber / 1000 | todate)&amp;#39;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;json&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
  &lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
    &lt;/span&gt;&lt;span style=&#34;color: #990000;font-weight: bold&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;0.currentInputWatermark&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
    &lt;/span&gt;&lt;span style=&#34;color: #990000;font-weight: bold&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;2025-04-25T09:44:20Z&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
  &lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_back_to_the_tumbling_window&#34;&gt;Back to the tumbling window&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So how do we move the watermark on and get some data emitted from the tumbling window?
First off, we need a new watermark to be generated.
When Flink SQL is reading from Kafka a watermark is only generated when the Kafka consumer reads a message.
No new messages, no updated watermark.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The generated watermark is the &lt;strong&gt;lowest (earliest) of the upstream watermarks&lt;/strong&gt; (i.e. per partition), which are in turn &lt;strong&gt;the latest value seen of &lt;code&gt;created_at&lt;/code&gt; minus five seconds&lt;/strong&gt;.
Note that this &lt;strong&gt;&lt;em&gt;excludes&lt;/em&gt; idle partitions&lt;/strong&gt;.
An idle partition could be one in which there’s no data, but it could also be a partition with data but for which no &lt;em&gt;new&lt;/em&gt; data has been received within the configured &lt;code&gt;scan.watermark.idle-timeout&lt;/code&gt; time.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This makes sense if you step back and think about what the whole point of watermarks is; to provide a mechanism for handling late and out-of-order data.
What Flink is doing is saying &amp;#34;&lt;em&gt;I cannot close this window yet because one or more of the partitions have not told me that it’s got all the data [because the watermark for that partition has not passed the window close time]&lt;/em&gt;&amp;#34;.
It’s also saying &amp;#34;&lt;em&gt;Regardless of the watermark generation policy (5 seconds in our case), I’m going to class any partitions have have not produced any data for a given period of time (30 seconds in our case) as idle, and so ignore their watermark when generating the downstream watermark&lt;/em&gt;&amp;#34;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So if I add one more row of data with a more recent &lt;code&gt;created_at&lt;/code&gt; outside of the window it’s not &lt;em&gt;necessarily&lt;/em&gt; going to cause the window to close.
Why not?
Because in the other partitions the watermark is still going to be earlier.
&lt;em&gt;But&lt;/em&gt; if it’s more than the idle timeout (&lt;code&gt;scan.watermark.idle-timeout&lt;/code&gt;) that partition’s watermark gets disregarded, and so the new row &lt;em&gt;will&lt;/em&gt; cause the window to close.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s add the row of data.
It’s several minutes since I created the previous ones.
Remember, &lt;code&gt;created_at&lt;/code&gt; is an event time, not wall clock time.
That said, the idle timeout &lt;strong&gt;is&lt;/strong&gt; based on wall clock time.
Fun, huh!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Here’s the data now:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------+-----------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------+-----------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;28&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;33&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So in partition 2 the watermark is &lt;code&gt;2025-04-25 09:45:28&lt;/code&gt; (&lt;code&gt;2025-04-25 09:45:33&lt;/code&gt; minus five seconds) and in partition 0 the watermark would be &lt;code&gt;2025-04-25 09:44:20.000&lt;/code&gt; except the partition has idled out (&lt;code&gt;scan.watermark.idle-timeout&lt;/code&gt;) and so in effect is the same as partition 1—idle, and so not included in the calculation of the generated watermark:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;http://localhost:8081/jobs/e79bb1ffe31e359a8152278c43ce81c7/vertices/19843528532cdce10b652a1bfda378b5/watermarks &lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;
            | jq &amp;#39;.[].value |= (tonumber / 1000 | todate)&amp;#39;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;json&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
  &lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
    &lt;/span&gt;&lt;span style=&#34;color: #990000;font-weight: bold&#34;&gt;&amp;#34;id&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;0.currentInputWatermark&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
    &lt;/span&gt;&lt;span style=&#34;color: #990000;font-weight: bold&#34;&gt;&amp;#34;value&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt; &lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;2025-04-25T09:45:28Z&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
  &lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;&lt;span style=&#34;color: #bbbbbb&#34;&gt;
&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Since &lt;code&gt;09:45:28&lt;/code&gt; is outside the window end, we get our windowed aggregate emitted!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------------------+-------------------------+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;event_count&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------------------+-------------------------+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now let’s add a record within the next window (&lt;code&gt;09:45&lt;/code&gt;-&lt;code&gt;09:46&lt;/code&gt;):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------+-----------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------+-----------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;28&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;33&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;38&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The watermark is now &lt;code&gt;2025-04-25 09:45:33&lt;/code&gt; (&lt;code&gt;2025-04-25 09:45:38&lt;/code&gt; minus 5 seconds).
If we want to make this window (&lt;code&gt;09:45&lt;/code&gt;-&lt;code&gt;09:46&lt;/code&gt;) emit a row we need to cause the watermark to be greater than &lt;code&gt;09:46:00&lt;/code&gt;, so we’ll add a record with a &lt;code&gt;created_at&lt;/code&gt; of &lt;code&gt;09:46:06&lt;/code&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------+-----------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;order_id&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;topic_partition&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;created_at&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------+-----------------+-------------------------+-------------------------+-------------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;28&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;0&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;3&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;33&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;4&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;38&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;           &lt;span style=&#34;color: #009999&#34;&gt;5&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;               &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;06&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;47&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The watermark moves on to &lt;code&gt;2025-04-25 09:46:01&lt;/code&gt; and the aggregate window gets emitted:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;sql&#34;&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------------------+-------------------------+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_start&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;              &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;window_end&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;          &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;event_count&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;+&lt;/span&gt;&lt;span style=&#34;color: #999988;font-style: italic&#34;&gt;-------------------------+-------------------------+----------------------+&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;44&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;
&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;45&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2025&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;04&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;-&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;25&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;09&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;46&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;00&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;.&lt;/span&gt;&lt;span style=&#34;color: #009999&#34;&gt;000&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;                    &lt;span style=&#34;color: #009999&#34;&gt;2&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://emojis.slackmojis.com/emojis/images/1643514139/978/conga_parrot.gif?1643514139&#34; alt=&#34;conga parrot&#34; width=&#34;32&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_️_phew_eighteen_months_since_starting_to_learn_flinki_think_i_understand_watermarks&#34;&gt;☺️ Phew. Eighteen months since starting to learn Flink…I think I understand watermarks :)&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://media2.giphy.com/media/3o7btNhMBytxAM6YBa/giphy.gif&#34; alt=&#34;Neo - I know Kung Fu&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;It’s taken a while, and a lot of scratching around and reading and asking smart people (huge kudos to colleague and Flink community member David Anderson), but I feel like I understand watermarks—or if not, I at least know which corners to go poking in next time I get stumped by them.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you’re wanting to understand watermarks properly my advice would be thus:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;olist arabic&#34;&gt;
&lt;ol class=&#34;arabic&#34;&gt;
&lt;li&gt;
&lt;p&gt;Read and watch these excellent resources. And then go and do it again.&lt;/p&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://youtu.be/QLzHeqzDnbM?si=LRMQSqlC7sYdwbCg&amp;amp;t=1349&#34;&gt;How does Apache Flink actually work—Danny Cranmer&lt;/a&gt; (video)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=PWLjEyJxhg0&#34;&gt;Watermarks in Flink SQL—David Anderson&lt;/a&gt; (video)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=sdhwpUAjqaI&#34;&gt;Event Time and Watermarks—David Anderson&lt;/a&gt; (video)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.oreilly.com/radar/the-world-beyond-batch-streaming-101/&#34;&gt;Streaming 101: The world beyond batch—Tyler Akidau&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://current.confluent.io/2024-sessions/timing-is-everything-understanding-event-time-processing-in-flink-sql&#34;&gt;Timing is Everything: Understanding Event-Time Processing in Flink SQL—Sharon Xie&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Fire up the Flink UI and poke around the watermarks tab with a set of data in which you’ve fixed the event time.
This makes it much easier to replicate and try out different settings.
If you use an event time that’s not fixed (such as Kafka timestamp and you’re inserting new records each time) you are, as they say, peeing in the wind.
And we know how messy that can get.&lt;/p&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
I’ve put the Docker Compose that I used to run all the above tests &lt;a href=&#34;https://github.com/rmoff/flink-examples/tree/main/flink-kafka-postgres&#34;&gt;on GitHub&lt;/a&gt;, so you can run it and explore to your heart’s content.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Read the fine documentation.
It’s not ideal that the information is spread across the docs how it is, but that is how it is, so deal with it or file a PR :)&lt;/p&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/concepts/time_attributes/#event-time&#34;&gt;Event Time&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/concepts/time/&#34;&gt;Timely Stream Processing&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/datastream/event-time/generating_watermarks/#watermark-strategies-and-the-kafka-connector&#34;&gt;Watermark Strategies and the Kafka Connector&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql/create/#watermark&#34;&gt;&lt;code&gt;WATERMARK&lt;/code&gt; DDL reference&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/connectors/table/kafka/#source-per-partition-watermarks&#34;&gt;Source Per-Partition Watermarks&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/config/#table-exec-source-idle-timeout&#34;&gt;Configuration reference&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;My thanks to David Anderson and Gunnar Morling for their help with this article.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    <item>
      <title>Interesting links - April 2025</title>
      <link>https://rmoff.net/2025/04/22/interesting-links-april-2025/</link>
      <pubDate>2025-04-22</pubDate>
      
      <guid>https://rmoff.net/2025/04/22/interesting-links-april-2025/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/04/t_IMG_9021.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;strong&gt;So. Many. Interesting. Links.&lt;/strong&gt; Not got time for all this? I’ve marked 🔥 for my top reads of the month :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_data_engineering&#34;&gt;Data Engineering&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://luminousmen.com/post/data-engineering-now-with-30-more-bullshit&#34;&gt;Data Engineering: Now with 30% More Bullshit&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;🔥 A good article from Andrew Jones on the &lt;a href=&#34;https://www.confluent.io/blog/shifting-left/&#34;&gt;concept of &amp;#34;shift left&amp;#34;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://practicaldatamodeling.substack.com/p/data-model-smells&#34;&gt;Data Model Smells&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/medialab/xan/blob/master/docs/LOVE_LETTER.md&#34;&gt;A love letter to the CSV format&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.getdbt.com/resources/reports/state-of-analytics-engineering-2025&#34;&gt;The 2025 State of Analytics Engineering Report&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Useful writeup from Anders Swanson on &lt;a href=&#34;https://roundup.getdbt.com/p/iceberg-give-it-a-rest&#34;&gt;[Iceberg, the Iceberg REST Catalog Specification, and more&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://georgheiler.com/post/learning-data-engineering#some-first-steps&#34;&gt;Georg Heiler - Upskilling data engineers&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_kafka&#34;&gt;Kafka&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://www.warpstream.com/blog/taking-out-the-trash-garbage-collection-of-object-storage-at-massive-scale&#34;&gt;Taking out the Trash: Garbage Collection of Object Storage at Massive Scale&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://cwiki.apache.org/confluence/display/KAFKA/KIP-1150%3A+Diskless+Topics&#34;&gt;KIP-1150: Diskless Topics - Apache Kafka - Apache Software Foundation&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://yokota.blog/2025/04/16/using-data-contracts-with-the-rust-schema-registry-client/&#34;&gt;Using Data Contracts with the Rust Schema Registry Client&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/jonas-grgt/ktea&#34;&gt;&lt;code&gt;ktea&lt;/code&gt;&lt;/a&gt; - a Kafka TUI client&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://cefboud.com/posts/kafka-producer-client-internals/&#34;&gt;Behind Sending Millions of Messages Per Second: A Look Under the Hood of Kafka Producer&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://jeqo.dev/blog/benchmarking-apache-kafka/distributed-omb/&#34;&gt;Benchmarking Kafka: Distributed Workers and Workload topology in OpenMessaging Benchmark&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.linkedin.com/pulse/queues-kafka-my-opinion-david-ware-xcvme/&#34;&gt;Queues for Kafka, my opinion&lt;/a&gt; (&lt;em&gt;see also: &lt;a href=&#34;https://yourlogicalfallacyis.com/no-true-scotsman&#34;&gt;no true scotsman&lt;/a&gt;&lt;/em&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_cdc&#34;&gt;CDC&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://www.morling.dev/blog/ingesting-debezium-events-from-kafka-with-flink-sql/&#34;&gt;A Deep Dive Into Ingesting Debezium Events From Kafka With Flink SQL&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A really good illustration of how CDC can &lt;a href=&#34;https://medium.com/allthatscales/from-transactional-bottlenecks-to-lightning-fast-analytics-74e0d3fff1c0&#34;&gt;enable low-latency use of data from transactional systems without impacting the OLTP workloads&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.alibabacloud.com/blog/best-practices-for-flink-cdc-yaml-in-realtime-compute-for-apache-flink_602102&#34;&gt;Best Practices for Flink CDC YAML in Realtime Compute for Apache Flink&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Using Debezium and Kafka Connect with Iceberg &lt;a href=&#34;https://medium.com/@neuw84/using-debezium-and-kafka-connect-with-iceberg-part-i-aca001ee166b&#34;&gt;part I&lt;/a&gt; &amp;amp; &lt;a href=&#34;https://medium.com/@neuw84/using-debezium-and-kafka-connect-with-iceberg-part-ii-0c5ecea68c5e&#34;&gt;part II&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://medium.com/adevinta-tech-blog/make-data-migration-easy-with-debezium-and-apache-kafka-4c9e2b9b6601&#34;&gt;How Kleinanzeigen used Debezium and Apache Kafka for data migration&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_stream_processing&#34;&gt;Stream Processing&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 A good article on using Flink SQL’s &lt;a href=&#34;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql/queries/match_recognize/&#34;&gt;&lt;code&gt;MATCH_RECOGNIZE&lt;/code&gt;&lt;/a&gt; for &lt;a href=&#34;https://medium.com/yugen-ai-technology-blog/real-time-fraud-detection-using-apache-flink-part-2-6b2cbd333024&#34;&gt;Real Time Fraud Detection&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A new paper discussing &lt;a href=&#34;https://arxiv.org/abs/2504.10438&#34;&gt;Snowflake Dynamic Tables&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A Flink CDC Pipeline connector for Apache Iceberg &lt;a href=&#34;https://github.com/apache/flink-cdc/blob/master/docs/content/docs/connectors/pipeline-connectors/iceberg.md&#34;&gt;has been added into the project&lt;/a&gt; ahead of Flink CDC release 3.4.0&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/turbolytics/sql-flow&#34;&gt;SQLFlow: DuckDB for Streaming Data&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A good writeup of &lt;a href=&#34;https://blog.zomato.com/eliminating-bottlenecks-in-real-time-data-streaming-a-zomato-ads-flink-journey&#34;&gt;performance optimisations made in Zomato’s Flink data streaming pipeline&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.alibabacloud.com/blog/compare-flink-sql-and-datastream-api-comprehensive-guide-for-new-developers_602133&#34;&gt;Comparing Flink SQL and DataStream API&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.devgenius.io/build-kafka-streams-apps-faster-with-kstreamplify-and-spring-boot-86999d586024&#34;&gt;Build Kafka Streams Apps Faster&lt;/a&gt; with &lt;a href=&#34;https://github.com/michelin/kstreamplify&#34;&gt;kstreamplify&lt;/a&gt; and Spring Boot&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A proposal (SPIP) to add a &lt;a href=&#34;https://docs.google.com/document/d/1PsSTngFuRVEOvUGzp_25CQL1yfzFHFr02XdMfQ7jOM4/edit&#34;&gt;Declarative Pipeline Framework&lt;/a&gt; to Apache Spark&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Pedro Mazala writes about &lt;a href=&#34;https://pedromazala.substack.com/p/the-case-for-a-custom-window-in-flink&#34;&gt;The case for a Custom Window in Flink&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://community.alibabacloud.com/blog/flash-a-next-gen-vectorized-stream-processing-engine-compatible-with-apache-flink_602088&#34;&gt;Flash: A Next-gen Vectorized Stream Processing Engine Compatible with Apache Flink&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;A talk from Liang Wu about &lt;a href=&#34;https://youtu.be/jaLTCgFQL0E?feature=shared&amp;amp;t=170&#34;&gt;LinkedIn’s internal Darwin tool for running Flink SQL in a notebook-like interface&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_ai&#34;&gt;AI&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://arxiv.org/pdf/2501.18197&#34;&gt;Fundamental Challenges in Evaluating Text2SQL Solutions and Detecting Their Limitations&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.confluent.io/blog/ai-meal-planner/&#34;&gt;Meal planning with AI&lt;/a&gt; (not just AI, but &lt;em&gt;Event-Driven, Multi-Agent AI Architectures&lt;/em&gt; 😁)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://medium.com/trainline/a-day-in-the-life-of-a-ml-engineer-at-trainline-26eb420dcdba&#34;&gt;A Day in the Life of a ML Engineer at Trainline&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://medium.com/@gejing/hands-on-mcp-server-deep-dive-connecting-flink-sql-gateway-to-the-llm-ecosystem-fcbd24dca0ac&#34;&gt;Hands-on MCP Server Deep Dive: Connecting Flink SQL Gateway to the LLM Ecosystem&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_general_data_stuff&#34;&gt;General Data Stuff&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://buttondown.com/jaffray/archive/its-time-to-stop-building-kv-databases/&#34;&gt;It’s Time to Stop Building KV Databases&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://pgdog.dev/blog/hacking-postgres-wire-protocol&#34;&gt;Hacking the Postgres wire protocol&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Some interesting articles from LanceDB, including where they see &lt;a href=&#34;https://blog.lancedb.com/the-future-of-open-source-table-formats-iceberg-and-lance/&#34;&gt;The Future of Open Source Table Formats: Apache Iceberg and Lance&lt;/a&gt;, why LanceDB is a suitable &lt;a href=&#34;https://blog.lancedb.com/designing-a-table-format-for-ml-workloads/&#34;&gt;table format for ML Workloads&lt;/a&gt;, and details of &lt;a href=&#34;https://blog.lancedb.com/lance-file-2-1-smaller-and-simpler/&#34;&gt;Lance File 2.1: Smaller and Simpler&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Slides from a seminar given by Will Deakin using some excellent dataviz to tell us about the &lt;a href=&#34;https://itsleeds.github.io/tds/s2/&#34;&gt;UK rail network&lt;/a&gt; and its usage&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;CloudFlare have been busy, &lt;a href=&#34;https://blog.cloudflare.com/cloudflare-acquires-arroyo-pipelines-streaming-ingestion-beta/&#34;&gt;acquiring stream processing startup Arroyo&lt;/a&gt;, launching &lt;a href=&#34;https://blog.cloudflare.com/r2-data-catalog-public-beta/&#34;&gt;managed Apache Iceberg tables&lt;/a&gt;, and optimising their tool for &lt;a href=&#34;https://blog.cloudflare.com/making-super-slurper-five-times-faster/&#34;&gt;migrating data from other providers&amp;#39; object stores into their own&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I recently discovered &lt;a href=&#34;https://github.com/okbob/pspg&#34;&gt;okbob/pspg&lt;/a&gt; which is a very nice pager for working with database CLIs such as psql&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Details of v3 of LinkedIn’s Nuage tool, which they describe as a &lt;a href=&#34;https://www.linkedin.com/blog/engineering/infrastructure/journey-of-next-generation-control-plane-for-data-systems&#34;&gt;control plane for data systems&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;TigerBeetle recently published &lt;a href=&#34;https://github.com/tigerbeetle/tigerbeetle/blob/main/docs/internals/ARCHITECTURE.md&#34;&gt;a technical overview of the internals of TigerBeetle&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_data_in_action&#34;&gt;Data in Action&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;A couple of interesting blogs from Salesforce, covering &lt;a href=&#34;https://engineering.salesforce.com/scaling-real-time-search-to-30-billion-queries-with-sub-second-latency-and-0-downtime/&#34;&gt;handling a lot of search queries with sub-second latency&lt;/a&gt; and their use of &lt;a href=&#34;https://engineering.salesforce.com/how-to-etl-at-petabyte-scale-with-trino-5fe8ac134e36/&#34;&gt;Trino for ETL at Petabyte-Scale&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Some interesting blogs from Discord (both recently, and in the past), covering across various facets of their infrastructure &lt;a href=&#34;https://discord.com/blog/how-discord-stores-trillions-of-messages&#34;&gt;storage&lt;/a&gt;, &lt;a href=&#34;https://discord.com/blog/how-discord-indexes-billions-of-messages&#34;&gt;indexing&lt;/a&gt;, &lt;a href=&#34;https://discord.com/blog/how-discord-creates-insights-from-trillions-of-data-points&#34;&gt;processing&lt;/a&gt;, and their &lt;a href=&#34;https://discord.com/blog/overclocking-dbt-discords-custom-solution-in-processing-petabytes-of-data&#34;&gt;their use of dbt&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;I really enjoyed this article about how Zillow use &lt;a href=&#34;https://www.zillow.com/tech/leveraging-knowledge-graphs-in-real-estate-search/&#34;&gt;knowledge graphs to help people find a house to buy&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;One of the departments within Amazon built &lt;a href=&#34;https://hudi.apache.org/blog/2025/03/31/amazon-hudi/&#34;&gt;a data lake platform called Nexus around Spark and Hudi&lt;/a&gt;  (&lt;a href=&#34;https://www.youtube.com/watch?v=rMXhlb7Uci8&#34;&gt;recording&lt;/a&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Klaviyo wrote about the &lt;a href=&#34;https://klaviyo.tech/the-fun-bits-reimagining-our-event-analytics-platform-459b9edfdecf&#34;&gt;evolution of their event analytics platform to include Clickhouse&lt;/a&gt;, having originally &lt;a href=&#34;https://klaviyo.tech/real-time-analytics-with-high-cardinality-dataset-90a63028b6f6&#34;&gt;built it on Cassandra&lt;/a&gt; before adding &lt;a href=&#34;https://klaviyo.tech/scaling-klaviyos-real-time-analytics-system-with-stream-processing-4b3bb87cd6b5&#34;&gt;Kafka and Flink&lt;/a&gt; and (&lt;a href=&#34;https://klaviyo.tech/flinkperf-c7bd28acc67&#34;&gt;optimising it further&lt;/a&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;An account from Lyka of their &lt;a href=&#34;https://medium.com/@coreycheung/we-built-a-data-lakehouse-to-help-sell-dog-food-a94f6ea9c648&#34;&gt;migration from a data warehouse on BigQuery to a lakehouse using Iceberg on S3 with Athena, and data warehouse on Snowflake&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Details of how Adevinta moved from &lt;a href=&#34;https://medium.com/adevinta-tech-blog/from-lakehouse-architecture-to-data-mesh-c532c91f7b61&#34;&gt;a Medallion-based lakehouse architecture to one built around data contracts and data mesh&lt;/a&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_and_finally&#34;&gt;And finally…&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;Nothing to do with data, but stuff that I’ve found interesting or has made me smile.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;🔥 &lt;a href=&#34;https://brilliantcrank.com/eject-disk/&#34;&gt;Eject disk.&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.brooks.team/posts/how-to-bike-across-the-country/&#34;&gt;How to Bike Across the Country&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;a href=&#34;https://www.merriam-webster.com/grammar/em-dash-en-dash-how-to-use&#34;&gt;How to Use Em Dashes (—), En Dashes (–), and Hyphens (-)&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;hr/&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;div class=&#34;title&#34;&gt;Tip&lt;/div&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
If you like these kind of links you might like to read about &lt;a href=&#34;https://rmoff.net/2024/05/22/how-i-try-to-keep-up-with-the-data-tech-world-a-list-of-data-blogs/&#34;&gt;How I Try To Keep Up With The Data Tech World (A List of Data Blogs)&lt;/a&gt;
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    <item>
      <title>Confluent Cloud for Apache Flink - Exploring the API</title>
      <link>https://rmoff.net/2025/03/25/confluent-cloud-for-apache-flink-exploring-the-api/</link>
      <pubDate>2025-03-25</pubDate>
      
      <guid>https://rmoff.net/2025/03/25/confluent-cloud-for-apache-flink-exploring-the-api/</guid>
      <media:content xmlns:media="http://search.yahoo.com/mrss/" url="https://rmoff.net/images/2025/03/t_IMG_1431.webp" medium="image" type="image/jpg" width="100" height="100" />
      <description>&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;a href=&#34;https://www.confluent.io/en-gb/blog/serverless-flink-confluent-cloud-generally-available/&#34;&gt;Confluent Cloud for Apache Flink&lt;/a&gt; gives you access to run Flink workloads using a serverless platform on Confluent Cloud.
After &lt;a href=&#34;https://rmoff.net/2025/03/13/creating-an-http-source-connector-on-confluent-cloud-from-the-cli/&#34;&gt;poking around the Confluent Cloud API for configuring connectors&lt;/a&gt; I wanted to take a look at the same for Flink.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Using the API is useful particularly if you want to script a deployment, or automate a bulk operation that might be tiresome to do otherwise.
It’s also handy if you just prefer living in the CLI :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
As well as the Confluent Cloud API, there is the &lt;a href=&#34;https://docs.confluent.io/confluent-cli/current/overview.html&#34;&gt;Confluent CLI&lt;/a&gt; too with nice things like a &lt;a href=&#34;https://docs.confluent.io/confluent-cli/current/command-reference/flink/confluent_flink_shell.html&#34;&gt;Flink shell&lt;/a&gt; built in.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_understanding_the_deployment_model_within_confluent_cloud&#34;&gt;Understanding the deployment model within Confluent Cloud&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can hack away at the API blindly, hopping between HTTP error codes and the API docs, until you succeed.
I did this to start with, and I don’t recommend it.
Spending a bit of time understanding the basic model of components makes things much easier in the long run.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/03/cc-flink-01.svg&#34; alt=&#34;cc flink 01&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;One key thing to understand is that &lt;a href=&#34;https://docs.confluent.io/cloud/current/flink/overview.html#ccloud-flink-overview-metadata-mapping&#34;&gt;Flink on Confluent Cloud models Kafka topics as Flink tables&lt;/a&gt;.
Not only that, but the Confluent Cloud Environment is represented in Flink SQL as a catalog, and each Confluent Cloud Kafka cluster in Flink SQL as a database.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When it comes to running Flink SQL, each &lt;em&gt;statement&lt;/em&gt; runs within a &lt;a href=&#34;https://docs.confluent.io/cloud/current/flink/concepts/compute-pools.html&#34;&gt;&lt;em&gt;compute pool&lt;/em&gt;&lt;/a&gt;.
One compute pool can run many statements.
Each environment can have many compute pools, as can each cloud provider and region within the environment.
You might create multiple compute pools for the purpose of workload isolation, or cost management.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you want to work with Flink SQL interactively through Confluent Cloud’s web interface you’ll need a &lt;em&gt;workspace&lt;/em&gt;.
Each compute pool has one or more workspaces.
You don’t have to have a workspace if you’re only submitting Flink SQL through the API or CLI.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_authentication&#34;&gt;Authentication&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To use the Confluent Cloud API you need an API key.
More accurately, you probably need several API keys :)
API keys are &lt;a href=&#34;https://docs.confluent.io/cloud/current/security/authenticate/workload-identities/service-accounts/api-keys/overview.html#resource-scopes&#34;&gt;scoped to a particular resource&lt;/a&gt;; there is no such thing as &lt;a href=&#34;https://xkcd.com/149/&#34;&gt;&lt;code&gt;sudo make me a sandwich&lt;/code&gt;&lt;/a&gt; on Confluent Cloud.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/03/cc-flink-02.svg&#34; alt=&#34;cc flink 02&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To work with Flink you need an API key for the environment/cloud provider/region.
Note that this is at a different granularity than a Kafka cluster, for which the API key is per-cluster.
You’ll also want a &lt;code&gt;cloud&lt;/code&gt; API key for working with compute pools and API keys themselves.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To create an API key you can use the &lt;a href=&#34;https://docs.confluent.io/confluent-cli/current/command-reference/api-key/confluent_api-key_create.html&#34;&gt;Confluent CLI&lt;/a&gt;, the web UI, or &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/API-Keys-(iamv2)/operation/createIamV2ApiKey&#34;&gt;the API itself&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_lets_get_started&#34;&gt;🟢 Let’s get started! 🏁&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
In this article I’m using &lt;a href=&#34;https://httpie.io/&#34;&gt;httpie&lt;/a&gt; to make my &lt;code&gt;http&lt;/code&gt; calls, as I like the syntax.
If you prefer you can use &lt;code&gt;curl&lt;/code&gt; or any other tool that makes HTTP calls :)
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you don’t already have your Confluent Cloud environment set up, see &lt;a href=&#34;https://rmoff.net/2025/03/13/creating-an-http-source-connector-on-confluent-cloud-from-the-cli/#_setup&#34;&gt;my previous article&lt;/a&gt;.
In this we created a Confluent Cloud environment, a Kafka cluster in that environment, and also a Schema Registry which was implicitly created.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Set the environment ID as an environment variable:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_ENV&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;env-253ngy&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If you don’t know your environment ID, you can get it from the web UI:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/03/cc-flink-06.webp&#34; alt=&#34;cc flink 06&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ll set up an API key for the &lt;code&gt;cloud&lt;/code&gt; resource:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;$ &lt;/span&gt;confluent api-key create &lt;span style=&#34;color: #000080&#34;&gt;--resource&lt;/span&gt; cloud
It may take a couple of minutes &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;for &lt;/span&gt;the API key to be ready.
Save the API key and secret. The secret is not retrievable later.
+------------+------------------------------------------------------------------+
| API Key    | &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;(&lt;/span&gt;XXXmy-cloud-api-keyXXX&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;)&lt;/span&gt;                                         |
| API Secret | &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;(&lt;/span&gt;XXXmy-cloud-api-secretXXX&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;)&lt;/span&gt;                                      |
+------------+------------------------------------------------------------------+&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This API key I’ve set as an environment variable as we need it for interacting with compute pools, and to create an API key for the Flink resource.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=(&lt;/span&gt;XXXmy-cloud-api-keyXXX&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=(&lt;/span&gt;XXXmy-cloud-api-secretXXX&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Since Flink resources are region-specific I’m going to store the region details as environment variables too:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;REGION&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;us-west-2
&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CLOUD&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;aws&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_compute_pools&#34;&gt;Compute pools&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/03/cc-flink-cp.svg&#34; alt=&#34;cc flink cp&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Before we can do anything with Flink we need a &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Compute-Pools-(fcpmv2)&#34;&gt;compute pool&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_get_compute_pools&#34;&gt;Get compute pools&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Compute-Pools-(fcpmv2)/operation/listFcpmV2ComputePools&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s see which, if any, compute pools exist:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET https://api.confluent.cloud/fcpm/v2/compute-pools&lt;span style=&#34;color: #d14&#34;&gt;\?&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;environment&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock tip&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-tip&#34; title=&#34;Tip&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
The &lt;code&gt;--print b&lt;/code&gt; option is shorthand for &lt;code&gt;--print body&lt;/code&gt; which prints the response body and none of the noisy response headers.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The response shows us that there are no compute pools:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;api_version&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;fcpm/v2&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[],&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;ComputePoolList&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;metadata&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;first&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;next&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_create_a_compute_pool&#34;&gt;Create a compute pool&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Compute-Pools-(fcpmv2)/operation/createFcpmV2ComputePool&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Since we got an empty metadata response from the above query, let’s go ahead and create a compute pool.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;A compute pool has a defined capacity, expressed in CFUs.
As well as its capacity, we’ll give it a name and specify where it’s to be located in terms of environment, cloud provider, and region.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http POST https://api.confluent.cloud/fcpm/v2/compute-pools &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    spec:&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;{
        &amp;#34;display_name&amp;#34;: &amp;#34;my-new-flink-pool&amp;#34;,
        &amp;#34;cloud&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CLOUD&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
        &amp;#34;region&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$REGION&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
        &amp;#34;max_cfu&amp;#34;: 20,
        &amp;#34;environment&amp;#34;: {
            &amp;#34;id&amp;#34;:&amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;
            }
        }&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This returns a rich set of data, including the ID of the created pool.
We want to store this as we’ll need it later on.
We could copy and paste the ID from the JSON response into a manual &lt;code&gt;export&lt;/code&gt; command, but we’re not heathens here—let’s automate it!&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;response&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;http POST https://api.confluent.cloud/fcpm/v2/compute-pools &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    spec:&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;{
        &amp;#34;display_name&amp;#34;: &amp;#34;my-flink-pool-&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;date&lt;/span&gt; +%Y-%m-%d&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
        &amp;#34;cloud&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CLOUD&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
        &amp;#34;region&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$REGION&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
        &amp;#34;max_cfu&amp;#34;: 20,
        &amp;#34;environment&amp;#34;: {
            &amp;#34;id&amp;#34;:&amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;
            }
        }&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;

&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_COMPUTE_POOL_ID&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$response&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.id&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ve created a second compute pool, and this time captured the details about it into the &lt;code&gt;CNFL_COMPUTE_POOL_ID&lt;/code&gt; environment variable:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;$ &lt;/span&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_COMPUTE_POOL_ID&lt;/span&gt;

lfcp-kz3m1p&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s look at what we’ve now got in terms of compute pools:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;$ &lt;/span&gt;http GET https://api.confluent.cloud/fcpm/v2/compute-pools&lt;span style=&#34;color: #d14&#34;&gt;\?&lt;/span&gt;environment&lt;span style=&#34;color: #d14&#34;&gt;\=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    | jq &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.data[] | .spec.display_name + &amp;#34; (&amp;#34; + .id + &amp;#34;): &amp;#34; + .status.phase&amp;#39;&lt;/span&gt;

&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;AWS.us-west-2.env-253ngy.c267 (lfcp-mxd977): PROVISIONED&amp;#34;&lt;/span&gt;
&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;my-new-flink-pool (lfcp-8oxrj0): PROVISIONED&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_delete_a_compute_pool&#34;&gt;Delete a compute pool&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Compute-Pools-(fcpmv2)/operation/deleteFcpmV2ComputePool&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What about the &lt;code&gt;my-new-flink-pool&lt;/code&gt; compute pool that we created first—it seems a waste, if not downright confusing, to keep it lying around.
Plus it gives a good excuse to try out the delete API.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;First we need the compute pool’s ID, which we can see from the output above (&lt;code&gt;lfcp-8oxrj0&lt;/code&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Then we use the &lt;code&gt;DELETE&lt;/code&gt; method:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http DELETE https://api.confluent.cloud/fcpm/v2/compute-pools/lfcp-8oxrj0?environment&lt;span style=&#34;color: #d14&#34;&gt;\=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The return code should be &lt;code&gt;HTTP/1.1 204 No Content&lt;/code&gt; if successful.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect3&#34;&gt;
&lt;h4 id=&#34;_delete_all_compute_pools&#34;&gt;Delete all compute pools&lt;/h4&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;What about if we’ve been messing about and have a ton of compute pools that we want to get rid of all at once?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This is why I like using APIs, because you can start to chain specific things (managing compute pools) with general shell techniques—in this case, &lt;code&gt;xargs&lt;/code&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET https://api.confluent.cloud/fcpm/v2/compute-pools&lt;span style=&#34;color: #d14&#34;&gt;\?&lt;/span&gt;environment&lt;span style=&#34;color: #d14&#34;&gt;\=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b | &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.data[].id&amp;#39;&lt;/span&gt; | &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    xargs &lt;span style=&#34;color: #000080&#34;&gt;-Ifoo&lt;/span&gt; http DELETE https://api.confluent.cloud/fcpm/v2/compute-pools/foo&lt;span style=&#34;color: #d14&#34;&gt;\?&lt;/span&gt;environment&lt;span style=&#34;color: #d14&#34;&gt;\=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;(I’m using additional line continuation characters (&lt;code&gt;\&lt;/code&gt;) just to break the command up so you can see what the constituent parts of it are).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_a_side_step_regions&#34;&gt;A side step: Regions&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Regions-(fcpmv2)/operation/listFcpmV2Regions&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;No resource to create here, just query.
To interact with Flink we need to know the HTTP endpoint for the region in which the compute pool is located.
We can get this using the &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Regions-(fcpmv2)&#34;&gt;regions API&lt;/a&gt;:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;https://api.confluent.cloud/fcpm/v2/regions?cloud=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CLOUD&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;amp;region_name=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$REGION&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
        &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;api_version&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;fcpm/v2&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;api_version&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;fcpm/v2&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;cloud&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;AWS&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;display_name&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Oregon (us-west-2)&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;http_endpoint&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;https://flink.us-west-2.aws.confluent.cloud&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;id&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;aws.us-west-2&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Region&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;metadata&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
                &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;private_http_endpoint&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;https://flink.us-west-2.aws.private.confluent.cloud&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;region_name&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;us-west-2&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;],&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;RegionList&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;metadata&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;first&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;next&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;total_size&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;1&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;As above with the compute pool ID, I’m going to store the Flink API endpoint (&lt;code&gt;http_endpoint&lt;/code&gt;) in an environment variable:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_FLINK_API_URL&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
        http GET &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;https://api.confluent.cloud/fcpm/v2/regions?cloud=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CLOUD&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;amp;region_name=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$REGION&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
        &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.data[].http_endpoint&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_were_almost_ready_to_start_sending_flink_sql_to_confluent_cloud&#34;&gt;We’re almost ready to start sending Flink SQL to Confluent Cloud…&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We’ve created a compute pool, we’ve got the Flink API endpoint; we now just need a Flink API key.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_flink_api_key&#34;&gt;Flink API key&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;A Flink API key operates at the environment/cloud provider/region level.
Before we can generate it we need the ID of our user, which we can get from…the user API:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Users-(iamv2)/operation/listIamV2Users&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_USER&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;http GET https://api.confluent.cloud/iam/v2/users &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
                    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
                    jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.data[] | select (.full_name==&amp;#34;rmoff&amp;#34;) | .id&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
I’m hardcoding my username in here.
There may be a better way to do this :)
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Now we can create the Flink API key.
I’m going to do like we did with the compute pool and store the response in an environment variable:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/API-Keys-(iamv2)/operation/createIamV2ApiKey&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;response&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;http POST https://api.confluent.cloud/iam/v2/api-keys &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    spec:&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;{
        &amp;#34;owner&amp;#34;: {&amp;#34;id&amp;#34; :&amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_USER&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;},
        &amp;#34;resource&amp;#34;: {&amp;#34;id&amp;#34;:&amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CLOUD&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$REGION&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;}
    }&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;

&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$response&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.id&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$response&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.spec.secret&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect1&#34;&gt;
&lt;h2 id=&#34;_statements&#34;&gt;Statements&lt;/h2&gt;
&lt;div class=&#34;sectionbody&#34;&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/03/cc-flink-statements.svg&#34; alt=&#34;cc flink statements&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Statements are how you send Flink SQL to Confluent Cloud.
They need a compute pool and Flink API key, both of which we created above.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;There are just a few more variables that we need to set for when we call the statements API:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;ulist&#34;&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Organization ID, which we can get from the organisation API:&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_ORG&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;http GET &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;https://api.confluent.cloud/org/v2/organizations&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
        &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b | jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.data[].id&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;&lt;em&gt;This assumes that there is only one org; if that’s not the case you’ll need to amend it to use the correct one.&lt;/em&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;When you run a Flink SQL statement you need to provide a catalog (a Confluent Cloud environment) and database (a Kafka cluster) context.
This may or may not be the same as where the table you’re interacting with is located, but it must be provided nonetheless.
In the web UI it’s set by default so you may not even notice it—with the API you need to provide it explicitly.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Whilst we set the ID of the Confluent Cloud environment above, we need its &lt;em&gt;name&lt;/em&gt;:&lt;/p&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_ENV_NAME&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    http GET https://api.confluent.cloud/org/v2/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.display_name&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;For the Kafka cluster, here’s a way to pick the first Kafka cluster from your environment and get its ID and name:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;&lt;span style=&#34;color: #008080&#34;&gt;response&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;http GET &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;https://api.confluent.cloud/cmk/v2/clusters?environment=&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
            &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_CLOUD_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;

&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_KAFKA_CLUSTER&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$response&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.data[0].id&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;
&lt;span style=&#34;color: #0086B3&#34;&gt;export &lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;CNFL_KAFKA_CLUSTER_NAME&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$(&lt;/span&gt;&lt;span style=&#34;color: #0086B3&#34;&gt;echo&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$response&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.data[0].spec.display_name&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_list_statements&#34;&gt;List statements&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)/operation/listSqlv1Statements&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This will list all the statements that have been run in the environment:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;admonitionblock note&#34;&gt;
&lt;table&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td class=&#34;icon&#34;&gt;
&lt;i class=&#34;fa icon-note&#34; title=&#34;Note&#34;&gt;&lt;/i&gt;
&lt;/td&gt;
&lt;td class=&#34;content&#34;&gt;
The scope for this is the entire Flink deployment (environment/cloud provider/region), so you’ll see statements not just those on the compute pool you’ve created, or even only those on compute pools that currently exist.
This threw me at first, because if you’ve been running things in the Flink environment already you may well get a long list returned.
&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;With jq we can list just the statement names and status:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    jq &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.data[]| .name + &amp;#34;: &amp;#34; + .status.phase&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code&gt;&amp;#34;ctas-measures-20250318121833: STOPPED&amp;#34;
&amp;#34;ctas-measures-dim-20250318122944: STOPPED&amp;#34;
&amp;#34;ctas-readings-2025-03-18-10-43-45: FAILED&amp;#34;
&amp;#34;ctas-readings-2025-03-18-10-53-18: COMPLETED&amp;#34;
&amp;#34;ctas-readings-2025-03-18-11-23-20: FAILED&amp;#34;
&amp;#34;ctas-readings-enriched-20250318131826: FAILED&amp;#34;
&amp;#34;ctas-readings-enriched-20250318131958: FAILED&amp;#34;
&amp;#34;ctas-readings-enriched-20250318132444: STOPPED&amp;#34;
&amp;#34;ctas-stations-20250318122308: STOPPED&amp;#34;
&amp;#34;ctas-stations-dim-20250318123821: STOPPED&amp;#34;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_create_a_statement&#34;&gt;Create a statement&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)/operation/createSqlv1Statement&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;When you create a statement you need to specify the Flink SQL, compute pool ID, and then the environment name and Kafka cluster name as &lt;code&gt;properties&lt;/code&gt; for the catalog and database:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http POST &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;my-flink-sql-statement-00 &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    spec:&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;{
        &amp;#34;compute_pool_id&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_COMPUTE_POOL_ID&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
        &amp;#34;statement&amp;#34;: &amp;#34;CREATE TABLE foo AS SELECT name, COUNT(*) AS cnt FROM (VALUES (&amp;#39;&lt;/span&gt;Bob&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;), (&amp;#39;&lt;/span&gt;Alice&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;), (&amp;#39;&lt;/span&gt;Greg&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;), (&amp;#39;&lt;/span&gt;Bob&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;)) AS NameTable(name) GROUP BY name;&amp;#34;,
        &amp;#34;properties&amp;#34;: {
            &amp;#34;sql.current-catalog&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV_NAME&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
            &amp;#34;sql.current-database&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_KAFKA_CLUSTER_NAME&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;
        }
    }&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You can then fetch the statement back to see its status:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 API doc: &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)/operation/getSqlv1Statement&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements/my-flink-sql-statement-00 &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #a61717;background-color: #e3d2d2&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;]&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;spec&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;properties&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;sql.current-catalog&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;rmoff&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;sql.current-database&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;cluster00&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;statement&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;CREATE TABLE foo AS SELECT name, COUNT(*) AS cnt FROM (VALUES (Bob), (Alice), (Greg), (Bob)) AS NameTable(name) GROUP BY name;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #a61717;background-color: #e3d2d2&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;]&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;status&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;detail&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;SQL validation failed. Error from line 1, column 64 to line 1, column 66.&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\n\n&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Caused by: Column &amp;#39;Bob&amp;#39; not found in any table&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;network_kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;PUBLIC&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;phase&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;FAILED&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You’ll notice that it says &lt;code&gt;FAILED&lt;/code&gt;.
This is where we get into the fun of calling APIs from the shell.
Single quotes, double quotes…all are fun and have their own nuances to understand.
If we look carefully at the &lt;code&gt;statement&lt;/code&gt; value returned above we can see that indeed &lt;code&gt;Bob&lt;/code&gt; et al are no longer single quoted—but should be.
The single quotes got lost in the &lt;code&gt;http&lt;/code&gt; command submission.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s use proper quoting for the single quotes in the SQL:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http POST &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;my-flink-sql-statement-01 &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    spec:&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;{
        &amp;#34;compute_pool_id&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_COMPUTE_POOL_ID&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
        &amp;#34;statement&amp;#34;: &amp;#34;CREATE TABLE foo AS SELECT name, COUNT(*) AS cnt FROM (VALUES (&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;Bob&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;), (&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;Alice&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;), (&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;Greg&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;), (&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;Bob&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;)) AS NameTable(name) GROUP BY name;&amp;#34;,
        &amp;#34;properties&amp;#34;: {
            &amp;#34;sql.current-catalog&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV_NAME&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
            &amp;#34;sql.current-database&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_KAFKA_CLUSTER_NAME&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;
        }
    }&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This time the statement works:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt; http GET &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements/my-flink-sql-statement-01 &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | jq &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.status&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;detail&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;network_kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;PUBLIC&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;phase&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;COMPLETED&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;scaling_status&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;last_updated&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2025-03-26T10:25:58Z&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;scaling_state&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;OK&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;
  &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;traits&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;is_append_only&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;is_bounded&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;schema&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{},&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;sql_kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;CREATE_TABLE_AS&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;upsert_columns&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;null&lt;/span&gt;
  &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If we load up the Confluent Cloud web UI we can see that the table has indeed been created:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/03/cc-flink-03.webp&#34; alt=&#34;cc flink 03&#34; width=&#34;25%&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Can we get this information (i.e. a list of tables) for ourselves from the API?&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;We can, and it’s a good excuse to look at how we get the &lt;em&gt;results&lt;/em&gt; from a statement.
So far we’ve just run a statement with no result set—it just created a table.
Like many databases, Flink SQL on Confluent Cloud provides an information schema that holds metadata about the contents of the database.
Let’s run a query to show all &amp;#39;tables&amp;#39; (topics) in a &amp;#39;database&amp;#39; (Kafka cluster).&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http POST &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #008080&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;list-tables-00 &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    spec:&lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;=&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;{
        &amp;#34;compute_pool_id&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_COMPUTE_POOL_ID&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
        &amp;#34;statement&amp;#34;: &amp;#34;SELECT * FROM `INFORMATION_SCHEMA`.`TABLES` WHERE TABLE_TYPE = &amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;BASE TABLE&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39; AND TABLE_CATALOG_ID = &amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39; AND TABLE_SCHEMA_ID = &amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_KAFKA_CLUSTER&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;\&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
        &amp;#34;properties&amp;#34;: {
            &amp;#34;sql.current-catalog&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV_NAME&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;,
            &amp;#34;sql.current-database&amp;#34;: &amp;#34;&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_KAFKA_CLUSTER_NAME&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;&amp;#34;
        }
    }&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This time, when we fetch the &lt;code&gt;status&lt;/code&gt; of the statement, it’s not just &lt;code&gt;COMPLETED&lt;/code&gt; but gives us information about the schema of the resultset:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements/list-tables-00 &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | jq &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.status&amp;#39;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
  &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;detail&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;network_kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;PUBLIC&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;phase&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;COMPLETED&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
  &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;traits&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;is_append_only&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;is_bounded&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;true&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;schema&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
      &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;columns&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
          &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;TABLE_CATALOG_ID&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
          &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;length&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2147483647&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;nullable&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
          &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;
        &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
          &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;name&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;TABLE_CATALOG&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
          &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;length&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;2147483647&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;nullable&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;false&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
            &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;type&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;VARCHAR&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
          &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;&lt;span style=&#34;color: #a61717;background-color: #e3d2d2&#34;&gt;…&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But what about the data itself?&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_reading_the_results_from_a_statement&#34;&gt;Reading the results from a statement&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 API doc: &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Statement-Results-(sqlv1)/operation/getSqlv1StatementResult&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To get the results from a statement you use the &lt;code&gt;/results&lt;/code&gt; endpoint against the statement name, thus:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements/list-tables-00/results &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;The schema we got from the statement endpoint above (&lt;code&gt;status.traits.schema&lt;/code&gt;), so the resultset just gives us the actual data:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;api_version&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;sql/v1&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;StatementResult&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;metadata&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2025-03-26T10:41:55.989063Z&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;next&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;https://flink.us-west-2.aws.confluent.cloud/sql/v1/organizations/178cb46b-d78e-435d-8b6e-d8d023a08e6f/environments/env-253ngy/statements/list-tables-00/res
ults&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;results&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
                &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;row&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;env-253ngy&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;rmoff&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;lkc-qnygo6&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;cluster00&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;foo&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;BASE TABLE&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;YES&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;HASH&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;6&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;YES&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;$rowtime&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;`SOURCE_WATERMARK`()&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;YES&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #000000;font-weight: bold&#34;&gt;null&lt;/span&gt;
                &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;]&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If there is more than one page of data you’ll need to use the &lt;code&gt;next&lt;/code&gt; element to get the actual path for the results, as shown in this example:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements/my-flink-sql-statement-02/results &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;api_version&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;sql/v1&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;StatementResult&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;metadata&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2025-03-31T10:12:14.066138521Z&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;next&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;https://flink.us-west-2.aws.confluent.cloud/sql/v1/organizations/178cb46b-d78e-435d-8b6e-d8d023a08e6f/environments/env-253ngy/statements/my-flink-sql-statement-02/results?page_token=eyJWZXJzaW9uIjoiZTg3N2E5NjktMWRiNS00ZjMxLTk4YTEtNWY4Zjkx
MWRjYmIzIiwiT2Zmc2V0IjowfS43YjIyNTY2NTcyNzM2OTZmNmUyMjNhMjI2NTM4MzczNzYxMzkzNjM5MmQzMTY0NjIzNTJkMzQ2NjMzMzEyZDM5Mzg2MTMxMmQzNTY2Mzg2NjM5MzEzMTY0NjM2MjYyMzMyMjJjMjI0ZjY2NjY3MzY1NzQyMjNhMzA3ZGZiZGIxZDFiMThhYTZjMDgzMjRiN2Q2NGI3MWZiNzYzNzA2OTBlMWQ&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;https://flink.us-west-2.aws.confluent.cloud/sql/v1/organizations/178cb46b-d78e-435d-8b6e-d8d023a08e6f/environments/env-253ngy/statements/my-flink-sql-statement-02/results&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;results&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[]&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;
&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;So now we run a &lt;code&gt;GET&lt;/code&gt; against the &lt;code&gt;metadata.next&lt;/code&gt; URL that we got:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET https://flink.us-west-2.aws.confluent.cloud/sql/v1/organizations/178cb46b-d78e-435d-8b6e-d8d023a08e6f/environments/env-253ngy/statements/my-flink-sql-statement-02/results&lt;span style=&#34;color: #d14&#34;&gt;\?&lt;/span&gt;page_token&lt;span style=&#34;color: #d14&#34;&gt;\=&lt;/span&gt;eyJWZXJzaW9uIjoiZTg3N2E5NjktMWRiNS00ZjMxLTk4YTEtNWY4ZjkxMWRjYmIzIiwiT2Zmc2V0IjowfS43YjIyNTY2NTcyNzM2OTZmNmUyMjNhMjI2NTM4MzczNzYxMzkzNjM5MmQzMTY0NjIzNTJkMzQ2NjMzMzEyZDM5Mzg2MTMxMmQzNTY2Mzg2NjM5MzEzMTY0NjM2MjYyMzMyMjJjMjI0ZjY2NjY3MzY1NzQyMjNhMzA3ZGZiZGIxZDFiMThhYTZjMDgzMjRiN2Q2NGI3MWZiNzYzNzA2OTBlMWQ &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span style=&#34;color: #000080&#34;&gt;--print&lt;/span&gt; b&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;This gives us the actual results (along with an updated &lt;code&gt;metadata.next&lt;/code&gt; for the next page of results):&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;javascript&#34;&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;api_version&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;sql/v1&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;kind&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;StatementResult&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;metadata&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;created_at&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2025-03-31T10:15:25.540107018Z&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;next&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;https://flink.us-west-2.aws.confluent.cloud/sql/v1/organizations/178cb46b-d78e-435d-8b6e-d8d023a08e6f/environments/env-253ngy/statements/my-flink-sql-statement-02/results?page_token=eyJWZXJzaW9uIjoiZTg3N2E5NjktMWRiNS00ZjMxLTk4YTEtNWY4ZjkxMWRjYmIzIiwiT2Zmc2V0Ijo3MDE4fS43YjIyNTY2NTcyNzM2OTZmNmUyMjNhMjI2NTM4MzczNzYxMzkzNjM5MmQzMTY0NjIzNTJkMzQ2NjMzMzEyZDM5Mzg2MTMxMmQzNTY2Mzg2NjM5MzEzMTY0NjM2MjYyMzMyMjJjMjI0ZjY2NjY3MzY1NzQyMjNhMzczMDMxMzg3ZGZiZGIxZDFiMThhYTZjMDgzMjRiN2Q2NGI3MWZiNzYzNzA2OTBlMWQ&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;self&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;https://flink.us-west-2.aws.confluent.cloud/sql/v1/organizations/178cb46b-d78e-435d-8b6e-d8d023a08e6f/environments/env-253ngy/statements/my-flink-sql-statement-02/results&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
    &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;results&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
        &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;data&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;{&lt;/span&gt;
                &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;op&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;color: #009999&#34;&gt;0&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;row&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;:&lt;/span&gt; &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;[&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2025-03-13 22:30:00.000&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2653-level-stage-i-15_min-mASD&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;0.089&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Water Level&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;mASD&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Merestones Road&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Cheltenham&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Hatherley Brook&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Severn Vale&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Cheltenham, Merestones Rd LVL - level-stage-i-15_min-mASD&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;900&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;Stage&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;instantaneous&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2653&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;2007-01-05&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;393651&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;220825&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;51.88594&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;background-color: #f8f8f8&#34;&gt;,&lt;/span&gt;
                    &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;-2.093645&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;
                &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;]&lt;/span&gt;
            &lt;span style=&#34;background-color: #f8f8f8&#34;&gt;},&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;But—as much as I am a fan of using APIs as a quick and powerful way to interact with something, reading SQL results is where I draw the line; trying to piece the above resultset manually together is not my idea of fun—and is why the Confluent Cloud Flink Workspace is a much nicer way to do this:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/03/cc-flink-04.webp&#34; alt=&#34;cc flink 04&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;or the Confluent CLI Flink shell:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;imageblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;img src=&#34;https://rmoff.net/images/2025/03/cc-flink-05.webp&#34; alt=&#34;cc flink 05&#34; width=&#34;50%&#34;/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;sect2&#34;&gt;
&lt;h3 id=&#34;_delete_statements&#34;&gt;Delete statements&lt;/h3&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;📕 &lt;a href=&#34;https://docs.confluent.io/cloud/current/api.html#tag/Statements-(sqlv1)/operation/deleteSqlv1Statement&#34;&gt;API doc&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;Let’s wrap up by tidying up after ourselves, and looking at how to delete statements.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;To delete a statement use the &lt;code&gt;DELETE&lt;/code&gt; method on the statement’s endpoint using its name:&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http DELETE &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements/list-tables-00 &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;You’ll get a &lt;code&gt;HTTP/1.1 202 Accepted&lt;/code&gt; response if successful.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;paragraph&#34;&gt;
&lt;p&gt;If we want to clean up your environment and delete all statements you can use something like the following.
Use it very carefully; it’ll literally delete all the statements with no undo.&lt;/p&gt;
&lt;/div&gt;
&lt;div class=&#34;listingblock&#34;&gt;
&lt;div class=&#34;content&#34;&gt;
&lt;pre class=&#34;rouge highlight&#34; style=&#34;background-color: #f8f8f8&#34;&gt;&lt;code data-lang=&#34;bash&#34;&gt;http GET &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt; | &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    jq &lt;span style=&#34;color: #000080&#34;&gt;-r&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#39;.data[].name&amp;#39;&lt;/span&gt; | &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    xargs &lt;span style=&#34;color: #000080&#34;&gt;-Ifoo&lt;/span&gt; http DELETE &lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_URL&lt;/span&gt;/sql/v1/organizations/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ORG&lt;/span&gt;/environments/&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_ENV&lt;/span&gt;/statements/foo &lt;span style=&#34;color: #d14&#34;&gt;\&lt;/span&gt;
    &lt;span style=&#34;color: #000080&#34;&gt;--auth&lt;/span&gt; &lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_KEY&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;:&lt;/span&gt;&lt;span style=&#34;color: #008080&#34;&gt;$CNFL_FLINK_API_SECRET&lt;/span&gt;&lt;span style=&#34;color: #d14&#34;&gt;&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
    </item>
    
  </channel>
</rss>