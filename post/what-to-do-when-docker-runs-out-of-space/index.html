<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>What to Do When Docker on the Mac Runs Out of Space</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.github.io/index.xml">
		<link rel="canonical" href="https://rmoff.github.io/post/what-to-do-when-docker-runs-out-of-space/">
		
		<link rel="shortcut icon" type="image/png" href="https://rmoff.github.io/apple-touch-icon-precomposed.png">
		<meta name="description" content="Quick tips on getting Docker up and running again">
		
		<meta name="generator" content="Hugo 0.52" />

		
		<meta name="og:title" content="What to Do When Docker on the Mac Runs Out of Space" />
		<meta name="og:type" content="article" />
		<meta name="og:image" content="https://rmoff.github.io/img/default-header-img.jpg" />
		<meta name="og:description" content="Quick tips on getting Docker up and running again" />
		<meta name="og:url" content="https://rmoff.github.io/post/what-to-do-when-docker-runs-out-of-space/" />
		<meta name="og:site_name" content="What to Do When Docker on the Mac Runs Out of Space" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.github.io/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.github.io/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.github.io/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.github.io/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.github.io/img/default-header-img.jpg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.github.io" title="Home">
						<img src="https://rmoff.github.io/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="/about-me/">about</a>
						<a class="link f5 ml2 dim near-white" href="/talks/">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.github.io/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.github.io/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">What to Do When Docker on the Mac Runs Out of Space</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2019-01-09T10:18:20Z">Jan 9, 2019</time>
								<span class="display-print">by Robin Moffatt</span>
								 in <a href="https://rmoff.github.io/categories//docker" class="no-underline category near-white dim">Docker</a>
								<span class="display-print">at https://rmoff.github.io/post/what-to-do-when-docker-runs-out-of-space/</span>
							
						
					</h2>
				</div>

				
				
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 nested-copy-line-height lh-copy f4 nested-links mw-100 measure-wide">
	<div class="paragraph">
<p>I use Docker and Docker Compose <em>a lot</em>. Like, every day. It&#8217;s a fantastic way to build repeatable demos and examples, that can be torn down and spun up in a repeatable way. But…what happens when the demo that was working is spun up and then tail spins down in a blaze of flames?</p>
</div>
<div class="paragraph">
<p>Here&#8217;s the excerpt of a log from my Oracle container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker-compose up -d  ; docker-compose logs -f oracle
Recreating connect-jdbc_oracle_1_4be0ad4479f8 ...
connect-jdbc_mssql_1_eb2a015c90b2 is up-to-date
connect-jdbc_zookeeper_1_948bd8f572fb is up-to-date
Starting connect-jdbc_mysql_1_88681355e0c9    ...
Starting connect-jdbc_postgres_1_69535455d741 ...
connect-jdbc_kafka_1_8b8a8c2b124d is up-to-date
connect-jdbc_schema-registry_1_f5e9a2675ed1 is up-to-date
Recreating connect-jdbc_oracle_1_4be0ad4479f8 ... done
Starting connect-jdbc_mysql_1_88681355e0c9    ... done
Starting connect-jdbc_postgres_1_69535455d741 ... done
Attaching to connect-jdbc_oracle_1_4be0ad4479f8
oracle_1_4be0ad4479f8 | ORACLE PASSWORD FOR SYS, SYSTEM AND PDBADMIN: Admin123
oracle_1_4be0ad4479f8 | cp: error writing '/opt/oracle/dbca.rsp': No space left on device
oracle_1_4be0ad4479f8 | cp: failed to extend '/opt/oracle/dbca.rsp': No space left on device
oracle_1_4be0ad4479f8 | mv: cannot stat '/opt/oracle/product/12.2.0.1/dbhome_1/dbs/spfileORCLCDB.ora': No such file or directory
oracle_1_4be0ad4479f8 | mv: cannot stat '/opt/oracle/product/12.2.0.1/dbhome_1/dbs/orapwORCLCDB': No such file or directory
oracle_1_4be0ad4479f8 | mv: cannot stat '/opt/oracle/product/12.2.0.1/dbhome_1/network/admin/sqlnet.ora': No such file or directory
oracle_1_4be0ad4479f8 | mv: cannot stat '/opt/oracle/product/12.2.0.1/dbhome_1/network/admin/listener.ora': No such file or directory
oracle_1_4be0ad4479f8 | mv: cannot stat '/opt/oracle/product/12.2.0.1/dbhome_1/network/admin/tnsnames.ora': No such file or directory
oracle_1_4be0ad4479f8 | cp: error writing '/etc/oratab': No space left on device
oracle_1_4be0ad4479f8 | cp: failed to extend '/etc/oratab': No space left on device
oracle_1_4be0ad4479f8 | ORACLE_HOME = [/home/oracle] ? ORACLE_BASE environment variable is not being set since this
oracle_1_4be0ad4479f8 | information is not available for the current user ID .
oracle_1_4be0ad4479f8 | You can set ORACLE_BASE manually if it is required.
oracle_1_4be0ad4479f8 | Resetting ORACLE_BASE to its previous value or ORACLE_HOME
oracle_1_4be0ad4479f8 | The Oracle base remains unchanged with value /opt/oracle
oracle_1_4be0ad4479f8 | /opt/oracle/checkDBStatus.sh: line 27: cannot create temp file for here-document: No space left on device
oracle_1_4be0ad4479f8 | tail: cannot open '/opt/oracle/diag/rdbms/*/*/trace/alert*.log' for reading: No such file or directory
oracle_1_4be0ad4479f8 | tail: no files remaining
oracle_1_4be0ad4479f8 | #####################################
oracle_1_4be0ad4479f8 | ########### E R R O R ###############
oracle_1_4be0ad4479f8 | DATABASE SETUP WAS NOT SUCCESSFUL!
oracle_1_4be0ad4479f8 | Please check output for further info!
oracle_1_4be0ad4479f8 | ########### E R R O R ###############
oracle_1_4be0ad4479f8 | #####################################</code></pre>
</div>
</div>
<div class="paragraph">
<p>Argh! It was working just yesterday!</p>
</div>
<div class="paragraph">
<p>If you check out the space that Docker&#8217;s using, you&#8217;ll see it can be quite a hog</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker system df
TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE
Images              86                  7                   36.87GB             35.87GB (97%)
Containers          13                  0                   76.66MB             76.66MB (100%)
Local Volumes       586                 9                   36.88GB             36.67GB (99%)
Build Cache         0                   0                   0B                  0B</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s over 70Gb of space!</p>
</div>
<div class="paragraph">
<p>If you load up the Docker UI you&#8217;ll see that it&#8217;s got a fixed size for the disk image that contains all the Docker data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2019/01/2019-01-09_10-48-49.png" alt="2019 01 09 10 48 49">
</div>
</div>
<div class="paragraph">
<p>You could increase this size, or you could tidy up some of the unused content. You can prune these down easily, using the <code>prune</code> command. Go carefully though, because if you trash all your images then they&#8217;re going to have to be pulled back down from their repository or rebuilt, and that can take some time. Don&#8217;t do it just before you need to run the demo…</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can do <code>docker system prune -af</code> but this trashes <strong>everything</strong>. I&#8217;d recommend taking a more structured approach to it, as shown below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Pruning the unused volumes and stopped containers is easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker volume prune
WARNING! This will remove all local volumes not used by at least one container.
Are you sure you want to continue? [y/N] y
Deleted Volumes:
dc502ff65c2dc5b51272834d7a6c58a36e8560876125b0b74f6024162fb28186
…
93d2e9fa57442a2f1a1837a7ecf14b069179bb814351e2888bdd0cfcd12d19dd

Total reclaimed space: 36.67GB</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker container prune
WARNING! This will remove all stopped containers.
Are you sure you want to continue? [y/N] y
Deleted Containers:
…
bf8b43823b644c238b3d1e8722a6ad9383b2162a6d0a4d80bcc5c661c91ade32

Total reclaimed space: 76.66MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can do the same with images, but I don&#8217;t want to trash <em>all</em> my images, so I cheat and use a GUI - the excellent <a href="https://www.portainer.io/">Portainer</a> (which itself can be run under Docker 😃)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2019/01/2019-01-09_10-25-34.png" alt="2019 01 09 10 25 34">
</div>
</div>
<div class="paragraph">
<p>Now my Docker has a bit more space to breathe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ docker system df
TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE
Images              33                  1                   17.2GB              17.15GB (99%)
Containers          1                   1                   0B                  0B
Local Volumes       1                   1                   33.57kB             0B (0%)
Build Cache         0                   0                   0B                  0B</code></pre>
</div>
</div>

</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					
				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.github.io/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2019 Robin Moffatt
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
