<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2023/04/h_IMG_8828.jpeg" >
		
		<title>Building Better Docs - Automating Jekyll Builds and Link Checking for PRs</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2023/04/20/building-better-docs-automating-jekyll-builds-and-link-checking-for-prs/">
		
		

		
		<meta property="og:title" content="Building Better Docs - Automating Jekyll Builds and Link Checking for PRs" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2023/04/h_IMG_8828.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2023/04/20/building-better-docs-automating-jekyll-builds-and-link-checking-for-prs/" />
		<meta property="og:site_name" content="Building Better Docs - Automating Jekyll Builds and Link Checking for PRs" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2023/04/h_IMG_8828.jpeg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Building Better Docs - Automating Jekyll Builds and Link Checking for PRs</h1>
			<p class="article-hero-meta">
				
					<time datetime="2023-04-20T08:54:11Z">20 Apr 2023</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/documentation">Documentation</a>, <a href="https://rmoff.net/categories/jekyll">Jekyll</a>, <a href="https://rmoff.net/categories/github-actions">GitHub Actions</a>
					<span class="display-print">at https://rmoff.net/2023/04/20/building-better-docs-automating-jekyll-builds-and-link-checking-for-prs/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#github-actions-are-magic">GitHub Actions are MAGIC</a></li>
    <li><a href="#triggering-the-action">Triggering the Action</a></li>
    <li><a href="#build-the-docs-site">Build the docs site</a></li>
    <li><a href="#deploy-a-preview-of-docs-changes">Deploy a Preview of Docs Changes</a></li>
    <li><a href="#checking-for-broken-links">Checking for Broken Links</a></li>
    <li><a href="#go-and-try-it-out">Go and try it out</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Documentation</span><span data-pagefind-filter="category" style="display:none">Jekyll</span><span data-pagefind-filter="category" style="display:none">GitHub Actions</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2023/04/h_IMG_8828.jpeg" style="display:none" alt="">
	<p>One of the most important ways that a project can help its developers is providing them good documentation. Actually, scratch that. <em>Great</em> documentation.</p>
<p><img src="/images/2023/04/Pasted%20image%2020230419164830.png" alt="Kathy Sierra - If you want them to RTFM, make a better FM"></p>
<p>The <a href="https://docs.lakefs.io/">lakeFS documentation</a> is built as a static site using <a href="https://jekyllrb.com/">Jekyll</a> and the <a href="https://just-the-docs.github.io/just-the-docs/">Just the Docs</a> theme, hosted on <a href="https://pages.github.com/">GitHub Pages</a>. The documentation itself is stored on GitHub, and <em>any</em> changes to it go through a PR review process.</p>
<p>There were two points of friction that I wanted to fix to make it easily and quicker to improve the docs:</p>
<ol>
<li>
<p>The local build process for docs was not instantaneous, meaning that <em>contributors</em> would either just not test their changes (&quot;<em>it&rsquo;s just a small docs change&quot;</em>, amiright?), or would diligently test them and wasting literally minutes between each build (if you&rsquo;ve any tips to fix this <a href="https://github.com/treeverse/lakeFS/issues/5404">let me know</a>!). On top of this, reviewers of PRs would need to clone the repo and build the docs site to be able to review the changes properly‚Ä¶so very tedious</p>
<p><img src="/images/2023/04/zzzzzzz-gif.gif" alt="BORING"></p>
</li>
<li>
<p>There were broken links, and no automated checking on incoming Pull Requests (PRs) that a change didn&rsquo;t break things further.</p>
</li>
</ol>
<h2 id="github-actions-are-magic">GitHub Actions are MAGIC&nbsp;<a class="headline-hash" href="#github-actions-are-magic">üîó</a> </h2>
<p>If you&rsquo;re already using GitHub PRs then using <a href="https://docs.github.com/en/actions">Actions</a> fits in with the workflow beautifully. Actions are defined per-repository and can be triggered by, amongst other things, a new PR. Actions can do lots of things including building and testing your code itself. The two actions I set up do the following:</p>
<ol>
<li>Build the docs site from the code in the PR, and deploy it as a static site hosted temporarily on surge.sh</li>
<li>Run a link checker on the whole site, and if broken links are found fail the job ‚ùå and log the problems</li>
</ol>
<p>You can see the action definition <a href="https://github.com/treeverse/lakeFS/blob/master/.github/workflows/docs-pr.yaml">here</a> - feel free to take it and customise it for your own use! Below I explain a bit more about how each works.</p>
<h2 id="triggering-the-action">Triggering the Action&nbsp;<a class="headline-hash" href="#triggering-the-action">üîó</a> </h2>
<p>The action is triggered by any PR to <code>master</code> branch and touching files under <code>/docs</code> (there&rsquo;s no point rebuilding the docs site if it&rsquo;s only code in the repo that changed and not docs)</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">on</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">pull_request</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">paths</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>- <span style="color:#ba2121">&#34;docs/**&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">branches</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>- master<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="build-the-docs-site">Build the docs site&nbsp;<a class="headline-hash" href="#build-the-docs-site">üîó</a> </h2>
<p>The action runs as a single job covering both purposes (preview deploy, and link checker). I guess it could be split and the build run twice. The job is executed on a container (defined in the <code>runs-on: ubuntu-20.04</code> step) that lives for the duration of the job.</p>
<p>The build itself is just as it is in the live docs deployment, running Jekyll&rsquo;s <code>build</code> command against the <code>docs</code> folder of the repo and writing the static site to a <code>_site</code> path on the container.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>Build latest<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">id</span>:<span style="color:#bbb"> </span>build-latest<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">working-directory</span>:<span style="color:#bbb"> </span>docs<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">run</span>:<span style="color:#bbb"> </span>bundle exec jekyll build --config _config.yml -d _site/ --verbose<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="deploy-a-preview-of-docs-changes">Deploy a Preview of Docs Changes&nbsp;<a class="headline-hash" href="#deploy-a-preview-of-docs-changes">üîó</a> </h2>
<p>Before deploying the preview the action some shell script which overlays on each page of the docs site a label to show that it&rsquo;s a preview build, and linking back to the PR from which it was generated:</p>
<p><img src="/images/2023/04/CleanShot_2023-04-19_at_17.47.05.png" alt=""></p>
<p>I wish I could claim credit for the code, but it was all the handiwork of chatGPT (pretty cool, right!). This updates the HTML files in place.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>Overlay PR message on each page<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">working-directory</span>:<span style="color:#bbb"> </span>docs/_site<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">run</span>:<span style="color:#bbb"> </span>|<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span>PR_URL=${{ github.event.pull_request.html_url }}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span>PR_NUMBER=${{ github.event.pull_request.number }}<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span>html_files=$(find . -name &#39;*.html&#39;)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span>for file in $html_files; do<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">		</span>sed -i -e &#34;s|\(.*\)\(&lt;/body&gt;\)|&lt;div style=\&#34;position: fixed; top: 5px; left: 5px; padding: 3px; background-color:<span style="color:#bbb"> </span><span style="color:#408080;font-style:italic">#e8ac07; font-weight: bold; z-index: 9999; box-shadow: 0 0 10px rgba(0,0,0,0.5);\&#34;&gt;‚ÑπÔ∏è This is a preview of PR &lt;a href=\&#34;$PR_URL\&#34; style=\&#34;color: black;\&#34;&gt;#$PR_NUMBER&lt;/a&gt;&lt;/div&gt;\n\1\2|&#34; $file</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span>done<span style="color:#bbb">
</span></span></span></code></pre></div><p>The next step then uses a <a href="https://github.com/afc163/surge-preview">pre-built Action</a> to deploy a given folder to <a href="https://surge.sh/">surge.sh</a> (a static site hosting service which provides a free plan that&rsquo;s perfect for this use). You can read more about setting up surge.sh <a href="/2022/04/06/using-github-actions-to-build-automagic-hugo-previews-of-draft-articles/#_setting_up_an_account_on_surge_sh">here</a>.</p>
<p>The action also updates the PR itself with the link to the preview, so the submitter and reviewer both can easily see the impact of the PR on the docs site.</p>
<p><img src="/images/2023/04/CleanShot_2023-04-19_at_17.51.29.png" alt=""></p>
<h2 id="checking-for-broken-links">Checking for Broken Links&nbsp;<a class="headline-hash" href="#checking-for-broken-links">üîó</a> </h2>
<p>This requires a single step in the job to invoke the link checking tool <a href="https://lychee.cli.rs/">lychee</a> using the supplied <a href="https://github.com/lycheeverse/lychee-action">GitHub Action</a></p>
<p>The root of the built docs site (<code>docs/_site</code> ) is supplied as the first argument, along with an exclusion file of pages and URLs to not check. I added to this things like URLs in the documentation that referred to sample instances of the lakeFS server (e.g. http://127.0.0.1:8000 is indeed a link, but not a link that we want to check because it&rsquo;s not going to be valid). Some other external sites also needed adding to the ignore file as they appeared to block the automated checking and caused false positives.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#bbb">  </span>- <span style="color:#008000;font-weight:bold">name</span>:<span style="color:#bbb"> </span>Check links<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">id</span>:<span style="color:#bbb"> </span>lychee<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">uses</span>:<span style="color:#bbb"> </span>lycheeverse/lychee-action@v1.6.1<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">with</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span><span style="color:#008000;font-weight:bold">args</span>:<span style="color:#bbb"> </span>docs/_site --no-progress --exclude-file=docs/.lycheeignore<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span><span style="color:#008000;font-weight:bold">fail</span>:<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span><span style="color:#008000;font-weight:bold">jobSummary</span>:<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">true</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span><span style="color:#008000;font-weight:bold">format</span>:<span style="color:#bbb"> </span>markdown<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">env</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	  </span><span style="color:#008000;font-weight:bold">GITHUB_TOKEN</span>:<span style="color:#bbb"> </span>${{secrets.GITHUB_TOKEN}}<span style="color:#bbb">
</span></span></span></code></pre></div><p>If any broken links are found the Action logs these in a very readable and useful way:</p>
<p><img src="/images/2023/04/CleanShot_2023-04-19_at_17.58.16.png" alt=""></p>
<h2 id="go-and-try-it-out">Go and try it out&nbsp;<a class="headline-hash" href="#go-and-try-it-out">üîó</a> </h2>
<p>The GitHub Action configuration that I used is <a href="https://github.com/treeverse/lakeFS/blob/master/.github/workflows/docs-pr.yaml">here</a>. Give it a try, and let me know any other cool tricks you have for keeping documentation in tip-top shape :)</p>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#github-actions-are-magic">GitHub Actions are MAGIC</a></li>
    <li><a href="#triggering-the-action">Triggering the Action</a></li>
    <li><a href="#build-the-docs-site">Build the docs site</a></li>
    <li><a href="#deploy-a-preview-of-docs-changes">Deploy a Preview of Docs Changes</a></li>
    <li><a href="#checking-for-broken-links">Checking for Broken Links</a></li>
    <li><a href="#go-and-try-it-out">Go and try it out</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
