<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Aligning mismatched Parquet schemas in DuckDB</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2023/03/03/aligning-mismatched-parquet-schemas-in-duckdb/">
		
		
		
		

		
		<meta property="og:title" content="Aligning mismatched Parquet schemas in DuckDB" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2023/03/h_IMG_8795.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2023/03/03/aligning-mismatched-parquet-schemas-in-duckdb/" />
		<meta property="og:site_name" content="Aligning mismatched Parquet schemas in DuckDB" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		
		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only' 
                })
		</script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/images/2023/03/h_IMG_8795.jpeg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://bsky.app/profile/rmoff.net"><i class="fa-brands fa-bluesky"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://data-folks.masto.host/@rmoff"><i class="fab fa-mastodon"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Aligning mismatched Parquet schemas in DuckDB</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2023-03-03T14:36:08Z">Mar 3, 2023</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/duckdb" class="no-underline category near-white dim">DuckDB</a>, <a href="https://rmoff.net/categories/parquet" class="no-underline category near-white dim">Parquet</a>
								<span class="display-print">at https://rmoff.net/2023/03/03/aligning-mismatched-parquet-schemas-in-duckdb/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="https://bsky.app/profile/rmoff.net" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw8">
	<p>What do you do when you want to query over multiple parquet files but the schemas don&rsquo;t quite line up? Let&rsquo;s find out 👇🏻</p>
<p>I&rsquo;ve got a set of parquet files in S3 (well, lakeFS<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, but let&rsquo;s not quibble over details) with the same datail split by year:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ lakectl fs ls lakefs://drones03/main/drone-registrations/
</span></span><span style="display:flex;"><span>object          2023-03-01 09:47:36 +0000 UTC    30.7 kB         Registations-P107-Active-2016.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:48:54 +0000 UTC    119.7 kB        Registations-P107-Active-2017.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:44:47 +0000 UTC    594.3 kB        Registations-P107-Active-2018.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:45:04 +0000 UTC    1.3 MB          Registations-P107-Active-2019.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:48:12 +0000 UTC    2.8 MB          Registations-P107-Active-2020.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:48:51 +0000 UTC    3.2 MB          Registations-P107-Active-2021.parquet
</span></span></code></pre></div><p>I want to query and manipulate the data. DuckDB is my friend since it works with <a href="https://duckdb.org/docs/data/parquet">parquet files</a>. I fire it up with an empty database:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ duckdb drones.duckdb
</span></span></code></pre></div><p>A <code>DESCRIBE</code> gives me the schema:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">DESCRIBE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>)<span style="color:#bbb"> </span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">┌─────────────────────────┬─────────────┬─────────┬─────────┬─────────┬─────────┐</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000;font-weight:bold">column_name</span><span style="color:#bbb">       </span><span style="">│</span><span style="color:#bbb"> </span>column_type<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">null</span><span style="color:#bbb">   </span><span style="">│</span><span style="color:#bbb">   </span><span style="color:#008000;font-weight:bold">key</span><span style="color:#bbb">   </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">default</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">  </span>extra<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">         </span><span style="color:#008000">varchar</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">   </span><span style="color:#008000">varchar</span><span style="color:#bbb">   </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">varchar</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">varchar</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">varchar</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">varchar</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">├─────────────────────────┼─────────────┼─────────┼─────────┼─────────┼─────────┤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Registration<span style="color:#bbb"> </span><span style="color:#008000">Date</span><span style="color:#bbb">       </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Registion<span style="color:#bbb"> </span>Expire<span style="color:#bbb"> </span>Dt<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Asset<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Type</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>RID<span style="color:#bbb"> </span>Equipped<span style="color:#bbb">            </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">BOOLEAN</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Asset<span style="color:#bbb"> </span>Model<span style="color:#bbb">             </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>City<span style="color:#bbb">           </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">State</span><span style="color:#666">/</span>Province<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">    </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">BIGINT</span><span style="color:#bbb">      </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>City<span style="color:#bbb">            </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">State</span><span style="color:#666">/</span>Province<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000">BIGINT</span><span style="color:#bbb">      </span><span style="">│</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">├─────────────────────────┴─────────────┴─────────┴─────────┴─────────┴─────────┤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">11</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb">                                                             </span><span style="color:#666">6</span><span style="color:#bbb"> </span>columns<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">└───────────────────────────────────────────────────────────────────────────────┘</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>Now I should be able to query a <a href="https://duckdb.org/docs/sql/query_syntax/sample">sample</a> of the data to check it out, right. Right?</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">100</span><span style="color:#666">%</span><span style="color:#bbb"> </span><span style="">▕████████████████████████████████████████████████████████████▏</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Error:<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Conversion</span><span style="color:#bbb"> </span>Error:<span style="color:#bbb"> </span>Could<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">convert</span><span style="color:#bbb"> </span>string<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;V1M 2K9&#39;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">to</span><span style="color:#bbb"> </span>INT64<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="spoiler-union_by_name">Spoiler: <code>UNION_BY_NAME</code>&nbsp;<a class="headline-hash" href="#spoiler-union_by_name">🔗</a> </h2>
<p>After posting this blog, two people both suggested using the <code>UNION_BY_NAME</code> option which was <a href="https://github.com/duckdb/duckdb/pull/5716">added to DuckDB recently</a>. This worked perfectly:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>union_by_name<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">True</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">100</span><span style="color:#666">%</span><span style="color:#bbb"> </span><span style="">▕████████████████████████████████████████████████████████████▏</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">┌──────────────────────┬─────────────────────┬───────────────┬──────────────┬───┬──────────────────────┬──────────────┬──────────────────────┬─────────────────────┐</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">  </span>Registration<span style="color:#bbb"> </span><span style="color:#008000">Date</span><span style="color:#bbb">   </span><span style="">│</span><span style="color:#bbb"> </span>Registion<span style="color:#bbb"> </span>Expire<span style="color:#bbb"> </span>Dt<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">  </span>Asset<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Type</span><span style="color:#bbb">   </span><span style="">│</span><span style="color:#bbb"> </span>RID<span style="color:#bbb"> </span>Equipped<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>City<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">State</span><span style="color:#666">/</span>Prov<span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">       </span><span style="">│</span><span style="color:#bbb">    </span><span style="color:#008000">varchar</span><span style="color:#bbb">    </span><span style="">│</span><span style="color:#bbb">   </span><span style="color:#008000">boolean</span><span style="color:#bbb">    </span><span style="">│</span><span style="color:#bbb">   </span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb">   </span><span style="color:#008000">varchar</span><span style="color:#bbb">    </span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">       </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">├──────────────────────┼─────────────────────┼───────────────┼──────────────┼───┼──────────────────────┼──────────────┼──────────────────────┼─────────────────────┤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2021</span><span style="color:#666">-</span><span style="color:#666">09</span><span style="color:#666">-</span><span style="color:#666">27</span><span style="color:#bbb"> </span><span style="color:#666">17</span>:<span style="color:#666">17</span>:<span style="color:#666">1</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2024</span><span style="color:#666">-</span><span style="color:#666">09</span><span style="color:#666">-</span><span style="color:#666">27</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>HOMEBUILT_UAS<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">false</span><span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">32177</span><span style="color:#bbb">                </span><span style="">│</span><span style="color:#bbb"> </span>Palatka<span style="color:#bbb">      </span><span style="">│</span><span style="color:#bbb"> </span>FL<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">32177</span><span style="color:#bbb">               </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2020</span><span style="color:#666">-</span><span style="color:#666">12</span><span style="color:#666">-</span><span style="color:#666">06</span><span style="color:#bbb"> </span><span style="color:#666">02</span>:<span style="color:#666">18</span>:<span style="color:#666">5</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2023</span><span style="color:#666">-</span><span style="color:#666">12</span><span style="color:#666">-</span><span style="color:#666">05</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">10065</span><span style="color:#bbb">                </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">New</span><span style="color:#bbb"> </span>York<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb"> </span>NY<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">10065</span><span style="color:#bbb">               </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2019</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">08</span><span style="color:#bbb"> </span><span style="color:#666">15</span>:<span style="color:#666">33</span>:<span style="color:#666">3</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">08</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">83706</span><span style="color:#bbb">                </span><span style="">│</span><span style="color:#bbb"> </span>Boise<span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb"> </span>ID<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">83706</span><span style="color:#bbb">               </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2020</span><span style="color:#666">-</span><span style="color:#666">12</span><span style="color:#666">-</span><span style="color:#666">03</span><span style="color:#bbb"> </span><span style="color:#666">14</span>:<span style="color:#666">26</span>:<span style="color:#666">0</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2023</span><span style="color:#666">-</span><span style="color:#666">12</span><span style="color:#666">-</span><span style="color:#666">03</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">49506</span><span style="color:#bbb">                </span><span style="">│</span><span style="color:#bbb"> </span>Grand<span style="color:#bbb"> </span>Rapids<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>MI<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">49506</span><span style="color:#bbb">               </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2020</span><span style="color:#666">-</span><span style="color:#666">01</span><span style="color:#666">-</span><span style="color:#666">27</span><span style="color:#bbb"> </span><span style="color:#666">18</span>:<span style="color:#666">57</span>:<span style="color:#666">0</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2023</span><span style="color:#666">-</span><span style="color:#666">01</span><span style="color:#666">-</span><span style="color:#666">27</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>HOME_BUILT<span style="color:#bbb">    </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">35758</span><span style="color:#bbb">                </span><span style="">│</span><span style="color:#bbb"> </span>Madison<span style="color:#bbb">      </span><span style="">│</span><span style="color:#bbb"> </span>AL<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">35758</span><span style="color:#bbb">               </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">├──────────────────────┴─────────────────────┴───────────────┴──────────────┴───┴──────────────────────┴──────────────┴──────────────────────┴─────────────────────┤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb">                                                                                                                                      </span><span style="color:#666">11</span><span style="color:#bbb"> </span>columns<span style="color:#bbb"> </span>(<span style="color:#666">8</span><span style="color:#bbb"> </span>shown)<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>Thanks <a href="https://twitter.com/mraasveldt"><code>@mraasveldt</code></a> and <a href="https://twitter.com/__AlexMonahan__"><code>@__AlexMonahan__</code></a>👍🏻</p>
<p>Problem solved. But if you want to follow along with another option, read on…</p>
<h2 id="back-to-the-detective-story">Back to the Detective Story&nbsp;<a class="headline-hash" href="#back-to-the-detective-story">🔗</a> </h2>
<p>So, we have this problem:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">100</span><span style="color:#666">%</span><span style="color:#bbb"> </span><span style="">▕████████████████████████████████████████████████████████████▏</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Error:<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Conversion</span><span style="color:#bbb"> </span>Error:<span style="color:#bbb"> </span>Could<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">convert</span><span style="color:#bbb"> </span>string<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;V1M 2K9&#39;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">to</span><span style="color:#bbb"> </span>INT64<span style="color:#bbb">
</span></span></span></code></pre></div><p>Huh. That sucks. Let&rsquo;s try it on a single file:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">┌──────────────────────┬─────────────────────┬─────────────────┬──────────────┬───┬──────────────────────┬────────────────┬──────────────────────┬─────────────────────┐</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">  </span>Registration<span style="color:#bbb"> </span><span style="color:#008000">Date</span><span style="color:#bbb">   </span><span style="">│</span><span style="color:#bbb"> </span>Registion<span style="color:#bbb"> </span>Expire<span style="color:#bbb"> </span>Dt<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">   </span>Asset<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Type</span><span style="color:#bbb">    </span><span style="">│</span><span style="color:#bbb"> </span>RID<span style="color:#bbb"> </span>Equipped<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">  </span>Mailing<span style="color:#bbb"> </span>City<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">State</span><span style="color:#666">/</span>Prov<span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">       </span><span style="">│</span><span style="color:#bbb">     </span><span style="color:#008000">varchar</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">   </span><span style="color:#008000">boolean</span><span style="color:#bbb">    </span><span style="">│</span><span style="color:#bbb">   </span><span style="">│</span><span style="color:#bbb">        </span>int64<span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">    </span><span style="color:#008000">varchar</span><span style="color:#bbb">     </span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb">        </span>int64<span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">├──────────────────────┼─────────────────────┼─────────────────┼──────────────┼───┼──────────────────────┼────────────────┼──────────────────────┼─────────────────────┤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">09</span><span style="color:#666">-</span><span style="color:#666">28</span><span style="color:#bbb"> </span><span style="color:#666">19</span>:<span style="color:#666">27</span>:<span style="color:#666">5</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2025</span><span style="color:#666">-</span><span style="color:#666">09</span><span style="color:#666">-</span><span style="color:#666">28</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>TRADITIONAL_UAS<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">false</span><span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">                </span><span style="color:#666">80203</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Denver<span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb"> </span>CO<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb">               </span><span style="color:#666">80203</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">26</span><span style="color:#bbb"> </span><span style="color:#666">13</span>:<span style="color:#666">10</span>:<span style="color:#666">2</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">26</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">       </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">                </span><span style="color:#666">33611</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Tampa<span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>FL<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb">               </span><span style="color:#666">33611</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">25</span><span style="color:#bbb"> </span><span style="color:#666">15</span>:<span style="color:#666">58</span>:<span style="color:#666">4</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">25</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">       </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">                </span><span style="color:#666">23337</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Wallops<span style="color:#bbb"> </span>Island<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>VA<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb">               </span><span style="color:#666">23337</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">11</span><span style="color:#666">-</span><span style="color:#666">30</span><span style="color:#bbb"> </span><span style="color:#666">17</span>:<span style="color:#666">17</span>:<span style="color:#666">1</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">11</span><span style="color:#666">-</span><span style="color:#666">30</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">       </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">                </span><span style="color:#666">32114</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Daytona<span style="color:#bbb"> </span>Beach<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>FL<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb">               </span><span style="color:#666">32114</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">25</span><span style="color:#bbb"> </span><span style="color:#666">15</span>:<span style="color:#666">58</span>:<span style="color:#666">4</span><span style="">…</span><span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">25</span><span style="color:#bbb">          </span><span style="">│</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">       </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb"> </span><span style="">…</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">                </span><span style="color:#666">23337</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Wallops<span style="color:#bbb"> </span>Island<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>VA<span style="color:#bbb">                   </span><span style="">│</span><span style="color:#bbb">               </span><span style="color:#666">23337</span><span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">├──────────────────────┴─────────────────────┴─────────────────┴──────────────┴───┴──────────────────────┴────────────────┴──────────────────────┴─────────────────────┤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb">                                                                                                                                          </span><span style="color:#666">11</span><span style="color:#bbb"> </span>columns<span style="color:#bbb"> </span>(<span style="color:#666">8</span><span style="color:#bbb"> </span>shown)<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>D<span style="color:#bbb">
</span></span></span></code></pre></div><p>That works, so we&rsquo;re going to have to narrow down the problem. <em>As a side note, I should probably log an enhancement request for more detailed error messages (for example, which file had the error, and which field).</em></p>
<p>Looking at the error message there&rsquo;s a data type problem with an <code>INT64</code> field (<code>BIGINT</code>). In the schema there are two fields with that:</p>
<pre tabindex="0"><code>Physical Postal Code
Mailing Postal Code
</code></pre><p>DuckDB&rsquo;s <a href="https://duckdb.org/docs/data/parquet#parquet-schema">parquet docs page</a> points me to the <code>parquet_schema</code> function, so let&rsquo;s have a look at these fields over the files in question:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>file_name,<span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">type</span>,<span style="color:#bbb"> </span>logical_type<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>parquet_schema(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>name<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">like</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;%Postal Code%&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">┌──────────────────────────────────────────────────────────────────────────────┬──────────────────────┬────────────┬──────────────┐</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">                                  </span>file_name<span style="color:#bbb">                                   </span><span style="">│</span><span style="color:#bbb">         </span>name<span style="color:#bbb">         </span><span style="">│</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">type</span><span style="color:#bbb">    </span><span style="">│</span><span style="color:#bbb"> </span>logical_type<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">                                   </span><span style="color:#008000">varchar</span><span style="color:#bbb">                                    </span><span style="">│</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">│</span><span style="color:#bbb">  </span><span style="color:#008000">varchar</span><span style="color:#bbb">   </span><span style="">│</span><span style="color:#bbb">   </span><span style="color:#008000">varchar</span><span style="color:#bbb">    </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">├──────────────────────────────────────────────────────────────────────────────┼──────────────────────┼────────────┼──────────────┤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2016</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>INT64<span style="color:#bbb">      </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2016</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>INT64<span style="color:#bbb">      </span><span style="">│</span><span style="color:#bbb">              </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2017</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2017</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2018</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2018</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2019</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2019</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2020</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2020</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2021</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2021</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">│</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">├──────────────────────────────────────────────────────────────────────────────┴──────────────────────┴────────────┴──────────────┤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span><span style="color:#666">12</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb">                                                                                                               </span><span style="color:#666">4</span><span style="color:#bbb"> </span>columns<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>So there&rsquo;s the problem; the 2016 file uses <code>INT64</code> for those fields whilst the remaining files use a string. The <code>SELECT</code> that I ran above against all the files failed because when it tried to apply the schema of the first file against the data read from the others it ended up trying to convert a string to a number, which is never going to end well.</p>
<p>Here&rsquo;s one way to fix things with a <code>UNION ALL</code>. Note the use of <code>filename</code> metadata column to help verify the data we&rsquo;re getting is what&rsquo;s expected. To start with let&rsquo;s just try it against two files:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span></code></pre></div><pre tabindex="0"><code>┌──────────────────────────────────────────────────────────────────────────────┬──────────────────────┐
│                                   filename                                   │ Physical Postal Code │
│                                   varchar                                    │       varchar        │
├──────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 80237                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 35222                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 36112                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 87123                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 35806                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet │ 68179                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet │ 32114                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet │ 93637                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet │ 33611                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet │ 36112                │
├──────────────────────────────────────────────────────────────────────────────┴──────────────────────┤
│ 10 rows                                                                                   2 columns │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre><p>Now we just need to specify the remainder of the files. Previously we wildcarded, but we can&rsquo;t include the 2016 file in that (since we&rsquo;re handling that with a <code>CAST</code> in the first block of the <code>UNION</code>), so we need to modify it. We&rsquo;ll test our new selection pattern first:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>filename;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">┌──────────────────────────────────────────────────────────────────────────────┐</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">                                   </span>filename<span style="color:#bbb">                                   </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb">                                   </span><span style="color:#008000">varchar</span><span style="color:#bbb">                                    </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">├──────────────────────────────────────────────────────────────────────────────┤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2018</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2019</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2017</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2020</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">│</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2021</span>.parquet<span style="color:#bbb"> </span><span style="">│</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">└──────────────────────────────────────────────────────────────────────────────┘</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>Let&rsquo;s test this with the <code>UNION</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span></code></pre></div><pre tabindex="0"><code>┌──────────────────────────────────────────────────────────────────────────────┬──────────────────────┐
│                                   filename                                   │ Physical Postal Code │
│                                   varchar                                    │       varchar        │
├──────────────────────────────────────────────────────────────────────────────┼──────────────────────┤
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 87123                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 32114                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 67301                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 35806                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │ 32114                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet │ 35806                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │ 98290                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │ 07641                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │ 33133                │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │ 20166                │
├──────────────────────────────────────────────────────────────────────────────┴──────────────────────┤
│ 10 rows                                                                                   2 columns │
└─────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre><p>Now we can put this all together to do what we were trying to do in the first place; look at a sample of rows from across the set of files - but making allowances for the mismatched datatypes of the schema.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>x<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>(<span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">   </span><span style="color:#ba2121">&#34;Registration Date&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Registion Expire Dt&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Type&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;RID Equipped&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Model&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">    </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">   </span>read_parquet<span style="color:#bbb">  </span>([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">10</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span></code></pre></div><pre tabindex="0"><code>┌────────────────────────────┬─────────────────────┬─────────────────┬──────────────┬──────────────────┬───────────────┬─────────────────────────┬──────────────────────┬──────────────┬────────────────────────┬─────────────────────┬──────────────────────────────────────────────────────────────────────────────┐
│     Registration Date      │ Registion Expire Dt │   Asset Type    │ RID Equipped │   Asset Model    │ Physical City │ Physical State/Province │ Physical Postal Code │ Mailing City │ Mailing State/Province │ Mailing Postal Code │                                   filename                                   │
│          varchar           │       varchar       │     varchar     │   boolean    │     varchar      │    varchar    │         varchar         │       varchar        │   varchar    │        varchar         │       varchar       │                                   varchar                                    │
├────────────────────────────┼─────────────────────┼─────────────────┼──────────────┼──────────────────┼───────────────┼─────────────────────────┼──────────────────────┼──────────────┼────────────────────────┼─────────────────────┼──────────────────────────────────────────────────────────────────────────────┤
│ 2021-03-24 13:35:06.817000 │ 2024-03-24          │ TRADITIONAL_UAS │ false        │ Phantom 4 Pro V2 │ Minneapolis   │ MN                      │ 55423                │ Minneapolis  │ MN                     │ 55423               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │
│ 2021-12-06 12:43:38.265000 │ 2024-12-06          │ TRADITIONAL_UAS │ false        │ Air 2S           │ Wo;;ots       │ CA                      │ 95490                │ Wo;;ots      │ CA                     │ 95490               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │
│ 2021-12-11 01:49:20.235000 │ 2024-12-10          │ TRADITIONAL_UAS │ false        │ Mavic Air        │ Rocklin       │ CA                      │ 95677                │ Rocklin      │ CA                     │ 95677               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │
│ 2020-06-01 12:43:09.114000 │ 2023-06-01          │ PURCHASED       │              │ Mavic 2 Air      │ Loveland      │ CO                      │ 80538                │ Loveland     │ CO                     │ 80538               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2020.parquet │
│ 2021-10-19 22:03:03.630000 │ 2024-10-19          │ HOMEBUILT_UAS   │ false        │ X1               │ Philadelphia  │ PA                      │ 19146                │ Philadelphia │ PA                     │ 19146               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │
│ 2020-12-31 00:59:16.326000 │ 2023-12-30          │ PURCHASED       │              │ SP7100           │ Cornelius     │ OR                      │ 97113                │ Cornelius    │ OR                     │ 97113               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2020.parquet │
│ 2020-10-14 18:31:39.662000 │ 2023-10-14          │ PURCHASED       │              │ Phantom Rtk 4    │ San Antonio   │ TX                      │ 78216                │ San Antonio  │ TX                     │ 78216               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2020.parquet │
│ 2019-05-14 23:10:35.507000 │ 2025-05-14          │ TRADITIONAL_UAS │ false        │ Mavic Pro 2      │ Greensboro    │ NC                      │ 27409                │ Greensboro   │ NC                     │ 27409               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2019.parquet │
│ 2019-05-29 14:50:18.922000 │ 2025-05-29          │ TRADITIONAL_UAS │ false        │ Phantom 4 Pro    │ Brighton      │ CO                      │ 80601                │ Brighton     │ CO                     │ 80601               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2019.parquet │
│ 2021-02-06 14:56:38.651000 │ 2024-02-06          │ PURCHASED       │              │ Mavic 2 Pro      │ Louisville    │ KY                      │ 40204                │ Louisville   │ KY                     │ 40204               │ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │
├────────────────────────────┴─────────────────────┴─────────────────┴──────────────┴──────────────────┴───────────────┴─────────────────────────┴──────────────────────┴──────────────┴────────────────────────┴─────────────────────┴──────────────────────────────────────────────────────────────────────────────┤
│ 10 rows                                                                                                                                                                                                                                                                                                 12 columns │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
</code></pre><p>This looks good, but we should check we&rsquo;re getting data from all files. We&rsquo;ll do that with a <code>COUNT</code> aggregate against the CTE:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>x<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>(<span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">   </span><span style="color:#ba2121">&#34;Registration Date&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Registion Expire Dt&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Type&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;RID Equipped&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Model&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">    </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">   </span>read_parquet<span style="color:#bbb">  </span>([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">COUNT</span>(<span style="color:#666">*</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>x<span style="color:#bbb"> 
</span></span></span><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>filename;</span></span></code></pre></div>
<pre tabindex="0"><code>┌──────────────────────────────────────────────────────────────────────────────┬──────────────┐
│                                   filename                                   │ count_star() │
│                                   varchar                                    │    int64     │
├──────────────────────────────────────────────────────────────────────────────┼──────────────┤
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet │         1280 │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet │         5819 │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2018.parquet │        24695 │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2019.parquet │        60105 │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2020.parquet │       143670 │
│ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet │       162826 │
└──────────────────────────────────────────────────────────────────────────────┴──────────────┘
</code></pre><p>Looks good to me!</p>
<p>For a finishing touch we could even wrap it in a <code>VIEW</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sql" data-lang="sql"><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">OR</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">REPLACE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">VIEW</span><span style="color:#bbb"> </span>Registations_P107_Active<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>x<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>(<span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">   </span><span style="color:#ba2121">&#34;Registration Date&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Registion Expire Dt&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Type&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;RID Equipped&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Model&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">    </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">   </span>read_parquet<span style="color:#bbb">  </span>([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>x;</span></span></code></pre></div>
<p>Which then can be used the same as above like this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">COUNT</span>(<span style="color:#666">*</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>Registations_P107_Active<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>filename;<span style="color:#bbb">
</span></span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><em>DID YOU KNOW…you can work with Parquet files in lakeFS directly from DuckDB? I didn&rsquo;t until I read <a href="https://docs.lakefs.io/integrations/duckdb.html">this doc</a></em> :)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><a href="https://bsky.app/profile/rmoff.net"><b class="fa-brands fa-bluesky"></b></a>  <em>Robin Moffatt works on the DevRel team at Confluent. He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2025 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
