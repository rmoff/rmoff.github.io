<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2023/03/h_IMG_8795.jpeg" >
		
		<title>Aligning mismatched Parquet schemas in DuckDB</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2023/03/03/aligning-mismatched-parquet-schemas-in-duckdb/">
		
		

		
		<meta property="og:title" content="Aligning mismatched Parquet schemas in DuckDB" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2023/03/h_IMG_8795.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2023/03/03/aligning-mismatched-parquet-schemas-in-duckdb/" />
		<meta property="og:site_name" content="Aligning mismatched Parquet schemas in DuckDB" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2023/03/h_IMG_8795.jpeg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Aligning mismatched Parquet schemas in DuckDB</h1>
			<p class="article-hero-meta">
				
					<time datetime="2023-03-03T14:36:08Z">03 Mar 2023</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/duckdb">DuckDB</a>, <a href="https://rmoff.net/categories/parquet">Parquet</a>
					<span class="display-print">at https://rmoff.net/2023/03/03/aligning-mismatched-parquet-schemas-in-duckdb/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#spoiler-union_by_name">Spoiler: <code>UNION_BY_NAME</code></a></li>
    <li><a href="#back-to-the-detective-story">Back to the Detective Story</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">DuckDB</span><span data-pagefind-filter="category" style="display:none">Parquet</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2023/03/h_IMG_8795.jpeg" style="display:none" alt="">
	<p>What do you do when you want to query over multiple parquet files but the schemas don&rsquo;t quite line up? Let&rsquo;s find out ğŸ‘‡ğŸ»</p>
<p>I&rsquo;ve got a set of parquet files in S3 (well, lakeFS<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, but let&rsquo;s not quibble over details) with the same datail split by year:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ lakectl fs ls lakefs://drones03/main/drone-registrations/
</span></span><span style="display:flex;"><span>object          2023-03-01 09:47:36 +0000 UTC    30.7 kB         Registations-P107-Active-2016.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:48:54 +0000 UTC    119.7 kB        Registations-P107-Active-2017.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:44:47 +0000 UTC    594.3 kB        Registations-P107-Active-2018.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:45:04 +0000 UTC    1.3 MB          Registations-P107-Active-2019.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:48:12 +0000 UTC    2.8 MB          Registations-P107-Active-2020.parquet
</span></span><span style="display:flex;"><span>object          2023-03-01 09:48:51 +0000 UTC    3.2 MB          Registations-P107-Active-2021.parquet
</span></span></code></pre></div><p>I want to query and manipulate the data. DuckDB is my friend since it works with <a href="https://duckdb.org/docs/data/parquet">parquet files</a>. I fire it up with an empty database:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ duckdb drones.duckdb
</span></span></code></pre></div><p>A <code>DESCRIBE</code> gives me the schema:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">DESCRIBE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>)<span style="color:#bbb"> </span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000;font-weight:bold">column_name</span><span style="color:#bbb">       </span><span style="">â”‚</span><span style="color:#bbb"> </span>column_type<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">null</span><span style="color:#bbb">   </span><span style="">â”‚</span><span style="color:#bbb">   </span><span style="color:#008000;font-weight:bold">key</span><span style="color:#bbb">   </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">default</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">  </span>extra<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="color:#008000">varchar</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">   </span><span style="color:#008000">varchar</span><span style="color:#bbb">   </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">varchar</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">varchar</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">varchar</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">varchar</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Registration<span style="color:#bbb"> </span><span style="color:#008000">Date</span><span style="color:#bbb">       </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Registion<span style="color:#bbb"> </span>Expire<span style="color:#bbb"> </span>Dt<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Asset<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Type</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>RID<span style="color:#bbb"> </span>Equipped<span style="color:#bbb">            </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">BOOLEAN</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Asset<span style="color:#bbb"> </span>Model<span style="color:#bbb">             </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>City<span style="color:#bbb">           </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">State</span><span style="color:#666">/</span>Province<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">    </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">BIGINT</span><span style="color:#bbb">      </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>City<span style="color:#bbb">            </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">State</span><span style="color:#666">/</span>Province<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000">BIGINT</span><span style="color:#bbb">      </span><span style="">â”‚</span><span style="color:#bbb"> </span>YES<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">11</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb">                                                             </span><span style="color:#666">6</span><span style="color:#bbb"> </span>columns<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>Now I should be able to query a <a href="https://duckdb.org/docs/sql/query_syntax/sample">sample</a> of the data to check it out, right. Right?</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">100</span><span style="color:#666">%</span><span style="color:#bbb"> </span><span style="">â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Error:<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Conversion</span><span style="color:#bbb"> </span>Error:<span style="color:#bbb"> </span>Could<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">convert</span><span style="color:#bbb"> </span>string<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;V1M 2K9&#39;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">to</span><span style="color:#bbb"> </span>INT64<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="spoiler-union_by_name">Spoiler: <code>UNION_BY_NAME</code>&nbsp;<a class="headline-hash" href="#spoiler-union_by_name">ğŸ”—</a> </h2>
<p>After posting this blog, two people both suggested using the <code>UNION_BY_NAME</code> option which was <a href="https://github.com/duckdb/duckdb/pull/5716">added to DuckDB recently</a>. This worked perfectly:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                      </span>union_by_name<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">True</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">100</span><span style="color:#666">%</span><span style="color:#bbb"> </span><span style="">â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">  </span>Registration<span style="color:#bbb"> </span><span style="color:#008000">Date</span><span style="color:#bbb">   </span><span style="">â”‚</span><span style="color:#bbb"> </span>Registion<span style="color:#bbb"> </span>Expire<span style="color:#bbb"> </span>Dt<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">  </span>Asset<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Type</span><span style="color:#bbb">   </span><span style="">â”‚</span><span style="color:#bbb"> </span>RID<span style="color:#bbb"> </span>Equipped<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>City<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">State</span><span style="color:#666">/</span>Prov<span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">       </span><span style="">â”‚</span><span style="color:#bbb">    </span><span style="color:#008000">varchar</span><span style="color:#bbb">    </span><span style="">â”‚</span><span style="color:#bbb">   </span><span style="color:#008000">boolean</span><span style="color:#bbb">    </span><span style="">â”‚</span><span style="color:#bbb">   </span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb">   </span><span style="color:#008000">varchar</span><span style="color:#bbb">    </span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">       </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2021</span><span style="color:#666">-</span><span style="color:#666">09</span><span style="color:#666">-</span><span style="color:#666">27</span><span style="color:#bbb"> </span><span style="color:#666">17</span>:<span style="color:#666">17</span>:<span style="color:#666">1</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2024</span><span style="color:#666">-</span><span style="color:#666">09</span><span style="color:#666">-</span><span style="color:#666">27</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>HOMEBUILT_UAS<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">false</span><span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">32177</span><span style="color:#bbb">                </span><span style="">â”‚</span><span style="color:#bbb"> </span>Palatka<span style="color:#bbb">      </span><span style="">â”‚</span><span style="color:#bbb"> </span>FL<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">32177</span><span style="color:#bbb">               </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2020</span><span style="color:#666">-</span><span style="color:#666">12</span><span style="color:#666">-</span><span style="color:#666">06</span><span style="color:#bbb"> </span><span style="color:#666">02</span>:<span style="color:#666">18</span>:<span style="color:#666">5</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2023</span><span style="color:#666">-</span><span style="color:#666">12</span><span style="color:#666">-</span><span style="color:#666">05</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">10065</span><span style="color:#bbb">                </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">New</span><span style="color:#bbb"> </span>York<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb"> </span>NY<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">10065</span><span style="color:#bbb">               </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2019</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">08</span><span style="color:#bbb"> </span><span style="color:#666">15</span>:<span style="color:#666">33</span>:<span style="color:#666">3</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">08</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">83706</span><span style="color:#bbb">                </span><span style="">â”‚</span><span style="color:#bbb"> </span>Boise<span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb"> </span>ID<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">83706</span><span style="color:#bbb">               </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2020</span><span style="color:#666">-</span><span style="color:#666">12</span><span style="color:#666">-</span><span style="color:#666">03</span><span style="color:#bbb"> </span><span style="color:#666">14</span>:<span style="color:#666">26</span>:<span style="color:#666">0</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2023</span><span style="color:#666">-</span><span style="color:#666">12</span><span style="color:#666">-</span><span style="color:#666">03</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">49506</span><span style="color:#bbb">                </span><span style="">â”‚</span><span style="color:#bbb"> </span>Grand<span style="color:#bbb"> </span>Rapids<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>MI<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">49506</span><span style="color:#bbb">               </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2020</span><span style="color:#666">-</span><span style="color:#666">01</span><span style="color:#666">-</span><span style="color:#666">27</span><span style="color:#bbb"> </span><span style="color:#666">18</span>:<span style="color:#666">57</span>:<span style="color:#666">0</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2023</span><span style="color:#666">-</span><span style="color:#666">01</span><span style="color:#666">-</span><span style="color:#666">27</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>HOME_BUILT<span style="color:#bbb">    </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">35758</span><span style="color:#bbb">                </span><span style="">â”‚</span><span style="color:#bbb"> </span>Madison<span style="color:#bbb">      </span><span style="">â”‚</span><span style="color:#bbb"> </span>AL<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">35758</span><span style="color:#bbb">               </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb">                                                                                                                                      </span><span style="color:#666">11</span><span style="color:#bbb"> </span>columns<span style="color:#bbb"> </span>(<span style="color:#666">8</span><span style="color:#bbb"> </span>shown)<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>Thanks <a href="https://twitter.com/mraasveldt"><code>@mraasveldt</code></a> and <a href="https://twitter.com/__AlexMonahan__"><code>@__AlexMonahan__</code></a>ğŸ‘ğŸ»</p>
<p>Problem solved. But if you want to follow along with another option, read onâ€¦</p>
<h2 id="back-to-the-detective-story">Back to the Detective Story&nbsp;<a class="headline-hash" href="#back-to-the-detective-story">ğŸ”—</a> </h2>
<p>So, we have this problem:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">100</span><span style="color:#666">%</span><span style="color:#bbb"> </span><span style="">â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Error:<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Conversion</span><span style="color:#bbb"> </span>Error:<span style="color:#bbb"> </span>Could<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">not</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">convert</span><span style="color:#bbb"> </span>string<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;V1M 2K9&#39;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">to</span><span style="color:#bbb"> </span>INT64<span style="color:#bbb">
</span></span></span></code></pre></div><p>Huh. That sucks. Let&rsquo;s try it on a single file:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>D<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">  </span>Registration<span style="color:#bbb"> </span><span style="color:#008000">Date</span><span style="color:#bbb">   </span><span style="">â”‚</span><span style="color:#bbb"> </span>Registion<span style="color:#bbb"> </span>Expire<span style="color:#bbb"> </span>Dt<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">   </span>Asset<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Type</span><span style="color:#bbb">    </span><span style="">â”‚</span><span style="color:#bbb"> </span>RID<span style="color:#bbb"> </span>Equipped<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">  </span>Mailing<span style="color:#bbb"> </span>City<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">State</span><span style="color:#666">/</span>Prov<span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">       </span><span style="">â”‚</span><span style="color:#bbb">     </span><span style="color:#008000">varchar</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">   </span><span style="color:#008000">boolean</span><span style="color:#bbb">    </span><span style="">â”‚</span><span style="color:#bbb">   </span><span style="">â”‚</span><span style="color:#bbb">        </span>int64<span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">    </span><span style="color:#008000">varchar</span><span style="color:#bbb">     </span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb">        </span>int64<span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">09</span><span style="color:#666">-</span><span style="color:#666">28</span><span style="color:#bbb"> </span><span style="color:#666">19</span>:<span style="color:#666">27</span>:<span style="color:#666">5</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2025</span><span style="color:#666">-</span><span style="color:#666">09</span><span style="color:#666">-</span><span style="color:#666">28</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>TRADITIONAL_UAS<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">false</span><span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">                </span><span style="color:#666">80203</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Denver<span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb"> </span>CO<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb">               </span><span style="color:#666">80203</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">26</span><span style="color:#bbb"> </span><span style="color:#666">13</span>:<span style="color:#666">10</span>:<span style="color:#666">2</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">26</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">       </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">                </span><span style="color:#666">33611</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Tampa<span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>FL<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb">               </span><span style="color:#666">33611</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">25</span><span style="color:#bbb"> </span><span style="color:#666">15</span>:<span style="color:#666">58</span>:<span style="color:#666">4</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">25</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">       </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">                </span><span style="color:#666">23337</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Wallops<span style="color:#bbb"> </span>Island<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>VA<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb">               </span><span style="color:#666">23337</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">11</span><span style="color:#666">-</span><span style="color:#666">30</span><span style="color:#bbb"> </span><span style="color:#666">17</span>:<span style="color:#666">17</span>:<span style="color:#666">1</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">11</span><span style="color:#666">-</span><span style="color:#666">30</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">       </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">                </span><span style="color:#666">32114</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Daytona<span style="color:#bbb"> </span>Beach<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>FL<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb">               </span><span style="color:#666">32114</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2016</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">25</span><span style="color:#bbb"> </span><span style="color:#666">15</span>:<span style="color:#666">58</span>:<span style="color:#666">4</span><span style="">â€¦</span><span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">2022</span><span style="color:#666">-</span><span style="color:#666">10</span><span style="color:#666">-</span><span style="color:#666">25</span><span style="color:#bbb">          </span><span style="">â”‚</span><span style="color:#bbb"> </span>PURCHASED<span style="color:#bbb">       </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="">â€¦</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">                </span><span style="color:#666">23337</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Wallops<span style="color:#bbb"> </span>Island<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>VA<span style="color:#bbb">                   </span><span style="">â”‚</span><span style="color:#bbb">               </span><span style="color:#666">23337</span><span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb">                                                                                                                                          </span><span style="color:#666">11</span><span style="color:#bbb"> </span>columns<span style="color:#bbb"> </span>(<span style="color:#666">8</span><span style="color:#bbb"> </span>shown)<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>D<span style="color:#bbb">
</span></span></span></code></pre></div><p>That works, so we&rsquo;re going to have to narrow down the problem. <em>As a side note, I should probably log an enhancement request for more detailed error messages (for example, which file had the error, and which field).</em></p>
<p>Looking at the error message there&rsquo;s a data type problem with an <code>INT64</code> field (<code>BIGINT</code>). In the schema there are two fields with that:</p>
<pre tabindex="0"><code>Physical Postal Code
Mailing Postal Code
</code></pre><p>DuckDB&rsquo;s <a href="https://duckdb.org/docs/data/parquet#parquet-schema">parquet docs page</a> points me to the <code>parquet_schema</code> function, so let&rsquo;s have a look at these fields over the files in question:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>file_name,<span style="color:#bbb"> </span>name,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">type</span>,<span style="color:#bbb"> </span>logical_type<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>parquet_schema(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-*.parquet&#39;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">WHERE</span><span style="color:#bbb"> </span>name<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">like</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;%Postal Code%&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">                                  </span>file_name<span style="color:#bbb">                                   </span><span style="">â”‚</span><span style="color:#bbb">         </span>name<span style="color:#bbb">         </span><span style="">â”‚</span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">type</span><span style="color:#bbb">    </span><span style="">â”‚</span><span style="color:#bbb"> </span>logical_type<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">                                   </span><span style="color:#008000">varchar</span><span style="color:#bbb">                                    </span><span style="">â”‚</span><span style="color:#bbb">       </span><span style="color:#008000">varchar</span><span style="color:#bbb">        </span><span style="">â”‚</span><span style="color:#bbb">  </span><span style="color:#008000">varchar</span><span style="color:#bbb">   </span><span style="">â”‚</span><span style="color:#bbb">   </span><span style="color:#008000">varchar</span><span style="color:#bbb">    </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2016</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>INT64<span style="color:#bbb">      </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2016</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>INT64<span style="color:#bbb">      </span><span style="">â”‚</span><span style="color:#bbb">              </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2017</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2017</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2018</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2018</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2019</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2019</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2020</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2020</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2021</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Physical<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2021</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>Mailing<span style="color:#bbb"> </span>Postal<span style="color:#bbb"> </span>Code<span style="color:#bbb">  </span><span style="">â”‚</span><span style="color:#bbb"> </span>BYTE_ARRAY<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb"> </span>StringType()<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span><span style="color:#666">12</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb">                                                                                                               </span><span style="color:#666">4</span><span style="color:#bbb"> </span>columns<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>So there&rsquo;s the problem; the 2016 file uses <code>INT64</code> for those fields whilst the remaining files use a string. The <code>SELECT</code> that I ran above against all the files failed because when it tried to apply the schema of the first file against the data read from the others it ended up trying to convert a string to a number, which is never going to end well.</p>
<p>Here&rsquo;s one way to fix things with a <code>UNION ALL</code>. Note the use of <code>filename</code> metadata column to help verify the data we&rsquo;re getting is what&rsquo;s expected. To start with let&rsquo;s just try it against two files:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span></code></pre></div><pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   filename                                   â”‚ Physical Postal Code â”‚
â”‚                                   varchar                                    â”‚       varchar        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 80237                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 35222                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 36112                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 87123                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 35806                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet â”‚ 68179                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet â”‚ 32114                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet â”‚ 93637                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet â”‚ 33611                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet â”‚ 36112                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10 rows                                                                                   2 columns â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><p>Now we just need to specify the remainder of the files. Previously we wildcarded, but we can&rsquo;t include the 2016 file in that (since we&rsquo;re handling that with a <code>CAST</code> in the first block of the <code>UNION</code>), so we need to modify it. We&rsquo;ll test our new selection pattern first:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>filename;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">                                   </span>filename<span style="color:#bbb">                                   </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb">                                   </span><span style="color:#008000">varchar</span><span style="color:#bbb">                                    </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2018</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2019</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2017</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2020</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â”‚</span><span style="color:#bbb"> </span>s3:<span style="color:#666">//</span>drones03<span style="color:#666">/</span>main<span style="color:#666">/</span>drone<span style="color:#666">-</span>registrations<span style="color:#666">/</span>Registations<span style="color:#666">-</span>P107<span style="color:#666">-</span>Active<span style="color:#666">-</span><span style="color:#666">2021</span>.parquet<span style="color:#bbb"> </span><span style="">â”‚</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>Let&rsquo;s test this with the <code>UNION</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>read_parquet([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                     </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span></code></pre></div><pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   filename                                   â”‚ Physical Postal Code â”‚
â”‚                                   varchar                                    â”‚       varchar        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 87123                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 32114                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 67301                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 35806                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚ 32114                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet â”‚ 35806                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚ 98290                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚ 07641                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚ 33133                â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚ 20166                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10 rows                                                                                   2 columns â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><p>Now we can put this all together to do what we were trying to do in the first place; look at a sample of rows from across the set of files - but making allowances for the mismatched datatypes of the schema.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>x<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>(<span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">   </span><span style="color:#ba2121">&#34;Registration Date&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Registion Expire Dt&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Type&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;RID Equipped&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Model&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">    </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">   </span>read_parquet<span style="color:#bbb">  </span>([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>x<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">USING</span><span style="color:#bbb"> </span>SAMPLE<span style="color:#bbb"> </span><span style="color:#666">10</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ROWS</span>;<span style="color:#bbb">
</span></span></span></code></pre></div><pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Registration Date      â”‚ Registion Expire Dt â”‚   Asset Type    â”‚ RID Equipped â”‚   Asset Model    â”‚ Physical City â”‚ Physical State/Province â”‚ Physical Postal Code â”‚ Mailing City â”‚ Mailing State/Province â”‚ Mailing Postal Code â”‚                                   filename                                   â”‚
â”‚          varchar           â”‚       varchar       â”‚     varchar     â”‚   boolean    â”‚     varchar      â”‚    varchar    â”‚         varchar         â”‚       varchar        â”‚   varchar    â”‚        varchar         â”‚       varchar       â”‚                                   varchar                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2021-03-24 13:35:06.817000 â”‚ 2024-03-24          â”‚ TRADITIONAL_UAS â”‚ false        â”‚ Phantom 4 Pro V2 â”‚ Minneapolis   â”‚ MN                      â”‚ 55423                â”‚ Minneapolis  â”‚ MN                     â”‚ 55423               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚
â”‚ 2021-12-06 12:43:38.265000 â”‚ 2024-12-06          â”‚ TRADITIONAL_UAS â”‚ false        â”‚ Air 2S           â”‚ Wo;;ots       â”‚ CA                      â”‚ 95490                â”‚ Wo;;ots      â”‚ CA                     â”‚ 95490               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚
â”‚ 2021-12-11 01:49:20.235000 â”‚ 2024-12-10          â”‚ TRADITIONAL_UAS â”‚ false        â”‚ Mavic Air        â”‚ Rocklin       â”‚ CA                      â”‚ 95677                â”‚ Rocklin      â”‚ CA                     â”‚ 95677               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚
â”‚ 2020-06-01 12:43:09.114000 â”‚ 2023-06-01          â”‚ PURCHASED       â”‚              â”‚ Mavic 2 Air      â”‚ Loveland      â”‚ CO                      â”‚ 80538                â”‚ Loveland     â”‚ CO                     â”‚ 80538               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2020.parquet â”‚
â”‚ 2021-10-19 22:03:03.630000 â”‚ 2024-10-19          â”‚ HOMEBUILT_UAS   â”‚ false        â”‚ X1               â”‚ Philadelphia  â”‚ PA                      â”‚ 19146                â”‚ Philadelphia â”‚ PA                     â”‚ 19146               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚
â”‚ 2020-12-31 00:59:16.326000 â”‚ 2023-12-30          â”‚ PURCHASED       â”‚              â”‚ SP7100           â”‚ Cornelius     â”‚ OR                      â”‚ 97113                â”‚ Cornelius    â”‚ OR                     â”‚ 97113               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2020.parquet â”‚
â”‚ 2020-10-14 18:31:39.662000 â”‚ 2023-10-14          â”‚ PURCHASED       â”‚              â”‚ Phantom Rtk 4    â”‚ San Antonio   â”‚ TX                      â”‚ 78216                â”‚ San Antonio  â”‚ TX                     â”‚ 78216               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2020.parquet â”‚
â”‚ 2019-05-14 23:10:35.507000 â”‚ 2025-05-14          â”‚ TRADITIONAL_UAS â”‚ false        â”‚ Mavic Pro 2      â”‚ Greensboro    â”‚ NC                      â”‚ 27409                â”‚ Greensboro   â”‚ NC                     â”‚ 27409               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2019.parquet â”‚
â”‚ 2019-05-29 14:50:18.922000 â”‚ 2025-05-29          â”‚ TRADITIONAL_UAS â”‚ false        â”‚ Phantom 4 Pro    â”‚ Brighton      â”‚ CO                      â”‚ 80601                â”‚ Brighton     â”‚ CO                     â”‚ 80601               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2019.parquet â”‚
â”‚ 2021-02-06 14:56:38.651000 â”‚ 2024-02-06          â”‚ PURCHASED       â”‚              â”‚ Mavic 2 Pro      â”‚ Louisville    â”‚ KY                      â”‚ 40204                â”‚ Louisville   â”‚ KY                     â”‚ 40204               â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 10 rows                                                                                                                                                                                                                                                                                                 12 columns â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><p>This looks good, but we should check we&rsquo;re getting data from all files. We&rsquo;ll do that with a <code>COUNT</code> aggregate against the CTE:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>x<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>(<span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">   </span><span style="color:#ba2121">&#34;Registration Date&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Registion Expire Dt&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Type&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;RID Equipped&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Model&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">    </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">   </span>read_parquet<span style="color:#bbb">  </span>([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">COUNT</span>(<span style="color:#666">*</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>x<span style="color:#bbb"> 
</span></span></span><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>filename;</span></span></code></pre></div>
<pre tabindex="0"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   filename                                   â”‚ count_star() â”‚
â”‚                                   varchar                                    â”‚    int64     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet â”‚         1280 â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2017.parquet â”‚         5819 â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2018.parquet â”‚        24695 â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2019.parquet â”‚        60105 â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2020.parquet â”‚       143670 â”‚
â”‚ s3://drones03/main/drone-registrations/Registations-P107-Active-2021.parquet â”‚       162826 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre><p>Looks good to me!</p>
<p>For a finishing touch we could even wrap it in a <code>VIEW</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-sql" data-lang="sql"><span style="display:flex; background-color:#e5e5e5"><span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">OR</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">REPLACE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">VIEW</span><span style="color:#bbb"> </span>Registations_P107_Active<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>x<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>(<span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">   </span><span style="color:#ba2121">&#34;Registration Date&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Registion Expire Dt&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Type&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;RID Equipped&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Asset Model&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Physical State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Physical Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Physical Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing City&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#ba2121">&#34;Mailing State/Province&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span><span style="color:#008000;font-weight:bold">CAST</span>(<span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Mailing Postal Code&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                    </span>filename<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">    </span>read_parquet(<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-2016.parquet&#39;</span>,<span style="color:#bbb"> </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">   </span>read_parquet<span style="color:#bbb">  </span>([<span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-201[7-9].parquet&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span><span style="color:#ba2121">&#39;s3://drones03/main/drone-registrations/Registations-P107-Active-202*.parquet&#39;</span>],<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">                                   </span>filename<span style="color:#666">=</span><span style="color:#008000;font-weight:bold">true</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">            </span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>x;</span></span></code></pre></div>
<p>Which then can be used the same as above like this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>filename,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">COUNT</span>(<span style="color:#666">*</span>)<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>Registations_P107_Active<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>filename;<span style="color:#bbb">
</span></span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p><em>DID YOU KNOWâ€¦you can work with Parquet files in lakeFS directly from DuckDB? I didn&rsquo;t until I read <a href="https://docs.lakefs.io/integrations/duckdb.html">this doc</a></em> :)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#spoiler-union_by_name">Spoiler: <code>UNION_BY_NAME</code></a></li>
    <li><a href="#back-to-the-detective-story">Back to the Detective Story</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
