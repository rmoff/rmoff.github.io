<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Learning Apache Flink S01E06: The Flink JDBC Driver</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2023/11/16/learning-apache-flink-s01e06-the-flink-jdbc-driver/">
		
		
		
		
		
		<meta property="og:title" content="Learning Apache Flink S01E06: The Flink JDBC Driver" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2023/11/h_IMG_6386.webp" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2023/11/16/learning-apache-flink-s01e06-the-flink-jdbc-driver/" />
		<meta property="og:site_name" content="Learning Apache Flink S01E06: The Flink JDBC Driver" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/images/2023/11/h_IMG_6386.webp'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings2" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://bsky.app/profile/rmoff.net"><i class="fa-brands fa-bluesky"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://data-folks.masto.host/@rmoff"><i class="fab fa-mastodon"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Learning Apache Flink S01E06: The Flink JDBC Driver</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2023-11-16T15:20:20Z">Nov 16, 2023</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/flink-jdbc" class="no-underline category near-white dim">Flink JDBC</a>, <a href="https://rmoff.net/categories/flink-sql-gateway" class="no-underline category near-white dim">Flink SQL Gateway</a>, <a href="https://rmoff.net/categories/laf" class="no-underline category near-white dim">LAF</a>, <a href="https://rmoff.net/categories/apache-flink" class="no-underline category near-white dim">Apache Flink</a>
								<span class="display-print">at https://rmoff.net/2023/11/16/learning-apache-flink-s01e06-the-flink-jdbc-driver/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="https://twitter.com/rmoff/" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw8">
	<p>As a newcomer to Apache Flink one of the first things I did was join the <a href="https://flink.apache.org/what-is-flink/community/#slack">Slack community</a> (which is vendor-neutral and controlled by the Flink PMC). At the moment I&rsquo;m pretty much in full-time lurker mode, soaking up the kind of questions that people have and how they&rsquo;re using Flink.</p>
<p>One <a href="https://apache-flink.slack.com/archives/C03G7LJTS2G/p1699672468626739">question</a> that caught my eye was from Marco Villalobos, in which he asked about the Flink JDBC driver and a <code>SQLDataException</code>  he was getting with a particular datatype. Now, unfortunately, I have no idea about the answer to this question—but the idea of a JDBC driver through which Flink SQL could be run sounded like a fascinating path to follow after <a href="/2023/10/10/learning-apache-flink-s01e04-a-partial-exploration-of-the-flink-sql-client/">previously looking at the SQL Client</a>.</p>
<p>This took me down a bit of a rabbit hole, because after digging through the docs my understanding is that there are two options if you have a client that you want to connect to Flink using JDBC</p>
<p><img src="/images/2023/11/jdbc_choice.webp" alt="Button choice meme - Flink JDBC or Hive JDBC via HiveServer2"></p>
<p>At this point in time (and I would love to be corrected if I&rsquo;m wrong!) my understanding is this:</p>
<blockquote>
<p><strong>tl;dr: If all you want to do is quickly hook up a JDBC client to Flink, then the Flink JDBC driver is the route to go—<em>if you&rsquo;re not bothered about a catalog to persist metadata</em>.
In either case, you also need to be running the SQL Gateway.</strong></p>
</blockquote>
<h2 id="what-are-the-jdbc-options-with-flink">What are the JDBC options with Flink?&nbsp;<a class="headline-hash" href="#what-are-the-jdbc-options-with-flink">🔗</a> </h2>
<p>The docs don&rsquo;t particularly help with this confusion, instead having two seemingly unconnected examples both with JDBC, and each using the SQL Gateway.</p>
<ul>
<li><a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/jdbcdriver/#use-with-a-jdbc-tool">Flink JDBC via SQL Gateway REST Endpoint</a></li>
<li><a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/hive-compatibility/hiveserver2/#clients--tools">Hive JDBC via SQL Gateway HiveServer2 Endpoint</a></li>
</ul>
<p>Looking at the history of the project brings to light how these pages have probably evolved.</p>
<ul>
<li>
<p>A new Flink JDBC Driver was added in 1.18 (<a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-293%3A+Introduce+Flink+Jdbc+Driver+For+Sql+Gateway">FLIP-293</a>) and <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/jdbcdriver/#flink-jdbc-driver">uses</a> the SQL Gateway&rsquo;s REST interface.</p>
<p>A JDBC driver and SQL gateway existed before as <a href="https://github.com/ververica/flink-sql-gateway">community</a> <a href="https://github.com/ververica/flink-jdbc-driver">projects</a> which had fallen out of maintenance and were written for older versions of Flink. The SQL Gateway had previously been brought into Flink in <a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-91%3A+Support+SQL+Gateway">FLIP-91</a>.</p>
</li>
<li>
<p>The other JDBC route is through the Hive JDBC Driver which <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/hive-compatibility/hiveserver2/#dbeaver">can be used</a> in conjunction with the HiveServer2 support which was added to the SQL Gateway last year in Flink 1.16 with <a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-223:+Support+HiveServer2+Endpoint">FLIP-223</a>.</p>
<p>The motivation around adding HiveServer2 was the assertion that Hive is still the de-facto interface for those doing batch processing in the &ldquo;Big Data&rdquo; world.</p>
</li>
</ul>
<h3 id="catalogs-and-metadata">Catalogs and Metadata…&nbsp;<a class="headline-hash" href="#catalogs-and-metadata">🔗</a> </h3>
<p>In looking at <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/connectors/table/hive/overview/#dependencies">the requirements</a> for using HiveServer2 (via the original page&rsquo;s <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/hive-compatibility/hiveserver2/#setting-up">Setup section</a>) I got scared off ;-)</p>
<p>I suspect at some point I will have to bite this bullet because Flink itself doesn&rsquo;t have its own metadata store, and per <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/connectors/table/hive/hive_catalog/">the docs</a>:</p>
<blockquote>
<p>HiveCatalog is the only persistent catalog provided out-of-box by Flink.</p>
</blockquote>
<p>When we talk about catalogs and persisting metadata we&rsquo;re talking about the tables and other objects that we define being there the next time we connect to the system. For transient processing, and indeed for sandbox and experimentation purposes, this might not be an issue. But this is something so fundamental that for something like an RDBMS that we wouldn&rsquo;t even think to check that it does it - we just assume that whether MySQL, Oracle, or whatever, when we create a table it will <em>of course</em> be there next time we connect to the server.</p>
<hr>
<p>So all that said, we&rsquo;re going to just use the Flink JDBC Driver for now, and save the HiveServer2 endpoint of the SQL Gateway for another day.</p>
<h2 id="hands-on-with-the-flink-jdbc-driver">Hands-on with the Flink JDBC Driver&nbsp;<a class="headline-hash" href="#hands-on-with-the-flink-jdbc-driver">🔗</a> </h2>
<p>My favourite way to learn something is by actually trying it out. The first step is to run the Flink cluster:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ./bin/start-cluster.sh
</span></span><span style="display:flex;"><span>Starting cluster.
</span></span><span style="display:flex;"><span>Starting standalonesession daemon on host asgard08.
</span></span><span style="display:flex;"><span>Starting taskexecutor daemon on host asgard08.
</span></span></code></pre></div><p>and then the <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/overview/">SQL Gateway</a>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ./bin/sql-gateway.sh start -Dsql-gateway.endpoint.rest.address<span style="color:#666">=</span>localhost
</span></span><span style="display:flex;"><span>Starting sql-gateway daemon on host asgard08.
</span></span></code></pre></div><p>The SQL Gateway exposes two <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/overview/#supported-endpoints">endpoints</a>: REST (default) and <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/hive-compatibility/hiveserver2/">HiveServer2</a> . Let&rsquo;s use the REST endpoint to check that it&rsquo;s working:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl http://localhost:8083/v1/info
</span></span><span style="display:flex;"><span><span style="color:#666">{</span><span style="color:#ba2121">&#34;productName&#34;</span>:<span style="color:#ba2121">&#34;Apache Flink&#34;</span>,<span style="color:#ba2121">&#34;version&#34;</span>:<span style="color:#ba2121">&#34;1.18.0&#34;</span><span style="color:#666">}</span>%
</span></span></code></pre></div><p>Now we&rsquo;ll use the JDBC driver, through the SQL gateway, from a suitable client. The JDBC driver isn&rsquo;t bundled with Flink itself so you need to download it:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl https://repo.maven.apache.org/maven2/org/apache/flink/flink-sql-jdbc-driver-bundle/1.18.0/flink-sql-jdbc-driver-bundle-1.18.0.jar -O
</span></span></code></pre></div><p>Now to choose our JDBC client.</p>
<h2 id="-attempt-1-jisql">❌ Attempt 1: <code>jisql</code>&nbsp;<a class="headline-hash" href="#-attempt-1-jisql">🔗</a> </h2>
<p>Many years ago and in a different life <a href="/2016/03/28/connecting-to-obiee-via-jdbc-with-jisql/">I used</a> <a href="https://github.com/stdunbar/jisql">jisql</a>, so that was my first choice here simply for familiarity.</p>
<p>After cloning <a href="https://github.com/stdunbar/jisql">the jisql repo</a> and building it (<code>mvn package</code>) I copied the Flink JDBC driver to the <code>target</code> folder that the build created.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ls -l *.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff  <span style="color:#666">22258619</span> <span style="color:#666">13</span> Nov 11:54 flink-sql-jdbc-driver-bundle-1.18.0.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff     <span style="color:#666">86883</span> <span style="color:#666">13</span> Nov 10:41 jisql-jar-with-dependencies.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff     <span style="color:#666">19917</span> <span style="color:#666">13</span> Nov 10:40 jisql.jar
</span></span></code></pre></div><p>Now to run it:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>java -cp <span style="color:#ba2121">&#34;</span><span style="color:#19177c">$PWD</span><span style="color:#ba2121">/*&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>	   com.xigole.util.sql.Jisql <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>	   -driver org.apache.flink.table.jdbc.FlinkDriver <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>	   -cstring jdbc:flink://localhost:8083 <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>	   -user none -password none -driverinfo
</span></span></code></pre></div><p>How I love the smell of Java stack traces in the morning 🙄</p>
<pre tabindex="0"><code>Exception in thread &#34;main&#34; java.lang.NoClassDefFoundError: org/slf4j/LoggerFactory
        at org.apache.flink.table.jdbc.FlinkDriver.&lt;clinit&gt;(FlinkDriver.java:40)
        at java.base/java.lang.Class.forName0(Native Method)
        at java.base/java.lang.Class.forName(Class.java:315)
        at com.xigole.util.sql.Jisql.run(Jisql.java:288)
        at com.xigole.util.sql.Jisql.main(Jisql.java:275)
Caused by: java.lang.ClassNotFoundException: org.slf4j.LoggerFactory
        at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:581)
        at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)
        at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:527)
        ... 5 more
</code></pre><p>One of the challenges for non-Java users of Flink (like me) is navigating these stacktraces which <a href="/2023/10/10/learning-apache-flink-s01e04-a-partial-exploration-of-the-flink-sql-client/#it-was-all-going-so-well-">pop up</a> even when you&rsquo;re using the SQL side of things. From bitter experience, I know that <code>NoClassDefFoundError</code> means I&rsquo;m probably missing a jar, or have a jar but in the wrong place, or the wrong colour, or something.</p>
<p>There&rsquo;s also a line in <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/jdbcdriver/#use-with-sqlline">the docs</a> that I missed the first time around:</p>
<blockquote>
<p><em>Notice that you need to copy slf4j-api-{slf4j.version}.jar to <code>target</code> which will be used by flink JDBC driver</em></p>
</blockquote>
<p>This jar is for the <a href="https://www.slf4j.org/">SLF4J API Module</a>. It&rsquo;s beyond my pay grade to explain why this isn&rsquo;t included with the Flink JDBC driver, so for now we&rsquo;ll deal with the sharp edge and just go and download that too.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl https://repo1.maven.org/maven2/org/slf4j/slf4j-api/2.0.9/slf4j-api-2.0.9.jar -O
</span></span><span style="display:flex;"><span>$ cp slf4j-api-2.0.9.jar target
</span></span><span style="display:flex;"><span>$ ls -l *.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff  <span style="color:#666">22258619</span> <span style="color:#666">13</span> Nov 11:54 flink-sql-jdbc-driver-bundle-1.18.0.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff     <span style="color:#666">86883</span> <span style="color:#666">13</span> Nov 10:41 jisql-jar-with-dependencies.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff     <span style="color:#666">19917</span> <span style="color:#666">13</span> Nov 10:40 jisql.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff     <span style="color:#666">64579</span> <span style="color:#666">13</span> Nov 11:54 slf4j-api-2.0.9.jar
</span></span></code></pre></div><p>Trying again:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ java -cp <span style="color:#ba2121">&#34;</span><span style="color:#19177c">$PWD</span><span style="color:#ba2121">/*&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           com.xigole.util.sql.Jisql <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           -driver org.apache.flink.table.jdbc.FlinkDriver <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           -cstring jdbc:flink://localhost:8083 <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           -user none -password none <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           -driverinfo
</span></span><span style="display:flex;"><span>           
</span></span><span style="display:flex;"><span><span style="color:#666">[</span>…<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>driver.getMajorVersion<span style="color:#666">()</span> is <span style="color:#666">1</span>
</span></span><span style="display:flex;"><span>driver.getMinorVersion<span style="color:#666">()</span> is <span style="color:#666">18</span>
</span></span><span style="display:flex;"><span>driver is not JDBC compliant
</span></span><span style="display:flex;"><span>metaData.getDatabaseProductName<span style="color:#666">()</span>: <span style="color:#ba2121">&#34;Flink JDBC Driver&#34;</span>
</span></span><span style="display:flex;"><span>metaData.getDatabaseProductVersion<span style="color:#666">()</span>: <span style="color:#ba2121">&#34;1.18.0&#34;</span>
</span></span><span style="display:flex;"><span>metaData.getDriverName<span style="color:#666">()</span>: <span style="color:#ba2121">&#34;org.apache.flink.table.jdbc.FlinkDriver&#34;</span>
</span></span><span style="display:flex;"><span>metaData.getDriverVersion<span style="color:#666">()</span>: <span style="color:#ba2121">&#34;1.18.0&#34;</span>
</span></span></code></pre></div><p>Nice, we&rsquo;re getting somewhere! Unfortunately, this is as far as we get. If we remove the <code>-driverinfo</code> flag (which gave us the driver info as seen above) so that we can get into the SQL prompt itself, we hit a problem:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ java -cp <span style="color:#ba2121">&#34;</span><span style="color:#19177c">$PWD</span><span style="color:#ba2121">/*&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           com.xigole.util.sql.Jisql <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           -driver org.apache.flink.table.jdbc.FlinkDriver <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           -cstring jdbc:flink://localhost:8083 <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>           -user none -password none
</span></span><span style="display:flex;"><span>SLF4J: No SLF4J providers were found.
</span></span><span style="display:flex;"><span>SLF4J: Defaulting to no-operation <span style="color:#666">(</span>NOP<span style="color:#666">)</span> logger implementation
</span></span><span style="display:flex;"><span>SLF4J: See https://www.slf4j.org/codes.html#noProviders <span style="color:#008000;font-weight:bold">for</span> further details.
</span></span><span style="display:flex;"><span>SQLException : SQL state: null java.sql.SQLFeatureNotSupportedException: FlinkConnection#clearWarnings is not supported yet. ErrorCode: <span style="color:#666">0</span>
</span></span></code></pre></div><p><code>SQLFeatureNotSupportedException</code> is a recurred theme with the Flink JDBC Driver. In this case, it&rsquo;s <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html#clearWarnings--"><code>clearWarnings</code></a> that isn&rsquo;t supported.</p>
<p>Even if I go into the code and comment out the call to <code>clearWarnings</code> and rebuild jisql (<em>look at me delving into Java code which I have no idea about what I&rsquo;m doing!</em> 🤪), it soon bombs out on further <code>SQLFeatureNotSupportedException</code> errors.</p>
<h2 id="-attempt-2-sqlline">✅ Attempt 2: <code>sqlline</code>&nbsp;<a class="headline-hash" href="#-attempt-2-sqlline">🔗</a> </h2>
<p>The <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/jdbcdriver/#use-with-sqlline">docs themselves demonstrate the JDBC Driver with sqlline</a> so I was hoping that this would at least work.</p>
<p>As before, I cloned the <a href="https://github.com/julianhyde/sqlline">repo</a> and built it (<code>./mvnw package -DskipTests</code> - one of the tests seems to be broken, hence skipping it). Learning from my lesson before I put both the Flink JDBC driver <em>and</em> slf4j jars in the same folder as the sqlline jar:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ls -l target/*.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff  <span style="color:#666">22258619</span> <span style="color:#666">13</span> Nov 11:06 flink-sql-jdbc-driver-bundle-1.18.0.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff     <span style="color:#666">64579</span> <span style="color:#666">13</span> Nov 11:11 slf4j-api-2.0.9.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff   <span style="color:#666">3128007</span> <span style="color:#666">13</span> Nov 10:54 sqlline-1.13.0-SNAPSHOT-jar-with-dependencies.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff    <span style="color:#666">505697</span> <span style="color:#666">13</span> Nov 10:54 sqlline-1.13.0-SNAPSHOT-javadoc.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff    <span style="color:#666">151338</span> <span style="color:#666">13</span> Nov 10:54 sqlline-1.13.0-SNAPSHOT-sources.jar
</span></span><span style="display:flex;"><span>-rw-r--r--@ <span style="color:#666">1</span> rmoff  staff    <span style="color:#666">243014</span> <span style="color:#666">13</span> Nov 10:54 sqlline-1.13.0-SNAPSHOT.jar
</span></span></code></pre></div><p>Now to run it. There are two options - the helper shell script that ships with sqlline and sets up the classpath nicely, or just directly like with jisql above. I opted for the former since it&rsquo;s tidier on the CLI:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ ./bin/sqlline
</span></span><span style="display:flex;"><span>sqlline version 1.13.0-SNAPSHOT
</span></span><span style="display:flex;"><span>sqlline&gt;
</span></span></code></pre></div><p>So far, so good.</p>
<p>Let&rsquo;s connect to the Flink cluster using the gateway&rsquo;s REST endpoint using the <code>connect</code> command and JDBC URL:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sqlline&gt; !connect jdbc:flink://localhost:8083
</span></span><span style="display:flex;"><span><span style="color:#666">[</span>…<span style="color:#666">]</span>
</span></span></code></pre></div><p>We&rsquo;re prompted for credentials, even though the driver doesn&rsquo;t support them at this stage. Hit return for both, ignore the <code>is not supported yet</code> errors, and we&rsquo;re now at a prompt from which we can enter some Flink SQL!</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Enter username <span style="color:#008000;font-weight:bold">for</span> jdbc:flink://localhost:8083:
</span></span><span style="display:flex;"><span>Enter password <span style="color:#008000;font-weight:bold">for</span> jdbc:flink://localhost:8083:
</span></span><span style="display:flex;"><span>Error: FlinkConnection#setReadOnly is not supported yet. <span style="color:#666">(</span><span style="color:#19177c">state</span><span style="color:#666">=</span>,code<span style="color:#666">=</span>0<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>Error: FlinkDatabaseMetaData#getDefaultTransactionIsolation is not supported <span style="color:#666">(</span><span style="color:#19177c">state</span><span style="color:#666">=</span>,code<span style="color:#666">=</span>0<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>0: jdbc:flink://localhost:8083&gt;
</span></span></code></pre></div><p>Let&rsquo;s run a query using the same example as <a href="/2023/10/10/learning-apache-flink-s01e04-a-partial-exploration-of-the-flink-sql-client/">last time</a>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#666">0</span>:<span style="color:#bbb"> </span>jdbc:flink:<span style="color:#666">//</span>localhost:<span style="color:#666">8083</span><span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.semicolon<span style="color:#666">&gt;</span><span style="color:#bbb">   </span>name,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.semicolon<span style="color:#666">&gt;</span><span style="color:#bbb">   </span><span style="color:#008000;font-weight:bold">COUNT</span>(<span style="color:#666">*</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>cnt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.semicolon<span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.semicolon<span style="color:#666">&gt;</span><span style="color:#bbb">   </span>(<span style="color:#008000;font-weight:bold">VALUES</span><span style="color:#bbb"> </span>(<span style="color:#ba2121">&#39;Bob&#39;</span>),<span style="color:#bbb"> </span>(<span style="color:#ba2121">&#39;Alice&#39;</span>),<span style="color:#bbb"> </span>(<span style="color:#ba2121">&#39;Greg&#39;</span>),<span style="color:#bbb"> </span>(<span style="color:#ba2121">&#39;Bob&#39;</span>))<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>NameTable(name)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.semicolon<span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>name;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">-------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span><span style="color:#bbb"> </span>name<span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span>cnt<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">-------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span><span style="color:#bbb"> </span>Bob<span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span>Alice<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span>Greg<span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span>Bob<span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span>Bob<span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">2</span><span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">-------+-----+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb"> </span>selected<span style="color:#bbb"> </span>(<span style="color:#666">1</span>.<span style="color:#666">044</span><span style="color:#bbb"> </span>seconds)<span style="color:#bbb">
</span></span></span></code></pre></div><p>What about streaming? We&rsquo;ll create a table using <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/connectors/table/datagen/">the <code>datagen</code> connector</a>. This connector basically stuffs random values into each field to match the respective data type.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#666">0</span>:<span style="color:#bbb"> </span>jdbc:flink:<span style="color:#666">//</span>localhost:<span style="color:#666">8083</span><span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>foo<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.)<span style="color:#666">&gt;</span><span style="color:#bbb">     </span>a_number<span style="color:#bbb">  </span><span style="color:#008000">BIGINT</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.)<span style="color:#666">&gt;</span><span style="color:#bbb">     </span>a_decimal<span style="color:#bbb"> </span><span style="color:#008000">DECIMAL</span>(<span style="color:#666">32</span>,<span style="color:#666">2</span>),<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.)<span style="color:#666">&gt;</span><span style="color:#bbb">     </span>a_string<span style="color:#bbb">  </span>STRING<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.)<span style="color:#666">&gt;</span><span style="color:#bbb"> </span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.)<span style="color:#666">&gt;</span><span style="color:#bbb">   </span><span style="color:#ba2121">&#39;connector&#39;</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;datagen&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.<span style="color:#bbb"> </span>.)<span style="color:#666">&gt;</span><span style="color:#bbb"> </span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">No</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb"> </span>affected<span style="color:#bbb"> </span>(<span style="color:#666">0</span>.<span style="color:#666">145</span><span style="color:#bbb"> </span>seconds)<span style="color:#bbb">
</span></span></span></code></pre></div><p>It&rsquo;s not pretty, but it is effective. Here&rsquo;s a bounded query against the table:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#666">0</span>:<span style="color:#bbb"> </span>jdbc:flink:<span style="color:#666">//</span>localhost:<span style="color:#666">8083</span><span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>foo<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">LIMIT</span><span style="color:#bbb"> </span><span style="color:#666">5</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">----------------------+-----------------------------------+------------------------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span><span style="color:#bbb">       </span>a_number<span style="color:#bbb">       </span><span style="color:#666">|</span><span style="color:#bbb">             </span>a_decimal<span style="color:#bbb">             </span><span style="color:#666">|</span><span style="color:#bbb">                                               </span>a_string<span style="color:#bbb">                                               </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">----------------------+-----------------------------------+------------------------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">5498399883014354114</span><span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">74212271515046392498116100096</span>.<span style="color:#666">00</span><span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">702</span>e6aa4b8c69d6fdd67ec90fcf90253377357b250e74d40934ab25cd6aa0c631309f49789b80678a522379b1ad3861187af<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">-</span><span style="color:#666">3618213315685925891</span><span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">93385166264069454971029946368</span>.<span style="color:#666">00</span><span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">4</span>e1ec64676a13eacb7d58757492c1ea3c0c77138dbdedca63827d516cd7849aa1c73fa714fb8d07d98e18c3a20a42ce24c53<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">9058675481861391925</span><span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">651238545085586500000000000000</span>.<span style="color:#666">00</span><span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span>b81f3859c94f37088821df93d2e5284ab0778b49d4c89729a45ef82634a8f1c7313224f1dca03e437653a563b93c15841c1e<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">-</span><span style="color:#666">607555464239338146</span><span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">214827744726156960000000000000</span>.<span style="color:#666">00</span><span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span>a15acba4276bcbb2b0846599d79c44fd23a22acc178f0c76abdc951c793149bd2735b734ccbc1f4b65c1294f09cb84cc153b<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">-</span><span style="color:#666">2603485567200316583</span><span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">413883713557198900000000000000</span>.<span style="color:#666">00</span><span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">7266</span>d08ef4fa9f84677ce01d536475e798f1218fdf63fdb174f7ce07e0511c6511f0d981ddc6a3d08b8e7a1fd5c01304d673<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">----------------------+-----------------------------------+------------------------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">5</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb"> </span>selected<span style="color:#bbb"> </span>(<span style="color:#666">0</span>.<span style="color:#666">832</span><span style="color:#bbb"> </span>seconds)<span style="color:#bbb">
</span></span></span></code></pre></div><p>Without the <code>LIMIT</code> clause, it&rsquo;s unbounded:</p>
<script async id="asciicast-SPNS2j5ci6Tu7QE0ggRdiNxqq" src="https://asciinema.org/a/SPNS2j5ci6Tu7QE0ggRdiNxqq.js"></script>
<p>One of the issues with using the JDBC Driver is that there is <em>extreme</em> verbosity. This might be from the REST endpoint rather than the JDBC driver itself (I&rsquo;m not sure) but either way, the user is left with a screenful of noise if they try to do something that causes a problem. For example, if you tell Flink to run as a batch job:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SET</span><span style="color:#bbb"> </span>execution.runtime<span style="color:#666">-</span><span style="color:#008000;font-weight:bold">mode</span><span style="color:#666">=</span>batch;<span style="color:#bbb">
</span></span></span></code></pre></div><p>and then run a <code>SELECT</code> against the above <code>foo</code> table (which is defined as an unbounded source) you get a sensible and well-formed error:</p>
<pre tabindex="0"><code>org.apache.flink.table.api.ValidationException:
Querying an unbounded table &#39;default_catalog.default_database.foo&#39; in batch mode is not allowed.
The table source is unbounded.
</code></pre><p>However, this error is buried amongst vast stacktrace noise. Here&rsquo;s what the above <em><strong>one</strong></em> error looks like—I had to zoom my font size right down to even get all the messages on the viewable screen:</p>
<p><img src="/images/2023/11/jdbc_stack.webp" alt="JDBC Stack Trace"></p>
<p>As a side note—since we&rsquo;ve gone down this bounded/unbounded batch/streaming path—you can also use datagen as a bounded source by setting the <code>number-of-rows</code> <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/connectors/table/datagen/#connector-options">option</a> in the DDL:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>bar<span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>c1<span style="color:#bbb"> </span><span style="color:#008000">INT</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span>c2<span style="color:#bbb"> </span>STRING<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>(<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#ba2121">&#39;connector&#39;</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;datagen&#39;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#ba2121">&#39;number-of-rows&#39;</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;8&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>);<span style="color:#bbb">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#666">0</span>:<span style="color:#bbb"> </span>jdbc:flink:<span style="color:#666">//</span>localhost:<span style="color:#666">8083</span><span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>bar;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">-------------+------------------------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span><span style="color:#bbb">     </span>c1<span style="color:#bbb">      </span><span style="color:#666">|</span><span style="color:#bbb">                                                  </span>c2<span style="color:#bbb">                                                  </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">-------------+------------------------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">-</span><span style="color:#666">596725830</span><span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span>e2286a4c7200d165502c49d58793f3867ec3462b75c029d0552f0475c36e95aff2cedd17e7c2fd0e12dfc90f4ca561513eaf<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">288846669</span><span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb"> </span>f39a0c31abd89ff15841d2875fd6669bb88e31357bdcf75a4d67c3d4aa67283497800fe820881a3bac6fbaddcce301d916b7<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">-</span><span style="color:#666">1278589269</span><span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span>ad9f5d238476c34dfaf4c60f42e1a1a38f64201f93ad5e9d59ea3831fdf1fcf47240820e437aa3db280917c4740169773558<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">-</span><span style="color:#666">2001314692</span><span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">8</span>aefa715dbb1cfabf4705b5e89263b95e09953605663861c0dba79b566b24f17f0f7e43f51f4192120c8e85c06922cf24b41<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">523937178</span><span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">66</span>e5a9e560b0014bdbb3393f660c6ad9cd5ddb098eef205ebfc13ffc819b50d31809bb1ebf2356d5943ec2f1b395b3c78fc0<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">445642724</span><span style="color:#bbb">   </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">7311</span>f7970f709ccbb724bf7386cf3baed4c6957d54fb4625f4a2f6fa958cf58617c812eb1cd4373e809234e5704e2141364f<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">2038995175</span><span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">0</span>ef84598989c488bda2a75d3138ec3cd08f7449b06a1b8321a63e46009f5dcea27e158023a2dabc6851c379f06cdad9e93f6<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">-</span><span style="color:#666">2071526857</span><span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#666">2</span>b0152d3da610caad8c7256e2e410b55979bde72c34f918ccd53f438f5ca5104d996db448e41edff536ba01f5664472e52c8<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">-------------+------------------------------------------------------------------------------------------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">8</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">rows</span><span style="color:#bbb"> </span>selected<span style="color:#bbb"> </span>(<span style="color:#666">0</span>.<span style="color:#666">813</span><span style="color:#bbb"> </span>seconds)<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="-dbeaver">🦫 DBeaver&nbsp;<a class="headline-hash" href="#-dbeaver">🔗</a> </h2>
<p>A popular open-source GUI for databases (and more) is <a href="https://github.com/dbeaver">DBeaver</a>. You can already use it with Flink through the HiveServer2 support in SQL Gateway, and the Flink JDBC Driver means it can natively support it.</p>
<p><img src="/images/2023/11/dbeaver1.webp" alt="DBeaver connection for Apache Flink"></p>
<p>Just like with sqlline, you can run Flink SQL statements to create and query tables. DBeaver seems happy querying both bounded tables:</p>
<p><img src="/images/2023/11/dbeaver2.webp" alt="Querying Apache Flink from DBeaver"></p>
<p>as well as unbounded:</p>
<p><video autoplay="true" loop="true" width=800 src="/images/2023/11/dbeaver_streaming_flink.mp4"></video></p>
<p>In the case of the unbounded table, it&rsquo;s hard to tell because of the random nature of datagen&rsquo;s data whether what I&rsquo;m seeing is results from <em>one</em> query paged into 200-row chunks, or if each time it goes to get more data it&rsquo;s the <em>first</em> 200 rows of a new result set that&rsquo;s shown.</p>
<p><em>You can add Flink JDBC to DBeaver yourself by modifying <code>plugins/org.jkiss.dbeaver.ext.generic/plugin.xml</code> and rebuilding it (which isn&rsquo;t as scary as it sounds; it&rsquo;s <a href="https://github.com/dbeaver/dbeaver/wiki/Build-from-sources">documented</a> and just watch out for <a href="https://github.com/dbeaver/dbeaver/issues/21841">this issue</a>). I&rsquo;ve submitted <a href="https://github.com/dbeaver/dbeaver/pull/21842">a PR</a> so hopefully by the time you read this it might even be in the downloadable version of the tool :)</em></p>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><a href="https://www.youtube.com/c/rmoff"><b class="fab fa-youtube-square"></b></a> <a href="https://www.linkedin.com/in/robinmoffatt/"><b class="fab fa-linkedin"></b></a> <em><a rel="me" href="https://data-folks.masto.host/@rmoff">Robin Moffatt</a> is a Principal DevEx Engineer at <a href="https://decodable.co">Decodable</a>. He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2024 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
