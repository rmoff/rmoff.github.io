<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/img/default-header-img.webp" type="image/webp">
		
		<title>Analysing ODI batch performance</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2010/11/03/analysing-odi-batch-performance/">
		
		

		
		<meta property="og:title" content="Analysing ODI batch performance" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/img/default-header-img.jpg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2010/11/03/analysing-odi-batch-performance/" />
		<meta property="og:site_name" content="Analysing ODI batch performance" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/img/default-header-img.webp');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Analysing ODI batch performance</h1>
			<p class="article-hero-meta">
				
					<time datetime="2010-11-03T00:00:00Z">03 Nov 2010</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/etl">etl</a>, <a href="https://rmoff.net/categories/odi">odi</a>, <a href="https://rmoff.net/categories/performance">performance</a>
					<span class="display-print">at https://rmoff.net/2010/11/03/analysing-odi-batch-performance/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#odi_04sql--session-runtimes-including-child-sessions">odi_04.sql &ndash; Session runtimes, including child sessions</a></li>
    <li><a href="#odi_06sql--session-runtime-broken-down-by-step">odi_06.sql &ndash; Session runtime, broken down by step</a></li>
    <li><a href="#odi_07sql--session-runtime-broken-down-task-for-a-given-step">odi_07.sql &ndash; Session runtime, broken down task, for a given step</a></li>
    <li><a href="#more-funky-stuff">More funky stuff</a>
      <ul>
        <li><a href="#odi_08sql---identify-task-optimisation-candidates">odi_08.sql - Identify task optimisation candidates</a></li>
      </ul>
    </li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">etl</span><span data-pagefind-filter="category" style="display:none">odi</span><span data-pagefind-filter="category" style="display:none">performance</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/img/default-header-img.jpg" style="display:none" alt="">
	<p>I&rsquo;ve been involved with some performance work around an ODI DWH load batch. The batch comprises well over 1000 tasks in ODI, and whilst the Operator console is not a bad interface, it&rsquo;s not very easy to spot the areas consuming the most runtime.</p>
<p>Here&rsquo;s a set of SQL statements to run against the ODI work repository tables to help you methodically find the steps of most interest for tuning efforts.</p>
<h2 id="odi_04sql--session-runtimes-including-child-sessions">odi_04.sql &ndash; Session runtimes, including child sessions&nbsp;<a class="headline-hash" href="#odi_04sql--session-runtimes-including-child-sessions">ðŸ”—</a> </h2>
<p>First off is the most fancy - using hierarchical SQL, it returns all sessions and child sessions:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- odi_04.sql
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- ODI sessions and child sessions - runtimes
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- https://rnm1978.wordpress.com/
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">--
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#408080;font-style:italic">--level,
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">	</span><span style="color:#408080;font-style:italic">--, parent_sess_no 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">    </span>sess_no,<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span><span style="color:#408080;font-style:italic">--Following column can be included if you want to see the root parent session name
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">	</span><span style="color:#408080;font-style:italic">--CONNECT_BY_ROOT sess_name &#34;Root session&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">  </span><span style="color:#408080;font-style:italic">--
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">  </span><span style="color:#408080;font-style:italic">-- Remove the lpad if you don&#39;t want child sessions indented in the results
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">	</span>lpad(<span style="color:#ba2121">&#39;&gt; &#39;</span>,<span style="color:#666">3</span><span style="color:#666">*</span>(<span style="color:#008000;font-weight:bold">level</span><span style="color:#666">-</span><span style="color:#666">1</span>),<span style="color:#ba2121">&#39;-&#39;</span>)<span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span>sess_name<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Name&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>TO_CHAR(SESS_BEG,<span style="color:#ba2121">&#39;yyyy-mm-dd hh24:mi:ss&#39;</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Session Start&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>TO_CHAR(SESS_END,<span style="color:#ba2121">&#39;yyyy-mm-dd hh24:mi:ss&#39;</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Session End&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>SESS_DUR,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>SESS_STATUS<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>SNP_SESSION<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-- You can determine how many levels to navigate: level 1 is the master sessions and no children, level 2 is the first layer of children, etc.
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">--where level &lt;= 3
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#008000;font-weight:bold">start</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">with</span><span style="color:#bbb"> 	    </span>parent_sess_no<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">is</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">null</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-- Use a mixture of the following predicates to identify your batch within the ODI Work Repository, and/or part of the batch of interest
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">--              and sess_name like &#39;%LOAD%&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">--		          and sess_status = &#39;D&#39; 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">		          </span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>sess_beg<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">between</span><span style="color:#bbb"> </span>to_date(<span style="color:#ba2121">&#39;1/11/2010 09:00&#39;</span>,<span style="color:#ba2121">&#39;DD/MM/YYYY HH24:MI&#39;</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>to_date(<span style="color:#ba2121">&#39;4/11/2010 18:00&#39;</span>,<span style="color:#ba2121">&#39;DD/MM/YYYY HH24:MI&#39;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">connect</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">prior</span><span style="color:#bbb"> </span>sess_no<span style="color:#bbb"> 	</span><span style="color:#666">=</span><span style="color:#bbb"> </span>parent_sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">/</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>This would return something similar to this: <img src="/images/rnm1978/snag-2010-11-03-18-30-05-0000.png" alt="" title="SNAG-2010-11-03-18.30.05-0000"></p>
<p>It&rsquo;s worth noting a couple of things:</p>
<ul>
<li>&ldquo;D&rdquo; status means &ldquo;Done&rdquo;. There&rsquo;s a table in the ODI repository that decodes statuses, although they&rsquo;re normally obvious</li>
<li>Seconds is the total for the session, <em>including</em> child sessions. So in the example shown, &ldquo;LOAD_FACT1_TRANS_BATCH&rdquo; takes a total of 4510 seconds, which is comprised of tasks within the session (see below), plus the runtime of LOAD_FACT1_STUFF (64 seconds) and LOAD_FACT1_SALES (4443 seconds).</li>
</ul>
<p>From this example, there are plenty of long-running steps, so let&rsquo;s pick one I prepared earlier, session number 984170, &ldquo;LOAD_FACT1_SALES&rdquo;, which is a child session of &ldquo;LOAD_FACT1_TRANS_BATCH&rdquo; (session number 980170).</p>
<h2 id="odi_06sql--session-runtime-broken-down-by-step">odi_06.sql &ndash; Session runtime, broken down by step&nbsp;<a class="headline-hash" href="#odi_06sql--session-runtime-broken-down-by-step">ðŸ”—</a> </h2>
<p>Using the session number determined by our analysis of the overall batch session runtimes, here&rsquo;s a query to show the runtime for each step in the session. It is possible to combine this with the hierarchical SQL of above, but I personally found it resulted in too much data to sift though as well as increasing the chances of random stabbing at big numbers. By picking a session from the first query for deliberate further analysis the mind is focussed on it.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- odi_06.sql
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- ODI session broken down by step, for a single session
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- https://rnm1978.wordpress.com/
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">--
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb">  </span>s.sess_no<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Session #&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>sl.nno<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Step Number&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>sess_name<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Session Name&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>ss.step_name<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Step Name&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>to_char(sl.step_beg,<span style="color:#ba2121">&#39;yyyy-mm-dd hh24:mi:ss&#39;</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Step Start&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>to_char(sl.step_end,<span style="color:#ba2121">&#39;yyyy-mm-dd hh24:mi:ss&#39;</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Step End&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>sl.step_dur<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Step Dur (s)&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>SNP_SESSION<span style="color:#bbb"> </span>S<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">outer</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>snp_sess_step<span style="color:#bbb"> </span>ss<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>s.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>ss.sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">inner</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>SNP_STEP_LOG<span style="color:#bbb"> </span>SL<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>ss.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>sl.sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>ss.nno<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>sl.nno<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb">   </span>s.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#666">984170</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>;<span style="color:#bbb">
</span></span></span></code></pre></div><p>For our example session it would give us output something like this:</p>
<p><img src="/images/rnm1978/snag-2010-11-03-18-59-17-0000.png" alt="" title="SNAG-2010-11-03-18.59.17-0000"></p>
<p>So now we can see that of a long-running load step, over 80% of the time is spent on the step &ldquo;Int. Table2 Merge&rdquo;, step number 3</p>
<h2 id="odi_07sql--session-runtime-broken-down-task-for-a-given-step">odi_07.sql &ndash; Session runtime, broken down task, for a given step&nbsp;<a class="headline-hash" href="#odi_07sql--session-runtime-broken-down-task-for-a-given-step">ðŸ”—</a> </h2>
<p>Using the same session number as before, and step number 3 as identified above, let&rsquo;s have a look at the individual tasks:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- odi_07.sql
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- ODI session broken down by task, for a given session and step
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- https://rnm1978.wordpress.com/
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">--
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb">  </span>s.sess_no<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Session #&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>sl.nno<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Step #&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>st.scen_task_no<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Task #&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>st.task_name1<span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39; - &#39;</span><span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span>st.task_name2<span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39; - &#39;</span><span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span>st.task_name3<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Task&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>to_char(stl.task_beg,<span style="color:#ba2121">&#39;yyyy-mm-dd hh24:mi:ss&#39;</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Task Start&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>stl.task_dur,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span>stl.nb_row<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>SNP_SESSION<span style="color:#bbb"> </span>S<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">outer</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>snp_sess_step<span style="color:#bbb"> </span>ss<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>s.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>ss.sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">inner</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>SNP_STEP_LOG<span style="color:#bbb"> </span>SL<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>ss.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>sl.sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>ss.nno<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>sl.nno<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">inner</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>SNP_SESS_TASK<span style="color:#bbb"> </span>ST<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>SS.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>st.sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>ss.nno<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>st.nno<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">inner</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>SNP_SESS_TASK_LOG<span style="color:#bbb"> </span>STL<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">ON</span><span style="color:#bbb"> </span>SL.SESS_NO<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>STL.SESS_NO<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>SL.nno<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>STL.nno<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>SL.nb_run<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>STL.nb_run<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>st.scen_task_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>stl.scen_task_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb">   </span>s.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#666">984170</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>sl.nno<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#666">3</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>;<span style="color:#bbb">
</span></span></span></code></pre></div><p><img src="/images/rnm1978/snag-2010-11-03-19-05-15-0000.png" alt="" title="SNAG-2010-11-03-19.05.15-0000"></p>
<p>So from here I&rsquo;d be focussing on two things:</p>
<ul>
<li>Of the long-running tasks, can they be tuned?</li>
<li>Is this whole step using the most efficient logic? Could some of the tasks be combined or removed entirely? Could the load be done in a better way?</li>
</ul>
<h2 id="more-funky-stuff">More funky stuff&nbsp;<a class="headline-hash" href="#more-funky-stuff">ðŸ”—</a> </h2>
<h3 id="odi_08sql---identify-task-optimisation-candidates">odi_08.sql - Identify task optimisation candidates&nbsp;<a class="headline-hash" href="#odi_08sql---identify-task-optimisation-candidates">ðŸ”—</a> </h3>
<p>At first glance this is a quick-win for listing out the longest running tasks within a batch. And it is that. But, beware of taking a blinkered view of tasks in isolation. The advantage of using the queries above to drill down from overall batch runtime down through sessions, steps, and then to tasks, is that you have the context of the task. Still, this query that follows can be useful for a quick hit list of tasks to check that have been covered off by more detailed analysis.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- odi_08.sql
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- ODI task optimisation candidates
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- 
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">-- https://rnm1978.wordpress.com/
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">--
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">DISTINCT</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#408080;font-style:italic">--level
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">  </span>st.task_name1<span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39; - &#39;</span><span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span>st.task_name2<span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39; - &#39;</span><span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span>st.task_name3<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Task&#34;</span>,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> 	</span>stl.task_dur,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>stl.nb_row,<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>s.sess_no<span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;/&#39;</span><span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb">  </span>sl.nno<span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;/&#39;</span><span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span>stl.scen_task_no<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">as</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Session/Step/Task #&#34;</span>,<span style="color:#bbb">  
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">  </span>SYS_CONNECT_BY_PATH(s.sess_name,<span style="color:#bbb"> </span><span style="color:#ba2121">&#39; / &#39;</span>)<span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39; / &#39;</span><span style="color:#bbb"> </span><span style="color:#666">||</span><span style="color:#bbb">	</span>ss.step_name<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Step Name&#34;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>SNP_SESSION<span style="color:#bbb"> </span>S<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">outer</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>snp_sess_step<span style="color:#bbb"> </span>ss<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>s.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>ss.sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">inner</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>SNP_STEP_LOG<span style="color:#bbb"> </span>SL<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>ss.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>sl.sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>ss.nno<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>sl.nno<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">inner</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>SNP_SESS_TASK<span style="color:#bbb"> </span>ST<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>SS.sess_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>st.sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>ss.nno<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>st.nno<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">inner</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>SNP_SESS_TASK_LOG<span style="color:#bbb"> </span>STL<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">ON</span><span style="color:#bbb"> </span>SL.SESS_NO<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>STL.SESS_NO<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>SL.nno<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>STL.nno<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>SL.nb_run<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>STL.nb_run<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">	</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>st.scen_task_no<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>stl.scen_task_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb"> </span>stl.task_dur<span style="color:#bbb"> </span><span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#666">&amp;&amp;</span>min_duration_secs<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>st.task_name3<span style="color:#bbb"> </span><span style="color:#666">!=</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;Run_Subscribed_Process_ID&#39;</span><span style="color:#bbb"> </span><span style="color:#408080;font-style:italic">-- Ignore parent tasks of child sessions
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#008000;font-weight:bold">start</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">with</span><span style="color:#bbb"> 	    </span>parent_sess_no<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">is</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">null</span><span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">		</span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>sess_beg<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">between</span><span style="color:#bbb"> </span>to_date(<span style="color:#ba2121">&#39;1/11/2010 09:00&#39;</span>,<span style="color:#ba2121">&#39;DD/MM/YYYY HH24:MI&#39;</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>to_date(<span style="color:#ba2121">&#39;1/11/2010 18:00&#39;</span>,<span style="color:#ba2121">&#39;DD/MM/YYYY HH24:MI&#39;</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">connect</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">by</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">prior</span><span style="color:#bbb"> </span>s.sess_no<span style="color:#bbb"> 	</span><span style="color:#666">=</span><span style="color:#bbb"> </span>s.parent_sess_no<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">order</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">by</span><span style="color:#bbb"> </span>stl.task_dur<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">desc</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">/</span><span style="color:#bbb">
</span></span></span></code></pre></div><p><img src="/images/rnm1978/snag-2010-11-03-19-48-24-0000.png" alt="" title="SNAG-2010-11-03-19.48.24-0000"></p>
<p>As can be seen clearly from this, there are several different types of task within ODI and not all with have a row count associated with them.</p>
<p>We can start doing more advanced analysis using this data. For example, of the tasks that do return row counts, what rows/sec throughput are we getting? Are there any steps where the throughput is abnormally low, and therefore a candidate for further examination? Dumping the output of odi_08.sql into Excel and adding a derived column rows/sec, and applying Colour Scales Conditional Formatting gives this: <img src="/images/rnm1978/snag-2010-11-03-19-56-29-0000.png" alt="" title="SNAG-2010-11-03-19.56.29-0000"></p>
<p>Looking at this and picking out two tasks that ran for about seven minutes, I&rsquo;d be a lot more interested in &ldquo;dummy task 13&rdquo; which processed just over 2 million rows in that time, compared to &ldquo;dummy task 2&rdquo; which processed nearly seven times as many - 13 million. Now it may be one is doing a direct insert and the other&rsquo;s doing some complicated merge logic, but it&rsquo;s well worth checking before just heading for the biggest runtime numbers.</p>

	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#odi_04sql--session-runtimes-including-child-sessions">odi_04.sql &ndash; Session runtimes, including child sessions</a></li>
    <li><a href="#odi_06sql--session-runtime-broken-down-by-step">odi_06.sql &ndash; Session runtime, broken down by step</a></li>
    <li><a href="#odi_07sql--session-runtime-broken-down-task-for-a-given-step">odi_07.sql &ndash; Session runtime, broken down task, for a given step</a></li>
    <li><a href="#more-funky-stuff">More funky stuff</a>
      <ul>
        <li><a href="#odi_08sql---identify-task-optimisation-candidates">odi_08.sql - Identify task optimisation candidates</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
