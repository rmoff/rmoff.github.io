<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/img/default-header-img.webp" type="image/webp">
		
		<title>Data Warehousing and Statistics in Oracle 11g - incremental global statistics</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2010/12/30/data-warehousing-and-statistics-in-oracle-11g-incremental-global-statistics/">
		
		

		
		<meta property="og:title" content="Data Warehousing and Statistics in Oracle 11g - incremental global statistics" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/img/default-header-img.jpg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2010/12/30/data-warehousing-and-statistics-in-oracle-11g-incremental-global-statistics/" />
		<meta property="og:site_name" content="Data Warehousing and Statistics in Oracle 11g - incremental global statistics" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/img/default-header-img.webp');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Data Warehousing and Statistics in Oracle 11g - incremental global statistics</h1>
			<p class="article-hero-meta">
				
					<time datetime="2010-12-30T00:00:00Z">30 Dec 2010</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/etl">etl</a>, <a href="https://rmoff.net/categories/oracle">oracle</a>, <a href="https://rmoff.net/categories/statistics">statistics</a>
					<span class="display-print">at https://rmoff.net/2010/12/30/data-warehousing-and-statistics-in-oracle-11g-incremental-global-statistics/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#too-good-to-be-true">Too good to be true?</a></li>
    <li><a href="#behind-the-scenes">Behind the scenes</a></li>
    <li><a href="#test-case">Test case</a></li>
    <li><a href="#results">Results</a></li>
    <li><a href="#why-the-worry">Why the worry?</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">etl</span><span data-pagefind-filter="category" style="display:none">oracle</span><span data-pagefind-filter="category" style="display:none">statistics</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/img/default-header-img.jpg" style="display:none" alt="">
	<p>This is a series of posts where I hope to humbly plug some gaps in the information available (or which has escaped my <a href="http://www.urbandictionary.com/define.php?term=google-fu">google-fu</a>) regarding statistics management in Oracle 11g specific to Data Warehousing.</p>
<p>Incremental Global Statistics is new functionality in Oracle 11g (and 10.2.0.4?) and is explained in depth in several places including:</p>
<ul>
<li><a href="http://download.oracle.com/docs/cd/B28359_01/server.111/b28274/stats.htm#i42218">OracleÂ® Database Performance Tuning Guide - Statistics on Partitioned Objects</a></li>
<li><a href="http://structureddata.org/2008/07/16/oracle-11g-incremental-global-statistics-on-partitioned-tables/">Greg Rahn - Oracle 11g: Incremental Global Statistics On Partitioned Tables</a></li>
<li><a href="http://blogs.oracle.com/optimizer/2009/02/maintaining_statistics_on_large_partitioned_tables.html">Inside the Oracle Optimiser - Maintaining statistics on large partitioned tables</a></li>
<li><a href="http://www.oraclegeek.net/downloads/One_Pass_Distinct_Sampling.ppt">Amit Poddar - One Pass Distinct Sampling</a> (ppt - slides 52 onwards are most relevant)</li>
</ul>
<p>In essence, Oracle maintains information about each partition when statistics is gathered on the partition, and it uses this to work out the global statistics - without having to scan the whole table. For a more detailed description, see the above links. It&rsquo;s important to note that this is not the same as aggregated global statistics (which Doug Burns <a href="http://oracledoug.com/serendipity/index.php?/archives/1590-Statistics-on-Partitioned-Tables-Contents.html">covers in detail here</a>)</p>
<p>To use it, you there are two conditions:</p>
<ol>
<li>The <code>INCREMENTAL</code> value for a partition table is set to <code>TRUE</code></li>
<li>You gather statistics on that table with the <code>GRANULARITY</code> parameter set to <code>AUTO</code></li>
</ol>
<h2 id="too-good-to-be-true">Too good to be true?&nbsp;<a class="headline-hash" href="#too-good-to-be-true">ðŸ”—</a> </h2>
<p>From what I&rsquo;d read, it sounded ideal for what we do, which is load big (10M+ rows per day) tables, partitioned on day. However, when I started testing it I discovered what may be a problem. The information about each partition is stored in the SYSAUX tablespace in two tables:</p>
<ul>
<li><code>SYS.WRI$_OPTSTAT_SYNOPSIS_HEAD$</code></li>
<li><code>SYS.WRI$_OPTSTAT_SYNOPSIS$</code></li>
</ul>
<p>Looking at the <code>WRI$_OPTSTAT_SYNOPSIS$</code> table on one of our databases, it had 216 million rows in and took up about 16GB of space. The documentation does say &ldquo;the SYSAUX tablespace consumes additional space to maintain the global statistics&rdquo; but this is an awful lot of space.</p>
<p>When I ran a test to gather incremental statistics on a two-partition table with a single row in each partition, it took three minutes to gather stats each time! A quick look at SQL Monitor showed that a lot of the time was spent on a <code>DELETE</code> from <code>WRI$_OPTSTAT_SYNOPSIS$</code>.</p>
<p>In a database with no other data in <code>WRI$_OPTSTAT_SYNOPSIS$</code>, the stats gather was sub-second.</p>
<p>Looking at the data on <code>WRI$_OPTSTAT_SYNOPSIS$</code>, it can be determined that for every table, partition, and column, there is an entry on the header table <code>WRI$_OPTSTAT_SYNOPSIS_HEAD$</code>. There is a unique synopsis number given to each combination, which has one or many entries on the synopsis hash table <code>WRI$_OPTSTAT_SYNOPSIS$</code>. There seems to be one hash for every distinct value in the table/partition/column.</p>
<h2 id="behind-the-scenes">Behind the scenes&nbsp;<a class="headline-hash" href="#behind-the-scenes">ðŸ”—</a> </h2>
<p>You can check whether a table is set for <code>INCREMENTAL</code> global statistics in two ways. For an individual table, <code>dbms_stats.get_prefs</code> will return the value:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span>dbms_stats.get_prefs(ownname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;HR&#39;</span>,pname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;INCREMENTAL&#39;</span>,<span style="color:#bbb"> </span>tabname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>dual;<span style="color:#bbb">
</span></span></span></code></pre></div><p>Alternatively, to list all tables in the database that have INCREMENTAL set, use this:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span>u.name<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;OWNER&#34;</span><span style="color:#bbb"> </span>,o.name<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;TABLE_NAME&#34;</span><span style="color:#bbb"> </span>,p.valchar<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>sys.OPTSTAT_USER_PREFS$<span style="color:#bbb"> </span>p<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">inner</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.obj$<span style="color:#bbb"> </span>o<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>p.obj<span style="color:#666">#=</span>o.obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">inner</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.<span style="color:#008000;font-weight:bold">user</span><span style="">$</span><span style="color:#bbb"> </span>u<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>o.<span style="color:#008000;font-weight:bold">owner</span><span style="color:#666">#=</span>u.<span style="color:#008000;font-weight:bold">user</span><span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb"> </span>p.PNAME<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;INCREMENTAL&#39;</span><span style="color:#bbb">
</span></span></span></code></pre></div><p>To look at the synopses (synopsii?), use this query:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>u.NAME<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;owner&#34;</span>,<span style="color:#bbb"> </span>o.NAME<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;table_name&#34;</span>,<span style="color:#bbb"> </span>p.subname<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;partition_name&#34;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">c</span>.NAME<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;column_name&#34;</span>,<span style="color:#bbb"> </span>to_char(h.analyzetime,<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;YYYY-MM-DD-HH24:MI:SS&#39;</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;analyse_Time&#34;</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">COUNT</span>(<span style="color:#666">*</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;hash entries&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>sys.wri$_optstat_synopsis_head$<span style="color:#bbb"> </span>h<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.<span style="color:#666">`</span>WRI$_OPTSTAT_SYNOPSIS$<span style="color:#666">`</span><span style="color:#bbb"> </span>s<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ON</span><span style="color:#bbb"> </span>h.synopsis<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>s.synopsis<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.obj$<span style="color:#bbb"> </span>o<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ON</span><span style="color:#bbb"> </span>h.bo<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>o.obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.<span style="color:#008000;font-weight:bold">user</span><span style="">$</span><span style="color:#bbb"> </span>u<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ON</span><span style="color:#bbb"> </span>o.<span style="color:#008000;font-weight:bold">owner</span><span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>u.<span style="color:#008000;font-weight:bold">user</span><span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.col$<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">c</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ON</span><span style="color:#bbb"> </span>h.bo<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">c</span>.obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AND</span><span style="color:#bbb"> </span>h.intcol<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">c</span>.intcol<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>(<span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>bo<span style="color:#666">#</span>,<span style="color:#bbb"> </span>obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>sys.tabpart$<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">UNION</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ALL</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>bo<span style="color:#666">#</span>,<span style="color:#bbb"> </span>obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>sys.tabcompart$)<span style="color:#bbb"> </span>tp<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ON</span><span style="color:#bbb"> </span>h.bo<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>tp.bo<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AND</span><span style="color:#bbb"> </span>h.<span style="color:#008000;font-weight:bold">group</span><span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>tp.obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">*</span><span style="color:#bbb"> </span><span style="color:#666">2</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.obj$<span style="color:#bbb"> </span>p<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ON</span><span style="color:#bbb"> </span>tp.obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>p.obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>u.NAME,<span style="color:#bbb"> </span>o.NAME,<span style="color:#bbb"> </span>p.subname,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">c</span>.NAME,<span style="color:#bbb"> </span>h.analyzetime<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">ORDER</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>u.NAME,<span style="color:#bbb"> </span>o.NAME,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">c</span>.NAME;<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="test-case">Test case&nbsp;<a class="headline-hash" href="#test-case">ðŸ”—</a> </h2>
<p>This is the test case I&rsquo;ve been using to investigate the issue. It is hopefully self-documenting.</p>
<p>I&rsquo;ve written a set of queries that examine the statistics in the data dictionary so that I can see how they get built up. USER_TAB_STATS_HISTORY is good for seeing a chronological record of the stats gathers.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#408080;font-style:italic">/* http://rnm1978.wordpress.com/ */</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="">\</span><span style="color:#408080;font-style:italic">-- -- ***************************** -- test_incr_stats.sql -- -- Test incremental statistic gathering -- ***************************** --
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>echo<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">off</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>timing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">off</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>feedback<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Check</span><span style="color:#bbb"> </span>the<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">current</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">size</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">of</span><span style="color:#bbb"> </span>the<span style="color:#bbb"> </span>synopsis<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#666">`</span>WRI$_OPTSTAT_SYNOPSIS$<span style="color:#666">`</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span>,<span style="color:#bbb"> </span>num_rows<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>dba_tables<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">like</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;WRI$_OPTSTAT_SYNOPSIS%&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span>to_char(<span style="color:#008000;font-weight:bold">min</span>(h.analyzetime),<span style="color:#ba2121">&#39;YYYY-MM-DD-HH24:MI:SS&#39;</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Earliest Synopsis&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>SYS.WRI$_OPTSTAT_SYNOPSIS_HEAD$<span style="color:#bbb"> </span>h;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Create</span><span style="color:#bbb"> </span>a<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">simple</span><span style="color:#bbb"> </span>test<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">drop</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table</span><span style="color:#bbb"> </span>BASE_T1;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">TABLE</span><span style="color:#bbb"> </span>BASE_T1<span style="color:#bbb"> </span>(<span style="color:#bbb"> </span>day_key<span style="color:#bbb"> </span><span style="color:#008000">INTEGER</span>,<span style="color:#bbb"> </span>store_num<span style="color:#bbb"> </span><span style="color:#008000">INTEGER</span>,<span style="color:#bbb"> </span>fact_01<span style="color:#bbb"> </span><span style="color:#008000">NUMBER</span>(<span style="color:#666">38</span>,<span style="color:#666">4</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">DEFAULT</span><span style="color:#bbb"> </span><span style="color:#666">0</span>)<span style="color:#bbb"> </span>PARTITION<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>RANGE<span style="color:#bbb"> </span>(<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;DAY_KEY&#34;</span>)<span style="color:#bbb"> </span>(<span style="color:#bbb"> </span>PARTITION<span style="color:#bbb"> </span>PART_1<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">VALUES</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">LESS</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">THAN</span><span style="color:#bbb"> </span>(<span style="color:#666">2</span>)<span style="color:#bbb"> </span>NOCOMPRESS,<span style="color:#bbb"> </span>PARTITION<span style="color:#bbb"> </span>PART_2<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">VALUES</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">LESS</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">THAN</span><span style="color:#bbb"> </span>(<span style="color:#666">3</span>)<span style="color:#bbb"> </span>NOCOMPRESS)<span style="color:#bbb"> </span>PARALLEL;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Set</span><span style="color:#bbb"> </span>the<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">to</span><span style="color:#bbb"> </span>INCREMENTAL<span style="color:#bbb"> </span>stats<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">exec</span><span style="color:#bbb"> </span>dbms_stats.set_table_prefs(pname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;INCREMENTAL&#39;</span>,ownname<span style="color:#666">=&gt;</span><span style="color:#008000;font-weight:bold">USER</span>,tabname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>,pvalue<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;TRUE&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>Gather<span style="color:#bbb"> </span>initial<span style="color:#bbb"> </span>stats<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>timing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">exec</span><span style="color:#bbb"> </span>dbms_stats.gather_table_stats(<span style="color:#bbb"> </span>ownname<span style="color:#666">=&gt;</span><span style="color:#008000;font-weight:bold">USER</span>,<span style="color:#bbb"> </span>tabname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>,<span style="color:#bbb"> </span>granularity<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;AUTO&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>timing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">off</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Add</span><span style="color:#bbb"> </span>one<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">row</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">of</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">to</span><span style="color:#bbb"> </span>partition<span style="color:#bbb"> </span><span style="color:#666">1</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">into</span><span style="color:#bbb"> </span>base_t1<span style="color:#bbb"> </span>(day_key,store_num,fact_01)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">values</span><span style="color:#bbb"> </span>(<span style="color:#666">1</span>,<span style="color:#bbb"> </span><span style="color:#666">1</span>,<span style="color:#666">10</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>Gather<span style="color:#bbb"> </span>stats<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>timing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">exec</span><span style="color:#bbb"> </span>dbms_stats.gather_table_stats(<span style="color:#bbb"> </span>ownname<span style="color:#666">=&gt;</span><span style="color:#008000;font-weight:bold">USER</span>,<span style="color:#bbb"> </span>tabname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>,<span style="color:#bbb"> </span>granularity<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;AUTO&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>timing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">off</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Add</span><span style="color:#bbb"> </span>one<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">row</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">of</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">to</span><span style="color:#bbb"> </span>partition<span style="color:#bbb"> </span><span style="color:#666">2</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">into</span><span style="color:#bbb"> </span>base_t1<span style="color:#bbb"> </span>(day_key,store_num,fact_01)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">values</span><span style="color:#bbb"> </span>(<span style="color:#666">2</span>,<span style="color:#bbb"> </span><span style="color:#666">1</span>,<span style="color:#666">10</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>Gather<span style="color:#bbb"> </span>stats<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>timing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">exec</span><span style="color:#bbb"> </span>dbms_stats.gather_table_stats(<span style="color:#bbb"> </span>ownname<span style="color:#666">=&gt;</span><span style="color:#008000;font-weight:bold">USER</span>,<span style="color:#bbb"> </span>tabname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>,<span style="color:#bbb"> </span>granularity<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;AUTO&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>timing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">off</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Add</span><span style="color:#bbb"> </span>another<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">row</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">of</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">to</span><span style="color:#bbb"> </span>partition<span style="color:#bbb"> </span><span style="color:#666">1</span>,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">with</span><span style="color:#bbb"> </span>a<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">new</span><span style="color:#bbb"> </span>store_num<span style="color:#bbb"> </span>value<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">insert</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">into</span><span style="color:#bbb"> </span>base_t1<span style="color:#bbb"> </span>(day_key,store_num,fact_01)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">values</span><span style="color:#bbb"> </span>(<span style="color:#666">1</span>,<span style="color:#bbb"> </span><span style="color:#666">2</span>,<span style="color:#666">10</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span><span style="color:#666">************</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>Gather<span style="color:#bbb"> </span>stats<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>timing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">exec</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>dbms_stats.gather_table_stats(<span style="color:#bbb"> </span>ownname<span style="color:#666">=&gt;</span><span style="color:#008000;font-weight:bold">USER</span>,<span style="color:#bbb"> </span>tabname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>,<span style="color:#bbb"> </span>granularity<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;AUTO&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>timing<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">off</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">set</span><span style="color:#bbb"> </span>linesize<span style="color:#bbb"> </span><span style="color:#666">156</span><span style="color:#bbb"> </span>col<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a12<span style="color:#bbb"> </span>col<span style="color:#bbb"> </span>partition_name<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a14<span style="color:#bbb"> </span>col<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">column_name</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a12<span style="color:#bbb"> </span>col<span style="color:#bbb"> </span>high_value<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a8<span style="color:#bbb"> </span>col<span style="color:#bbb"> </span>low_value<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a8<span style="color:#bbb"> </span>col<span style="color:#bbb"> </span>global_stats<span style="color:#bbb"> </span>head<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Global|Stats&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a7<span style="color:#bbb"> </span>col<span style="color:#bbb"> </span>stale_stats<span style="color:#bbb"> </span>head<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Stale|Stats&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">for</span><span style="color:#bbb"> </span>a5<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>Incremental<span style="color:#bbb"> </span>stats<span style="color:#bbb"> </span>setting:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span>dbms_stats.get_prefs(ownname<span style="color:#666">=&gt;</span><span style="color:#008000;font-weight:bold">USER</span>,pname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;INCREMENTAL&#39;</span>,<span style="color:#bbb"> </span>tabname<span style="color:#666">=&gt;</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>dual;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>Actual<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">in</span><span style="color:#bbb"> </span>the<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span>day_key,<span style="color:#008000;font-weight:bold">count</span>(<span style="color:#666">*</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>BASE_T1<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">group</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">by</span><span style="color:#bbb"> </span>day_key<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">order</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">by</span><span style="color:#bbb"> </span>day_key<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">asc</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>USER_TAB_STATISTICS:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span>,partition_name,num_rows,sample_size,<span style="color:#bbb"> </span>to_char(last_analyzed,<span style="color:#ba2121">&#39;YYYY-MM-DD-HH24:MI:SS&#39;</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Last Analyzed&#34;</span>,global_stats,stale_stats<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>user_tab_statistics<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span><span style="color:#666">=</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>USER_TAB_STATS_HISTORY:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span>,partition_name,stats_update_time<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>user_tab_stats_history<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span><span style="color:#666">=</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">order</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">by</span><span style="color:#bbb"> </span>stats_update_time<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">asc</span><span style="color:#bbb"> </span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>USER_TAB_COL_STATISTICS:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span>,<span style="color:#008000;font-weight:bold">column_name</span>,sample_size,to_char(last_analyzed,<span style="color:#ba2121">&#39;YYYY-MM-DD-HH24:MI:SS&#39;</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Last Analyzed&#34;</span>,<span style="color:#bbb"> </span>global_stats,num_distinct,low_value,high_value<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>USER_TAB_COL_STATISTICS<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span><span style="color:#666">=</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>USER_PART_COL_STATISTICS:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span>,partition_name,<span style="color:#008000;font-weight:bold">column_name</span>,sample_size,to_char(last_analyzed,<span style="color:#ba2121">&#39;YYYY-MM-DD-HH24:MI:SS&#39;</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Last Analyzed&#34;</span>,<span style="color:#bbb"> </span>global_stats,num_distinct,low_value,high_value<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>USER_PART_COL_STATISTICS<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">table_name</span><span style="color:#666">=</span><span style="color:#ba2121">&#39;BASE_T1&#39;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>prompt<span style="color:#bbb"> </span>Synopsis<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">data</span>:<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>o.name<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;TABLE_NAME&#34;</span><span style="color:#bbb"> </span>,p.subname<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Part&#34;</span><span style="color:#bbb"> </span>,<span style="color:#008000;font-weight:bold">c</span>.name<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Column&#34;</span><span style="color:#bbb"> </span>,to_char(h.analyzetime,<span style="color:#ba2121">&#39;YYYY-MM-DD-HH24:MI:SS&#39;</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Analyse Time&#34;</span><span style="color:#bbb"> </span>,<span style="color:#008000;font-weight:bold">count</span>(<span style="color:#666">*</span>)<span style="color:#bbb"> </span><span style="color:#ba2121">&#34;Hash count&#34;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>SYS.WRI$_OPTSTAT_SYNOPSIS_HEAD$<span style="color:#bbb"> </span>h<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.<span style="color:#666">`</span>WRI$_OPTSTAT_SYNOPSIS$<span style="color:#666">`</span><span style="color:#bbb"> </span>s<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>h.synopsis<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span>s.synopsis<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.obj$<span style="color:#bbb"> </span>o<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>h.bo<span style="color:#666">#=</span>o.obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.<span style="color:#008000;font-weight:bold">user</span><span style="">$</span><span style="color:#bbb"> </span>u<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>o.<span style="color:#008000;font-weight:bold">owner</span><span style="color:#666">#=</span>u.<span style="color:#008000;font-weight:bold">user</span><span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.col$<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">c</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>h.bo<span style="color:#666">#=</span><span style="color:#008000;font-weight:bold">c</span>.obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>h.intcol<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">c</span>.intcol<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>(<span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span>bo<span style="color:#666">#</span>,obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>sys.tabpart$<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">union</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">all</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">select</span><span style="color:#bbb"> </span>bo<span style="color:#666">#</span>,obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">from</span><span style="color:#bbb"> </span>sys.tabcompart$)<span style="color:#bbb"> </span>tp<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>h.bo<span style="color:#666">#=</span>tp.bo<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>h.<span style="color:#008000;font-weight:bold">group</span><span style="color:#666">#=</span>tp.obj<span style="color:#666">#*</span><span style="color:#666">2</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">left</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">join</span><span style="color:#bbb"> </span>sys.obj$<span style="color:#bbb"> </span>p<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">on</span><span style="color:#bbb"> </span>tp.obj<span style="color:#666">#=</span>p.obj<span style="color:#666">#</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">where</span><span style="color:#bbb"> </span>u.name<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">USER</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>o.name<span style="color:#bbb"> </span><span style="color:#666">=</span><span style="color:#bbb"> </span><span style="color:#ba2121">&#39;BASE_T1&#39;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">group</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">by</span><span style="color:#bbb"> </span>u.name,o.name<span style="color:#bbb"> </span>,p.subname,<span style="color:#008000;font-weight:bold">c</span>.name,h.analyzetime<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">order</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">by</span><span style="color:#bbb"> </span>u.name,o.name;<span style="color:#bbb">
</span></span></span></code></pre></div><h2 id="results">Results&nbsp;<a class="headline-hash" href="#results">ðŸ”—</a> </h2>
<p>This was run on Oracle 11.1.0.7, on several different databases. I&rsquo;ve edited the output slightly for brevity.</p>
<p>Where SYS.WRI$_OPTSTAT_SYNOPSIS is small, it can be seen that the stats gather is fast - as would be expected for a table so small:</p>
<pre tabindex="0"><code>************ Check the current size of the synopsis table `WRI$_OPTSTAT_SYNOPSIS$`

TABLE_NAME   NUM_ROWS
------------ ----------
WRI$_OPTSTAT 0
WRI$_OPTSTAT 1940
WRI$_OPTSTAT 287236

Gather initial stats PL/SQL procedure successfully completed.
Elapsed: 00:00:00.16

************ Add one row of data to partition 1
************ Gather stats PL/SQL procedure successfully completed.
Elapsed: 00:00:00.27
************ Add one row of data to partition 2
************ Gather stats PL/SQL procedure successfully completed.
Elapsed: 00:00:00.27
************ Add another row of data to partition 1, with a new store_num value
************ Gather stats PL/SQL procedure successfully completed.
Elapsed: 00:00:00.34

Incremental stats setting:
DBMS_STATS.GET_PREFS(OWNNAME=&gt;USER,PNAME=&gt;&#39;INCREMENTAL&#39;,TABNAME=&gt;&#39;BASE_T1&#39;)
------------------------------------------------------------------------------------------------
TRUE

Actual data in the table:

DAY_KEY     COUNT(*)
----------  ----------
1           2
2           1

2 rows selected.

USER_TAB_STATISTICS:

Global Stale TABLE_NAME PARTITION_NAME NUM_ROWS SAMPLE_SIZE Last Analyzed Stats Stats ------------ -------------- ---------- ----------- ------------------- ------- ----- BASE_T1 3 3 2010-12-30-18:04:56 YES NO BASE_T1 PART_1 2 2 2010-12-30-18:04:56 YES NO BASE_T1 PART_2 1 1 2010-12-30-18:04:56 YES NO

3 rows selected.

USER_TAB_STATS_HISTORY:

TABLE_NAME PARTITION_NAME STATS_UPDATE_TIME ------------ -------------- --------------------------------------------------------------------------- BASE_T1 PART_1 30-DEC-10 18.04.55.633710 +00:00 BASE_T1 PART_2 30-DEC-10 18.04.55.633710 +00:00 BASE_T1 30-DEC-10 18.04.55.645162 +00:00 BASE_T1 PART_1 30-DEC-10 18.04.55.856920 +00:00 BASE_T1 30-DEC-10 18.04.55.910722 +00:00 BASE_T1 PART_2 30-DEC-10 18.04.56.126645 +00:00 BASE_T1 30-DEC-10 18.04.56.181336 +00:00 BASE_T1 PART_1 30-DEC-10 18.04.56.442624 +00:00 BASE_T1 30-DEC-10 18.04.56.527702 +00:00

9 rows selected.

USER_TAB_COL_STATISTICS:

Global TABLE_NAME COLUMN_NAME SAMPLE_SIZE Last Analyzed Stats NUM_DISTINCT LOW_VALU HIGH_VAL ------------ ------------ ----------- ------------------- ------- ------------ -------- -------- BASE_T1 DAY_KEY 3 2010-12-30-18:04:56 YES 2 C102 C103 BASE_T1 STORE_NUM 3 2010-12-30-18:04:56 YES 2 C102 C103 BASE_T1 FACT_01 3 2010-12-30-18:04:56 YES 1 C10B C10B

3 rows selected.

USER_PART_COL_STATISTICS:

Global TABLE_NAME PARTITION_NAME COLUMN_NAME SAMPLE_SIZE Last Analyzed Stats NUM_DISTINCT LOW_VALU HIGH_VAL ------------ -------------- ------------ ----------- ------------------- ------- ------------ -------- -------- BASE_T1 PART_1 DAY_KEY 2 2010-12-30-18:04:56 YES 1 C102 C102 BASE_T1 PART_1 STORE_NUM 2 2010-12-30-18:04:56 YES 2 C102 C103 BASE_T1 PART_1 FACT_01 2 2010-12-30-18:04:56 YES 1 C10B C10B BASE_T1 PART_2 DAY_KEY 1 2010-12-30-18:04:56 YES 1 C103 C103 BASE_T1 PART_2 STORE_NUM 1 2010-12-30-18:04:56 YES 1 C102 C102 BASE_T1 PART_2 FACT_01 1 2010-12-30-18:04:56 YES 1 C10B C10B

6 rows selected.

Synopsis data:

TABLE_NAME Part Column Analyse Time Hash count ------------ ------------------------------ ------------------------------ ------------------- ---------- BASE_T1 PART_2 DAY_KEY 2010-12-30-18:04:56 1 BASE_T1 PART_2 FACT_01 2010-12-30-18:04:56 1 BASE_T1 PART_1 STORE_NUM 2010-12-30-18:04:56 2 BASE_T1 PART_1 DAY_KEY 2010-12-30-18:04:56 1 BASE_T1 PART_2 STORE_NUM 2010-12-30-18:04:56 1 BASE_T1 PART_1 FACT_01 2010-12-30-18:04:56 1

6 rows selected.
</code></pre><p>Note that there are two hash values for the synopsis for PART_1 column STORE_NUM, because there are two values in the column in that partition.</p>
<p>You can see clearly from USER_TAB_STATS_HISTORY three things:</p>
<ol>
<li>The order in which stats are gathered - partitions, and then table</li>
<li>That partitions that have not been updated are not re-analyzed</li>
<li>That global stats are updated each time the stats gather is run</li>
</ol>
<p>Where SYS.WRI$_OPTSTAT_SYNOPSIS is large, stats gather is much slower:</p>
<pre tabindex="0"><code>Check the current size of the synopsis table `WRI$_OPTSTAT_SYNOPSIS$`

TABLE_NAME NUM_ROWS ------------------------------ ---------- WRI$_OPTSTAT_SYNOPSIS_PARTGRP 0 WRI$_OPTSTAT_SYNOPSIS_HEAD$ 64259 `WRI$_OPTSTAT_SYNOPSIS$` 216854569

************ Gather initial stats Elapsed: 00:00:00.57 ************ Add one row of data to partition 1 ************ Gather stats Elapsed: 00:03:04.58 ************ Add one row of data to partition 2 ************ Gather stats Elapsed: 00:02:25.20 ************ Add another row of data to partition 1, with a new store_num value ************ Gather stats Elapsed: 00:02:25.76 ************

Actual data in the table:

DAY_KEY COUNT(*) ---------- ---------- 1 2 2 1

USER_TAB_STATISTICS:

Global Stale TABLE_NAME PARTITION_NAME NUM_ROWS SAMPLE_SIZE Last Analyzed Stats Stats ------------ -------------- ---------- ----------- ------------------- ------- ----- BASE_T1 3 3 2010-12-30-17:51:34 YES NO BASE_T1 PART_1 2 2 2010-12-30-17:50:53 YES NO BASE_T1 PART_2 1 1 2010-12-30-17:48:27 YES NO

USER_TAB_STATS_HISTORY:

TABLE_NAME PARTITION_NAME STATS_UPDATE_TIME ------------ -------------- --------------------------------------------------------------------------- BASE_T1 PART_1 30-DEC-10 17.43.39.320426 +00:00 BASE_T1 PART_2 30-DEC-10 17.43.39.320426 +00:00 BASE_T1 30-DEC-10 17.43.39.360753 +00:00 BASE_T1 PART_1 30-DEC-10 17.46.02.331166 +00:00 BASE_T1 30-DEC-10 17.46.43.939090 +00:00 BASE_T1 PART_2 30-DEC-10 17.48.27.926559 +00:00 BASE_T1 30-DEC-10 17.49.09.144722 +00:00 BASE_T1 PART_1 30-DEC-10 17.50.53.818049 +00:00 BASE_T1 30-DEC-10 17.51.34.915096 +00:00

USER_TAB_COL_STATISTICS:

Global TABLE_NAME COLUMN_NAME SAMPLE_SIZE Last Analyzed Stats NUM_DISTINCT LOW_VALU HIGH_VAL ------------ ------------ ----------- ------------------- ------- ------------ -------- -------- BASE_T1 DAY_KEY 3 2010-12-30-17:51:34 YES 2 C102 C103 BASE_T1 STORE_NUM 3 2010-12-30-17:51:34 YES 2 C102 C103 BASE_T1 FACT_01 3 2010-12-30-17:51:34 YES 1 C10B C10B

USER_PART_COL_STATISTICS:

Global TABLE_NAME PARTITION_NAME COLUMN_NAME SAMPLE_SIZE Last Analyzed Stats NUM_DISTINCT LOW_VALU HIGH_VAL ------------ -------------- ------------ ----------- ------------------- ------- ------------ -------- -------- BASE_T1 PART_1 DAY_KEY 2 2010-12-30-17:50:53 YES 1 C102 C102 BASE_T1 PART_1 STORE_NUM 2 2010-12-30-17:50:53 YES 2 C102 C103 BASE_T1 PART_1 FACT_01 2 2010-12-30-17:50:53 YES 1 C10B C10B BASE_T1 PART_2 DAY_KEY 1 2010-12-30-17:48:27 YES 1 C103 C103 BASE_T1 PART_2 STORE_NUM 1 2010-12-30-17:48:27 YES 1 C102 C102 BASE_T1 PART_2 FACT_01 1 2010-12-30-17:48:27 YES 1 C10B C10B

Synopsis data:

TABLE_NAME Part Column Analyse Time Hash count ------------ ------------------------------ ------------------------------ ------------------- ---------- BASE_T1 PART_1 FACT_01 2010-12-30-17:50:53 1 BASE_T1 PART_2 DAY_KEY 2010-12-30-17:48:27 1 BASE_T1 PART_1 STORE_NUM 2010-12-30-17:50:53 2 BASE_T1 PART_2 FACT_01 2010-12-30-17:48:27 1 BASE_T1 PART_2 STORE_NUM 2010-12-30-17:48:27 1 BASE_T1 PART_1 DAY_KEY 2010-12-30-17:50:53 1
</code></pre><h2 id="why-the-worry">Why the worry?&nbsp;<a class="headline-hash" href="#why-the-worry">ðŸ”—</a> </h2>
<p>My worry is that with wide tables and many partitions, the synopsis history could grow very large. In the same way that FTS of a big table to gather global stats the &lsquo;old&rsquo; way is going to get slower as the size increases, is the same going to happen with incremental stats?</p>
<p>I&rsquo;ve dug around on My Oracle Support but not hit any specific bugs on this.</p>
<p>I found <a href="http://forums.oracle.com/forums/thread.jspa?threadID=862386">a posting on OTN</a> describing the same behaviour as I&rsquo;ve found, but with the comment &ldquo;Oracle [&hellip;] just tell me that it is normal, expected behaviour and that if I don&rsquo;t like it I should turn off Incremental global stats.&rdquo;.</p>
<p>Doing some back-of-a-fag-packet maths with some of our tables would have the synopsis information growing at 150k rows per day for one table. We&rsquo;ve quite a few wide &amp; big tables, and unless we can convince our users to make do with no history ;-) they&rsquo;re going to keep growing.</p>
<p>Hopefully someone will see this and point out something I&rsquo;ve not understood about the functionality, or missed in the documentation. If not, then I&rsquo;m going to do some larger-scale testing to try and put numbers around stats gather times using incremental vs non-incremental. If nothing else, to get a better understanding of how big this table could be growing.</p>
<p>I&rsquo;d be really interested to know what other data warehousing sites on 11g do in terms of partitioned table statistics and whether they use incremental stats or not.</p>
<p>Comments most welcome, please! :)</p>

	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#too-good-to-be-true">Too good to be true?</a></li>
    <li><a href="#behind-the-scenes">Behind the scenes</a></li>
    <li><a href="#test-case">Test case</a></li>
    <li><a href="#results">Results</a></li>
    <li><a href="#why-the-worry">Why the worry?</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
