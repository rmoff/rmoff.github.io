<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2019/08/IMG_9097.jpg" >
		
		<title>Reset Kafka Connect Source Connector Offsets</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2019/08/15/reset-kafka-connect-source-connector-offsets/">
		
		

		
		<meta property="og:title" content="Reset Kafka Connect Source Connector Offsets" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2019/08/IMG_9097.jpg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2019/08/15/reset-kafka-connect-source-connector-offsets/" />
		<meta property="og:site_name" content="Reset Kafka Connect Source Connector Offsets" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2019/08/IMG_9097.jpg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Reset Kafka Connect Source Connector Offsets</h1>
			<p class="article-hero-meta">
				
					<time datetime="2019-08-15T10:42:34&#43;01:00">15 Aug 2019</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/kafka-connect">Kafka Connect</a>, <a href="https://rmoff.net/categories/offsets">offsets</a>, <a href="https://rmoff.net/categories/kcat-kafkacat">kcat (kafkacat)</a>
					<span class="display-print">at https://rmoff.net/2019/08/15/reset-kafka-connect-source-connector-offsets/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Kafka Connect</span><span data-pagefind-filter="category" style="display:none">offsets</span><span data-pagefind-filter="category" style="display:none">kcat (kafkacat)</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2019/08/IMG_9097.jpg" style="display:none" alt="">
	<div class="paragraph">
<p>Kafka Connect in distributed mode uses Kafka itself to persist the offsets of any source connectors. This is a great way to do things as it means that you can easily add more workers, rebuild existing ones, etc without having to worry about where the state is persisted. I personally always recommend using distributed mode, even if just for a single worker instance - it just makes things easier, and more standard. Watch my <a href="https://www.confluent.io/online-talks/from-zero-to-hero-with-kafka-connect">talk online here</a> to understand more about this. If you want to <em>reset</em> the offset of a source connector then you can do so by <em>very carefully</em> modifying the data in the Kafka topic itself.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The offsets of Sink connectors are managed using the Kafka consumer group protocol (<a href="/2019/08/09/resetting-a-consumer-group-in-kafka/">see here</a> for how an example of how to reset those)
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In this example I’m using the very simple FileStreamSourceConnector.</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>-H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> http://localhost:8083/connectors/source-file-01/config <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>-d <span style="color:#ba2121">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">    &#34;connector.class&#34;: &#34;org.apache.kafka.connect.file.FileStreamSourceConnector&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">    &#34;key.converter&#34;: &#34;org.apache.kafka.connect.storage.StringConverter&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">    &#34;value.converter&#34;: &#34;org.apache.kafka.connect.storage.StringConverter&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">    &#34;topic&#34;: &#34;testdata&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">    &#34;file&#34;:&#34;/data/testdata.txt&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">    }&#39;</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>As I add data to the file, it is ingested by Kafka Connect and written to a topic.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This connector is just for testing really; for proper file-based ingestion check out <a href="https://www.confluent.io/hub/jcustenborder/kafka-connect-spooldir">kafka-connect-spooldir</a>. There’s also <a href="https://github.com/streamthoughts/kafka-connect-file-pulse">kafka-connect-file-pulse</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>So now let’s imagine we want to get the connector to <strong>re-consume</strong> all of the source data. One very simple option is to just rename the connector, which then means it has no existing offsets stored, and thus will start from the beginning again. This can be a bit clumsy though depending on the use case. The alternative is to modify the actual offsets themselves.</p>
</div>
<div class="paragraph">
<p>The first thing is to determine the Kafka topic being used to persist the offsets. The default is usually <code>connect-offsets</code> but I’ve taken to overriding this to include an underscore prefix to make it easy to spot an internal topic. Regardless; you can look at your Connect worker config, and/or check the worker log for <code>offset.storage.topic</code>:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span> <span style="color:#666">[</span>2019-08-15 08:29:46,585<span style="color:#666">]</span> INFO DistributedConfig values:
</span></span><span style="display:flex;"><span><span style="color:#666">[</span>…<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>   offset.storage.partitions <span style="color:#666">=</span> <span style="color:#666">25</span>
</span></span><span style="display:flex;"><span>   offset.storage.replication.factor <span style="color:#666">=</span> <span style="color:#666">1</span>
</span></span><span style="display:flex;"><span>   offset.storage.topic <span style="color:#666">=</span> _connect-offsets
</span></span><span style="display:flex;"><span><span style="color:#666">[</span>…<span style="color:#666">]</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Now shutdown <em>all</em> connect workers that are using this topic. If you don’t do this then funny things might happen, since connect only periodically flushes offsets to the topic, and doesn’t read them from it except at startup.</p>
</div>
<div class="paragraph">
<p>With the connect worker shutdown, you can now examine the topic. I’m using <code>kafkacat</code> here because it is very flexible in how it works with both keys and partitions which will be very important in a moment.</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="">$</span> <span style="">kafkacat</span> <span style="">-b</span> <span style="">localhost:</span><span style="color:#666">9092</span> <span style="">-t</span> <span style="">_connect-offsets</span> <span style="">-C</span> <span style="">-K#</span>
</span></span><span style="display:flex;"><span><span style="">%</span> <span style="">Reached</span> <span style="">end</span> <span style="">of</span> <span style="">topic</span> <span style="">_connect-offsets</span> [<span style="color:#666">0</span>] <span style="">at</span> <span style="">offset</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span><span style="">%</span> <span style="">Reached</span> <span style="">end</span> <span style="">of</span> <span style="">topic</span> <span style="">_connect-offsets</span> [<span style="color:#666">1</span>] <span style="">at</span> <span style="">offset</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>[<span style="">…</span>]
</span></span><span style="display:flex;"><span>[<span style="color:#ba2121">&#34;source-file-01&#34;</span>,{<span style="color:#008000;font-weight:bold">&#34;filename&#34;</span>:<span style="color:#ba2121">&#34;/data/testdata.txt&#34;</span>}]<span style="">#</span>{<span style="color:#008000;font-weight:bold">&#34;position&#34;</span>:<span style="color:#666">87</span>}
</span></span><span style="display:flex;"><span>[<span style="">…</span>]</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>We can see here using the consumer mode (<code>-C</code>) and a key separator character of <code>#</code> that the key of the message is the connector’s name plus file</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[<span style="color:#ba2121">&#34;source-file-01&#34;</span>,{<span style="color:#008000;font-weight:bold">&#34;filename&#34;</span>:<span style="color:#ba2121">&#34;/data/testdata.txt&#34;</span>}]</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>and the value of the message is the position offset in the file</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#008000;font-weight:bold">&#34;position&#34;</span>:<span style="color:#666">87</span>}</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Now use the <code>-f</code> option of <code>kafkacat</code> to display this even more clearly, along with a bunch of other important metadata including the <strong>partition</strong>:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="">$</span> <span style="">kafkacat</span> <span style="">-b</span> <span style="">localhost:</span><span style="color:#666">9092</span> <span style="">-t</span> <span style="">_connect-offsets</span> <span style="">-C</span> <span style="">-f</span> <span style="">&#39;\nKey</span> <span style="">(%K</span> <span style="">bytes):</span> <span style="">%k</span>
</span></span><span style="display:flex;"><span>  <span style="">Value</span> <span style="">(%S</span> <span style="">bytes):</span> <span style="">%s</span>
</span></span><span style="display:flex;"><span>  <span style="">Timestamp:</span> <span style="">%T</span>
</span></span><span style="display:flex;"><span>  <span style="">Partition:</span> <span style="">%p</span>
</span></span><span style="display:flex;"><span>  <span style="">Offset:</span> <span style="">%o\n&#39;</span>
</span></span><span style="display:flex;"><span><span style="">%</span> <span style="">Reached</span> <span style="">end</span> <span style="">of</span> <span style="">topic</span> <span style="">_connect-offsets</span> [<span style="color:#666">0</span>] <span style="">at</span> <span style="">offset</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span><span style="">%</span> <span style="">Reached</span> <span style="">end</span> <span style="">of</span> <span style="">topic</span> <span style="">_connect-offsets</span> [<span style="color:#666">1</span>] <span style="">at</span> <span style="">offset</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>[<span style="">…</span>]
</span></span><span style="display:flex;"><span><span style="">Key</span> <span style="">(</span><span style="color:#666">52</span> <span style="">bytes):</span> [<span style="color:#ba2121">&#34;source-file-01&#34;</span>,{<span style="color:#008000;font-weight:bold">&#34;filename&#34;</span>:<span style="color:#ba2121">&#34;/data/testdata.txt&#34;</span>}]
</span></span><span style="display:flex;"><span><span style="">Value</span> <span style="">(</span><span style="color:#666">15</span> <span style="">bytes):</span> {<span style="color:#008000;font-weight:bold">&#34;position&#34;</span>:<span style="color:#666">87</span>}
</span></span><span style="display:flex;"><span><span style="">Timestamp:</span> <span style="color:#666">1565859303551</span>
</span></span><span style="display:flex;"><span><span style="">Partition:</span> <span style="color:#666">20</span>
</span></span><span style="display:flex;"><span><span style="">Offset:</span> <span style="color:#666">0</span>
</span></span><span style="display:flex;"><span>[<span style="">…</span>]</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Take note of the partition number, because we’ll need that shortly.</p>
</div>
<div class="paragraph">
<p>Having seen how Kafka Connect stores this data, we can now amend it. For this, the Kafka Connect worker <em>really</em> does need to be shut down. We’re going to prepare our payload which we’ll pass to <code>kafkacat</code> in a similar way to above. The payload is going to be the key, which remains fixed, and a value. The value can either be a given offset, or it can be <code>NULL</code> which denotes nothing, nada, nowt—start from scratch. Here’s sending a NULL, which is known as a <em>tombstone message</em>. Very important is that you specify the same target partition (using <code>-p</code>) for the message as the one that you saw above:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#008000">echo</span> <span style="color:#ba2121">&#39;[&#34;source-file-01&#34;,{&#34;filename&#34;:&#34;/data/testdata.txt&#34;}]#&#39;</span> | <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b localhost:9092 -t _connect-offsets -P -Z -K# -p <span style="color:#666">20</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>In the <code>echo</code> we’re specifying the key (<code>[&#34;source-file-01&#34;,{&#34;filename&#34;:&#34;/data/testdata.txt&#34;}]</code>) followed by the key separator (<code>#</code>, defined in the <code>kafakcat</code> argument <code>-K#</code>), and the <code>-Z</code> in <code>kafkacat</code> tells it to send the empty value as a NULL. As stated above, <em>don’t forget to target the correct partition</em>.</p>
</div>
<div class="paragraph">
<p>Now when we restart the Kafka Connect worker, we can see that the file has been re-processed (note the incrementing <code>offset</code> value but repeating <code>Value</code> payloads):</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kafkacat -b localhost:9092 -t testdata -f <span style="color:#ba2121">&#39;Value (%S bytes): %s     [Kafka message timestamp: %T / offset: %o]\n&#39;</span>
</span></span><span style="display:flex;"><span>% Auto-selecting Consumer mode <span style="color:#666">(</span>use -P or -C to override<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 08:54:18 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565859259988</span> / offset: 0<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 08:54:23 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565859263997</span> / offset: 1<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 08:54:26 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565859267000</span> / offset: 2<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 09:25:45 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565861146526</span> / offset: 3<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 09:25:58 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565861158568</span> / offset: 4<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 08:54:18 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565861628675</span> / offset: 5<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 08:54:23 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565861628677</span> / offset: 6<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 08:54:26 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565861628677</span> / offset: 7<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 09:25:45 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565861628677</span> / offset: 8<span style="color:#666">]</span>
</span></span><span style="display:flex;"><span>Value <span style="color:#666">(</span><span style="color:#666">28</span> bytes<span style="color:#666">)</span>: Thu Aug <span style="color:#666">15</span> 09:25:58 UTC <span style="color:#666">2019</span>     <span style="color:#666">[</span>Kafka message timestamp: <span style="color:#666">1565861628677</span> / offset: 9<span style="color:#666">]</span></span></span></code></pre></div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If this doesn’t work for you, make sure you’ve got the partition correct. If you don’t, it won’t work.
</td>
</tr>
</tbody></table>
</div>

	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
