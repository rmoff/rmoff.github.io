<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>What to Do When Docker on the Mac Runs Out of Space</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2019/01/09/what-to-do-when-docker-on-the-mac-runs-out-of-space/">
		
		<meta name="description" content="Quick tips on getting Docker up and running again">
		
		<meta name="generator" content="Hugo 0.75.1" />

		
		<meta property="og:title" content="What to Do When Docker on the Mac Runs Out of Space" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/img/default-header-img.jpg" />
		<meta property="og:description" content="Quick tips on getting Docker up and running again" />
		<meta property="og:url" content="https://rmoff.net/2019/01/09/what-to-do-when-docker-on-the-mac-runs-out-of-space/" />
		<meta property="og:site_name" content="What to Do When Docker on the Mac Runs Out of Space" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/img/default-header-img.jpg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">What to Do When Docker on the Mac Runs Out of Space</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2019-01-09T10:18:20Z">Jan 9, 2019</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/docker" class="no-underline category near-white dim">Docker</a>
								<span class="display-print">at https://rmoff.net/2019/01/09/what-to-do-when-docker-on-the-mac-runs-out-of-space/</span>
							
						
					</h2>
				</div>

				
				
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw7">
	<div class="paragraph">
<p>I use Docker and Docker Compose <em>a lot</em>. Like, every day. Itâ€™s a fantastic way to build repeatable demos and examples, that can be torn down and spun up in a repeatable way. Butâ€¦what happens when the demo that was working is spun up and then tail spins down in a blaze of flames?</p>
</div>
<div class="paragraph">
<p>Hereâ€™s the excerpt of a log from my Oracle container:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker-compose up -d  ; docker-compose logs -f oracle
Recreating connect-jdbc_oracle_1_4be0ad4479f8 ...
connect-jdbc_mssql_1_eb2a015c90b2 is up-to-date
connect-jdbc_zookeeper_1_948bd8f572fb is up-to-date
Starting connect-jdbc_mysql_1_88681355e0c9    ...
Starting connect-jdbc_postgres_1_69535455d741 ...
connect-jdbc_kafka_1_8b8a8c2b124d is up-to-date
connect-jdbc_schema-registry_1_f5e9a2675ed1 is up-to-date
Recreating connect-jdbc_oracle_1_4be0ad4479f8 ... <span style="color:#008000;font-weight:bold">done</span>
Starting connect-jdbc_mysql_1_88681355e0c9    ... <span style="color:#008000;font-weight:bold">done</span>
Starting connect-jdbc_postgres_1_69535455d741 ... <span style="color:#008000;font-weight:bold">done</span>
Attaching to connect-jdbc_oracle_1_4be0ad4479f8
oracle_1_4be0ad4479f8 | ORACLE PASSWORD FOR SYS, SYSTEM AND PDBADMIN: Admin123
oracle_1_4be0ad4479f8 | cp: error writing <span style="color:#ba2121">&#39;/opt/oracle/dbca.rsp&#39;</span>: No space left on device
oracle_1_4be0ad4479f8 | cp: failed to extend <span style="color:#ba2121">&#39;/opt/oracle/dbca.rsp&#39;</span>: No space left on device
oracle_1_4be0ad4479f8 | mv: cannot stat <span style="color:#ba2121">&#39;/opt/oracle/product/12.2.0.1/dbhome_1/dbs/spfileORCLCDB.ora&#39;</span>: No such file or directory
oracle_1_4be0ad4479f8 | mv: cannot stat <span style="color:#ba2121">&#39;/opt/oracle/product/12.2.0.1/dbhome_1/dbs/orapwORCLCDB&#39;</span>: No such file or directory
oracle_1_4be0ad4479f8 | mv: cannot stat <span style="color:#ba2121">&#39;/opt/oracle/product/12.2.0.1/dbhome_1/network/admin/sqlnet.ora&#39;</span>: No such file or directory
oracle_1_4be0ad4479f8 | mv: cannot stat <span style="color:#ba2121">&#39;/opt/oracle/product/12.2.0.1/dbhome_1/network/admin/listener.ora&#39;</span>: No such file or directory
oracle_1_4be0ad4479f8 | mv: cannot stat <span style="color:#ba2121">&#39;/opt/oracle/product/12.2.0.1/dbhome_1/network/admin/tnsnames.ora&#39;</span>: No such file or directory
oracle_1_4be0ad4479f8 | cp: error writing <span style="color:#ba2121">&#39;/etc/oratab&#39;</span>: No space left on device
oracle_1_4be0ad4479f8 | cp: failed to extend <span style="color:#ba2121">&#39;/etc/oratab&#39;</span>: No space left on device
oracle_1_4be0ad4479f8 | <span style="color:#19177c">ORACLE_HOME</span> <span style="color:#666">=</span> <span style="color:#666">[</span>/home/oracle<span style="color:#666">]</span> ? ORACLE_BASE environment variable is not being <span style="color:#008000">set</span> since this
oracle_1_4be0ad4479f8 | information is not available <span style="color:#008000;font-weight:bold">for</span> the current user ID .
oracle_1_4be0ad4479f8 | You can <span style="color:#008000">set</span> ORACLE_BASE manually <span style="color:#008000;font-weight:bold">if</span> it is required.
oracle_1_4be0ad4479f8 | Resetting ORACLE_BASE to its previous value or ORACLE_HOME
oracle_1_4be0ad4479f8 | The Oracle base remains unchanged with value /opt/oracle
oracle_1_4be0ad4479f8 | /opt/oracle/checkDBStatus.sh: line 27: cannot create temp file <span style="color:#008000;font-weight:bold">for</span> here-document: No space left on device
oracle_1_4be0ad4479f8 | tail: cannot open <span style="color:#ba2121">&#39;/opt/oracle/diag/rdbms/*/*/trace/alert*.log&#39;</span> <span style="color:#008000;font-weight:bold">for</span> reading: No such file or directory
oracle_1_4be0ad4479f8 | tail: no files remaining
oracle_1_4be0ad4479f8 | <span style="color:#408080;font-style:italic">#####################################</span>
oracle_1_4be0ad4479f8 | <span style="color:#408080;font-style:italic">########### E R R O R ###############</span>
oracle_1_4be0ad4479f8 | DATABASE SETUP WAS NOT SUCCESSFUL!
oracle_1_4be0ad4479f8 | Please check output <span style="color:#008000;font-weight:bold">for</span> further info!
oracle_1_4be0ad4479f8 | <span style="color:#408080;font-style:italic">########### E R R O R ###############</span>
oracle_1_4be0ad4479f8 | <span style="color:#408080;font-style:italic">#####################################</span></code></pre></div>
</div>
<div class="paragraph">
<p>Argh! It was working just yesterday!</p>
</div>
<div class="paragraph">
<p>If you check out the space that Dockerâ€™s using, youâ€™ll see it can be quite a hog</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker system df
TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE
Images              <span style="color:#666">86</span>                  <span style="color:#666">7</span>                   36.87GB             35.87GB <span style="color:#666">(</span>97%<span style="color:#666">)</span>
Containers          <span style="color:#666">13</span>                  <span style="color:#666">0</span>                   76.66MB             76.66MB <span style="color:#666">(</span>100%<span style="color:#666">)</span>
Local Volumes       <span style="color:#666">586</span>                 <span style="color:#666">9</span>                   36.88GB             36.67GB <span style="color:#666">(</span>99%<span style="color:#666">)</span>
Build Cache         <span style="color:#666">0</span>                   <span style="color:#666">0</span>                   0B                  0B</code></pre></div>
</div>
<div class="paragraph">
<p>Thatâ€™s over 70Gb of space!</p>
</div>
<div class="paragraph">
<p>If you load up the Docker UI youâ€™ll see that itâ€™s got a fixed size for the disk image that contains all the Docker data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2019/01/2019-01-09_10-48-49.png" alt="2019 01 09 10 48 49"/>
</div>
</div>
<div class="paragraph">
<p>You could increase this size, or you could tidy up some of the unused content. You can prune these down easily, using the <code>prune</code> command. Go carefully though, because if you trash all your images then theyâ€™re going to have to be pulled back down from their repository or rebuilt, and that can take some time. Donâ€™t do it just before you need to run the demoâ€¦</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can do <code>docker system prune -af</code> but this trashes <strong>everything</strong>. Iâ€™d recommend taking a more structured approach to it, as shown below.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Pruning the unused volumes and stopped containers is easy:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker volume prune
WARNING! This will remove all <span style="color:#008000">local</span> volumes not used by at least one container.
Are you sure you want to <span style="color:#008000;font-weight:bold">continue</span>? <span style="color:#666">[</span>y/N<span style="color:#666">]</span> y
Deleted Volumes:
dc502ff65c2dc5b51272834d7a6c58a36e8560876125b0b74f6024162fb28186
â€¦
93d2e9fa57442a2f1a1837a7ecf14b069179bb814351e2888bdd0cfcd12d19dd

Total reclaimed space: 36.67GB</code></pre></div>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker container prune
WARNING! This will remove all stopped containers.
Are you sure you want to <span style="color:#008000;font-weight:bold">continue</span>? <span style="color:#666">[</span>y/N<span style="color:#666">]</span> y
Deleted Containers:
â€¦
bf8b43823b644c238b3d1e8722a6ad9383b2162a6d0a4d80bcc5c661c91ade32

Total reclaimed space: 76.66MB</code></pre></div>
</div>
<div class="paragraph">
<p>You can do the same with images, but I donâ€™t want to trash <em>all</em> my images, so I cheat and use a GUI - the excellent <a href="https://www.portainer.io/">Portainer</a> (which itself can be run under Docker ðŸ˜ƒ)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2019/01/2019-01-09_10-25-34.png" alt="2019 01 09 10 25 34"/>
</div>
</div>
<div class="paragraph">
<p>Now my Docker has a bit more space to breathe:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker system df
TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE
Images              <span style="color:#666">33</span>                  <span style="color:#666">1</span>                   17.2GB              17.15GB <span style="color:#666">(</span>99%<span style="color:#666">)</span>
Containers          <span style="color:#666">1</span>                   <span style="color:#666">1</span>                   0B                  0B
Local Volumes       <span style="color:#666">1</span>                   <span style="color:#666">1</span>                   33.57kB             0B <span style="color:#666">(</span>0%<span style="color:#666">)</span>
Build Cache         <span style="color:#666">0</span>                   <span style="color:#666">0</span>                   0B                  0B</code></pre></div>
</div>
<hr/>
<div class="paragraph">
<p>This same problem can cause Elasticsearch to stop working also, if it runs out of space the index becomes read-only:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#666">{</span><span style="color:#ba2121">&#34;error&#34;</span>:<span style="color:#666">{</span><span style="color:#ba2121">&#34;root_cause&#34;</span>:<span style="color:#666">[{</span><span style="color:#ba2121">&#34;type&#34;</span>:<span style="color:#ba2121">&#34;cluster_block_exception&#34;</span>,<span style="color:#ba2121">&#34;reason&#34;</span>:<span style="color:#ba2121">&#34;blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];&#34;</span><span style="color:#666">}]</span>,<span style="color:#ba2121">&#34;type&#34;</span>:<span style="color:#ba2121">&#34;cluster_block_exception&#34;</span>,<span style="color:#ba2121">&#34;reason&#34;</span>:<span style="color:#ba2121">&#34;blocked by: [FORBIDDEN/12/index read-only / allow delete (api)];&#34;</span><span style="color:#666">}</span>,<span style="color:#ba2121">&#34;status&#34;</span>:403<span style="color:#666">}</span></code></pre></div>
</div>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <em>Robin Moffatt is a Senior Developer Advocate at Confluent, and an Oracle ACE Director (Alumnus). He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2020 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
