<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Using Confluent Cloud when there is no Cloud (or internet)</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/04/20/using-confluent-cloud-when-there-is-no-cloud-or-internet/">
		
		
		
		

		
		<meta property="og:title" content="Using Confluent Cloud when there is no Cloud (or internet)" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/04/IMG_3958.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/04/20/using-confluent-cloud-when-there-is-no-cloud-or-internet/" />
		<meta property="og:site_name" content="Using Confluent Cloud when there is no Cloud (or internet)" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/toc.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/retro-cards.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/custom.css" />
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		
		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only' 
                })
		</script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/images/2020/04/IMG_3958.jpeg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net/" title="Home">
						<link rel="preload" as="image" href="https://rmoff.net/img/repton.gif">
						<img
							src="https://rmoff.net/img/logo.jpg"
							class="w2 h2 br-100"
							alt="rmoff&#39;s random ramblings"
							onmouseover="this.src='https:\/\/rmoff.net\/img\/repton.gif';"
							onmouseout="this.src='https:\/\/rmoff.net\/img\/logo.jpg';"
						/>
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://bsky.app/profile/rmoff.net"><i class="fa-brands fa-bluesky"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fa-brands fa-x-twitter"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">
						<span class="terminal-title">Using Confluent Cloud when there is no Cloud (or internet)<span class="terminal-cursor"></span></span>
					</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2020-04-20T13:55:46&#43;01:00">Apr 20, 2020</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/confluent-cloud" class="no-underline category near-white dim">Confluent Cloud</a>, <a href="https://rmoff.net/categories/replicator" class="no-underline category near-white dim">Replicator</a>
								<span class="display-print">at https://rmoff.net/2020/04/20/using-confluent-cloud-when-there-is-no-cloud-or-internet/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="https://bsky.app/profile/rmoff.net" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<div class="container-fluid docs">
  <div class="row">
    <main class="docs-content" role="main">

<article class="article">
	
<div class="paragraph">
<p><a href="https://confluent.cloud/signup">‚òÅÔ∏èConfluent Cloud</a> is a great solution for a hosted and managed Apache Kafka service, with the additional benefits of Confluent Platform such as ksqlDB and managed Kafka Connect connectors. But as a developer, you won‚Äôt always have a reliable internet connection. Train, planes, and automobiles‚Äînot to mention crappy hotel or conference Wi-Fi. Wouldn‚Äôt it be useful if you could have a replica of your Cloud data on your local machine? That just pulled down new data automagically, without needing to be restarted each time you got back on the network?</p>
</div>
<div class="paragraph">
<p>Let me show you here how you can go about doing this, to replicate one (or more) topics from Confluent Cloud onto your local machine. It‚Äôs also a really useful thing if you want to develop something locally without perhaps being ready to deploy it against your cloud environment.</p>
</div>
<div class="sect1">
<h2 id="_how">How?&nbsp;<a class="headline-hash" href="#_how">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Confluent Replicator is a Kafka Connect plugin, acting as a consumer from one Kafka cluster (Confluent Cloud) and producer to another (your local Kafka cluster). I use Docker Compose to run Kafka locally, almost exclusively. It‚Äôs a piece of cake to provision, spin up - and tear down new environments, in isolation from others.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup">Setup&nbsp;<a class="headline-hash" href="#_setup">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a <code>.env</code> file with your Confluent Cloud broker details and credentials in it:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#19177c">CCLOUD_BROKER_HOST</span><span style="color:#666">=</span>foo.bar.bork.bork.bork.us-central1.gcp.confluent.cloud:9092
</span></span><span style="display:flex;"><span><span style="color:#19177c">CCLOUD_API_KEY</span><span style="color:#666">=</span>yyy
</span></span><span style="display:flex;"><span><span style="color:#19177c">CCLOUD_API_SECRET</span><span style="color:#666">=</span>xxx</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Use these environment variables in your local shell (we‚Äôll use them with Docker later, hence writing them to a file for re-use)</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#008000">source</span> .env</span></span></code></pre></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_some_test_data_on_confluent_cloud">Create some test data on Confluent Cloud&nbsp;<a class="headline-hash" href="#_create_some_test_data_on_confluent_cloud">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Chuck some dummy data into a Confluent Cloud topic:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#008000">echo</span> <span style="color:#008000;font-weight:bold">$(</span>date<span style="color:#008000;font-weight:bold">)</span> | <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b <span style="color:#19177c">$CCLOUD_BROKER_HOST</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -X security.protocol<span style="color:#666">=</span>SASL_SSL -X sasl.mechanisms<span style="color:#666">=</span>PLAIN <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -X sasl.username<span style="color:#666">=</span><span style="color:#ba2121">&#34;</span><span style="color:#19177c">$CCLOUD_API_KEY</span><span style="color:#ba2121">&#34;</span> -X sasl.password<span style="color:#666">=</span><span style="color:#ba2121">&#34;</span><span style="color:#19177c">$CCLOUD_API_SECRET</span><span style="color:#ba2121">&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -X api.version.request<span style="color:#666">=</span><span style="color:#008000">true</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -t test_topic -P</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Verify that it‚Äôs there:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>‚ûú kafkacat -b <span style="color:#19177c">$CCLOUD_BROKER_HOST</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>              -X security.protocol<span style="color:#666">=</span>SASL_SSL -X sasl.mechanisms<span style="color:#666">=</span>PLAIN <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>              -X sasl.username<span style="color:#666">=</span><span style="color:#ba2121">&#34;</span><span style="color:#19177c">$CCLOUD_API_KEY</span><span style="color:#ba2121">&#34;</span> -X sasl.password<span style="color:#666">=</span><span style="color:#ba2121">&#34;</span><span style="color:#19177c">$CCLOUD_API_SECRET</span><span style="color:#ba2121">&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>              -X api.version.request<span style="color:#666">=</span><span style="color:#008000">true</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>              -t test_topic -C -e
</span></span><span style="display:flex;"><span>Fri <span style="color:#666">17</span> Apr <span style="color:#666">2020</span> 18:03:17 BST</span></span></code></pre></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_local_kafka_cluster">Create local Kafka cluster&nbsp;<a class="headline-hash" href="#_create_local_kafka_cluster">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now spin up yourself a local Kafka cluster using <a href="https://github.com/confluentinc/demo-scene/blob/master/ccloud-replicator/docker-compose.yml">this Docker Compose</a>:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>‚ûú docker-compose up -d
</span></span><span style="display:flex;"><span>‚ûú docker-compose ps
</span></span><span style="display:flex;"><span>   Name               Command            State                      Ports
</span></span><span style="display:flex;"><span>---------------------------------------------------------------------------------------------
</span></span><span style="display:flex;"><span>kafka-1      /etc/confluent/docker/run   Up      0.0.0.0:9092-&gt;9092/tcp
</span></span><span style="display:flex;"><span>kafka-2      /etc/confluent/docker/run   Up      0.0.0.0:19092-&gt;19092/tcp, 9092/tcp
</span></span><span style="display:flex;"><span>kafka-3      /etc/confluent/docker/run   Up      0.0.0.0:29092-&gt;29092/tcp, 9092/tcp
</span></span><span style="display:flex;"><span>replicator   /etc/confluent/docker/run   Up      0.0.0.0:58083-&gt;58083/tcp, 8083/tcp, 9092/tcp
</span></span><span style="display:flex;"><span>zookeeper    /etc/confluent/docker/run   Up      2181/tcp, 2888/tcp, 3888/tcp</span></span></code></pre></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_set_up_replicator">Set up Replicator&nbsp;<a class="headline-hash" href="#_set_up_replicator">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we‚Äôll check that the Replicator container has started and is ready. Replicator runs as a plugin to Kafka Connect, so we use its API for interacting with Replicator.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
I‚Äôm running a Kafka Connect worker that‚Äôs listening on <code>58083</code> - modify the code examples below if you‚Äôre using a different one (e.g. the default 8083).
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;Waiting for Kafka Connect to start listening on localhost:58083 ‚è≥&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">while</span> : ; <span style="color:#008000;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#19177c">curl_status</span><span style="color:#666">=</span><span style="color:#008000;font-weight:bold">$(</span>curl -s -o /dev/null -w %<span style="color:#666">{</span>http_code<span style="color:#666">}</span> http://localhost:58083/connectors<span style="color:#008000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">echo</span> -e <span style="color:#008000;font-weight:bold">$(</span>date<span style="color:#008000;font-weight:bold">)</span> <span style="color:#ba2121">&#34; Kafka Connect listener HTTP state: &#34;</span> <span style="color:#19177c">$curl_status</span> <span style="color:#ba2121">&#34; (waiting for 200)&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000;font-weight:bold">if</span> <span style="color:#666">[</span> <span style="color:#19177c">$curl_status</span> -eq <span style="color:#666">200</span> <span style="color:#666">]</span> ; <span style="color:#008000;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000;font-weight:bold">fi</span>
</span></span><span style="display:flex;"><span>    sleep <span style="color:#666">5</span>
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">done</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Should show:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Mon <span style="color:#666">20</span> Apr <span style="color:#666">2020</span> 12:32:37 BST  Kafka Connect listener HTTP state:  <span style="color:#666">200</span>  <span style="color:#666">(</span>waiting <span style="color:#008000;font-weight:bold">for</span> 200<span style="color:#666">)</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>We can also verify that the Replicator plugin has been loaded correctly:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>curl -s localhost:58083/connector-plugins|jq <span style="color:#ba2121">&#39;.[].class&#39;</span>|grep -q io.confluent.connect.replicator.ReplicatorSourceConnector
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">if</span> <span style="color:#666">[</span> <span style="color:#19177c">$?</span> -eq <span style="color:#666">0</span> <span style="color:#666">]</span>; <span style="color:#008000;font-weight:bold">then</span> 
</span></span><span style="display:flex;"><span>   <span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;Replicator plugin is correctly loaded ‚úÖ&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>   <span style="color:#008000">echo</span> <span style="color:#ba2121">&#34;üò¢ Replicator plugin is not loaded. Please check the Kafka Connect worker logs and installation steps&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008000;font-weight:bold">fi</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Should show:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Replicator plugin is correctly loaded ‚úÖ</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Now send the config to the Kafka Connect worker</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="">source</span> <span style="">.env</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">epoch=$(date</span> <span style="">+%s)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="">curl</span> <span style="">-s</span> <span style="">-X</span> <span style="">PUT</span> <span style="">-H</span> <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="">\</span>
</span></span><span style="display:flex;"><span>    <span style="">-H</span>  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> <span style="color:#ba2121">&#34;http://localhost:58083/connectors/replicator-source&#34;</span><span style="">$epoch</span><span style="color:#ba2121">&#34;/config&#34;</span> <span style="">\</span>
</span></span><span style="display:flex;"><span>    <span style="">-d</span> <span style="">&#39;</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;connector.class&#34;</span>             : <span style="color:#ba2121">&#34;io.confluent.connect.replicator.ReplicatorSourceConnector&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;key.converter&#34;</span>               : <span style="color:#ba2121">&#34;io.confluent.connect.replicator.util.ByteArrayConverter&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;value.converter&#34;</span>             : <span style="color:#ba2121">&#34;io.confluent.connect.replicator.util.ByteArrayConverter&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;header.converter&#34;</span>            : <span style="color:#ba2121">&#34;io.confluent.connect.replicator.util.ByteArrayConverter&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;src.kafka.bootstrap.servers&#34;</span> : <span style="color:#ba2121">&#34;&#39;$CCLOUD_BROKER_HOST&#39;:9092&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;src.kafka.security.protocol&#34;</span> : <span style="color:#ba2121">&#34;SASL_SSL&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;src.kafka.sasl.mechanism&#34;</span>    : <span style="color:#ba2121">&#34;PLAIN&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;src.kafka.sasl.jaas.config&#34;</span>  : <span style="color:#ba2121">&#34;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&#34;&#39;$CCLOUD_API_KEY&#39;\&#34; password=\&#34;&#39;$CCLOUD_API_SECRET&#39;\&#34;;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;src.consumer.group.id&#34;</span>       : <span style="color:#ba2121">&#34;replicator-&#39;$epoch&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;dest.kafka.bootstrap.servers&#34;</span>: <span style="color:#ba2121">&#34;kafka-1:39092,kafka-2:49092,kafka-3:59092&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;topic.whitelist&#34;</span>             : <span style="color:#ba2121">&#34;test_topic&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;topic.rename.format&#34;</span>         :<span style="color:#ba2121">&#34;${topic}&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;confluent.license&#34;</span>           :<span style="color:#ba2121">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;confluent.topic.bootstrap.servers&#34;</span>:<span style="color:#ba2121">&#34;kafka-1:39092,kafka-2:49092,kafka-3:59092&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;confluent.topic.replication.factor&#34;</span>:<span style="color:#666">1</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#008000;font-weight:bold">&#34;offset.start&#34;</span>                :<span style="color:#ba2121">&#34;consumer&#34;</span>
</span></span><span style="display:flex;"><span>        }<span style="">&#39;</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Check that it‚Äôs running:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>‚ûú curl -s <span style="color:#ba2121">&#34;http://localhost:58083/connectors?expand=info&amp;expand=status&#34;</span> | <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>       jq <span style="color:#ba2121">&#39;. | to_entries[] | [ .value.info.type, .key, .value.status.connector.state,.value.status.tasks[].state,.value.info.config.&#34;connector.class&#34;]|join(&#34;:|:&#34;)&#39;</span> | <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>       column -s : -t| sed <span style="color:#ba2121">&#39;s/\&#34;//g&#39;</span>| sort
</span></span><span style="display:flex;"><span><span style="color:#008000">source</span>  |  replicator-source1587382706  |  RUNNING  |  RUNNING  |  io.confluent.connect.replicator.ReplicatorSourceConnector</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Check that we‚Äôve got data:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>‚ûú kafkacat -b localhost:29092 -t test_topic -C -e
</span></span><span style="display:flex;"><span>Fri <span style="color:#666">17</span> Apr <span style="color:#666">2020</span> 18:03:17 BST</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>So now when data gets sent to Confluent Cloud, we get it also pushed to our local Kafka cluster.</p>
</div>
<script id="asciicast-fKlgOPK2gsIW42MIEg7y9FpXz" src="https://asciinema.org/a/fKlgOPK2gsIW42MIEg7y9FpXz.js" async=""></script>
</div>
</div>
<div class="sect1">
<h2 id="_restarting_and_dealing_with_network_glitches">Restarting and dealing with network glitches&nbsp;<a class="headline-hash" href="#_restarting_and_dealing_with_network_glitches">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>The cool thing about Kafka, and Kafka Connect, is that it keeps track of where a particular consumer has read up to in a topic. Replicator therefore will read from a topic whilst it‚Äôs running, and if you stop and restart it, it‚Äôll just catch up from where it got to before it stopped.</p>
</div>
<div class="paragraph">
<p>The same principle applies to if your local machine goes off the network, or perhaps just goes through some patchy connectivity. If it can connect to the source cluster (Confluent Cloud), it will do so. If it can‚Äôt, it‚Äôll just keep trying and carry on again once it can do.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ingesting_a_fresh_copy_of_the_data">Ingesting a fresh copy of the data&nbsp;<a class="headline-hash" href="#_ingesting_a_fresh_copy_of_the_data">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>So there‚Äôs restarting, and then there‚Äôs <strong>restarting</strong>. What if instead of wanting to restart the connector (we rebooted the machine, made a config change, whatever) we want to actually <em>start afresh</em> and start a <em>new replication</em> of the topic from Confluent Cloud?</p>
</div>
<div class="paragraph">
<p>Because of the clever way Kafka Connect uses the Kafka consumer group protocol to track offsets, if you were to delete the replicator configuration and create it afresh, it would still carry on from where it got to before! You can see the consumer group name (and consumption progress) in Confluent Cloud UI:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2020/04/replicator01.png" alt="replicator01"/>
</div>
</div>
<div class="paragraph">
<p>For this reason you may have noticed in the config that we ran above the use of <code>epoch</code> in the configuration name and, most importantly, <a href="https://docs.confluent.io/current/connect/kafka-connect-replicator/configuration_options.html#cluster-id-and-group-id"><code>src.consumer.group.id</code></a>. This is just one way of ensuring a unique group name tied to this particular instance of the replicator. We can then choose to provision a new one if we want to start afresh, or restart an existing one.</p>
</div>
<div class="paragraph">
<p>Whilst you‚Äôre there in the Confluent Cloud UI you can check out the detailed view of the progress of a particular consumer group</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2020/04/replicator02.png" alt="replicator02"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changing_the_target_topic">Changing the target topic&nbsp;<a class="headline-hash" href="#_changing_the_target_topic">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>There‚Äôs a bunch of parameters that you can set with Replicator. One particularly useful one is to modify the name of the target topic that Replicator writes to. Here‚Äôs an example of routing a source topic to a target one that includes the identifier (<code>epoch</code>) of the Replicator that wrote it</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#ba2121">&#34;topic.rename.format&#34;</span>:<span style="color:#ba2121">&#34;</span><span style="color:#b68;font-weight:bold">${</span><span style="color:#19177c">topic</span><span style="color:#b68;font-weight:bold">}</span><span style="color:#ba2121">-ccloud-&#39;</span><span style="color:#19177c">$epoch</span><span style="color:#ba2121">&#39;&#34;</span>,</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>The resulting topic name goes from <code>test_topic</code> on the source (Confluent Cloud) to <code>test_topic-ccloud-1587388241</code> on our target local cluster</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>‚ûú kafkacat -b localhost:29092 -t test_topic-ccloud-1587388241 -C -q -u -o end
</span></span><span style="display:flex;"><span>Here<span style="">&#39;</span>s a <span style="color:#008000">test</span> message, sent at Mon <span style="color:#666">20</span> Apr <span style="color:#666">2020</span> 14:14:09 BST</span></span></code></pre></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_credentials_safely">Storing credentials safely&nbsp;<a class="headline-hash" href="#_storing_credentials_safely">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the example above we passed the credentials for Confluent Cloud just as environment variables to Kafka Connect, which is not great from a security point of view. Instead we could use <a href="/2019/05/24/putting-kafka-connect-passwords-in-a-separate-file-/-externalising-secrets/">external secrets</a>. Note that the Replicator docker container has the necessary <code>config.providers</code> settings to enable this, and that we‚Äôve mounted out local <code>.env</code> file into the container.</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>‚Ä¶<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">CONNECT_CONFIG_PROVIDERS</span>:<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;file&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span><span style="color:#008000;font-weight:bold">CONNECT_CONFIG_PROVIDERS_FILE_CLASS</span>:<span style="color:#bbb"> </span><span style="color:#ba2121">&#39;org.apache.kafka.common.config.provider.FileConfigProvider&#39;</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">    </span><span style="color:#008000;font-weight:bold">volumes</span>:<span style="color:#bbb"> 
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">      </span>- ./.env:/opt/config</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Now when we create the replicator we can reference the file and attributes within it:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#19177c">epoch</span><span style="color:#666">=</span><span style="color:#008000;font-weight:bold">$(</span>date +%s<span style="color:#008000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>curl -s -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> <span style="color:#ba2121">&#34;http://localhost:58083/connectors/replicator-source&#34;</span><span style="color:#19177c">$epoch</span><span style="color:#ba2121">&#34;/config&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        {
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;io.confluent.connect.replicator.ReplicatorSourceConnector&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;key.converter&#34;: &#34;io.confluent.connect.replicator.util.ByteArrayConverter&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;value.converter&#34;: &#34;io.confluent.connect.replicator.util.ByteArrayConverter&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;header.converter&#34;: &#34;io.confluent.connect.replicator.util.ByteArrayConverter&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;src.kafka.bootstrap.servers&#34;: &#34;${file:/opt/config:CCLOUD_BROKER_HOST}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;src.kafka.security.protocol&#34;: &#34;SASL_SSL&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;src.kafka.sasl.mechanism&#34;: &#34;PLAIN&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;src.kafka.sasl.jaas.config&#34;: &#34;org.apache.kafka.common.security.plain.PlainLoginModule required username=\&#34;${file:/opt/config:CCLOUD_API_KEY}\&#34; password=\&#34;${file:/opt/config:CCLOUD_API_SECRET}\&#34;;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;src.consumer.group.id&#34;: &#34;replicator-&#39;</span><span style="color:#19177c">$epoch</span><span style="color:#ba2121">&#39;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;dest.kafka.bootstrap.servers&#34;: &#34;kafka-1:39092,kafka-2:49092,kafka-3:59092&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;topic.whitelist&#34;: &#34;test_topic&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;topic.rename.format&#34;:&#34;${topic}&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;confluent.license&#34;:&#34;&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;confluent.topic.bootstrap.servers&#34;:&#34;kafka-1:39092,kafka-2:49092,kafka-3:59092&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;confluent.topic.replication.factor&#34;:1,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;offset.start&#34;:&#34;consumer&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        }&#39;</span> </span></span></code></pre></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_its_not_just_for_cloud">It‚Äôs not just for Cloud&nbsp;<a class="headline-hash" href="#_its_not_just_for_cloud">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use Replicator between any two Apache Kafka clusters, and Confluent Control Center to give you the same consumer group monitoring view that I showed above.</p>
</div>
<div class="paragraph">
<p>Try it out by <a href="https://www.confluent.io/download/">downloading Confluent Platform</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_further_reading">Further reading&nbsp;<a class="headline-hash" href="#_further_reading">üîó</a> </h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.confluent.io/current/multi-dc-deployments/replicator/index.html">Replicator documentation</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/installation/docker/installation/replicator.html">Replicator tutorial</a></p>
</li>
<li>
<p><a href="https://docs.confluent.io/current/connect/kafka-connect-replicator/configuration_options.html">Replicator configuration options</a></p>
</li>
</ul>
</div>
</div>
</div>

	<hr>
	<div style="background-color: rgba(204, 234, 255, 0.25); margin-bottom:50px;margin-top:50px;padding: 20px; border-width: 2px; border-style: solid; border-color: darkorange;">
	
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
		
	</div>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><a href="https://bsky.app/profile/rmoff.net"><b class="fa-brands fa-bluesky"></b></a>  <em>Robin Moffatt works on the DevRel team at Confluent. He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		

</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_how">How?</a></li>
    <li><a href="#_setup">Setup</a></li>
    <li><a href="#_create_some_test_data_on_confluent_cloud">Create some test data on Confluent Cloud</a></li>
    <li><a href="#_create_local_kafka_cluster">Create local Kafka cluster</a></li>
    <li><a href="#_set_up_replicator">Set up Replicator</a></li>
    <li><a href="#_restarting_and_dealing_with_network_glitches">Restarting and dealing with network glitches</a></li>
    <li><a href="#_ingesting_a_fresh_copy_of_the_data">Ingesting a fresh copy of the data</a></li>
    <li><a href="#_changing_the_target_topic">Changing the target topic</a></li>
    <li><a href="#_storing_credentials_safely">Storing credentials safely</a></li>
    <li><a href="#_its_not_just_for_cloud">It‚Äôs not just for Cloud</a></li>
    <li><a href="#_further_reading">Further reading</a></li>
  </ul>
</nav>
      </div>
      
      <div class="toc-mobile-label">TABLE OF CONTENTS</div>
      
    
    </div>
  </div>
</div>


		</main>
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2026 
			</p>
		</footer>
		
	</body>
</html>
