<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2020/08/IMG_6110.jpeg" >
		
		<title>Counting the number of messages in a Kafka topic</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/09/08/counting-the-number-of-messages-in-a-kafka-topic/">
		
		

		
		<meta property="og:title" content="Counting the number of messages in a Kafka topic" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/08/IMG_6110.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/09/08/counting-the-number-of-messages-in-a-kafka-topic/" />
		<meta property="og:site_name" content="Counting the number of messages in a Kafka topic" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2020/08/IMG_6110.jpeg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Counting the number of messages in a Kafka topic</h1>
			<p class="article-hero-meta">
				
					<time datetime="2020-09-08T10:00:05&#43;01:00">08 Sep 2020</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/kcat-kafkacat">kcat (kafkacat)</a>, <a href="https://rmoff.net/categories/ksqldb">ksqlDB</a>
					<span class="display-print">at https://rmoff.net/2020/09/08/counting-the-number-of-messages-in-a-kafka-topic/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_select_countgroup_by"><code>SELECT COUNT(*)‚Ä¶GROUP BY‚Ä¶</code></a>
      <ul>
        <li><a href="#_group_by_field"><code>GROUP BY &lt;field&gt;</code></a></li>
        <li><a href="#_group_by_time_window"><code>GROUP BY &lt;time window&gt;</code></a></li>
        <li><a href="#_not_everyone_loves_streams">Not everyone loves streams?</a></li>
      </ul>
    </li>
    <li><a href="#_other_ways_to_count_the_messages">Other ways to count the messages</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">kcat (kafkacat)</span><span data-pagefind-filter="category" style="display:none">ksqlDB</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2020/08/IMG_6110.jpeg" style="display:none" alt="">
	<div class="paragraph">
<p>There‚Äôs ways, and then there‚Äôs ways, to count the number of records/events/messages in a Kafka topic. Most of them are potentially inaccurate, or inefficient, or both. Here‚Äôs one that falls into the <em>potentially inefficient</em> category, using <code>kafkacat</code> to read all the messages and pipe to <code>wc</code> which with the <code>-l</code> will tell you how many lines there are, and since each message is a line, how many messages you have in the Kafka topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>kafkacat <span style="color: #f92672">-b</span> broker:29092 <span style="color: #f92672">-t</span> mytestopic <span style="color: #f92672">-C</span> <span style="color: #f92672">-e</span> <span style="color: #f92672">-q</span>| <span style="color: #f8f8f2">wc</span> <span style="color: #f92672">-l</span>
       3</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can verify what‚Äôs happening by removing the pipe to just see the messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>kafkacat <span style="color: #f92672">-b</span> broker:29092 <span style="color: #f92672">-t</span> mytestopic <span style="color: #f92672">-C</span> <span style="color: #f92672">-e</span> <span style="color: #f92672">-q</span>
I<span style="color: #e6db74">&#39;m message 1
I&#39;</span>m message 2
I<span style="color: #e6db74">&#39;m message 3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What do the flags for <code>kafkacat</code> mean?</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-C</code>: act as a Consumer</p>
</li>
<li>
<p><code>-q</code>: quiet, no informational messages from kafkacat</p>
</li>
<li>
<p><code>-e</code>: exit once last offset read</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_select_countgroup_by"><code>SELECT COUNT(*)‚Ä¶GROUP BY‚Ä¶</code>&nbsp;<a class="headline-hash" href="#_select_countgroup_by">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Consuming all the messages from the topic is fine, but what about if you want to break it down further? Say, by key, or other field in the data? This is where being able to express yourself in SQL with <a href="https://ksqldb.io">ksqlDB</a> comes in handy.</p>
</div>
<div class="paragraph">
<p>First up we need a schema for the data in the topic (since we‚Äôre working with fields now, not just entire records). If we‚Äôre using Avro or Protobuf then the schema is already available, but for JSON/CSV we can specify it as part of the statement in which we tell ksqlDB about the Kafka topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">CREATE</span> <span style="color: #f8f8f2;background-color: #49483e">STREAM</span> <span style="color: #f8f8f2;background-color: #49483e">CARPARK_SRC</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2">date</span>          <span style="color: #f8f8f2">VARCHAR</span> <span style="color: #f8f8f2;background-color: #49483e">,</span>
                           <span style="color: #f8f8f2">time</span>          <span style="color: #f8f8f2">VARCHAR</span> <span style="color: #f8f8f2;background-color: #49483e">,</span>
                           <span style="color: #f8f8f2;background-color: #49483e">name</span>          <span style="color: #f8f8f2">VARCHAR</span> <span style="color: #f8f8f2;background-color: #49483e">,</span>
                           <span style="color: #f8f8f2;background-color: #49483e">capacity</span>      <span style="color: #f8f8f2">INT</span> <span style="color: #f8f8f2;background-color: #49483e">,</span>
                           <span style="color: #f8f8f2;background-color: #49483e">empty_places</span>  <span style="color: #f8f8f2">INT</span> <span style="color: #f8f8f2;background-color: #49483e">)</span>
           <span style="color: #66d9ef;font-weight: bold">WITH</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">KAFKA_TOPIC</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;carparks&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
                 <span style="color: #f8f8f2;background-color: #49483e">VALUE_FORMAT</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;DELIMITED&#39;</span><span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_group_by_field"><code>GROUP BY &lt;field&gt;</code>&nbsp;<a class="headline-hash" href="#_group_by_field">üîó</a> </h3>
<div class="paragraph">
<p>Now that we have a stream, we can query it and check the number of messages. We need to tell ksqlDB that we want it to read from the beginning of the topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SET</span> <span style="color: #e6db74">&#39;auto.offset.reset&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;earliest&#39;</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and then we run our <code>COUNT</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f8f8f2;background-color: #49483e">NAME</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span>
  <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">CARPARK_SRC</span>
  <span style="color: #66d9ef;font-weight: bold">GROUP</span> <span style="color: #66d9ef;font-weight: bold">BY</span> <span style="color: #f8f8f2;background-color: #49483e">NAME</span>
  <span style="color: #f8f8f2;background-color: #49483e">EMIT</span> <span style="color: #f8f8f2;background-color: #49483e">CHANGES</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------------+----------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">NAME</span>                <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------------+----------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Westgate</span>            <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">60</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Burnett</span> <span style="color: #f8f8f2;background-color: #49483e">St</span>          <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">60</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Crown</span> <span style="color: #f8f8f2;background-color: #49483e">Court</span>         <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">60</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Leisure</span> <span style="color: #f8f8f2;background-color: #49483e">Exchange</span>    <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">60</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">NCP</span> <span style="color: #f8f8f2;background-color: #49483e">Hall</span> <span style="color: #f8f8f2;background-color: #49483e">Ings</span>       <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">60</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Broadway</span>            <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">60</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Kirkgate</span> <span style="color: #f8f8f2;background-color: #49483e">Centre</span>     <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">60</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Sharpe</span> <span style="color: #f8f8f2;background-color: #49483e">Street</span>       <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">60</span>        <span style="color: #f92672;font-weight: bold">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each of the <code>NAME</code> values above has 60 records associated with it, and thus if we run a <code>GROUP BY</code> across all messages (using a dummy <code>GROUP BY</code> to force the aggregation) we‚Äôll see that there‚Äôs a total of 480 messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span>
  <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">CARPARK_SRC</span>
  <span style="color: #66d9ef;font-weight: bold">GROUP</span> <span style="color: #66d9ef;font-weight: bold">BY</span> <span style="color: #ae81ff">1</span>
  <span style="color: #f8f8f2;background-color: #49483e">EMIT</span> <span style="color: #f8f8f2;background-color: #49483e">CHANGES</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span>    <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">480</span>          <span style="color: #f92672;font-weight: bold">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When running this, you may notice that the query doesn‚Äôt exit, but instead the CLI says</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">Press</span> <span style="color: #f8f8f2;background-color: #49483e">CTRL</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #66d9ef;font-weight: bold">C</span> <span style="color: #66d9ef;font-weight: bold">to</span> <span style="color: #f8f8f2;background-color: #49483e">interrupt</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That‚Äôs because we‚Äôve run a <strong>push query</strong>, we‚Äôve subscribed to the stream of results from the Kafka topic, and since Kafka topics are unbounded so are the results of a query against it. As new data arrives, the aggregate values may changes, and will be returned to the client as they do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span>    <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">480</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">488</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">496</span>          <span style="color: #f92672;font-weight: bold">|</span>

<span style="color: #f8f8f2;background-color: #49483e">Press</span> <span style="color: #f8f8f2;background-color: #49483e">CTRL</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #66d9ef;font-weight: bold">C</span> <span style="color: #66d9ef;font-weight: bold">to</span> <span style="color: #f8f8f2;background-color: #49483e">interrupt</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_group_by_time_window"><code>GROUP BY &lt;time window&gt;</code>&nbsp;<a class="headline-hash" href="#_group_by_time_window">üîó</a> </h3>
<div class="paragraph">
<p>In the example above we see how ksqlDB can count all of the messages in a topic, counting them up either in entirety or broken down by a field of your choice. What about if we‚Äôd like to count the number of messages by slices of time? For example, how many messages in the topic <em>per four hours</em>? For this we use <strong>time windowing</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f8f8f2;background-color: #49483e">TIMESTAMPTOSTRING</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">WINDOWSTART</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #e6db74">&#39;yyyy-MM-dd HH:mm:ss&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #e6db74">&#39;Europe/London&#39;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
         <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">FOUR_HOUR_WINDOW_START_TS</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
       <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span>
  <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">CARPARK_SRC</span>
        <span style="color: #66d9ef;font-weight: bold">WINDOW</span> <span style="color: #f8f8f2;background-color: #49483e">TUMBLING</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">SIZE</span> <span style="color: #ae81ff">4</span> <span style="color: #f8f8f2;background-color: #49483e">HOURS</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
  <span style="color: #66d9ef;font-weight: bold">GROUP</span> <span style="color: #66d9ef;font-weight: bold">BY</span> <span style="color: #ae81ff">1</span>
  <span style="color: #f8f8f2;background-color: #49483e">EMIT</span> <span style="color: #f8f8f2;background-color: #49483e">CHANGES</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------------------+-----------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">FOUR_HOUR_WINDOW_START_TS</span> <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span>  <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------------------+-----------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2020</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">09</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span> <span style="color: #ae81ff">13</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span>       <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">368</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2020</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">09</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span> <span style="color: #ae81ff">17</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span>       <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">464</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2020</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">09</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">07</span> <span style="color: #ae81ff">21</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span>       <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">128</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2020</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">09</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">08</span> <span style="color: #ae81ff">01</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span>       <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">8</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2020</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">09</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">08</span> <span style="color: #ae81ff">05</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span>       <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">8</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2020</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">09</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">08</span> <span style="color: #ae81ff">09</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span>       <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">120</span>        <span style="color: #f92672;font-weight: bold">|</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_not_everyone_loves_streams">Not everyone loves streams?&nbsp;<a class="headline-hash" href="#_not_everyone_loves_streams">üîó</a> </h3>
<div class="paragraph">
<p>The above streaming queries are pretty cool, but you don‚Äôt always want to run a continuous query just to check on the number of records in a topic. Quite likely, you just want to do a quick lookup. Kinda like against a database table, with a good ole&#39; regular <code>SELECT</code> that just gives you an answer and exits. Fear not!</p>
</div>
<div class="paragraph">
<p>In this brave new world of streaming SQL we can still do this, and it‚Äôs because ksqlDB can actually build and maintain materialised views. Instead of scanning through the data in a topic each time you want to know how many messages there are, it will instead <strong>materialise that information internally</strong> and then make it available for you to query <em>on demand</em>. Check this out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">CREATE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f8f8f2;background-color: #49483e">MESSAGE_COUNT_BY_4HR</span> <span style="color: #66d9ef;font-weight: bold">AS</span>
    <span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">DUMMY_FIELD</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
           <span style="color: #f8f8f2;background-color: #49483e">TIMESTAMPTOSTRING</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">WINDOWSTART</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #e6db74">&#39;yyyy-MM-dd HH:mm:ss&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #e6db74">&#39;Europe/London&#39;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
             <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">WINDOW_START_TS</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
           <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span>
    <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">CARPARK_SRC</span>
            <span style="color: #66d9ef;font-weight: bold">WINDOW</span> <span style="color: #f8f8f2;background-color: #49483e">TUMBLING</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">SIZE</span> <span style="color: #ae81ff">4</span> <span style="color: #f8f8f2;background-color: #49483e">HOURS</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
    <span style="color: #66d9ef;font-weight: bold">GROUP</span> <span style="color: #66d9ef;font-weight: bold">BY</span> <span style="color: #ae81ff">1</span>
    <span style="color: #f8f8f2;background-color: #49483e">EMIT</span> <span style="color: #f8f8f2;background-color: #49483e">CHANGES</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We‚Äôve now built a table that ksqlDB will keep up to date as any new messages arrive. Whenever we want to know the message count, we can run a query (known as a <strong>pull query</strong> here, contrast to <strong>push query</strong> above):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f8f8f2;background-color: #49483e">WINDOW_START_TS</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span>
  <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">MESSAGE_COUNT_BY_4HR</span>
  <span style="color: #66d9ef;font-weight: bold">WHERE</span> <span style="color: #f8f8f2;background-color: #49483e">WINDOWSTART</span> <span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #e6db74">&#39;2020-09-08T08:00:00+0100&#39;</span>
    <span style="color: #66d9ef;font-weight: bold">AND</span> <span style="color: #f8f8f2;background-color: #49483e">DUMMY_FIELD</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">1</span> <span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------------+-----------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">WINDOW_START_TS</span>      <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">RECORD_CT</span>  <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------------+-----------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2020</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">09</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">08</span> <span style="color: #ae81ff">09</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">00</span>  <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">184</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f8f8f2;background-color: #49483e">Query</span> <span style="color: #f8f8f2;background-color: #49483e">terminated</span>
<span style="color: #f8f8f2;background-color: #49483e">ksql</span><span style="color: #f92672;font-weight: bold">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Did you see that? That right there ‚òùÔ∏è! This:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">Query</span> <span style="color: #f8f8f2;background-color: #49483e">terminated</span>
<span style="color: #f8f8f2;background-color: #49483e">ksql</span><span style="color: #f92672;font-weight: bold">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The query ran, looked up the value, and then returned it to the user. You can do this from the commandline, but you can also do it from your application, using the <a href="https://docs.ksqldb.io/en/latest/developer-guide/ksqldb-clients/java-client/">Java client</a>, <a href="https://docs.ksqldb.io/en/latest/developer-guide/ksqldb-rest-api/streaming-endpoint/">REST API</a>, or even the nascent <a href="https://github.com/rmoff/ksqldb-go">Go client</a> being developed. Here‚Äôs an example with the REST API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>curl <span style="color: #f92672">--http2</span> <span style="color: #e6db74">&#39;http://localhost:8088/query-stream&#39;</span> <span style="color: #ae81ff">\</span>
     <span style="color: #f92672">--data-raw</span> <span style="color: #e6db74">&#39;{&#34;sql&#34;:&#34;SELECT WINDOW_START_TS, RECORD_CT FROM MESSAGE_COUNT_BY_4HR WHERE WINDOWSTART &gt; &#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;2020-09-08T08:00:00+0100&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39; AND DUMMY_FIELD=1 ;&#34;}&#39;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f92672;font-weight: bold">{</span><span style="color: #e6db74">&#34;queryId&#34;</span>:null,<span style="color: #e6db74">&#34;columnNames&#34;</span>:[<span style="color: #e6db74">&#34;WINDOW_START_TS&#34;</span>,<span style="color: #e6db74">&#34;RECORD_CT&#34;</span><span style="color: #f92672;font-weight: bold">]</span>,<span style="color: #e6db74">&#34;columnTypes&#34;</span>:[<span style="color: #e6db74">&#34;STRING&#34;</span>,<span style="color: #e6db74">&#34;BIGINT&#34;</span><span style="color: #f92672;font-weight: bold">]}</span>
<span style="color: #f92672;font-weight: bold">[</span><span style="color: #e6db74">&#34;2020-09-08 09:00:00&#34;</span>,184]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_ways_to_count_the_messages">Other ways to count the messages&nbsp;<a class="headline-hash" href="#_other_ways_to_count_the_messages">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>On the <a href="http://cnfl.io/slack">Confluent Community Slack forum</a> there was an interesting thread about this, and which prompted me to blog it here.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong><a href="https://www.linkedin.com/in/eightnoteight/">Srinivas Devaki</a></strong>:
You can use GetOffsetShell to get the earliest and latest offsets and compute the number of messages by subtracting with each other</p>
</div>
</blockquote>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #75715e;font-style: italic"># Get Latest Offset</span>
/opt/kafka/bin/kafka-run-class.sh kafka.tools.GetOffsetShell <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--broker-list</span> localhost:9092 <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--topic</span> my_topic <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--time</span> <span style="color: #f92672">-1</span>
<span style="color: #75715e;font-style: italic"># Get Earliest Offset</span>
/opt/kafka/bin/kafka-run-class.sh kafka.tools.GetOffsetShell <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--broker-list</span> localhost:9092 <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--topic</span> my_topic <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--time</span> <span style="color: #f92672">-2</span></code></pre>
</div>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong><a href="https://twitter.com/Mr_mitchellh">Mitch Henderson</a></strong>: Small note, offsets are very much not guaranteed to be sequential.  Not every offset will be a record the client will receive.  The above will give you a round about estimate of the number of messages, not it will not be exact.  The only way to get an exact number is to dump the topic and pipe it to wc</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Srinivas</strong>: awesome detail, never knew that offsets are not guaranteed to be sequential. But why is that so? I‚Äôve tried searching about this but couldn‚Äôt find any references, any link where I can read more on this?</p>
</div>
</blockquote>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>Mitch</strong>: Idempotent and transactional production are the most common reasons.  But there are others.</p>
</div>
</blockquote>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong><a href="https://twitter.com/weeco5">Weeco</a></strong>: Also because of gaps in compacted topics this won‚Äôt work
If you don‚Äôt want to consume all messages to count the number of records I have just one idea how to get a rough estimate. I described that here: <a href="https://github.com/cloudhut/kowl/issues/83" class="bare">https://github.com/cloudhut/kowl/issues/83</a></p>
</div>
</blockquote>
</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_select_countgroup_by"><code>SELECT COUNT(*)‚Ä¶GROUP BY‚Ä¶</code></a>
      <ul>
        <li><a href="#_group_by_field"><code>GROUP BY &lt;field&gt;</code></a></li>
        <li><a href="#_group_by_time_window"><code>GROUP BY &lt;time window&gt;</code></a></li>
        <li><a href="#_not_everyone_loves_streams">Not everyone loves streams?</a></li>
      </ul>
    </li>
    <li><a href="#_other_ways_to_count_the_messages">Other ways to count the messages</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
