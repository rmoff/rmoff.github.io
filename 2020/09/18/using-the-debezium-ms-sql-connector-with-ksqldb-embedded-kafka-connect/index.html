<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2020/09/IMG_6749.jpeg" >
		
		<title>Using the Debezium MS SQL connector with ksqlDB embedded Kafka Connect</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/09/18/using-the-debezium-ms-sql-connector-with-ksqldb-embedded-kafka-connect/">
		
		

		
		<meta property="og:title" content="Using the Debezium MS SQL connector with ksqlDB embedded Kafka Connect" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/09/IMG_6749.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/09/18/using-the-debezium-ms-sql-connector-with-ksqldb-embedded-kafka-connect/" />
		<meta property="og:site_name" content="Using the Debezium MS SQL connector with ksqlDB embedded Kafka Connect" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2020/09/IMG_6749.jpeg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Using the Debezium MS SQL connector with ksqlDB embedded Kafka Connect</h1>
			<p class="article-hero-meta">
				
					<time datetime="2020-09-18T10:00:05&#43;01:00">18 Sep 2020</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/ms-sql">MS SQL</a>, <a href="https://rmoff.net/categories/debezium">Debezium</a>, <a href="https://rmoff.net/categories/confluent-hub">Confluent Hub</a>, <a href="https://rmoff.net/categories/ksqldb">ksqlDB</a>, <a href="https://rmoff.net/categories/docker-compose">Docker Compose</a>
					<span class="display-print">at https://rmoff.net/2020/09/18/using-the-debezium-ms-sql-connector-with-ksqldb-embedded-kafka-connect/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_setting_up_the_docker_compose">Setting up the Docker Compose</a>
      <ul>
        <li><a href="#_installing_connectors_in_ksqldb_without_confluent_hub_client">Installing connectors in ksqlDB without Confluent Hub client</a></li>
      </ul>
    </li>
    <li><a href="#_running_the_stack">Running the stack</a></li>
    <li><a href="#_configuring_ms_sql_for_cdc">Configuring MS SQL for CDC</a></li>
    <li><a href="#_adding_a_sql_server_connector_in_ksqldb">Adding a SQL Server connector in ksqlDB</a></li>
    <li><a href="#_using_ms_sql_data_in_ksqldb">Using MS SQL data in ksqlDB</a></li>
    <li><a href="#_capturing_changes_from_ms_sql">Capturing changes from MS SQL</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">MS SQL</span><span data-pagefind-filter="category" style="display:none">Debezium</span><span data-pagefind-filter="category" style="display:none">Confluent Hub</span><span data-pagefind-filter="category" style="display:none">ksqlDB</span><span data-pagefind-filter="category" style="display:none">Docker Compose</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2020/09/IMG_6749.jpeg" style="display:none" alt="">
	
<div class="paragraph">
<p>Prompted by <a href="https://stackoverflow.com/questions/63946368/how-to-use-the-debezium-sql-server-connector-with-ksqldb-embedded-connect">a question on StackOverflow</a> I thought I‚Äôd take a quick look at setting up <a href="https://ksqldb.io">ksqlDB</a> to ingest CDC events from Microsoft SQL Server using <a href="https://debezium.io/">Debezium</a>. Some of this is based on my previous article, <a href="/2019/11/20/streaming-data-from-sql-server-to-kafka-to-snowflake-with-kafka-connect/">Streaming data from SQL Server to Kafka to Snowflake ‚ùÑÔ∏è with Kafka Connect</a>.</p>
</div>
<div class="sect1">
<h2 id="_setting_up_the_docker_compose">Setting up the Docker Compose&nbsp;<a class="headline-hash" href="#_setting_up_the_docker_compose">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>I like standalone, repeatable, demo code. For that reason I love using Docker Compose and I embed everything in there - connector installation, the kitchen sink - the works.</p>
</div>
<div class="paragraph">
<p>You can find the complete <a href="https://github.com/confluentinc/demo-scene/blob/master/mssql-to-kafka-with-ksqldb/docker-compose.yml">Docker Compose file on GitHub</a>.</p>
</div>
<div class="sect2">
<h3 id="_installing_connectors_in_ksqldb_without_confluent_hub_client">Installing connectors in ksqlDB without Confluent Hub client&nbsp;<a class="headline-hash" href="#_installing_connectors_in_ksqldb_without_confluent_hub_client">üîó</a> </h3>
<div class="paragraph">
<p>I‚Äôll usually take advantage of the <code>command:</code> stanza in a Docker Compose service to do things like connector installation, <a href="/2018/12/15/docker-tips-and-tricks-with-ksql-and-kafka/">as detailed here</a>. In ksqlDB 0.11 the Confluent Hub client is absent so I‚Äôve had to take a slightly hackier route. If you head over to <a href="https://hub.confluent.io">Confluent Hub</a> and download the connector you want (in this case Debezium MS SQL) you can check the network console to get the direct URL, in this case</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">https://d1i4a15mxbxib1.cloudfront.net/api/plugins/debezium/debezium-connector-sqlserver/versions/1.2.2/debezium-debezium-connector-sqlserver-1.2.2.zip</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, this URL is liable to change but for now, it works :) (I realise that this runs contrary to making a demo repeatable, but what‚Äôs life if we can‚Äôt live on the edge a bit)</p>
</div>
<div class="paragraph">
<p>With this code we can download and install the connector within the ksqlDB Docker container when it spins up</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">curl https://d1i4a15mxbxib1.cloudfront.net/api/plugins/debezium/debezium-connector-sqlserver/versions/1.2.2/debezium-debezium-connector-sqlserver-1.2.2.zip <span style="color: #f92672">-o</span> /tmp/kafka-connect-mssql.zip
yum <span style="color: #f8f8f2">install</span> <span style="color: #f92672">-y</span> unzip
unzip /tmp/kafka-connect-mssql.zip <span style="color: #f92672">-d</span> /usr/share/java/</code></pre>
</div>
</div>
<div class="paragraph">
<p>There‚Äôs a wrinkle in the plan here which is that the latest version of the container runs as a non-root user, and <code>sudo</code> is not installed (<a href="https://xkcd.com/149/">no sandwiches for me</a>). To hack around this we elevate the container to run as root user in the Docker Compose spec:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml">  <span style="color: #a6e22e">ksqldb</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">image</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">confluentinc/ksqldb-server:0.11.0</span>
    <span style="color: #a6e22e">container_name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">ksqldb</span>
    <span style="color: #a6e22e">user</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">root</span>
    <span style="color: #e6db74">‚Ä¶</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when the container launches it downloads the connector, installs <code>unzip</code> and unzips the connector archive directly into the <code>plugin.path</code> in which Kafka Connect (running embedded in ksqlDB) will look for it.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The &#39;proper&#39; way to do this is either bake your own ksqlDB image with the connector plugin already installed, or to download the connector to the host machine, and mount it into the ksqlDB container. Both of these are fine, but involve more moving parts and stuff to go wrong than a standalone Docker Compose file for my purposes :)
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_the_stack">Running the stack&nbsp;<a class="headline-hash" href="#_running_the_stack">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spin up the <a href="https://github.com/confluentinc/demo-scene/blob/master/mssql-to-kafka-with-ksqldb/docker-compose.yml">Docker Compose file</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">docker-compose up <span style="color: #f92672">-d</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and then launch ksqlDB - this seemingly complex snippet simply waits for ksqlDB to be available before launching the CLI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">docker <span style="color: #f8f8f2">exec</span> <span style="color: #f92672">-it</span> ksqldb bash <span style="color: #f92672">-c</span> <span style="color: #e6db74">&#39;echo -e &#34;\n\n  Waiting for ksqlDB to be available before launching CLI\n&#34;; while : ; do curl_status=$(curl -s -o /dev/null -w %{http_code} http://ksqldb:8088/info) ; echo -e $(date) &#34; ksqlDB server listener HTTP state: &#34; $curl_status &#34; (waiting for 200)&#34; ; if [ $curl_status -eq 200 ] ; then  break ; fi ; sleep 5 ; done ; ksql http://ksqldb:8088&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In a separate terminal, once ksqlDB has finished starting (i.e. once the ksqlDB CLI starts from the above command) make sure that the MS SQL connector has installed correctly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">docker <span style="color: #f8f8f2">exec </span>ksqldb curl <span style="color: #f92672">-s</span> localhost:8083/connector-plugins</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f92672;font-weight: bold">[{</span><span style="color: #e6db74">&#34;class&#34;</span>:<span style="color: #e6db74">&#34;io.debezium.connector.sqlserver.SqlServerConnector&#34;</span>,<span style="color: #e6db74">&#34;type&#34;</span>:<span style="color: #e6db74">&#34;source&#34;</span>,<span style="color: #e6db74">&#34;version&#34;</span>:<span style="color: #e6db74">&#34;1.2.2.Final&#34;</span><span style="color: #f92672;font-weight: bold">}]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_ms_sql_for_cdc">Configuring MS SQL for CDC&nbsp;<a class="headline-hash" href="#_configuring_ms_sql_for_cdc">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the MS SQL container starts a couple of scripts are run to set up the database for CDC and add some test data. If you‚Äôre not using the Docker Compose then you need to run these yourself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">USE</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">master</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #66d9ef;font-weight: bold">GO</span>
<span style="color: #66d9ef;font-weight: bold">CREATE</span> <span style="color: #66d9ef;font-weight: bold">DATABASE</span> <span style="color: #f8f8f2;background-color: #49483e">demo</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #66d9ef;font-weight: bold">GO</span>
<span style="color: #f8f8f2;background-color: #49483e">USE</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">demo</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #66d9ef;font-weight: bold">EXEC</span> <span style="color: #f8f8f2;background-color: #49483e">sys</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">sp_cdc_enable_db</span>
<span style="color: #66d9ef;font-weight: bold">GO</span>

<span style="color: #75715e;font-style: italic">-- Run this to confirm that CDC is now enabled: </span>
<span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f8f8f2;background-color: #49483e">name</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">is_cdc_enabled</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">sys</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">databases</span><span style="color: #f8f8f2;background-color: #49483e">;</span> 
<span style="color: #66d9ef;font-weight: bold">GO</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">use</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">demo</span><span style="color: #f8f8f2;background-color: #49483e">];</span>

<span style="color: #66d9ef;font-weight: bold">CREATE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f8f8f2;background-color: #49483e">demo</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">dbo</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">ORDERS</span> <span style="color: #f8f8f2;background-color: #49483e">(</span> <span style="color: #f8f8f2;background-color: #49483e">order_id</span> <span style="color: #f8f8f2">INT</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span> <span style="color: #f8f8f2">INT</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">order_ts</span> <span style="color: #f8f8f2">DATE</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">order_total_usd</span> <span style="color: #f8f8f2">DECIMAL</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">5</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">),</span> <span style="color: #f8f8f2;background-color: #49483e">item</span> <span style="color: #f8f8f2">VARCHAR</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">50</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #f8f8f2;background-color: #49483e">);</span> 
<span style="color: #66d9ef;font-weight: bold">GO</span>

<span style="color: #66d9ef;font-weight: bold">EXEC</span> <span style="color: #f8f8f2;background-color: #49483e">sys</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">sp_cdc_enable_table</span>
<span style="color: #f92672;font-weight: bold">@</span><span style="color: #f8f8f2;background-color: #49483e">source_schema</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #f8f8f2;background-color: #49483e">N</span><span style="color: #e6db74">&#39;dbo&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
<span style="color: #f92672;font-weight: bold">@</span><span style="color: #f8f8f2;background-color: #49483e">source_name</span>   <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #f8f8f2;background-color: #49483e">N</span><span style="color: #e6db74">&#39;ORDERS&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
<span style="color: #f92672;font-weight: bold">@</span><span style="color: #f8f8f2;background-color: #49483e">role_name</span>     <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #66d9ef;font-weight: bold">NULL</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
<span style="color: #f92672;font-weight: bold">@</span><span style="color: #f8f8f2;background-color: #49483e">supports_net_changes</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #ae81ff">0</span>
<span style="color: #66d9ef;font-weight: bold">GO</span>

<span style="color: #75715e;font-style: italic">-- At this point you should get a row returned from this query</span>
<span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">name</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #66d9ef;font-weight: bold">Schema_Name</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">tb</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">name</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #66d9ef;font-weight: bold">Table_Name</span> <span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">tb</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">object_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">tb</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #66d9ef;font-weight: bold">type</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">tb</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">type_desc</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">tb</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">is_tracked_by_cdc</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">sys</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">tables</span> <span style="color: #f8f8f2;background-color: #49483e">tb</span> <span style="color: #66d9ef;font-weight: bold">INNER</span> <span style="color: #66d9ef;font-weight: bold">JOIN</span> <span style="color: #f8f8f2;background-color: #49483e">sys</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">schemas</span> <span style="color: #f8f8f2;background-color: #49483e">s</span> <span style="color: #66d9ef;font-weight: bold">on</span> <span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">schema_id</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #f8f8f2;background-color: #49483e">tb</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">schema_id</span> <span style="color: #66d9ef;font-weight: bold">WHERE</span> <span style="color: #f8f8f2;background-color: #49483e">tb</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">is_tracked_by_cdc</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #ae81ff">1</span>
<span style="color: #66d9ef;font-weight: bold">GO</span>
<span style="color: #75715e;font-style: italic">-- h/t William Prigol Lopes https://stackoverflow.com/a/61698148/350613</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_a_sql_server_connector_in_ksqldb">Adding a SQL Server connector in ksqlDB&nbsp;<a class="headline-hash" href="#_adding_a_sql_server_connector_in_ksqldb">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>You should now have the ksqlDB prompt open</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">                  <span style="color: #f92672;font-weight: bold">===========================================</span>
                  <span style="color: #f92672;font-weight: bold">=</span>       _              _ ____  ____       <span style="color: #f92672;font-weight: bold">=</span>
                  <span style="color: #f92672;font-weight: bold">=</span>      | | _____  __ _| |  _ <span style="color: #ae81ff">\|</span> __ <span style="color: #f92672;font-weight: bold">)</span>      <span style="color: #f92672;font-weight: bold">=</span>
                  <span style="color: #f92672;font-weight: bold">=</span>      | |/ / __|/ _<span style="color: #e6db74">`</span> | | | | |  _ <span style="color: #ae81ff">\ </span>     <span style="color: #f92672;font-weight: bold">=</span>
                  <span style="color: #f92672;font-weight: bold">=</span>      |   &lt;<span style="color: #ae81ff">\_</span>_ <span style="color: #ae81ff">\ </span><span style="color: #f92672;font-weight: bold">(</span>_| | | |_| | |_<span style="color: #f92672;font-weight: bold">)</span> |     <span style="color: #f92672;font-weight: bold">=</span>
                  <span style="color: #f92672;font-weight: bold">=</span>      |_|<span style="color: #ae81ff">\_\_</span>__/<span style="color: #ae81ff">\_</span>_, |_|____/|____/      <span style="color: #f92672;font-weight: bold">=</span>
                  <span style="color: #f92672;font-weight: bold">=</span>                   |_|                   <span style="color: #f92672;font-weight: bold">=</span>
                  <span style="color: #f92672;font-weight: bold">=</span>  Event Streaming Database purpose-built <span style="color: #f92672;font-weight: bold">=</span>
                  <span style="color: #f92672;font-weight: bold">=</span>        <span style="color: #66d9ef;font-weight: bold">for </span>stream processing apps       <span style="color: #f92672;font-weight: bold">=</span>
                  <span style="color: #f92672;font-weight: bold">===========================================</span>

Copyright 2017-2020 Confluent Inc.

CLI v0.11.0, Server v0.11.0 located at http://ksqldb:8088

Having trouble? Type <span style="color: #e6db74">&#39;help&#39;</span> <span style="color: #f92672;font-weight: bold">(</span><span style="color: #66d9ef;font-weight: bold">case</span><span style="color: #f92672">-insensitive</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">for </span>a rundown of how things work!

ksql&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>From the ksqlDB prompt create the connector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">CREATE</span> <span style="color: #66d9ef;font-weight: bold">SOURCE</span> <span style="color: #f8f8f2;background-color: #49483e">CONNECTOR</span> <span style="color: #f8f8f2;background-color: #49483e">SOURCE_MSSQL_ORDERS_01</span> <span style="color: #66d9ef;font-weight: bold">WITH</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
      <span style="color: #e6db74">&#39;connector.class&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;io.debezium.connector.sqlserver.SqlServerConnector&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;database.hostname&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;mssql&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;database.port&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;1433&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;database.user&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;sa&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;database.password&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;Admin123&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;database.dbname&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;demo&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;database.server.name&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;mssql&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;table.whitelist&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;dbo.orders&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;database.history.kafka.bootstrap.servers&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;broker:29092&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;database.history.kafka.topic&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;dbz_dbhistory.mssql.asgard-01&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#39;decimal.handling.mode&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;double&#39;</span>
<span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Check that it‚Äôs running successfully</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SHOW</span> <span style="color: #f8f8f2;background-color: #49483e">CONNECTORS</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"> <span style="color: #f8f8f2;background-color: #49483e">Connector</span> <span style="color: #f8f8f2;background-color: #49483e">Name</span>         <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">Type</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">Class</span>                                              <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Status</span>
<span style="color: #75715e;font-style: italic">--------------------------------------------------------------------------------------------------------------------</span>
 <span style="color: #f8f8f2;background-color: #49483e">SOURCE_MSSQL_ORDERS_01</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">SOURCE</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">io</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">debezium</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">connector</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">sqlserver</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">SqlServerConnector</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">RUNNING</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">1</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #ae81ff">1</span> <span style="color: #f8f8f2;background-color: #49483e">tasks</span> <span style="color: #f8f8f2;background-color: #49483e">RUNNING</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #75715e;font-style: italic">--------------------------------------------------------------------------------------------------------------------</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If it‚Äôs <strong>not</strong> (e.g. if the Status is <code>WARNING</code>) then run <code>docker logs -f ksqldb</code> and page through to find the <code>ERROR</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_ms_sql_data_in_ksqldb">Using MS SQL data in ksqlDB&nbsp;<a class="headline-hash" href="#_using_ms_sql_data_in_ksqldb">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the connector running and the data flowing you can declare a stream against it</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">CREATE</span> <span style="color: #f8f8f2;background-color: #49483e">STREAM</span> <span style="color: #f8f8f2;background-color: #49483e">ORDERS</span> <span style="color: #66d9ef;font-weight: bold">WITH</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">KAFKA_TOPIC</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;mssql.dbo.ORDERS&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">VALUE_FORMAT</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;AVRO&#39;</span><span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and then start to explore the data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SET</span> <span style="color: #e6db74">&#39;auto.offset.reset&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;earliest&#39;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>

<span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #66d9ef;font-weight: bold">SOURCE</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">NAME</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">SOURCE</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #66d9ef;font-weight: bold">SCHEMA</span> <span style="color: #f92672;font-weight: bold">+</span> <span style="color: #e6db74">&#39;.&#39;</span> <span style="color: #f92672;font-weight: bold">+</span> <span style="color: #66d9ef;font-weight: bold">SOURCE</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2">&#34;TABLE&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">OP</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #66d9ef;font-weight: bold">BEFORE</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #66d9ef;font-weight: bold">AFTER</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">ORDERS</span> <span style="color: #f8f8f2;background-color: #49483e">EMIT</span> <span style="color: #f8f8f2;background-color: #49483e">CHANGES</span> <span style="color: #66d9ef;font-weight: bold">LIMIT</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">+-----------------------+-----------------------+-------+---------+-----------------------+
|NAME                   |KSQL_COL_0             |OP     |BEFORE   |AFTER                  |
+-----------------------+-----------------------+-------+---------+-----------------------+
|mssql                  |dbo.ORDERS             |r      |null     |<span style="color: #f92672;font-weight: bold">{</span><span style="color: #f8f8f2">ORDER_ID</span><span style="color: #f92672;font-weight: bold">=</span>1, CUSTOMER_I|
|                       |                       |       |         |D<span style="color: #f92672;font-weight: bold">=</span>7, <span style="color: #f8f8f2">ORDER_TS</span><span style="color: #f92672;font-weight: bold">=</span>18256, OR|
|                       |                       |       |         |DER_TOTAL_USD<span style="color: #f92672;font-weight: bold">=</span>2.1, ITEM|
|                       |                       |       |         |<span style="color: #f92672;font-weight: bold">=</span>Proper Job<span style="color: #f92672;font-weight: bold">}</span>           |
|mssql                  |dbo.ORDERS             |r      |null     |<span style="color: #f92672;font-weight: bold">{</span><span style="color: #f8f8f2">ORDER_ID</span><span style="color: #f92672;font-weight: bold">=</span>2, CUSTOMER_I|
|                       |                       |       |         |D<span style="color: #f92672;font-weight: bold">=</span>8, <span style="color: #f8f8f2">ORDER_TS</span><span style="color: #f92672;font-weight: bold">=</span>18236, OR|
|                       |                       |       |         |DER_TOTAL_USD<span style="color: #f92672;font-weight: bold">=</span>0.23, ITE|
|                       |                       |       |         |M<span style="color: #f92672;font-weight: bold">=</span>Wainwright<span style="color: #f92672;font-weight: bold">}</span>          |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the <code>‚Üí</code> operator to access the nested fields.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #66d9ef;font-weight: bold">AFTER</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">ORDER_ID</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">AFTER</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">CUSTOMER_ID</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">AFTER</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">ORDER_TOTAL_USD</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">ORDERS</span> <span style="color: #f8f8f2;background-color: #49483e">EMIT</span> <span style="color: #f8f8f2;background-color: #49483e">CHANGES</span> <span style="color: #66d9ef;font-weight: bold">LIMIT</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">+-------------+--------------+------------------+
|ORDER_ID     |CUSTOMER_ID   |ORDER_TOTAL_USD   |
+-------------+--------------+------------------+
|1            |7             |2.1               |
|2            |8             |0.23              |
|3            |12            |4.3               |
|4            |7             |4.88              |
|5            |14            |3.89              |
Limit Reached
Query terminated</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_capturing_changes_from_ms_sql">Capturing changes from MS SQL&nbsp;<a class="headline-hash" href="#_capturing_changes_from_ms_sql">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we‚Äôve just seen the snapshot/bootstrap ingest of data from MS SQL into Kafka/ksqlDB. Let‚Äôs make some changes in MS SQL and see how they show up in ksqlDB.</p>
</div>
<div class="paragraph">
<p>Launch the MS SQL CLI</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">docker <span style="color: #f8f8f2">exec</span> <span style="color: #f92672">-it</span> mssql bash <span style="color: #f92672">-c</span> <span style="color: #e6db74">&#39;/opt/mssql-tools/bin/sqlcmd -l 30 -d demo -S localhost -U sa -P $SA_PASSWORD&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Make some changes to the data</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">DELETE</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">ORDERS</span> <span style="color: #66d9ef;font-weight: bold">WHERE</span> <span style="color: #f8f8f2;background-color: #49483e">ORDER_ID</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #66d9ef;font-weight: bold">UPDATE</span> <span style="color: #f8f8f2;background-color: #49483e">ORDERS</span> <span style="color: #66d9ef;font-weight: bold">SET</span> <span style="color: #f8f8f2;background-color: #49483e">ORDER_TOTAL_USD</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #f8f8f2;background-color: #49483e">ORDER_TOTAL_USD</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">9</span> <span style="color: #66d9ef;font-weight: bold">WHERE</span> <span style="color: #f8f8f2;background-color: #49483e">ORDER_ID</span> <span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #66d9ef;font-weight: bold">INSERT</span> <span style="color: #66d9ef;font-weight: bold">INTO</span> <span style="color: #f8f8f2;background-color: #49483e">ORDERS</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">order_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">order_ts</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">order_total_usd</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">item</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">values</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">9</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;2019-11-29T11:10:39Z&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;2.24&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;Black Sheep Ale&#39;</span><span style="color: #f8f8f2;background-color: #49483e">);</span>
<span style="color: #66d9ef;font-weight: bold">GO</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Check out the data in ksqlDB</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f8f8f2;background-color: #49483e">OP</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
       <span style="color: #66d9ef;font-weight: bold">SOURCE</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #66d9ef;font-weight: bold">SCHEMA</span> <span style="color: #f92672;font-weight: bold">+</span> <span style="color: #e6db74">&#39;.&#39;</span> <span style="color: #f92672;font-weight: bold">+</span> <span style="color: #66d9ef;font-weight: bold">SOURCE</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2">&#34;TABLE&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
       <span style="color: #66d9ef;font-weight: bold">BEFORE</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">ORDER_ID</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">B_ORDER_ID</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
       <span style="color: #66d9ef;font-weight: bold">AFTER</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">ORDER_ID</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">A_ORDER_ID</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
       <span style="color: #66d9ef;font-weight: bold">BEFORE</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">ORDER_TOTAL_USD</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">B_ORDER_TOTAL_USD</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
       <span style="color: #66d9ef;font-weight: bold">AFTER</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">ORDER_TOTAL_USD</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">A_ORDER_TOTAL_USD</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
       <span style="color: #66d9ef;font-weight: bold">BEFORE</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">ITEM</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">B_ITEM</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
       <span style="color: #66d9ef;font-weight: bold">AFTER</span><span style="color: #f92672;font-weight: bold">-&gt;</span><span style="color: #f8f8f2;background-color: #49483e">ITEM</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">A_ITEM</span>
  <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">ORDERS</span>
  <span style="color: #66d9ef;font-weight: bold">WHERE</span> <span style="color: #66d9ef;font-weight: bold">NOT</span> <span style="color: #f8f8f2;background-color: #49483e">OP</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;r&#39;</span>
  <span style="color: #f8f8f2;background-color: #49483e">EMIT</span> <span style="color: #f8f8f2;background-color: #49483e">CHANGES</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----+-------------+------------+-----------+-------------------+------------------+---------------------+---------------------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">OP</span>   <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">KSQL_COL_0</span>   <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">B_ORDER_ID</span>  <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">A_ORDER_ID</span> <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">B_ORDER_TOTAL_USD</span>  <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">A_ORDER_TOTAL_USD</span> <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">B_ITEM</span>               <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">A_ITEM</span>               <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----+-------------+------------+-----------+-------------------+------------------+---------------------+---------------------+</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">d</span>    <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">dbo</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">ORDERS</span>   <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">1</span>           <span style="color: #f92672;font-weight: bold">|</span><span style="color: #66d9ef;font-weight: bold">null</span>       <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">1</span>                <span style="color: #f92672;font-weight: bold">|</span><span style="color: #66d9ef;font-weight: bold">null</span>              <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Proper</span> <span style="color: #f8f8f2;background-color: #49483e">Job</span>           <span style="color: #f92672;font-weight: bold">|</span><span style="color: #66d9ef;font-weight: bold">null</span>                 <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">u</span>    <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">dbo</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">ORDERS</span>   <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2</span>           <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2</span>          <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">23</span>               <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">21</span>              <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Wainwright</span>           <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Wainwright</span>           <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span><span style="color: #66d9ef;font-weight: bold">c</span>    <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">dbo</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">ORDERS</span>   <span style="color: #f92672;font-weight: bold">|</span><span style="color: #66d9ef;font-weight: bold">null</span>        <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">9</span>          <span style="color: #f92672;font-weight: bold">|</span><span style="color: #66d9ef;font-weight: bold">null</span>               <span style="color: #f92672;font-weight: bold">|</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">24</span>              <span style="color: #f92672;font-weight: bold">|</span><span style="color: #66d9ef;font-weight: bold">null</span>                 <span style="color: #f92672;font-weight: bold">|</span><span style="color: #f8f8f2;background-color: #49483e">Black</span> <span style="color: #f8f8f2;background-color: #49483e">Sheep</span> <span style="color: #f8f8f2;background-color: #49483e">Ale</span>      <span style="color: #f92672;font-weight: bold">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Things to note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>d</code> deletion message gives you access to the row state before it was deleted</p>
</li>
<li>
<p>The <code>u</code> update message gives you the field values before they were updated (<code>ORDER_TOTAL_USD</code>)</p>
</li>
<li>
<p>The <code>c</code> creation message has null values in the <code>BEFORE</code> object because there were no values before the row was created :)</p>
</li>
</ul>
</div>
</div>
</div>

	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_setting_up_the_docker_compose">Setting up the Docker Compose</a>
      <ul>
        <li><a href="#_installing_connectors_in_ksqldb_without_confluent_hub_client">Installing connectors in ksqlDB without Confluent Hub client</a></li>
      </ul>
    </li>
    <li><a href="#_running_the_stack">Running the stack</a></li>
    <li><a href="#_configuring_ms_sql_for_cdc">Configuring MS SQL for CDC</a></li>
    <li><a href="#_adding_a_sql_server_connector_in_ksqldb">Adding a SQL Server connector in ksqlDB</a></li>
    <li><a href="#_using_ms_sql_data_in_ksqldb">Using MS SQL data in ksqlDB</a></li>
    <li><a href="#_capturing_changes_from_ms_sql">Capturing changes from MS SQL</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
