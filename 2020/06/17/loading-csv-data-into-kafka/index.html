<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2020/06/IMG_5005.jpeg" >
		
		<title>Loading CSV data into Kafka</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/06/17/loading-csv-data-into-kafka/">
		
		

		
		<meta property="og:title" content="Loading CSV data into Kafka" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/06/IMG_5005.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/06/17/loading-csv-data-into-kafka/" />
		<meta property="og:site_name" content="Loading CSV data into Kafka" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2020/06/IMG_5005.jpeg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Loading CSV data into Kafka</h1>
			<p class="article-hero-meta">
				
					<time datetime="2020-06-17T17:57:18&#43;01:00">17 Jun 2020</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/kafka-connect">Kafka Connect</a>, <a href="https://rmoff.net/categories/csv">CSV</a>, <a href="https://rmoff.net/categories/ksqldb">ksqlDB</a>, <a href="https://rmoff.net/categories/postgres">Postgres</a>
					<span class="display-print">at https://rmoff.net/2020/06/17/loading-csv-data-into-kafka/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_schemas">Schemas?</a></li>
    <li><a href="#_kafka_connect_spooldir_connector">Kafka Connect SpoolDir connector</a>
      <ul>
        <li><a href="#_loading_data_from_csv_into_kafka_and_applying_a_schema">Loading data from CSV into Kafka and applying a schema</a></li>
        <li><a href="#_setting_the_message_key">Setting the message key</a></li>
        <li><a href="#_changing_the_schema_field_types">Changing the schema field types</a></li>
        <li><a href="#_just_gimme_the_plain_text">Just gimme the plain text! ðŸ˜¢</a></li>
      </ul>
    </li>
    <li><a href="#_side_bar_schemas_in_action">Side-bar: Schemas in action</a></li>
    <li><a href="#_regex_and_json">Regex and JSON</a></li>
    <li><a href="#_streaming_csv_data_from_kafka_to_a_database_or_anywhere_else">Streaming CSV data from Kafka to a database (or anywhere elseâ€¦)</a></li>
    <li><a href="#_try_it_out">Try it out!</a></li>
    <li><a href="#_video_tutorial">Video Tutorial</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Kafka Connect</span><span data-pagefind-filter="category" style="display:none">CSV</span><span data-pagefind-filter="category" style="display:none">ksqlDB</span><span data-pagefind-filter="category" style="display:none">Postgres</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2020/06/IMG_5005.jpeg" style="display:none" alt="">
	<div class="paragraph">
<p>For whatever reason, CSV still exists as a ubiquitous data interchange format. It doesnâ€™t get much simpler: chuck some plaintext with fields separated by commas into a file and stick <code>.csv</code> on the end. If youâ€™re feeling helpful you can include a header row with field names in.</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csv" data-lang="csv"><span style="display:flex;"><span><span style="color:#ba2121">order_id</span>,<span style="color:#ba2121">customer_id</span>,<span style="color:#ba2121">order_total_usd</span>,<span style="color:#ba2121">make</span>,<span style="color:#ba2121">model</span>,<span style="color:#ba2121">delivery_city</span>,<span style="color:#ba2121">delivery_company</span>,<span style="color:#ba2121">delivery_address</span>
</span></span><span style="display:flex;"><span><span style="color:#ba2121">1</span>,<span style="color:#ba2121">535</span>,<span style="color:#ba2121">190899.73</span>,<span style="color:#ba2121">Dodge</span>,<span style="color:#ba2121">Ram Wagon B350</span>,<span style="color:#ba2121">Sheffield</span>,<span style="color:#ba2121">DuBuque LLC</span>,<span style="color:#ba2121">2810 Northland Avenue</span>
</span></span><span style="display:flex;"><span><span style="color:#ba2121">2</span>,<span style="color:#ba2121">671</span>,<span style="color:#ba2121">33245.53</span>,<span style="color:#ba2121">Volkswagen</span>,<span style="color:#ba2121">Cabriolet</span>,<span style="color:#ba2121">Edinburgh</span>,<span style="color:#ba2121">Bechtelar-VonRueden</span>,<span style="color:#ba2121">1 Macpherson Crossing</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>In this article weâ€™ll see how to load this CSV data into Kafka, without even needing to write any code</p>
</div>
<div class="paragraph">
<p>Importantly, weâ€™re not going to reinvent the wheel by trying to write some code to do it ourselves - <a href="https://docs.confluent.io/current/connect/index.html">Kafka Connect</a> (which is part of Apache Kafka) already exists <a href="https://rmoff.dev/ljc-kafka-02">to do all of this for us</a>; we just need the appropriate connector.</p>
</div>
<div class="paragraph">
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/N1pseW9waNI?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"></iframe>
    </div>

</div>
<div class="sect1">
<h2 id="_schemas">Schemas?&nbsp;<a class="headline-hash" href="#_schemas">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Yeah, schemas. CSV files might not care about them much, but the users of your data in Kafka will. <strong>Ideally</strong> we want a way to define the schema of the data that we ingest so that it can be stored and read by anyone who wants to use the data. To understand why this is such a big deal check out:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.infoq.com/presentations/contracts-streaming-microservices/">Streaming Microservices: Contracts &amp; Compatibility</a> (InfoQ talk)</p>
</li>
<li>
<p><a href="https://www.confluent.io/blog/schema-registry-kafka-stream-processing-yes-virginia-you-really-need-one">Yes, Virginia, You Really Do Need a Schema Registry</a> (blog)</p>
</li>
<li>
<p><a href="https://www.confluent.io/blog/schemas-contracts-compatibility">Schemas, Contracts, and Compatibility</a> (blog)</p>
</li>
<li>
<p><a href="https://www.confluent.io/blog/confluent-platform-now-supports-protobuf-json-schema-custom-formats/">Confluent Platform Now Supports Protobuf, JSON Schema, and Custom Formats</a> (blog)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are going to define a schema at ingest (and I hope you do), use Avro, Protobuf, or JSON Schema, as described <a href="https://www.confluent.io/blog/kafka-connect-deep-dive-converters-serialization-explained">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You donâ€™t <strong>have</strong> to use a schema. You can just ingest the CSV data as-is, and I cover this below too.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kafka_connect_spooldir_connector">Kafka Connect SpoolDir connector&nbsp;<a class="headline-hash" href="#_kafka_connect_spooldir_connector">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Kafka Connect SpoolDir connector supports various flatfile formats, including CSV. Get it from <a href="https://www.confluent.io/hub/jcustenborder/kafka-connect-spooldir">Confluent Hub</a>, and check out the <a href="https://docs.confluent.io/current/connect/kafka-connect-spooldir/">docs here</a>. Once youâ€™ve installed it in your Kafka Connect worker make sure you restart the worker for it to pick it up. You can check by running:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -s localhost:8083/connector-plugins|jq <span style="color:#ba2121">&#39;.[].class&#39;</span>|egrep <span style="color:#ba2121">&#39;SpoolDir&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirCsvSourceConnector&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirJsonSourceConnector&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirLineDelimitedSourceConnector&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirSchemaLessJsonSourceConnector&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.elf.SpoolDirELFSourceConnector&#34;</span></span></span></code></pre></div>
</div>
<div class="sect2">
<h3 id="_loading_data_from_csv_into_kafka_and_applying_a_schema">Loading data from CSV into Kafka and applying a schema&nbsp;<a class="headline-hash" href="#_loading_data_from_csv_into_kafka_and_applying_a_schema">ðŸ”—</a> </h3>
<div class="paragraph">
<p>If you have a header row with field names you can take advantage of these to define the schema at ingestion time (which is a <strong>good</strong> idea).</p>
</div>
<div class="paragraph">
<p>Create the connector:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -i -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> http://localhost:8083/connectors/source-csv-spooldir-00/config <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirCsvSourceConnector&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;topic&#34;: &#34;orders_spooldir_00&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;input.path&#34;: &#34;/data/unprocessed&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;finished.path&#34;: &#34;/data/processed&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;error.path&#34;: &#34;/data/error&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;input.file.pattern&#34;: &#34;.*\\.csv&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;schema.generation.enabled&#34;:&#34;true&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;csv.first.row.as.header&#34;:&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        }&#39;</span></span></span></code></pre></div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
when you create the connector with this configuration you need to run this with <code>&#34;csv.first.row.as.header&#34;:&#34;true&#34;</code> and a file with headers already in place pending to be read.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Now head over to a Kafka consumer and observe our data. Here Iâ€™m using kafkacat cos itâ€™s great :)</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker <span style="color:#008000">exec</span> kafkacat <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b kafka:29092 -t orders_spooldir_00 <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -C -o-1 -J <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -s <span style="color:#19177c">key</span><span style="color:#666">=</span>s -s <span style="color:#19177c">value</span><span style="color:#666">=</span>avro -r http://schema-registry:8081 | <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             jq <span style="color:#ba2121">&#39;.payload&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;order_id&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;500&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;customer_id&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;424&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;order_total_usd&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;160312.42&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;make&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Chevrolet&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;model&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Suburban 1500&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;delivery_city&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;London&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;delivery_company&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Predovic LLC&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;delivery_address&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;2 Sundown Drive&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">}</span>
</span></span><span style="display:flex;"><span><span style="color:#666">}</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Whatâ€™s more, in the header of the Kafka message is the metadata from the file itself:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ docker <span style="color:#008000">exec</span> kafkacat <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b kafka:29092 -t orders_spooldir_00 <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -C -o-1 -J <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -s <span style="color:#19177c">key</span><span style="color:#666">=</span>s -s <span style="color:#19177c">value</span><span style="color:#666">=</span>avro -r http://schema-registry:8081 | <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             jq <span style="color:#ba2121">&#39;.headers&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">[</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;file.name&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;orders.csv&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;file.path&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;/data/unprocessed/orders.csv&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;file.length&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;39102&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;file.offset&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;501&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;file.last.modified&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;2020-06-17T13:33:50.000Z&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">]</span></span></span></code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_the_message_key">Setting the message key&nbsp;<a class="headline-hash" href="#_setting_the_message_key">ðŸ”—</a> </h3>
<div class="paragraph">
<p>Assuming you have header row to provide field names, you can set <code>schema.generation.key.fields</code> to the name of the field(s) youâ€™d like to use for the Kafka message key. If youâ€™re running this after the first example above remember that the connector relocates your file so you need to move it back to the <code>input.path</code> location for it to be processed again.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The connector name (here itâ€™s <code>source-csv-spooldir-01</code>) is used in tracking which files have been processed and the offset within them, so a connector of the same name wonâ€™t reprocess a file of the same name and lower offset than already processed. If you want to force it to reprocess a file, give the connector a new name.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -i -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> http://localhost:8083/connectors/source-csv-spooldir-01/config <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirCsvSourceConnector&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;topic&#34;: &#34;orders_spooldir_01&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;input.path&#34;: &#34;/data/unprocessed&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;finished.path&#34;: &#34;/data/processed&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;error.path&#34;: &#34;/data/error&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;input.file.pattern&#34;: &#34;.*\\.csv&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;schema.generation.enabled&#34;:&#34;true&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;schema.generation.key.fields&#34;:&#34;order_id&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;csv.first.row.as.header&#34;:&#34;true&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        }&#39;</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>The resulting Kafka message has the <code>order_id</code> set as the message key:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker <span style="color:#008000">exec</span> kafkacat <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b kafka:29092 -t orders_spooldir_01 -o-1 <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -C -J <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             -s <span style="color:#19177c">key</span><span style="color:#666">=</span>s -s <span style="color:#19177c">value</span><span style="color:#666">=</span>avro -r http://schema-registry:8081 | <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>             jq <span style="color:#ba2121">&#39;{&#34;key&#34;:.key,&#34;payload&#34;: .payload}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;key&#34;</span>: <span style="color:#ba2121">&#34;Struct{order_id=3}&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;payload&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;order_id&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;3&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;customer_id&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;695&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;order_total_usd&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;155664.90&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;make&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Toyota&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;model&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Avalon&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;delivery_city&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Brighton&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;delivery_company&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Jacobs, Ebert and Dooley&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;delivery_address&#34;</span>: <span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;4 Loomis Crossing&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#666">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">}</span>
</span></span><span style="display:flex;"><span><span style="color:#666">}</span></span></span></code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="_changing_the_schema_field_types">Changing the schema field types&nbsp;<a class="headline-hash" href="#_changing_the_schema_field_types">ðŸ”—</a> </h3>
<div class="paragraph">
<p>The connector does a fair job at setting the schema, but maybe you want to override it. You can declare the whole thing upfront using the <code>value.schema</code> configuration, but perhaps you are happy with it inferring the whole schema except for a couple of fields. Here you can use <a href="https://docs.confluent.io/current/connect/transforms/index.html">Single Message Transform</a> to munge it:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -i -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> http://localhost:8083/connectors/source-csv-spooldir-02/config <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirCsvSourceConnector&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;topic&#34;: &#34;orders_spooldir_02&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;input.path&#34;: &#34;/data/unprocessed&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;finished.path&#34;: &#34;/data/processed&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;error.path&#34;: &#34;/data/error&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;input.file.pattern&#34;: &#34;.*\\.csv&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;schema.generation.enabled&#34;:&#34;true&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;schema.generation.key.fields&#34;:&#34;order_id&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;csv.first.row.as.header&#34;:&#34;true&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;transforms&#34;:&#34;castTypes&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;transforms.castTypes.type&#34;:&#34;org.apache.kafka.connect.transforms.Cast$Value&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;transforms.castTypes.spec&#34;:&#34;order_id:int32,customer_id:int32,order_total_usd:float32&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        }&#39;</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>If you go and look at the schema thatâ€™s been created and stored in the Schema Registry you can see the field data types have been set as specified:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>âžœ curl --silent --location --request GET <span style="color:#ba2121">&#39;http://localhost:8081/subjects/orders_spooldir_02-value/versions/latest&#39;</span> |jq <span style="color:#ba2121">&#39;.schema|fromjson&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#ba2121">&#34;record&#34;</span>, <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;Value&#34;</span>, <span style="color:#ba2121">&#34;namespace&#34;</span>: <span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.model&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;fields&#34;</span>: <span style="color:#666">[</span>
</span></span><span style="display:flex; background-color:#e5e5e5"><span>    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;order_id&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;int&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span></span><span style="display:flex; background-color:#e5e5e5"><span>    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;customer_id&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;int&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span></span><span style="display:flex; background-color:#e5e5e5"><span>    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;order_total_usd&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;float&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;make&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;model&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;delivery_city&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;delivery_company&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;delivery_address&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#666">]</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ba2121">&#34;connect.name&#34;</span>: <span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.model.Value&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#666">}</span></span></span></code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="_just_gimme_the_plain_text">Just gimme the plain text! ðŸ˜¢&nbsp;<a class="headline-hash" href="#_just_gimme_the_plain_text">ðŸ”—</a> </h3>
<div class="paragraph">
<p>All of this schemas seems like a bunch of fuss really, doesnâ€™t it? Well not really. But, if you absolutely must just have CSV in your Kafka topic then hereâ€™s how. Note that weâ€™re using a <a href="https://docs.confluent.io/current/connect/kafka-connect-spooldir/connectors/line_delimited_source_connector.html">different connector class</a> and weâ€™re using <code>org.apache.kafka.connect.storage.StringConverter</code> to write the values. If you want to learn more about serialisers and converters <a href="https://www.confluent.io/blog/kafka-connect-deep-dive-converters-serialization-explained">see here</a>.</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -i -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> http://localhost:8083/connectors/source-csv-spooldir-03/config <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirLineDelimitedSourceConnector&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;value.converter&#34;:&#34;org.apache.kafka.connect.storage.StringConverter&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;topic&#34;: &#34;orders_spooldir_03&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;input.path&#34;: &#34;/data/unprocessed&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;finished.path&#34;: &#34;/data/processed&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;error.path&#34;: &#34;/data/error&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;input.file.pattern&#34;: &#34;.*\\.csv&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        }&#39;</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>The result? Just CSV.</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>âžœ docker <span style="color:#008000">exec</span> kafkacat <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b kafka:29092 -t orders_spooldir_03 -o-5 -C -u -q
</span></span><span style="display:flex;"><span>496,456,80466.80,Volkswagen,Touareg,Leeds,Hilpert-Williamson,96 Stang Junction
</span></span><span style="display:flex;"><span>497,210,57743.67,Dodge,Neon,London,Christiansen Group,7442 Algoma Hill
</span></span><span style="display:flex;"><span>498,88,211171.02,Nissan,370Z,York,<span style="color:#ba2121">&#34;King, Yundt and Skiles&#34;</span>,3 1st Plaza
</span></span><span style="display:flex;"><span>499,343,126072.73,Chevrolet,Camaro,Sheffield,<span style="color:#ba2121">&#34;Schiller, Ankunding and Schumm&#34;</span>,8920 Hoffman Place
</span></span><span style="display:flex;"><span>500,424,160312.42,Chevrolet,Suburban 1500,London,Predovic LLC,2 Sundown Drive</span></span></code></pre></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_side_bar_schemas_in_action">Side-bar: Schemas in action&nbsp;<a class="headline-hash" href="#_side_bar_schemas_in_action">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>So weâ€™ve read some CSV data into Kafka. Thatâ€™s not the end of its journey. Itâ€™s going to be used for something! Letâ€™s do that.</p>
</div>
<div class="paragraph">
<p>Hereâ€™s <a href="https://ksqldb.io/quickstart.html">ksqlDB</a>, in which we declare the orders topic we wrote to with a schema as a stream:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>ksql<span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span>STREAM<span style="color:#bbb"> </span>ORDERS_02<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>(KAFKA_TOPIC<span style="color:#666">=</span><span style="color:#ba2121">&#39;orders_spooldir_02&#39;</span>,VALUE_FORMAT<span style="color:#666">=</span><span style="color:#ba2121">&#39;AVRO&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>Message<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">----------------
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb"> </span>Stream<span style="color:#bbb"> </span>created<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">----------------</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Having done thatâ€”and because thereâ€™s a schema that was created at ingestion timeâ€”we can see all of the fields available to us:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>ksql<span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">DESCRIBE</span><span style="color:#bbb"> </span>ORDERS_02;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>Name<span style="color:#bbb">                 </span>:<span style="color:#bbb"> </span>ORDERS_02<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>Field<span style="color:#bbb">            </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">Type</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#bbb"> </span>ROWKEY<span style="color:#bbb">           </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>(STRING)<span style="color:#bbb">  </span>(<span style="color:#008000;font-weight:bold">key</span>)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>ORDER_ID<span style="color:#bbb">         </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#008000">INTEGER</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>CUSTOMER_ID<span style="color:#bbb">      </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#008000">INTEGER</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>ORDER_TOTAL_USD<span style="color:#bbb">  </span><span style="color:#666">|</span><span style="color:#bbb"> </span>DOUBLE<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>MAKE<span style="color:#bbb">             </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>(STRING)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>MODEL<span style="color:#bbb">            </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>(STRING)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>DELIVERY_CITY<span style="color:#bbb">    </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>(STRING)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>DELIVERY_COMPANY<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>(STRING)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"> </span>DELIVERY_ADDRESS<span style="color:#bbb"> </span><span style="color:#666">|</span><span style="color:#bbb"> </span><span style="color:#008000">VARCHAR</span>(STRING)<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#408080;font-style:italic">-------------------------------------------
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#008000;font-weight:bold">For</span><span style="color:#bbb"> </span>runtime<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">statistics</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">and</span><span style="color:#bbb"> </span>query<span style="color:#bbb"> </span>details<span style="color:#bbb"> </span>run:<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">DESCRIBE</span><span style="color:#bbb"> </span>EXTENDED<span style="color:#bbb"> </span><span style="color:#666">&lt;</span>Stream,<span style="color:#008000;font-weight:bold">Table</span><span style="color:#666">&gt;</span>;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>ksql<span style="color:#666">&gt;</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>and run queries against the data thatâ€™s in Kafka:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>ksql<span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">SELECT</span><span style="color:#bbb"> </span>DELIVERY_CITY,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">COUNT</span>(<span style="color:#666">*</span>)<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>ORDER_COUNT,<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">MAX</span>(<span style="color:#008000;font-weight:bold">CAST</span>(ORDER_TOTAL_USD<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span><span style="color:#008000">DECIMAL</span>(<span style="color:#666">9</span>,<span style="color:#666">2</span>)))<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">AS</span><span style="color:#bbb"> </span>BIGGEST_ORDER_USD<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">FROM</span><span style="color:#bbb"> </span>ORDERS_02<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">GROUP</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">BY</span><span style="color:#bbb"> </span>DELIVERY_CITY<span style="color:#bbb"> </span>EMIT<span style="color:#bbb"> </span>CHANGES;<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">---------------+-------------+---------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span>DELIVERY_CITY<span style="color:#bbb">  </span><span style="color:#666">|</span>ORDER_COUNT<span style="color:#bbb">  </span><span style="color:#666">|</span>BIGGEST_ORDER_USD<span style="color:#bbb">    </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">+</span><span style="color:#408080;font-style:italic">---------------+-------------+---------------------+
</span></span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span>Bradford<span style="color:#bbb">       </span><span style="color:#666">|</span><span style="color:#666">13</span><span style="color:#bbb">           </span><span style="color:#666">|</span><span style="color:#666">189924</span>.<span style="color:#666">47</span><span style="color:#bbb">            </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span>Edinburgh<span style="color:#bbb">      </span><span style="color:#666">|</span><span style="color:#666">13</span><span style="color:#bbb">           </span><span style="color:#666">|</span><span style="color:#666">199502</span>.<span style="color:#666">66</span><span style="color:#bbb">            </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span>Bristol<span style="color:#bbb">        </span><span style="color:#666">|</span><span style="color:#666">16</span><span style="color:#bbb">           </span><span style="color:#666">|</span><span style="color:#666">213830</span>.<span style="color:#666">34</span><span style="color:#bbb">            </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span>Sheffield<span style="color:#bbb">      </span><span style="color:#666">|</span><span style="color:#666">74</span><span style="color:#bbb">           </span><span style="color:#666">|</span><span style="color:#666">216233</span>.<span style="color:#666">98</span><span style="color:#bbb">            </span><span style="color:#666">|</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#666">|</span>London<span style="color:#bbb">         </span><span style="color:#666">|</span><span style="color:#666">160</span><span style="color:#bbb">          </span><span style="color:#666">|</span><span style="color:#666">219736</span>.<span style="color:#666">06</span><span style="color:#bbb">            </span><span style="color:#666">|</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>What about our data that we just ingested into a different topic as straight-up CSV? Because, like, schemas arenâ€™t important?</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>ksql<span style="color:#666">&gt;</span><span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">CREATE</span><span style="color:#bbb"> </span>STREAM<span style="color:#bbb"> </span>ORDERS_03<span style="color:#bbb"> </span><span style="color:#008000;font-weight:bold">WITH</span><span style="color:#bbb"> </span>(KAFKA_TOPIC<span style="color:#666">=</span><span style="color:#ba2121">&#39;orders_spooldir_03&#39;</span>,VALUE_FORMAT<span style="color:#666">=</span><span style="color:#ba2121">&#39;DELIMITED&#39;</span>);<span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span><span style="color:#008000;font-weight:bold">No</span><span style="color:#bbb"> </span>columns<span style="color:#bbb"> </span>supplied.</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Yeah, no columns supplied. No schema, no bueno. If you want to work with the data, whether to query in SQL, stream to a data lake, or do anything else withâ€”at some point youâ€™re going to have to declare that schema. Hence why CSV, as a schemaless-serialisation method, is a bad way to exchange data between systems.</p>
</div>
<div class="paragraph">
<p>If you really want to use your CSV data in ksqlDB, you can, you just need to enter the schemaâ€”which is error prone and tedious. You enter it each time to use the data, every other consumer of the data enters it each time too. Declaring it once at ingest and it being available for all to use makes a lot more sense.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_regex_and_json">Regex and JSON&nbsp;<a class="headline-hash" href="#_regex_and_json">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>If youâ€™re using the REST API to submit configuration you might hit up against errors sending regex values within the JSON. For example, if you want to set <code>input.file.pattern</code> to <code>.*\.csv</code> and you put that in your JSON literally:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;input.file.pattern&#34;</span>: <span style="color:#ba2121">&#34;.*\.csv&#34;</span>,</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Youâ€™ll get this error back if you submit it as inline data with <code>curl</code>:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>com.fasterxml.jackson.core.JsonParseException: Unrecognized character escape <span style="color:#ba2121">&#39;.&#39;</span> <span style="color:#666">(</span>code 46<span style="color:#666">)</span>                                                    at <span style="color:#666">[</span>Source: <span style="color:#666">(</span>org.glassfish.jersey.message.internal.ReaderInterceptorExecutor<span style="color:#19177c">$UnCloseableInputStream</span><span style="color:#666">)</span>; line: 7, column: 36<span style="color:#666">]</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>THe solution is to escape the escape character (the backslash):</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;input.file.pattern&#34;</span>: <span style="color:#ba2121">&#34;.*\\.csv&#34;</span>,</span></span></code></pre></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_streaming_csv_data_from_kafka_to_a_database_or_anywhere_else">Streaming CSV data from Kafka to a database (or anywhere elseâ€¦)&nbsp;<a class="headline-hash" href="#_streaming_csv_data_from_kafka_to_a_database_or_anywhere_else">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since youâ€™ve got a schema to the data, you can easily sink it to a database, such as Postgres:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -X PUT http://localhost:8083/connectors/sink-postgres-orders-00/config <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -H <span style="color:#ba2121">&#34;Content-Type: application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;io.confluent.connect.jdbc.JdbcSinkConnector&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;connection.url&#34;: &#34;jdbc:postgresql://postgres:5432/&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;connection.user&#34;: &#34;postgres&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;connection.password&#34;: &#34;postgres&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;tasks.max&#34;: &#34;1&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;topics&#34;: &#34;orders_spooldir_02&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;auto.create&#34;: &#34;true&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;auto.evolve&#34;:&#34;true&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;pk.mode&#34;:&#34;record_value&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;pk.fields&#34;:&#34;order_id&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;insert.mode&#34;: &#34;upsert&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">        &#34;table.name.format&#34;:&#34;orders&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">    }&#39;</span></span></span></code></pre></div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This <strong>only</strong> works if you have a schema in your data. See <a href="https://rmoff.dev/jdbc-sink-schemas">here</a> to understand why and how to work with this requirement.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#19177c">postgres</span><span style="color:#666">=</span><span style="color:#408080;font-style:italic"># \dt</span>
</span></span><span style="display:flex;"><span>         List of relations
</span></span><span style="display:flex;"><span> Schema |  Name  | Type  |  Owner
</span></span><span style="display:flex;"><span>--------+--------+-------+----------
</span></span><span style="display:flex;"><span> public | orders | table | postgres
</span></span><span style="display:flex;"><span><span style="color:#666">(</span><span style="color:#666">1</span> row<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#19177c">postgres</span><span style="color:#666">=</span><span style="color:#408080;font-style:italic"># \d orders;</span>
</span></span><span style="display:flex;"><span>                    Table <span style="color:#ba2121">&#34;public.orders&#34;</span>
</span></span><span style="display:flex;"><span>      Column      |  Type   | Collation | Nullable | Default
</span></span><span style="display:flex;"><span>------------------+---------+-----------+----------+---------
</span></span><span style="display:flex;"><span> order_id         | integer |           | not null |
</span></span><span style="display:flex;"><span> customer_id      | integer |           |          |
</span></span><span style="display:flex;"><span> order_total_usd  | real    |           |          |
</span></span><span style="display:flex;"><span> make             | text    |           |          |
</span></span><span style="display:flex;"><span> model            | text    |           |          |
</span></span><span style="display:flex;"><span> delivery_city    | text    |           |          |
</span></span><span style="display:flex;"><span> delivery_company | text    |           |          |
</span></span><span style="display:flex;"><span> delivery_address | text    |           |          |
</span></span><span style="display:flex;"><span>Indexes:
</span></span><span style="display:flex;"><span>    <span style="color:#ba2121">&#34;orders_pkey&#34;</span> PRIMARY KEY, btree <span style="color:#666">(</span>order_id<span style="color:#666">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#19177c">postgres</span><span style="color:#666">=</span><span style="color:#408080;font-style:italic"># SELECT * FROM orders FETCH FIRST 10 ROWS ONLY;</span>
</span></span><span style="display:flex;"><span> order_id | customer_id | order_total_usd |    make    |     model      | delivery_city |     delivery_company     |     delivery_address
</span></span><span style="display:flex;"><span>----------+-------------+-----------------+------------+----------------+---------------+--------------------------+--------------------------
</span></span><span style="display:flex;"><span>        <span style="color:#666">1</span> |         <span style="color:#666">535</span> |       190899.73 | Dodge      | Ram Wagon B350 | Sheffield     | DuBuque LLC              | <span style="color:#666">2810</span> Northland Avenue
</span></span><span style="display:flex;"><span>        <span style="color:#666">2</span> |         <span style="color:#666">671</span> |        33245.53 | Volkswagen | Cabriolet      | Edinburgh     | Bechtelar-VonRueden      | <span style="color:#666">1</span> Macpherson Crossing
</span></span><span style="display:flex;"><span>        <span style="color:#666">3</span> |         <span style="color:#666">695</span> |        155664.9 | Toyota     | Avalon         | Brighton      | Jacobs, Ebert and Dooley | <span style="color:#666">4</span> Loomis Crossing
</span></span><span style="display:flex;"><span>        <span style="color:#666">4</span> |         <span style="color:#666">366</span> |        149012.9 | Hyundai    | Santa Fe       | Leeds         | Kiehn Group              | <span style="color:#666">538</span> Burning Wood Alley
</span></span><span style="display:flex;"><span>        <span style="color:#666">5</span> |         <span style="color:#666">175</span> |        63274.18 | Kia        | Sportage       | Leeds         | Miller-Hudson            | <span style="color:#666">6</span> Kennedy Court
</span></span><span style="display:flex;"><span>        <span style="color:#666">6</span> |          <span style="color:#666">37</span> |        97790.04 | BMW        | <span style="color:#666">3</span> Series       | Bristol       | Price Group              | <span style="color:#666">21611</span> Morning Trail
</span></span><span style="display:flex;"><span>        <span style="color:#666">7</span> |         <span style="color:#666">644</span> |        76240.84 | Mazda      | MPV            | Leeds         | Kihn and Sons            | <span style="color:#666">9</span> Susan Street
</span></span><span style="display:flex;"><span>        <span style="color:#666">8</span> |         <span style="color:#666">973</span> |       216233.98 | Hyundai    | Elantra        | Sheffield     | Feeney, Howe and Koss    | <span style="color:#666">07671</span> Hazelcrest Terrace
</span></span><span style="display:flex;"><span>        <span style="color:#666">9</span> |         <span style="color:#666">463</span> |        162589.1 | Chrysler   | Grand Voyager  | York          | Fay, Murazik and Schumm  | <span style="color:#666">42080</span> Pawling Circle
</span></span><span style="display:flex;"><span>       <span style="color:#666">10</span> |         <span style="color:#666">863</span> |       111208.24 | Ford       | Laser          | Leeds         | Boehm, Mohr and Doyle    | <span style="color:#666">0919</span> International Trail
</span></span><span style="display:flex;"><span><span style="color:#666">(</span><span style="color:#666">10</span> rows<span style="color:#666">)</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>To learn more about writing data from Kafka to a database see <a href="https://rmoff.dev/kafka-jdbc-video">this tutorial</a>.</p>
</div>
<div class="paragraph">
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/b-3qN_tlYR4?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"></iframe>
    </div>

</div>
<div class="paragraph">
<p>For more tutorials on Kafka Connect see <a href="https://www.youtube.com/playlist?list=PL5T99fPsK7ppB_AbZhBhTyKHtHWZLWIJ8">ðŸŽ¥ this playlist</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_try_it_out">Try it out!&nbsp;<a class="headline-hash" href="#_try_it_out">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>All <a href="https://github.com/confluentinc/demo-scene/tree/master/csv-to-kafka">the code for this article is on GitHub</a>, and you just need Docker and Docker Compose to spin it up and give it a try. The commandline examples quoted below are based on the Docker environment.</p>
</div>
<div class="paragraph">
<p>To spin it up, clone the repository, change to the correct folder, and launch the stack:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>git clone https://github.com/confluentinc/demo-scene.git
</span></span><span style="display:flex;"><span><span style="color:#008000">cd</span> csv-to-kafka
</span></span><span style="display:flex;"><span>docker-compose up -d</span></span></code></pre></div>
</div>
<div class="paragraph">
<p>Wait for Kafka Connect to launch and then off you go!</p>
</div>
<div class="paragraph">
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bash -c <span style="color:#ba2121">&#39; \
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">echo -e &#34;\n\n=============\nWaiting for Kafka Connect to start listening on localhost â³\n=============\n&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">while [ $(curl -s -o /dev/null -w %{http_code} http://localhost:8083/connectors) -ne 200 ] ; do
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">  echo -e &#34;\t&#34; $(date) &#34; Kafka Connect listener HTTP state: &#34; $(curl -s -o /dev/null -w %{http_code} http://localhost:8083/connectors) &#34; (waiting for 200)&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">  sleep 5
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">done
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">echo -e $(date) &#34;\n\n--------------\n\o/ Kafka Connect is ready! Listener HTTP state: &#34; $(curl -s -o /dev/null -w %{http_code} http://localhost:8083/connectors) &#34;\n--------------\n&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#ba2121">&#39;</span></span></span></code></pre></div>
</div>
<div class="paragraph">
<p>The examples in this article are based on the <code>data</code> folder mapped to <code>/data</code> on the Kafka Connect worker.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_video_tutorial">Video Tutorial&nbsp;<a class="headline-hash" href="#_video_tutorial">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
      <iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen" loading="eager" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/N1pseW9waNI?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" title="YouTube video"></iframe>
    </div>

</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_schemas">Schemas?</a></li>
    <li><a href="#_kafka_connect_spooldir_connector">Kafka Connect SpoolDir connector</a>
      <ul>
        <li><a href="#_loading_data_from_csv_into_kafka_and_applying_a_schema">Loading data from CSV into Kafka and applying a schema</a></li>
        <li><a href="#_setting_the_message_key">Setting the message key</a></li>
        <li><a href="#_changing_the_schema_field_types">Changing the schema field types</a></li>
        <li><a href="#_just_gimme_the_plain_text">Just gimme the plain text! ðŸ˜¢</a></li>
      </ul>
    </li>
    <li><a href="#_side_bar_schemas_in_action">Side-bar: Schemas in action</a></li>
    <li><a href="#_regex_and_json">Regex and JSON</a></li>
    <li><a href="#_streaming_csv_data_from_kafka_to_a_database_or_anywhere_else">Streaming CSV data from Kafka to a database (or anywhere elseâ€¦)</a></li>
    <li><a href="#_try_it_out">Try it out!</a></li>
    <li><a href="#_video_tutorial">Video Tutorial</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
