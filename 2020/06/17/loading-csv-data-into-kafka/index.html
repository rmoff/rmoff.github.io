<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Loading CSV data into Kafka</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/06/17/loading-csv-data-into-kafka/">
		
		
		
		<meta name="generator" content="Hugo 0.75.1" />

		
		<meta property="og:title" content="Loading CSV data into Kafka" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/06/IMG_5005.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/06/17/loading-csv-data-into-kafka/" />
		<meta property="og:site_name" content="Loading CSV data into Kafka" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/images/2020/06/IMG_5005.jpeg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Loading CSV data into Kafka</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2020-06-17T17:57:18&#43;01:00">Jun 17, 2020</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/kafka-connect" class="no-underline category near-white dim">Kafka Connect</a>, <a href="https://rmoff.net/categories/csv" class="no-underline category near-white dim">CSV</a>, <a href="https://rmoff.net/categories/ksqldb" class="no-underline category near-white dim">KsqlDB</a>, <a href="https://rmoff.net/categories/postgres" class="no-underline category near-white dim">Postgres</a>
								<span class="display-print">at https://rmoff.net/2020/06/17/loading-csv-data-into-kafka/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="https://twitter.com/rmoff/" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw7">
	<div class="paragraph">
<p>For whatever reason, CSV still exists as a ubiquitous data interchange format. It doesn’t get much simpler: chuck some plaintext with fields separated by commas into a file and stick <code>.csv</code> on the end. If you’re feeling helpful you can include a header row with field names in.</p>
</div>
<div class="paragraph">
<pre><code class="language-csv" data-lang="csv">order_id,customer_id,order_total_usd,make,model,delivery_city,delivery_company,delivery_address
1,535,190899.73,Dodge,Ram Wagon B350,Sheffield,DuBuque LLC,2810 Northland Avenue
2,671,33245.53,Volkswagen,Cabriolet,Edinburgh,Bechtelar-VonRueden,1 Macpherson Crossing</code></pre>
</div>
<div class="paragraph">
<p>In this article we’ll see how to load this CSV data into Kafka, without even needing to write any code</p>
</div>
<div class="paragraph">
<p>Importantly, we’re not going to reinvent the wheel by trying to write some code to do it ourselves - <a href="https://docs.confluent.io/current/connect/index.html">Kafka Connect</a> (which is part of Apache Kafka) already exists <a href="https://rmoff.dev/ljc-kafka-02">to do all of this for us</a>; we just need the appropriate connector.</p>
</div>
<div class="paragraph">

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/N1pseW9waNI" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

</div>
<div class="sect1">
<h2 id="_schemas">Schemas?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Yeah, schemas. CSV files might not care about them much, but the users of your data in Kafka will. <strong>Ideally</strong> we want a way to define the schema of the data that we ingest so that it can be stored and read by anyone who wants to use the data. To understand why this is such a big deal check out:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.infoq.com/presentations/contracts-streaming-microservices/">Streaming Microservices: Contracts &amp; Compatibility</a> (InfoQ talk)</p>
</li>
<li>
<p><a href="https://www.confluent.io/blog/schema-registry-kafka-stream-processing-yes-virginia-you-really-need-one">Yes, Virginia, You Really Do Need a Schema Registry</a> (blog)</p>
</li>
<li>
<p><a href="https://www.confluent.io/blog/schemas-contracts-compatibility">Schemas, Contracts, and Compatibility</a> (blog)</p>
</li>
<li>
<p><a href="https://www.confluent.io/blog/confluent-platform-now-supports-protobuf-json-schema-custom-formats/">Confluent Platform Now Supports Protobuf, JSON Schema, and Custom Formats</a> (blog)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are going to define a schema at ingest (and I hope you do), use Avro, Protobuf, or JSON Schema, as described <a href="https://www.confluent.io/blog/kafka-connect-deep-dive-converters-serialization-explained">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You don’t <strong>have</strong> to use a schema. You can just ingest the CSV data as-is, and I cover this below too.
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_kafka_connect_spooldir_connector">Kafka Connect SpoolDir connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Kafka Connect SpoolDir connector supports various flatfile formats, including CSV. Get it from <a href="https://www.confluent.io/hub/jcustenborder/kafka-connect-spooldir">Confluent Hub</a>, and check out the <a href="https://docs.confluent.io/current/connect/kafka-connect-spooldir/">docs here</a>. Once you’ve installed it in your Kafka Connect worker make sure you restart the worker for it to pick it up. You can check by running:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ curl -s localhost:8083/connector-plugins|jq <span style="color:#ba2121">&#39;.[].class&#39;</span>|egrep <span style="color:#ba2121">&#39;SpoolDir&#39;</span>

<span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirCsvSourceConnector&#34;</span>
<span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirJsonSourceConnector&#34;</span>
<span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirLineDelimitedSourceConnector&#34;</span>
<span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirSchemaLessJsonSourceConnector&#34;</span>
<span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.spooldir.elf.SpoolDirELFSourceConnector&#34;</span></code></pre></div>
</div>
<div class="sect2">
<h3 id="_loading_data_from_csv_into_kafka_and_applying_a_schema">Loading data from CSV into Kafka and applying a schema</h3>
<div class="paragraph">
<p>If you have a header row with field names you can take advantage of these to define the schema at ingestion time (which is a <strong>good</strong> idea).</p>
</div>
<div class="paragraph">
<p>Create the connector:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -i -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> http://localhost:8083/connectors/source-csv-spooldir-00/config <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirCsvSourceConnector&#34;,
</span><span style="color:#ba2121">        &#34;topic&#34;: &#34;orders_spooldir_00&#34;,
</span><span style="color:#ba2121">        &#34;input.path&#34;: &#34;/data/unprocessed&#34;,
</span><span style="color:#ba2121">        &#34;finished.path&#34;: &#34;/data/processed&#34;,
</span><span style="color:#ba2121">        &#34;error.path&#34;: &#34;/data/error&#34;,
</span><span style="color:#ba2121">        &#34;input.file.pattern&#34;: &#34;.*\\.csv&#34;,
</span><span style="color:#ba2121">        &#34;schema.generation.enabled&#34;:&#34;true&#34;,
</span><span style="color:#ba2121">        &#34;csv.first.row.as.header&#34;:&#34;true&#34;
</span><span style="color:#ba2121">        }&#39;</span></code></pre></div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
when you create the connector with this configuration you need to run this with <code>&#34;csv.first.row.as.header&#34;:&#34;true&#34;</code> and a file with headers already in place pending to be read.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>Now head over to a Kafka consumer and observe our data. Here I’m using kafkacat cos it’s great :)</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ docker <span style="color:#008000">exec</span> kafkacat <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b kafka:29092 -t orders_spooldir_00 <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>             -C -o-1 -J <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>             -s <span style="color:#19177c">key</span><span style="color:#666">=</span>s -s <span style="color:#19177c">value</span><span style="color:#666">=</span>avro -r http://schema-registry:8081 | <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>             jq <span style="color:#ba2121">&#39;.payload&#39;</span>
<span style="color:#666">{</span>
  <span style="color:#ba2121">&#34;order_id&#34;</span>: <span style="color:#666">{</span>
    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;500&#34;</span>
  <span style="color:#666">}</span>,
  <span style="color:#ba2121">&#34;customer_id&#34;</span>: <span style="color:#666">{</span>
    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;424&#34;</span>
  <span style="color:#666">}</span>,
  <span style="color:#ba2121">&#34;order_total_usd&#34;</span>: <span style="color:#666">{</span>
    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;160312.42&#34;</span>
  <span style="color:#666">}</span>,
  <span style="color:#ba2121">&#34;make&#34;</span>: <span style="color:#666">{</span>
    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Chevrolet&#34;</span>
  <span style="color:#666">}</span>,
  <span style="color:#ba2121">&#34;model&#34;</span>: <span style="color:#666">{</span>
    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Suburban 1500&#34;</span>
  <span style="color:#666">}</span>,
  <span style="color:#ba2121">&#34;delivery_city&#34;</span>: <span style="color:#666">{</span>
    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;London&#34;</span>
  <span style="color:#666">}</span>,
  <span style="color:#ba2121">&#34;delivery_company&#34;</span>: <span style="color:#666">{</span>
    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Predovic LLC&#34;</span>
  <span style="color:#666">}</span>,
  <span style="color:#ba2121">&#34;delivery_address&#34;</span>: <span style="color:#666">{</span>
    <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;2 Sundown Drive&#34;</span>
  <span style="color:#666">}</span>
<span style="color:#666">}</span></code></pre></div>
</div>
<div class="paragraph">
<p>What’s more, in the header of the Kafka message is the metadata from the file itself:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ docker <span style="color:#008000">exec</span> kafkacat <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b kafka:29092 -t orders_spooldir_00 <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>             -C -o-1 -J <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>             -s <span style="color:#19177c">key</span><span style="color:#666">=</span>s -s <span style="color:#19177c">value</span><span style="color:#666">=</span>avro -r http://schema-registry:8081 | <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>             jq <span style="color:#ba2121">&#39;.headers&#39;</span>
<span style="color:#666">[</span>
  <span style="color:#ba2121">&#34;file.name&#34;</span>,
  <span style="color:#ba2121">&#34;orders.csv&#34;</span>,
  <span style="color:#ba2121">&#34;file.path&#34;</span>,
  <span style="color:#ba2121">&#34;/data/unprocessed/orders.csv&#34;</span>,
  <span style="color:#ba2121">&#34;file.length&#34;</span>,
  <span style="color:#ba2121">&#34;39102&#34;</span>,
  <span style="color:#ba2121">&#34;file.offset&#34;</span>,
  <span style="color:#ba2121">&#34;501&#34;</span>,
  <span style="color:#ba2121">&#34;file.last.modified&#34;</span>,
  <span style="color:#ba2121">&#34;2020-06-17T13:33:50.000Z&#34;</span>
<span style="color:#666">]</span></code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_the_message_key">Setting the message key</h3>
<div class="paragraph">
<p>Assuming you have header row to provide field names, you can set <code>schema.generation.key.fields</code> to the name of the field(s) you’d like to use for the Kafka message key. If you’re running this after the first example above remember that the connector relocates your file so you need to move it back to the <code>input.path</code> location for it to be processed again.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The connector name (here it’s <code>source-csv-spooldir-01</code>) is used in tracking which files have been processed and the offset within them, so a connector of the same name won’t reprocess a file of the same name and lower offset than already processed. If you want to force it to reprocess a file, give the connector a new name.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -i -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> http://localhost:8083/connectors/source-csv-spooldir-01/config <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirCsvSourceConnector&#34;,
</span><span style="color:#ba2121">        &#34;topic&#34;: &#34;orders_spooldir_01&#34;,
</span><span style="color:#ba2121">        &#34;input.path&#34;: &#34;/data/unprocessed&#34;,
</span><span style="color:#ba2121">        &#34;finished.path&#34;: &#34;/data/processed&#34;,
</span><span style="color:#ba2121">        &#34;error.path&#34;: &#34;/data/error&#34;,
</span><span style="color:#ba2121">        &#34;input.file.pattern&#34;: &#34;.*\\.csv&#34;,
</span><span style="color:#ba2121">        &#34;schema.generation.enabled&#34;:&#34;true&#34;,
</span><span style="color:#ba2121">        &#34;schema.generation.key.fields&#34;:&#34;order_id&#34;,
</span><span style="color:#ba2121">        &#34;csv.first.row.as.header&#34;:&#34;true&#34;
</span><span style="color:#ba2121">        }&#39;</span></code></pre></div>
</div>
<div class="paragraph">
<p>The resulting Kafka message has the <code>order_id</code> set as the message key:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker <span style="color:#008000">exec</span> kafkacat <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b kafka:29092 -t orders_spooldir_01 -o-1 <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>             -C -J <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>             -s <span style="color:#19177c">key</span><span style="color:#666">=</span>s -s <span style="color:#19177c">value</span><span style="color:#666">=</span>avro -r http://schema-registry:8081 | <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>             jq <span style="color:#ba2121">&#39;{&#34;key&#34;:.key,&#34;payload&#34;: .payload}&#39;</span>
<span style="color:#666">{</span>
  <span style="color:#ba2121">&#34;key&#34;</span>: <span style="color:#ba2121">&#34;Struct{order_id=3}&#34;</span>,
  <span style="color:#ba2121">&#34;payload&#34;</span>: <span style="color:#666">{</span>
    <span style="color:#ba2121">&#34;order_id&#34;</span>: <span style="color:#666">{</span>
      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;3&#34;</span>
    <span style="color:#666">}</span>,
    <span style="color:#ba2121">&#34;customer_id&#34;</span>: <span style="color:#666">{</span>
      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;695&#34;</span>
    <span style="color:#666">}</span>,
    <span style="color:#ba2121">&#34;order_total_usd&#34;</span>: <span style="color:#666">{</span>
      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;155664.90&#34;</span>
    <span style="color:#666">}</span>,
    <span style="color:#ba2121">&#34;make&#34;</span>: <span style="color:#666">{</span>
      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Toyota&#34;</span>
    <span style="color:#666">}</span>,
    <span style="color:#ba2121">&#34;model&#34;</span>: <span style="color:#666">{</span>
      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Avalon&#34;</span>
    <span style="color:#666">}</span>,
    <span style="color:#ba2121">&#34;delivery_city&#34;</span>: <span style="color:#666">{</span>
      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Brighton&#34;</span>
    <span style="color:#666">}</span>,
    <span style="color:#ba2121">&#34;delivery_company&#34;</span>: <span style="color:#666">{</span>
      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;Jacobs, Ebert and Dooley&#34;</span>
    <span style="color:#666">}</span>,
    <span style="color:#ba2121">&#34;delivery_address&#34;</span>: <span style="color:#666">{</span>
      <span style="color:#ba2121">&#34;string&#34;</span>: <span style="color:#ba2121">&#34;4 Loomis Crossing&#34;</span>
    <span style="color:#666">}</span>
  <span style="color:#666">}</span>
<span style="color:#666">}</span></code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="_changing_the_schema_field_types">Changing the schema field types</h3>
<div class="paragraph">
<p>The connector does a fair job at setting the schema, but maybe you want to override it. You can declare the whole thing upfront using the <code>value.schema</code> configuration, but perhaps you are happy with it inferring the whole schema except for a couple of fields. Here you can use <a href="https://docs.confluent.io/current/connect/transforms/index.html">Single Message Transform</a> to munge it:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -i -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> http://localhost:8083/connectors/source-csv-spooldir-02/config <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirCsvSourceConnector&#34;,
</span><span style="color:#ba2121">        &#34;topic&#34;: &#34;orders_spooldir_02&#34;,
</span><span style="color:#ba2121">        &#34;input.path&#34;: &#34;/data/unprocessed&#34;,
</span><span style="color:#ba2121">        &#34;finished.path&#34;: &#34;/data/processed&#34;,
</span><span style="color:#ba2121">        &#34;error.path&#34;: &#34;/data/error&#34;,
</span><span style="color:#ba2121">        &#34;input.file.pattern&#34;: &#34;.*\\.csv&#34;,
</span><span style="color:#ba2121">        &#34;schema.generation.enabled&#34;:&#34;true&#34;,
</span><span style="color:#ba2121">        &#34;schema.generation.key.fields&#34;:&#34;order_id&#34;,
</span><span style="color:#ba2121">        &#34;csv.first.row.as.header&#34;:&#34;true&#34;,
</span><span style="color:#ba2121">        &#34;transforms&#34;:&#34;castTypes&#34;,
</span><span style="color:#ba2121">        &#34;transforms.castTypes.type&#34;:&#34;org.apache.kafka.connect.transforms.Cast$Value&#34;,
</span><span style="color:#ba2121">        &#34;transforms.castTypes.spec&#34;:&#34;order_id:int32,customer_id:int32,order_total_usd:float32&#34;
</span><span style="color:#ba2121">        }&#39;</span></code></pre></div>
</div>
<div class="paragraph">
<p>If you go and look at the schema that’s been created and stored in the Schema Registry you can see the field data types have been set as specified:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">➜ curl --silent --location --request GET <span style="color:#ba2121">&#39;http://localhost:8081/subjects/orders_spooldir_02-value/versions/latest&#39;</span> |jq <span style="color:#ba2121">&#39;.schema|fromjson&#39;</span>
<span style="color:#666">{</span>
  <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#ba2121">&#34;record&#34;</span>, <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;Value&#34;</span>, <span style="color:#ba2121">&#34;namespace&#34;</span>: <span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.model&#34;</span>,
  <span style="color:#ba2121">&#34;fields&#34;</span>: <span style="color:#666">[</span>
<span style="display:block;width:100%;background-color:#e5e5e5">    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;order_id&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;int&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span><span style="display:block;width:100%;background-color:#e5e5e5">    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;customer_id&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;int&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span><span style="display:block;width:100%;background-color:#e5e5e5">    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;order_total_usd&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;float&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
</span>    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;make&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;model&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;delivery_city&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;delivery_company&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>,
    <span style="color:#666">{</span> <span style="color:#ba2121">&#34;name&#34;</span>: <span style="color:#ba2121">&#34;delivery_address&#34;</span>, <span style="color:#ba2121">&#34;type&#34;</span>: <span style="color:#666">[</span> <span style="color:#ba2121">&#34;null&#34;</span>, <span style="color:#ba2121">&#34;string&#34;</span> <span style="color:#666">]</span>, <span style="color:#ba2121">&#34;default&#34;</span>: null <span style="color:#666">}</span>
  <span style="color:#666">]</span>,
  <span style="color:#ba2121">&#34;connect.name&#34;</span>: <span style="color:#ba2121">&#34;com.github.jcustenborder.kafka.connect.model.Value&#34;</span>
<span style="color:#666">}</span></code></pre></div>
</div>
</div>
<div class="sect2">
<h3 id="_just_gimme_the_plain_text">Just gimme the plain text! 😢</h3>
<div class="paragraph">
<p>All of this schemas seems like a bunch of fuss really, doesn’t it? Well not really. But, if you absolutely must just have CSV in your Kafka topic then here’s how. Note that we’re using a <a href="https://docs.confluent.io/current/connect/kafka-connect-spooldir/connectors/line_delimited_source_connector.html">different connector class</a> and we’re using <code>org.apache.kafka.connect.storage.StringConverter</code> to write the values. If you want to learn more about serialisers and converters <a href="https://www.confluent.io/blog/kafka-connect-deep-dive-converters-serialization-explained">see here</a>.</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -i -X PUT -H <span style="color:#ba2121">&#34;Accept:application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -H  <span style="color:#ba2121">&#34;Content-Type:application/json&#34;</span> http://localhost:8083/connectors/source-csv-spooldir-03/config <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;com.github.jcustenborder.kafka.connect.spooldir.SpoolDirLineDelimitedSourceConnector&#34;,
</span><span style="color:#ba2121">        &#34;value.converter&#34;:&#34;org.apache.kafka.connect.storage.StringConverter&#34;,
</span><span style="color:#ba2121">        &#34;topic&#34;: &#34;orders_spooldir_03&#34;,
</span><span style="color:#ba2121">        &#34;input.path&#34;: &#34;/data/unprocessed&#34;,
</span><span style="color:#ba2121">        &#34;finished.path&#34;: &#34;/data/processed&#34;,
</span><span style="color:#ba2121">        &#34;error.path&#34;: &#34;/data/error&#34;,
</span><span style="color:#ba2121">        &#34;input.file.pattern&#34;: &#34;.*\\.csv&#34;
</span><span style="color:#ba2121">        }&#39;</span></code></pre></div>
</div>
<div class="paragraph">
<p>The result? Just CSV.</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">➜ docker <span style="color:#008000">exec</span> kafkacat <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    kafkacat -b kafka:29092 -t orders_spooldir_03 -o-5 -C -u -q
496,456,80466.80,Volkswagen,Touareg,Leeds,Hilpert-Williamson,96 Stang Junction
497,210,57743.67,Dodge,Neon,London,Christiansen Group,7442 Algoma Hill
498,88,211171.02,Nissan,370Z,York,<span style="color:#ba2121">&#34;King, Yundt and Skiles&#34;</span>,3 1st Plaza
499,343,126072.73,Chevrolet,Camaro,Sheffield,<span style="color:#ba2121">&#34;Schiller, Ankunding and Schumm&#34;</span>,8920 Hoffman Place
500,424,160312.42,Chevrolet,Suburban 1500,London,Predovic LLC,2 Sundown Drive</code></pre></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_side_bar_schemas_in_action">Side-bar: Schemas in action</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So we’ve read some CSV data into Kafka. That’s not the end of its journey. It’s going to be used for something! Let’s do that.</p>
</div>
<div class="paragraph">
<p>Here’s <a href="https://ksqldb.io/quickstart.html">ksqlDB</a>, in which we declare the orders topic we wrote to with a schema as a stream:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">ksql<span style="color:#666">&gt;</span> <span style="color:#008000;font-weight:bold">CREATE</span> STREAM ORDERS_02 <span style="color:#008000;font-weight:bold">WITH</span> (KAFKA_TOPIC<span style="color:#666">=</span><span style="color:#ba2121">&#39;orders_spooldir_02&#39;</span>,VALUE_FORMAT<span style="color:#666">=</span><span style="color:#ba2121">&#39;AVRO&#39;</span>);

 Message
<span style="color:#408080;font-style:italic">----------------
</span><span style="color:#408080;font-style:italic"></span> Stream created
<span style="color:#408080;font-style:italic">----------------</span></code></pre></div>
</div>
<div class="paragraph">
<p>Having done that—and because there’s a schema that was created at ingestion time—we can see all of the fields available to us:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">ksql<span style="color:#666">&gt;</span> <span style="color:#008000;font-weight:bold">DESCRIBE</span> ORDERS_02;

Name                 : ORDERS_02
 Field            <span style="color:#666">|</span> <span style="color:#008000;font-weight:bold">Type</span>
<span style="color:#408080;font-style:italic">-------------------------------------------
</span><span style="color:#408080;font-style:italic"></span> ROWKEY           <span style="color:#666">|</span> <span style="color:#008000">VARCHAR</span>(STRING)  (<span style="color:#008000;font-weight:bold">key</span>)
 ORDER_ID         <span style="color:#666">|</span> <span style="color:#008000">INTEGER</span>
 CUSTOMER_ID      <span style="color:#666">|</span> <span style="color:#008000">INTEGER</span>
 ORDER_TOTAL_USD  <span style="color:#666">|</span> DOUBLE
 MAKE             <span style="color:#666">|</span> <span style="color:#008000">VARCHAR</span>(STRING)
 MODEL            <span style="color:#666">|</span> <span style="color:#008000">VARCHAR</span>(STRING)
 DELIVERY_CITY    <span style="color:#666">|</span> <span style="color:#008000">VARCHAR</span>(STRING)
 DELIVERY_COMPANY <span style="color:#666">|</span> <span style="color:#008000">VARCHAR</span>(STRING)
 DELIVERY_ADDRESS <span style="color:#666">|</span> <span style="color:#008000">VARCHAR</span>(STRING)
<span style="color:#408080;font-style:italic">-------------------------------------------
</span><span style="color:#408080;font-style:italic"></span><span style="color:#008000;font-weight:bold">For</span> runtime <span style="color:#008000;font-weight:bold">statistics</span> <span style="color:#008000;font-weight:bold">and</span> query details run: <span style="color:#008000;font-weight:bold">DESCRIBE</span> EXTENDED <span style="color:#666">&lt;</span>Stream,<span style="color:#008000;font-weight:bold">Table</span><span style="color:#666">&gt;</span>;
ksql<span style="color:#666">&gt;</span></code></pre></div>
</div>
<div class="paragraph">
<p>and run queries against the data that’s in Kafka:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">ksql<span style="color:#666">&gt;</span> <span style="color:#008000;font-weight:bold">SELECT</span> DELIVERY_CITY, <span style="color:#008000;font-weight:bold">COUNT</span>(<span style="color:#666">*</span>) <span style="color:#008000;font-weight:bold">AS</span> ORDER_COUNT, <span style="color:#008000;font-weight:bold">MAX</span>(<span style="color:#008000;font-weight:bold">CAST</span>(ORDER_TOTAL_USD <span style="color:#008000;font-weight:bold">AS</span> <span style="color:#008000">DECIMAL</span>(<span style="color:#666">9</span>,<span style="color:#666">2</span>))) <span style="color:#008000;font-weight:bold">AS</span> BIGGEST_ORDER_USD <span style="color:#008000;font-weight:bold">FROM</span> ORDERS_02 <span style="color:#008000;font-weight:bold">GROUP</span> <span style="color:#008000;font-weight:bold">BY</span> DELIVERY_CITY EMIT CHANGES;
<span style="color:#666">+</span><span style="color:#408080;font-style:italic">---------------+-------------+---------------------+
</span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span>DELIVERY_CITY  <span style="color:#666">|</span>ORDER_COUNT  <span style="color:#666">|</span>BIGGEST_ORDER_USD    <span style="color:#666">|</span>
<span style="color:#666">+</span><span style="color:#408080;font-style:italic">---------------+-------------+---------------------+
</span><span style="color:#408080;font-style:italic"></span><span style="color:#666">|</span>Bradford       <span style="color:#666">|</span><span style="color:#666">13</span>           <span style="color:#666">|</span><span style="color:#666">189924</span>.<span style="color:#666">47</span>            <span style="color:#666">|</span>
<span style="color:#666">|</span>Edinburgh      <span style="color:#666">|</span><span style="color:#666">13</span>           <span style="color:#666">|</span><span style="color:#666">199502</span>.<span style="color:#666">66</span>            <span style="color:#666">|</span>
<span style="color:#666">|</span>Bristol        <span style="color:#666">|</span><span style="color:#666">16</span>           <span style="color:#666">|</span><span style="color:#666">213830</span>.<span style="color:#666">34</span>            <span style="color:#666">|</span>
<span style="color:#666">|</span>Sheffield      <span style="color:#666">|</span><span style="color:#666">74</span>           <span style="color:#666">|</span><span style="color:#666">216233</span>.<span style="color:#666">98</span>            <span style="color:#666">|</span>
<span style="color:#666">|</span>London         <span style="color:#666">|</span><span style="color:#666">160</span>          <span style="color:#666">|</span><span style="color:#666">219736</span>.<span style="color:#666">06</span>            <span style="color:#666">|</span></code></pre></div>
</div>
<div class="paragraph">
<p>What about our data that we just ingested into a different topic as straight-up CSV? Because, like, schemas aren’t important?</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">ksql<span style="color:#666">&gt;</span> <span style="color:#008000;font-weight:bold">CREATE</span> STREAM ORDERS_03 <span style="color:#008000;font-weight:bold">WITH</span> (KAFKA_TOPIC<span style="color:#666">=</span><span style="color:#ba2121">&#39;orders_spooldir_03&#39;</span>,VALUE_FORMAT<span style="color:#666">=</span><span style="color:#ba2121">&#39;DELIMITED&#39;</span>);
<span style="color:#008000;font-weight:bold">No</span> columns supplied.</code></pre></div>
</div>
<div class="paragraph">
<p>Yeah, no columns supplied. No schema, no bueno. If you want to work with the data, whether to query in SQL, stream to a data lake, or do anything else with—at some point you’re going to have to declare that schema. Hence why CSV, as a schemaless-serialisation method, is a bad way to exchange data between systems.</p>
</div>
<div class="paragraph">
<p>If you really want to use your CSV data in ksqlDB, you can, you just need to enter the schema—which is error prone and tedious. You enter it each time to use the data, every other consumer of the data enters it each time too. Declaring it once at ingest and it being available for all to use makes a lot more sense.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_regex_and_json">Regex and JSON</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you’re using the REST API to submit configuration you might hit up against errors sending regex values within the JSON. For example, if you want to set <code>input.file.pattern</code> to <code>.*\.csv</code> and you put that in your JSON literally:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#ba2121">&#34;input.file.pattern&#34;</span>: <span style="color:#ba2121">&#34;.*\.csv&#34;</span>,</code></pre></div>
</div>
<div class="paragraph">
<p>You’ll get this error back if you submit it as inline data with <code>curl</code>:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">com.fasterxml.jackson.core.JsonParseException: Unrecognized character escape <span style="color:#ba2121">&#39;.&#39;</span> <span style="color:#666">(</span>code 46<span style="color:#666">)</span>                                                    at <span style="color:#666">[</span>Source: <span style="color:#666">(</span>org.glassfish.jersey.message.internal.ReaderInterceptorExecutor<span style="color:#19177c">$UnCloseableInputStream</span><span style="color:#666">)</span>; line: 7, column: 36<span style="color:#666">]</span></code></pre></div>
</div>
<div class="paragraph">
<p>THe solution is to escape the escape character (the backslash):</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#ba2121">&#34;input.file.pattern&#34;</span>: <span style="color:#ba2121">&#34;.*\\.csv&#34;</span>,</code></pre></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_streaming_csv_data_from_kafka_to_a_database_or_anywhere_else">Streaming CSV data from Kafka to a database (or anywhere else…)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since you’ve got a schema to the data, you can easily sink it to a database, such as Postgres:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X PUT http://localhost:8083/connectors/sink-postgres-orders-00/config <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -H <span style="color:#ba2121">&#34;Content-Type: application/json&#34;</span> <span style="color:#b62;font-weight:bold">\
</span><span style="color:#b62;font-weight:bold"></span>    -d <span style="color:#ba2121">&#39;{
</span><span style="color:#ba2121">        &#34;connector.class&#34;: &#34;io.confluent.connect.jdbc.JdbcSinkConnector&#34;,
</span><span style="color:#ba2121">        &#34;connection.url&#34;: &#34;jdbc:postgresql://postgres:5432/&#34;,
</span><span style="color:#ba2121">        &#34;connection.user&#34;: &#34;postgres&#34;,
</span><span style="color:#ba2121">        &#34;connection.password&#34;: &#34;postgres&#34;,
</span><span style="color:#ba2121">        &#34;tasks.max&#34;: &#34;1&#34;,
</span><span style="color:#ba2121">        &#34;topics&#34;: &#34;orders_spooldir_02&#34;,
</span><span style="color:#ba2121">        &#34;auto.create&#34;: &#34;true&#34;,
</span><span style="color:#ba2121">        &#34;auto.evolve&#34;:&#34;true&#34;,
</span><span style="color:#ba2121">        &#34;pk.mode&#34;:&#34;record_value&#34;,
</span><span style="color:#ba2121">        &#34;pk.fields&#34;:&#34;order_id&#34;,
</span><span style="color:#ba2121">        &#34;insert.mode&#34;: &#34;upsert&#34;,
</span><span style="color:#ba2121">        &#34;table.name.format&#34;:&#34;orders&#34;
</span><span style="color:#ba2121">    }&#39;</span></code></pre></div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This <strong>only</strong> works if you have a schema in your data. See <a href="https://rmoff.dev/jdbc-sink-schemas">here</a> to understand why and how to work with this requirement.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#19177c">postgres</span><span style="color:#666">=</span><span style="color:#408080;font-style:italic"># \dt</span>
         List of relations
 Schema |  Name  | Type  |  Owner
--------+--------+-------+----------
 public | orders | table | postgres
<span style="color:#666">(</span><span style="color:#666">1</span> row<span style="color:#666">)</span>

<span style="color:#19177c">postgres</span><span style="color:#666">=</span><span style="color:#408080;font-style:italic"># \d orders;</span>
                    Table <span style="color:#ba2121">&#34;public.orders&#34;</span>
      Column      |  Type   | Collation | Nullable | Default
------------------+---------+-----------+----------+---------
 order_id         | integer |           | not null |
 customer_id      | integer |           |          |
 order_total_usd  | real    |           |          |
 make             | text    |           |          |
 model            | text    |           |          |
 delivery_city    | text    |           |          |
 delivery_company | text    |           |          |
 delivery_address | text    |           |          |
Indexes:
    <span style="color:#ba2121">&#34;orders_pkey&#34;</span> PRIMARY KEY, btree <span style="color:#666">(</span>order_id<span style="color:#666">)</span>

<span style="color:#19177c">postgres</span><span style="color:#666">=</span><span style="color:#408080;font-style:italic"># SELECT * FROM orders FETCH FIRST 10 ROWS ONLY;</span>
 order_id | customer_id | order_total_usd |    make    |     model      | delivery_city |     delivery_company     |     delivery_address
----------+-------------+-----------------+------------+----------------+---------------+--------------------------+--------------------------
        <span style="color:#666">1</span> |         <span style="color:#666">535</span> |       190899.73 | Dodge      | Ram Wagon B350 | Sheffield     | DuBuque LLC              | <span style="color:#666">2810</span> Northland Avenue
        <span style="color:#666">2</span> |         <span style="color:#666">671</span> |        33245.53 | Volkswagen | Cabriolet      | Edinburgh     | Bechtelar-VonRueden      | <span style="color:#666">1</span> Macpherson Crossing
        <span style="color:#666">3</span> |         <span style="color:#666">695</span> |        155664.9 | Toyota     | Avalon         | Brighton      | Jacobs, Ebert and Dooley | <span style="color:#666">4</span> Loomis Crossing
        <span style="color:#666">4</span> |         <span style="color:#666">366</span> |        149012.9 | Hyundai    | Santa Fe       | Leeds         | Kiehn Group              | <span style="color:#666">538</span> Burning Wood Alley
        <span style="color:#666">5</span> |         <span style="color:#666">175</span> |        63274.18 | Kia        | Sportage       | Leeds         | Miller-Hudson            | <span style="color:#666">6</span> Kennedy Court
        <span style="color:#666">6</span> |          <span style="color:#666">37</span> |        97790.04 | BMW        | <span style="color:#666">3</span> Series       | Bristol       | Price Group              | <span style="color:#666">21611</span> Morning Trail
        <span style="color:#666">7</span> |         <span style="color:#666">644</span> |        76240.84 | Mazda      | MPV            | Leeds         | Kihn and Sons            | <span style="color:#666">9</span> Susan Street
        <span style="color:#666">8</span> |         <span style="color:#666">973</span> |       216233.98 | Hyundai    | Elantra        | Sheffield     | Feeney, Howe and Koss    | <span style="color:#666">07671</span> Hazelcrest Terrace
        <span style="color:#666">9</span> |         <span style="color:#666">463</span> |        162589.1 | Chrysler   | Grand Voyager  | York          | Fay, Murazik and Schumm  | <span style="color:#666">42080</span> Pawling Circle
       <span style="color:#666">10</span> |         <span style="color:#666">863</span> |       111208.24 | Ford       | Laser          | Leeds         | Boehm, Mohr and Doyle    | <span style="color:#666">0919</span> International Trail
<span style="color:#666">(</span><span style="color:#666">10</span> rows<span style="color:#666">)</span></code></pre></div>
</div>
<div class="paragraph">
<p>To learn more about writing data from Kafka to a database see <a href="https://rmoff.dev/kafka-jdbc-video">this tutorial</a>.</p>
</div>
<div class="paragraph">

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/b-3qN_tlYR4" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

</div>
<div class="paragraph">
<p>For more tutorials on Kafka Connect see <a href="https://www.youtube.com/playlist?list=PL5T99fPsK7ppB_AbZhBhTyKHtHWZLWIJ8">🎥 this playlist</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_try_it_out">Try it out!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>All <a href="https://github.com/confluentinc/demo-scene/tree/master/csv-to-kafka">the code for this article is on GitHub</a>, and you just need Docker and Docker Compose to spin it up and give it a try. The commandline examples quoted below are based on the Docker environment.</p>
</div>
<div class="paragraph">
<p>To spin it up, clone the repository, change to the correct folder, and launch the stack:</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">git clone https://github.com/confluentinc/demo-scene.git
<span style="color:#008000">cd</span> csv-to-kafka
docker-compose up -d</code></pre></div>
</div>
<div class="paragraph">
<p>Wait for Kafka Connect to launch and then off you go!</p>
</div>
<div class="paragraph">
<div class="highlight"><pre style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">bash -c <span style="color:#ba2121">&#39; \
</span><span style="color:#ba2121">echo -e &#34;\n\n=============\nWaiting for Kafka Connect to start listening on localhost ⏳\n=============\n&#34;
</span><span style="color:#ba2121">while [ $(curl -s -o /dev/null -w %{http_code} http://localhost:8083/connectors) -ne 200 ] ; do
</span><span style="color:#ba2121">  echo -e &#34;\t&#34; $(date) &#34; Kafka Connect listener HTTP state: &#34; $(curl -s -o /dev/null -w %{http_code} http://localhost:8083/connectors) &#34; (waiting for 200)&#34;
</span><span style="color:#ba2121">  sleep 5
</span><span style="color:#ba2121">done
</span><span style="color:#ba2121">echo -e $(date) &#34;\n\n--------------\n\o/ Kafka Connect is ready! Listener HTTP state: &#34; $(curl -s -o /dev/null -w %{http_code} http://localhost:8083/connectors) &#34;\n--------------\n&#34;
</span><span style="color:#ba2121">&#39;</span></code></pre></div>
</div>
<div class="paragraph">
<p>The examples in this article are based on the <code>data</code> folder mapped to <code>/data</code> on the Kafka Connect worker.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_video_tutorial">Video Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/N1pseW9waNI" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

</div>
</div>
</div>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <em>Robin Moffatt is a Senior Developer Advocate at Confluent, and an Oracle ACE Director (Alumnus). He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2020 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
