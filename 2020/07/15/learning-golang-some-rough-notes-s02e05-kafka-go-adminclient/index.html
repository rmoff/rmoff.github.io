<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Learning Golang (some rough notes) - S02E05 - Kafka Go AdminClient</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/07/15/learning-golang-some-rough-notes-s02e05-kafka-go-adminclient/">
		
		
		
		<meta name="generator" content="Hugo 0.75.1" />

		
		<meta property="og:title" content="Learning Golang (some rough notes) - S02E05 - Kafka Go AdminClient" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/07/IMG_5284.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/07/15/learning-golang-some-rough-notes-s02e05-kafka-go-adminclient/" />
		<meta property="og:site_name" content="Learning Golang (some rough notes) - S02E05 - Kafka Go AdminClient" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/images/2020/07/IMG_5284.jpeg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Learning Golang (some rough notes) - S02E05 - Kafka Go AdminClient</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2020-07-15T11:00:05&#43;01:00">Jul 15, 2020</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/go" class="no-underline category near-white dim">Go</a>, <a href="https://rmoff.net/categories/golang" class="no-underline category near-white dim">Golang</a>, <a href="https://rmoff.net/categories/kafka" class="no-underline category near-white dim">Kafka</a>, <a href="https://rmoff.net/categories/kafka-adminclient-api" class="no-underline category near-white dim">Kafka AdminClient API</a>
								<span class="display-print">at https://rmoff.net/2020/07/15/learning-golang-some-rough-notes-s02e05-kafka-go-adminclient/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="https://twitter.com/rmoff/" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw7">
	<div class="paragraph">
<p>Having ticked off the basics with an Apache Kafka <a href="/2020/07/10/learning-golang-some-rough-notes-s02e02-adding-error-handling-to-the-producer/">producer</a> and <a href="/2020/07/14/learning-golang-some-rough-notes-s02e03-kafka-go-consumer-channel-based/">consumer</a> in Go, let’s now check out the AdminClient. This is useful for checking out metadata about the cluster, creating topics, and stuff like that.</p>
</div>
<div class="sect1">
<h2 id="_contexts">Contexts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use some of the functions that the AdminClient provides I had to read up on <a href="https://golang.org/pkg/context/"><code>Context</code></a>, which I’d not encountered on my brief journey with <a href="/2020/06/25/learning-golang-some-rough-notes-s01e00/">Go so far</a>. The tl;dr is that a context provides a clean way for functions to timeout or cancel their operation across function calls. Or to put it <a href="https://golang.org/pkg/context/#pkg-overview">another way</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Package context defines the Context type, which carries deadlines, cancellation signals, and other request-scoped values across API boundaries and between processes.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This is what it looks like in operation. You define the context (in this with a timeout):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="go"><span style="color: #000000;font-weight: bold">import</span> <span style="background-color: #f8f8f8">(</span>
	<span style="color: #d14">&#34;context&#34;</span>
	<span style="color: #d14">&#34;time&#34;</span>
<span style="color: #999988;font-style: italic">// …</span>
<span style="background-color: #f8f8f8">)</span>

<span style="color: #999988;font-style: italic">// …</span>
<span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">cancel</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">WithTimeout</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Background</span><span style="background-color: #f8f8f8">(),</span> <span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">time</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Second</span><span style="background-color: #f8f8f8">)</span>
<span style="color: #000000;font-weight: bold">defer</span> <span style="background-color: #f8f8f8">cancel</span><span style="background-color: #f8f8f8">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you can also do it like this…</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="go"><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">_</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">WithTimeout</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Background</span><span style="background-color: #f8f8f8">(),</span> <span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">time</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Second</span><span style="background-color: #f8f8f8">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>…but per the code comment in <a href="https://golang.org/pkg/context/#WithDeadline">the example given</a> it’s good practice to make sure <code>cancel</code> is called as soon as the context is done with.</p>
</div>
<div class="paragraph">
<p>Another thing to note is the nice way to specify time periods in Go. Instead of having to check the API documentation each time as to whether you’re specifying seconds, microseconds, etc, and then doing the necessary maths on the time period that you want to specify, you can instead just use human-friendly notation such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>5*time.Microsecond</code></p>
</li>
<li>
<p><code>30*time.Second</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, having defined the context, we pass it when invoking a function call that requires it, such as <code>ClusterID()</code> in the AdminClient:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="go"><span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">ClusterID</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>More completely, the code looks something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="go"><span style="color: #999988;font-style: italic">// Get the ClusterID</span>
<span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">ClusterID</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">);</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">!=</span> <span style="color: #008080">nil</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;😢 Error getting ClusterID</span><span style="color: #d14">\n\t</span><span style="color: #d14">Error: %v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span><span style="background-color: #f8f8f8">)</span>
<span style="background-color: #f8f8f8">}</span> <span style="color: #000000;font-weight: bold">else</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;✔️ ClusterID: %v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">)</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the context times out then an error is returned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code>😢 Error getting ClusterID
	Error: context.deadlineExceededError context deadline exceeded</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that if you want to use the context in successive calls, the timeout does not reset on each use. So if you have something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="go"><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">cancel</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">WithTimeout</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Background</span><span style="background-color: #f8f8f8">(),</span> <span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">time</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Second</span><span style="background-color: #f8f8f8">)</span>
<span style="color: #000000;font-weight: bold">defer</span> <span style="background-color: #f8f8f8">cancel</span><span style="background-color: #f8f8f8">()</span>

<span style="color: #999988;font-style: italic">// Call the first thing</span>
<span style="background-color: #f8f8f8">doSomething</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">)</span>

<span style="color: #999988;font-style: italic">// Call the second thing</span>
<span style="background-color: #f8f8f8">doSomethingElse</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The timeout of five seconds includes the execution of the second function. If you want to reset it in between then you’d do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="go"><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">cancel</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">WithTimeout</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Background</span><span style="background-color: #f8f8f8">(),</span> <span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">time</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Second</span><span style="background-color: #f8f8f8">)</span>
<span style="color: #000000;font-weight: bold">defer</span> <span style="background-color: #f8f8f8">cancel</span><span style="background-color: #f8f8f8">()</span>

<span style="color: #999988;font-style: italic">// Call the first thing</span>
<span style="background-color: #f8f8f8">doSomething</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">)</span>

<span style="color: #999988;font-style: italic">// Start the context timer again</span>
<span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">cancel</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">WithTimeout</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Background</span><span style="background-color: #f8f8f8">(),</span> <span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">time</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Second</span><span style="background-color: #f8f8f8">)</span>

<span style="color: #999988;font-style: italic">// Call the second thing</span>
<span style="background-color: #f8f8f8">doSomethingElse</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adminclient">AdminClient</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://docs.confluent.io/5.5.1/clients/confluent-kafka-go/index.html#AdminClient">docs</a> list comprehensively the functions available from the AdminClient. Here’s a simple example that shows using some of them to list information about the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="go"><span style="color: #000000;font-weight: bold">package</span> <span style="background-color: #f8f8f8">main</span>

<span style="color: #000000;font-weight: bold">import</span> <span style="background-color: #f8f8f8">(</span>
	<span style="color: #d14">&#34;context&#34;</span>
	<span style="color: #d14">&#34;fmt&#34;</span>
	<span style="color: #d14">&#34;time&#34;</span>

	<span style="color: #d14">&#34;gopkg.in/confluentinc/confluent-kafka-go.v1/kafka&#34;</span>
<span style="background-color: #f8f8f8">)</span>

<span style="color: #000000;font-weight: bold">func</span> <span style="background-color: #f8f8f8">main</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>

	<span style="color: #999988;font-style: italic">// --</span>
	<span style="color: #999988;font-style: italic">// Create AdminClient instance</span>
	<span style="color: #999988;font-style: italic">// https://docs.confluent.io/current/clients/confluent-kafka-go/index.html#NewAdminClient</span>

	<span style="color: #999988;font-style: italic">// Store the config</span>
	<span style="background-color: #f8f8f8">cm</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">kafka</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">ConfigMap</span><span style="background-color: #f8f8f8">{</span>
		<span style="color: #d14">&#34;bootstrap.servers&#34;</span><span style="color: #000000;font-weight: bold">:</span> <span style="color: #d14">&#34;localhost:9092&#34;</span><span style="background-color: #f8f8f8">}</span>

	<span style="color: #999988;font-style: italic">// Variable p holds the new AdminClient instance.</span>
	<span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">kafka</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">NewAdminClient</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">cm</span><span style="background-color: #f8f8f8">)</span>
	<span style="color: #999988;font-style: italic">// Make sure we close it when we&#39;re done</span>
	<span style="color: #000000;font-weight: bold">defer</span> <span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Close</span><span style="background-color: #f8f8f8">()</span>

	<span style="color: #999988;font-style: italic">// Check for errors in creating the AdminClient</span>
	<span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">!=</span> <span style="color: #008080">nil</span> <span style="background-color: #f8f8f8">{</span>
		<span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">ke</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">ok</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">kafka</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Error</span><span style="background-color: #f8f8f8">);</span> <span style="background-color: #f8f8f8">ok</span> <span style="color: #000000;font-weight: bold">==</span> <span style="color: #008080">true</span> <span style="background-color: #f8f8f8">{</span>
			<span style="color: #000000;font-weight: bold">switch</span> <span style="background-color: #f8f8f8">ec</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">ke</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Code</span><span style="background-color: #f8f8f8">();</span> <span style="background-color: #f8f8f8">ec</span> <span style="background-color: #f8f8f8">{</span>
			<span style="color: #000000;font-weight: bold">case</span> <span style="background-color: #f8f8f8">kafka</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">ErrInvalidArg</span><span style="color: #000000;font-weight: bold">:</span>
				<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;😢 Can&#39;t create the AdminClient because you&#39;ve configured it wrong (code: %d)!</span><span style="color: #d14">\n\t</span><span style="color: #d14">%v</span><span style="color: #d14">\n\n</span><span style="color: #d14">To see the configuration options, refer to https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">ec</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span><span style="background-color: #f8f8f8">)</span>
			<span style="color: #000000;font-weight: bold">default</span><span style="color: #000000;font-weight: bold">:</span>
				<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;😢 Can&#39;t create the AdminClient (Kafka error code %d)</span><span style="color: #d14">\n\t</span><span style="color: #d14">Error: %v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">ec</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span><span style="background-color: #f8f8f8">)</span>
			<span style="background-color: #f8f8f8">}</span>
		<span style="background-color: #f8f8f8">}</span> <span style="color: #000000;font-weight: bold">else</span> <span style="background-color: #f8f8f8">{</span>
			<span style="color: #999988;font-style: italic">// It&#39;s not a kafka.Error</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;😢 Oh noes, there&#39;s a generic error creating the AdminClient! %v&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Error</span><span style="background-color: #f8f8f8">())</span>
		<span style="background-color: #f8f8f8">}</span>

	<span style="background-color: #f8f8f8">}</span> <span style="color: #000000;font-weight: bold">else</span> <span style="background-color: #f8f8f8">{</span>

		<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Println</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;✔️ Created AdminClient&#34;</span><span style="background-color: #f8f8f8">)</span>

		<span style="color: #999988;font-style: italic">// Create a context for use when calling some of these functions</span>
		<span style="color: #999988;font-style: italic">// This lets you set a variable timeout on invoking these calls</span>
		<span style="color: #999988;font-style: italic">// If the timeout passes then an error is returned.</span>
		<span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">cancel</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">WithTimeout</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Background</span><span style="background-color: #f8f8f8">(),</span> <span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">time</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Second</span><span style="background-color: #f8f8f8">)</span>
		<span style="color: #000000;font-weight: bold">defer</span> <span style="background-color: #f8f8f8">cancel</span><span style="background-color: #f8f8f8">()</span>

		<span style="color: #999988;font-style: italic">// Get the ClusterID</span>
		<span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">ClusterID</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">);</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">!=</span> <span style="color: #008080">nil</span> <span style="background-color: #f8f8f8">{</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;😢 Error getting ClusterID</span><span style="color: #d14">\n\t</span><span style="color: #d14">Error: %v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span><span style="background-color: #f8f8f8">)</span>
		<span style="background-color: #f8f8f8">}</span> <span style="color: #000000;font-weight: bold">else</span> <span style="background-color: #f8f8f8">{</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;✔️ ClusterID: %v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">)</span>
		<span style="background-color: #f8f8f8">}</span>

		<span style="color: #999988;font-style: italic">// Start the context timer again (otherwise it carries on from the original deadline)</span>
		<span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">cancel</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">WithTimeout</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">context</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Background</span><span style="background-color: #f8f8f8">(),</span> <span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">time</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Second</span><span style="background-color: #f8f8f8">)</span>

		<span style="color: #999988;font-style: italic">// Get the ControllerID</span>
		<span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">ControllerID</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ctx</span><span style="background-color: #f8f8f8">);</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">!=</span> <span style="color: #008080">nil</span> <span style="background-color: #f8f8f8">{</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;😢 Error getting ControllerID</span><span style="color: #d14">\n\t</span><span style="color: #d14">Error: %v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span><span style="background-color: #f8f8f8">)</span>
		<span style="background-color: #f8f8f8">}</span> <span style="color: #000000;font-weight: bold">else</span> <span style="background-color: #f8f8f8">{</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;✔️ ControllerID: %v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">)</span>
		<span style="background-color: #f8f8f8">}</span>

		<span style="color: #999988;font-style: italic">// Get some metadata</span>
		<span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">md</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">a</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">GetMetadata</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">nil</span><span style="background-color: #f8f8f8">,</span> <span style="color: #008080">false</span><span style="background-color: #f8f8f8">,</span> <span style="color: #445588;font-weight: bold">int</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">5</span><span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">time</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Second</span><span style="background-color: #f8f8f8">));</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">!=</span> <span style="color: #008080">nil</span> <span style="background-color: #f8f8f8">{</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;😢 Error getting cluster Metadata</span><span style="color: #d14">\n\t</span><span style="color: #d14">Error: %v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">e</span><span style="background-color: #f8f8f8">)</span>
		<span style="background-color: #f8f8f8">}</span> <span style="color: #000000;font-weight: bold">else</span> <span style="background-color: #f8f8f8">{</span>
			<span style="color: #999988;font-style: italic">// Print the originating broker info</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;✔️ Metadata [Originating broker]</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">)</span>
			<span style="background-color: #f8f8f8">b</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="background-color: #f8f8f8">md</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">OriginatingBroker</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;</span><span style="color: #d14">\t</span><span style="color: #d14">[ID %d] %v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">b</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">ID</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">b</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Host</span><span style="background-color: #f8f8f8">)</span>

			<span style="color: #999988;font-style: italic">// Print the brokers</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;✔️ Metadata [brokers]</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">)</span>
			<span style="color: #000000;font-weight: bold">for</span> <span style="background-color: #f8f8f8">_</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">b</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="color: #000000;font-weight: bold">range</span> <span style="background-color: #f8f8f8">md</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Brokers</span> <span style="background-color: #f8f8f8">{</span>
				<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;</span><span style="color: #d14">\t</span><span style="color: #d14">[ID %d] %v:%d</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">b</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">ID</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">b</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Host</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">b</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Port</span><span style="background-color: #f8f8f8">)</span>
			<span style="background-color: #f8f8f8">}</span>
			<span style="color: #999988;font-style: italic">// Print the topics</span>
			<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;✔️ Metadata [topics]</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">)</span>
			<span style="color: #000000;font-weight: bold">for</span> <span style="background-color: #f8f8f8">_</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">t</span> <span style="color: #000000;font-weight: bold">:=</span> <span style="color: #000000;font-weight: bold">range</span> <span style="background-color: #f8f8f8">md</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Topics</span> <span style="background-color: #f8f8f8">{</span>
				<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;</span><span style="color: #d14">\t</span><span style="color: #d14">(%v partitions)</span><span style="color: #d14">\t</span><span style="color: #d14">%v</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span> <span style="color: #0086B3">len</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">t</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Partitions</span><span style="background-color: #f8f8f8">),</span> <span style="background-color: #f8f8f8">t</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Topic</span><span style="background-color: #f8f8f8">)</span>
			<span style="background-color: #f8f8f8">}</span>
		<span style="background-color: #f8f8f8">}</span>
		<span style="background-color: #f8f8f8">fmt</span><span style="color: #000000;font-weight: bold">.</span><span style="background-color: #f8f8f8">Printf</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;</span><span style="color: #d14">\n\n</span><span style="color: #d14">👋 … and we&#39;re done.</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">)</span>
	<span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code>✔️ Created AdminClient
✔️ ClusterID: hukPYvRVTF2nU8efMXUq6g
✔️ ControllerID: 1
✔️ Metadata [Originating broker]
	[ID 1] localhost:9092/1
✔️ Metadata [brokers]
	[ID 1] localhost:9092
✔️ Metadata [topics]
	(5 partitions)	_kafka-connect-01-status
	(1 partitions)	ratings
	(1 partitions)	__confluent.support.metrics
	(25 partitions)	_kafka-connect-01-offsets
	(1 partitions)	_kafka-connect-01-configs
	(50 partitions)	__consumer_offsets


👋 … and we&#39;re done.</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_more_episodes">📺 More Episodes…</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Kafka and Go</p>
<div class="ulist">
<ul>
<li>
<p><a href="/2020/07/08/learning-golang-some-rough-notes-s02e00-kafka-and-go/">S02E00 - Kafka and Go</a></p>
</li>
<li>
<p><a href="/2020/07/08/learning-golang-some-rough-notes-s02e01-my-first-kafka-go-producer/">S02E01 - My First Kafka Go Producer</a></p>
</li>
<li>
<p><a href="/2020/07/10/learning-golang-some-rough-notes-s02e02-adding-error-handling-to-the-producer/">S02E02 - Adding error handling to the Producer</a></p>
</li>
<li>
<p><a href="/2020/07/14/learning-golang-some-rough-notes-s02e03-kafka-go-consumer-channel-based/">S02E03 - Kafka Go Consumer (Channel-based)</a></p>
</li>
<li>
<p><a href="/2020/07/14/learning-golang-some-rough-notes-s02e04-kafka-go-consumer-function-based/">S02E04 - Kafka Go Consumer (Function-based)</a></p>
</li>
<li>
<p><a href="/2020/07/15/learning-golang-some-rough-notes-s02e05-kafka-go-adminclient/">S02E05 - Kafka Go AdminClient</a></p>
</li>
<li>
<p><a href="/2020/07/15/learning-golang-some-rough-notes-s02e06-putting-the-producer-in-a-function-and-handling-errors-in-a-go-routine/">S02E06 - Putting the Producer in a function and handling errors in a Go routine</a></p>
</li>
<li>
<p><a href="/2020/07/16/learning-golang-some-rough-notes-s02e07-splitting-go-code-into-separate-source-files-and-building-a-binary-executable/">S02E07 - Splitting Go code into separate source files and building a binary executable</a></p>
</li>
<li>
<p><a href="/2020/07/17/learning-golang-some-rough-notes-s02e08-checking-kafka-advertised.listeners-with-go/">S02E08 - Checking Kafka advertised.listeners with Go</a></p>
</li>
<li>
<p><a href="/2020/07/23/learning-golang-some-rough-notes-s02e09-processing-chunked-responses-before-eof-is-reached/">S02E09 - Processing chunked responses before EOF is reached</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Learning Go</p>
<div class="ulist">
<ul>
<li>
<p><a href="/2020/06/25/learning-golang-some-rough-notes-s01e00/">S01E00 - Background</a></p>
</li>
<li>
<p><a href="/2020/06/25/learning-golang-some-rough-notes-s01e01-pointers/">S01E01 - Pointers</a></p>
</li>
<li>
<p><a href="/2020/06/25/learning-golang-some-rough-notes-s01e02-slices/">S01E02 - Slices</a></p>
</li>
<li>
<p><a href="/2020/06/29/learning-golang-some-rough-notes-s01e03-maps/">S01E03 - Maps</a></p>
</li>
<li>
<p><a href="/2020/06/29/learning-golang-some-rough-notes-s01e04-function-closures/">S01E04 - Function Closures</a></p>
</li>
<li>
<p><a href="/2020/06/30/learning-golang-some-rough-notes-s01e05-interfaces/">S01E05 - Interfaces</a></p>
</li>
<li>
<p><a href="/2020/07/01/learning-golang-some-rough-notes-s01e06-errors/">S01E06 - Errors</a></p>
</li>
<li>
<p><a href="/2020/07/01/learning-golang-some-rough-notes-s01e07-readers/">S01E07 - Readers</a></p>
</li>
<li>
<p><a href="/2020/07/02/learning-golang-some-rough-notes-s01e08-images/">S01E08 - Images</a></p>
</li>
<li>
<p><a href="/2020/07/02/learning-golang-some-rough-notes-s01e09-concurrency-channels-goroutines/">S01E09 - Concurrency (Channels, Goroutines)</a></p>
</li>
<li>
<p><a href="/2020/07/03/learning-golang-some-rough-notes-s01e10-concurrency-web-crawler/">S01E10 - Concurrency (Web Crawler)</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <em>Robin Moffatt is a Senior Developer Advocate at Confluent, and an Oracle ACE Director (Alumnus). He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2020 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
