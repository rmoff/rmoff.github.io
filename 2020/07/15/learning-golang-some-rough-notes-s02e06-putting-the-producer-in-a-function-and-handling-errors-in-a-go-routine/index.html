<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2020/07/IMG_5284.jpeg" >
		
		<title>Learning Golang (some rough notes) - S02E06 - Putting the Producer in a function and handling errors in a Go routine</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/07/15/learning-golang-some-rough-notes-s02e06-putting-the-producer-in-a-function-and-handling-errors-in-a-go-routine/">
		
		

		
		<meta property="og:title" content="Learning Golang (some rough notes) - S02E06 - Putting the Producer in a function and handling errors in a Go routine" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/07/IMG_5284.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/07/15/learning-golang-some-rough-notes-s02e06-putting-the-producer-in-a-function-and-handling-errors-in-a-go-routine/" />
		<meta property="og:site_name" content="Learning Golang (some rough notes) - S02E06 - Putting the Producer in a function and handling errors in a Go routine" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2020/07/IMG_5284.jpeg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Learning Golang (some rough notes) - S02E06 - Putting the Producer in a function and handling errors in a Go routine</h1>
			<p class="article-hero-meta">
				
					<time datetime="2020-07-15T14:00:05&#43;01:00">15 Jul 2020</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/go">Go</a>, <a href="https://rmoff.net/categories/golang">Golang</a>, <a href="https://rmoff.net/categories/kafka">Kafka</a>, <a href="https://rmoff.net/categories/kafka-producer-api">Kafka Producer API</a>, <a href="https://rmoff.net/categories/go-routine">Go routine</a>
					<span class="display-print">at https://rmoff.net/2020/07/15/learning-golang-some-rough-notes-s02e06-putting-the-producer-in-a-function-and-handling-errors-in-a-go-routine/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_command_line_arguments">Command line arguments</a></li>
    <li><a href="#_functions">Functions</a></li>
    <li><a href="#_errors">Errors</a>
      <ul>
        <li><a href="#_error_in_go_routines">Error in Go routines</a></li>
      </ul>
    </li>
    <li><a href="#_the_producer">The Producer</a></li>
    <li><a href="#_more_episodes">ðŸ“º More Episodesâ€¦</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Go</span><span data-pagefind-filter="category" style="display:none">Golang</span><span data-pagefind-filter="category" style="display:none">Kafka</span><span data-pagefind-filter="category" style="display:none">Kafka Producer API</span><span data-pagefind-filter="category" style="display:none">Go routine</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2020/07/IMG_5284.jpeg" style="display:none" alt="">
	<div class="paragraph">
<p>When I set out to <a href="/2020/06/25/learning-golang-some-rough-notes-s01e00/">learn Go</a> one of the aims I had in mind was to write a version of <a href="https://github.com/rmoff/kafka-listeners/blob/master/python/python_kafka_test_client.py">this little Python utility</a> which accompanies a blog I wrote recently about <a href="https://www.confluent.io/blog/kafka-client-cannot-connect-to-broker-on-aws-on-docker-etc">understanding and diagnosing problems with Kafka advertised listeners</a>. Having successfully got <a href="/2020/07/10/learning-golang-some-rough-notes-s02e02-adding-error-handling-to-the-producer/">Producer</a>, <a href="/2020/07/14/learning-golang-some-rough-notes-s02e04-kafka-go-consumer-function-based/">Consumer</a>, and <a href="/2020/07/15/learning-golang-some-rough-notes-s02e05-kafka-go-adminclient/">AdminClient</a> API examples working, it is now time to turn to that task.</p>
</div>
<div class="paragraph">
<p>Iâ€™m quite keen to figure out how to do this <em>properly</em> and take the opportunity to learn. It would be easy enough to copy &amp; paste all my snippets together, ignore any error handling, and check the task off as done. But since I donâ€™t have a strong background in coding, now seems a good chance to try and instill a little bit of rigour in what Iâ€™m doing.</p>
</div>
<div class="sect1">
<h2 id="_command_line_arguments">Command line arguments&nbsp;<a class="headline-hash" href="#_command_line_arguments">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of hard coding the broker host and port, I want to be able to pass this as a commandline argument. This is easy enough using the <a href="https://golang.org/pkg/os/">OS</a> package, which behaves very similar to the Python equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #66d9ef;font-weight: bold">import</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
	<span style="color: #e6db74">&#34;os&#34;</span>
<span style="color: #f8f8f2;background-color: #49483e">)</span>

<span style="color: #66d9ef;font-weight: bold">func</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>

	<span style="color: #75715e;font-style: italic">// Read the first commandline argument to get the broker details</span>
	<span style="color: #f8f8f2;background-color: #49483e">broker</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">os</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Args</span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
	<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;Broker: %v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Iâ€™m using VSCode for my IDE as it works very nicely with Go - both for writing code, and debugging it. To pass an argument to the command line as part of debugging go to <code>Run</code> â†’ <code>Open Configurations</code> and in the JSON file set the argument(s) that you want to pass:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #e6db74">&#34;</span><span style="color: #e6db74">args</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #e6db74">&#34;</span><span style="color: #e6db74">localhost:9092</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This works fine when the code is run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code>Broker: localhost:9092</code></pre>
</div>
</div>
<div class="paragraph">
<p>But what if the user <em>doesnâ€™t</em> specify the required commandline arguments?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code>panic: runtime error: index out of range [1] with length 1

goroutine 1 [running]:
main.main()
	/Users/rmoff/git/rmoff-blog/content/code/go/kafka/producer_function/producer_function.go:15 +0x24e</code></pre>
</div>
</div>
<div class="paragraph">
<p>So we need a bit of care here, and check for the length too</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #66d9ef;font-weight: bold">var</span> <span style="color: #f8f8f2;background-color: #49483e">broker</span> <span style="color: #66d9ef;font-weight: bold">string</span>
<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2">len</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">os</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Args</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #f92672;font-weight: bold">==</span> <span style="color: #ae81ff">2</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #f8f8f2;background-color: #49483e">broker</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #f8f8f2;background-color: #49483e">os</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Args</span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Println</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;(No broker specifed on commandline; defaulting to localhost:9092)&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
    <span style="color: #f8f8f2;background-color: #49483e">broker</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#34;localhost:9092&#34;</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span>
<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;Broker: %v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functions">Functions&nbsp;<a class="headline-hash" href="#_functions">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>main()</code> code is going to look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #75715e;font-style: italic">// Do init stuff to set vars etc</span>
<span style="color: #75715e;font-style: italic">// â€¦</span>

<span style="color: #75715e;font-style: italic">// Create AdminClient connection to check metadata</span>
<span style="color: #f8f8f2;background-color: #49483e">doAdmin</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #75715e;font-style: italic">// Produce message</span>
<span style="color: #f8f8f2;background-color: #49483e">doProduce</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2;background-color: #49483e">topic</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #75715e;font-style: italic">// Consume message</span>
<span style="color: #f8f8f2;background-color: #49483e">doConsume</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2;background-color: #49483e">topic</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #75715e;font-style: italic">// fin.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each one is dependent on the other, so we need to know if there was an errorâ€¦</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_errors">Errors&nbsp;<a class="headline-hash" href="#_errors">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Following the same pattern as I explored <a href="/2020/07/10/learning-golang-some-rough-notes-s02e02-adding-error-handling-to-the-producer/">here</a> Iâ€™m expecting to have something that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #75715e;font-style: italic">// Do init stuff to set vars etc</span>
<span style="color: #75715e;font-style: italic">// â€¦</span>

<span style="color: #75715e;font-style: italic">// Create AdminClient connection to check metadata</span>
<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">doAdmin</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">);</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;There was a problem with AdminClient :-(</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">%v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #75715e;font-style: italic">// Produce message</span>
    <span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">doProduce</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">topic</span><span style="color: #f8f8f2;background-color: #49483e">);</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
        <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;There was a problem calling the producer :-(</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">%v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
    <span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
        <span style="color: #75715e;font-style: italic">// Consume message</span>
        <span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">doConsume</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">topic</span><span style="color: #f8f8f2;background-color: #49483e">);</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
            <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;There was a problem calling the consumer :-(</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">%v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
        <span style="color: #f8f8f2;background-color: #49483e">}</span>
    <span style="color: #f8f8f2;background-color: #49483e">}</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span>

<span style="color: #75715e;font-style: italic">// fin.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To do this, each function needs to return an <code>error</code>, so the function looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #66d9ef;font-weight: bold">func</span> <span style="color: #f8f8f2;background-color: #49483e">doProduce</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">topic</span> <span style="color: #66d9ef;font-weight: bold">string</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">error</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #75715e;font-style: italic">// If you hit an error then</span>
    <span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #f8f8f2;background-color: #49483e">errors</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">New</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;OH NO! THERE WAS AN ERROR&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

    <span style="color: #75715e;font-style: italic">// assuming everything has gone ok return no error</span>
    <span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #66d9ef">nil</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where we were previously dumping messages to the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ˜¢ Can&#39;t create the producer (Kafka error code %d)</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">Error: %v</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">ec</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We now want to take this and pass it back as the error. Since <code>errors.New()</code> takes a <code>string</code> it makes sense to replace our existing <code>fmt.Printf</code> with <code>fmt.Sprintf</code> and pass this to <code>errors.New()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #f8f8f2;background-color: #49483e">errors</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">New</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ˜¢ Can&#39;t create the producer (Kafka error code %d)</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">Error: %v</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">ec</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Go linter in VSCode is brilliant here as it actively tells you this is not the best way to do it, with some nice orange underlining:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2020/07/error01.png" alt="error01"/>
</div>
</div>
<div class="paragraph">
<p>If you hover over it you get a nice tip of how to write the code better:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2020/07/error02.png" alt="error02"/>
</div>
</div>
<div class="paragraph">
<p>So, instead of</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #f8f8f2;background-color: #49483e">errors</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">New</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ˜¢ Can&#39;t create the producer (Kafka error code %d)</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">Error: %v</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">ec</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We just replace</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ˜¢ Can&#39;t create the producer (Kafka error code %d)</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">Error: %v</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">ec</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Errorf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ˜¢ Can&#39;t create the producer (Kafka error code %d)</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">Error: %v</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">ec</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_error_in_go_routines">Error in Go routines&nbsp;<a class="headline-hash" href="#_error_in_go_routines">ðŸ”—</a> </h3>
<div class="paragraph">
<p>This all works, except in the Go routine within the function. In the case of the Producer code the Go routine is there to handle events such as message delivery reports, errors, etc. Since a Go routine is a function itself with no return variables, then we canâ€™t <code>return</code> an error from within it. If you try to, you get this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code>too many arguments to return
	have (error)
	want ()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, maybe the code in your function will catch an error as a side effect of the error thrown in the Go routine, but itâ€™s not great to rely on that happening. Instead we can provide a channel that the Go routine can write to if thereâ€™s an error, and then check that from our parent function and return an error if we find one. Something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #66d9ef;font-weight: bold">package</span> <span style="color: #f8f8f2;background-color: #49483e">main</span>

<span style="color: #66d9ef;font-weight: bold">import</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
	<span style="color: #e6db74">&#34;errors&#34;</span>
	<span style="color: #e6db74">&#34;fmt&#34;</span>
	<span style="color: #e6db74">&#34;time&#34;</span>
<span style="color: #f8f8f2;background-color: #49483e">)</span>

<span style="color: #66d9ef;font-weight: bold">func</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
	<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">doThisThing</span><span style="color: #f8f8f2;background-color: #49483e">();</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;doThisThing failed.</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">%v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
	<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;doThisThing worked.</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

	<span style="color: #f8f8f2;background-color: #49483e">}</span>
<span style="color: #f8f8f2;background-color: #49483e">}</span>

<span style="color: #66d9ef;font-weight: bold">func</span> <span style="color: #f8f8f2;background-color: #49483e">doThisThing</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #66d9ef;font-weight: bold">error</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>

	<span style="color: #f8f8f2;background-color: #49483e">ec</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2">make</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">chan</span> <span style="color: #66d9ef;font-weight: bold">string</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

	<span style="color: #66d9ef;font-weight: bold">go</span> <span style="color: #66d9ef;font-weight: bold">func</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>

		<span style="color: #75715e;font-style: italic">// If we&#39;re all good then do stuff</span>
		<span style="color: #75715e;font-style: italic">// â€¦</span>

		<span style="color: #75715e;font-style: italic">// If we hit an error then log an error</span>
		<span style="color: #f8f8f2;background-color: #49483e">ec</span> <span style="color: #f92672;font-weight: bold">&lt;-</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;here is an error from the go routine :(</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
		<span style="color: #f8f8f2;background-color: #49483e">ec</span> <span style="color: #f92672;font-weight: bold">&lt;-</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;here is another error from the go routine :(</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
		<span style="color: #f8f8f2">close</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">ec</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
	<span style="color: #f8f8f2;background-color: #49483e">}()</span>

	<span style="color: #75715e;font-style: italic">// Do all our stuff in the function that we need to</span>
	<span style="color: #75715e;font-style: italic">// â€¦</span>
	<span style="color: #f8f8f2;background-color: #49483e">time</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sleep</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #ae81ff">2</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #f8f8f2;background-color: #49483e">time</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Second</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
	<span style="color: #75715e;font-style: italic">// pretend we&#39;re doing stuff</span>
	<span style="color: #75715e;font-style: italic">// â€¦</span>

	<span style="color: #75715e;font-style: italic">// When we&#39;re ready to return, check if the go routine has sent errors</span>
	<span style="color: #75715e;font-style: italic">// Note that we&#39;re relying on the Go routine to close the channel, otherwise</span>
	<span style="color: #75715e;font-style: italic">// we deadlock.</span>
	<span style="color: #75715e;font-style: italic">// If there are no errors then the channel is simply closed and we read no values.</span>
	<span style="color: #f8f8f2;background-color: #49483e">done</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #66d9ef">false</span>
	<span style="color: #66d9ef;font-weight: bold">var</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #66d9ef;font-weight: bold">string</span>
	<span style="color: #66d9ef;font-weight: bold">for</span> <span style="color: #f92672;font-weight: bold">!</span><span style="color: #f8f8f2;background-color: #49483e">done</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">t</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">o</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f92672;font-weight: bold">&lt;-</span><span style="color: #f8f8f2;background-color: #49483e">ec</span><span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2;background-color: #49483e">o</span> <span style="color: #f92672;font-weight: bold">==</span> <span style="color: #66d9ef">false</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #75715e;font-style: italic">// o is false if we&#39;ve read all the values and the channel is closed</span>
			<span style="color: #75715e;font-style: italic">// If that&#39;s the case, then we&#39;re done here</span>
			<span style="color: #f8f8f2;background-color: #49483e">done</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #66d9ef">true</span>
		<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #75715e;font-style: italic">// We&#39;ve read a value so let&#39;s concatenate it with the others</span>
			<span style="color: #75715e;font-style: italic">// that we&#39;ve got</span>
			<span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">+=</span> <span style="color: #f8f8f2;background-color: #49483e">t</span>
		<span style="color: #f8f8f2;background-color: #49483e">}</span>
	<span style="color: #f8f8f2;background-color: #49483e">}</span>

	<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2">len</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #75715e;font-style: italic">// If we&#39;ve got any errors, then return an error to the caller</span>
		<span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #f8f8f2;background-color: #49483e">errors</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">New</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
	<span style="color: #f8f8f2;background-color: #49483e">}</span>

	<span style="color: #75715e;font-style: italic">// assuming everything has gone ok return no error</span>
	<span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #66d9ef">nil</span>

<span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When run this looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code>doThisThing failed.
here is an error from the go routine :(
here is another error from the go routine :(</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_producer">The Producer&nbsp;<a class="headline-hash" href="#_the_producer">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>With this error handling in place, I can now call my <code>doProduce</code> function and get an error (or not) back from it successfully:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It works!</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code>â„¹ï¸ No broker specified on commandline; defaulting to localhost:9092

Broker: localhost:9092

--
âœ¨ All messages flushed from the queue
âœ… Message &#39;foo / Thu, 16 Jul 2020 00:05:57 +0100&#39; delivered to topic &#39;rmoff_test_00&#39; (partition 0 at offset 11)

-=-=
Wrapping upâ€¦
ðŸ‘‹ â€¦ and we&#39;re done.
Oh joy! Oh rejoice! Calling the producer worked *just fine*.</code></pre>
</div>
</div>
</li>
<li>
<p>It doesnâ€™t!</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code>â„¹ï¸ No broker specified on commandline; defaulting to localhost:9092

Broker: localhost:9092
-=-=
Wrapping upâ€¦
âŒ â€¦ returning an error

There was a problem calling the producer :-(

**â˜ ï¸ Uh oh, caught an error:
	localhost:9092/bootstrap: Connect to ipv6#[::1]:9092 failed: Connection refused (after 3ms in state CONNECT)

**â˜ ï¸ Uh oh, caught an error:
	1/1 brokers are down

--
âš ï¸ Failed to flush all messages after 1000 milliseconds. 1 message(s) remain</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hereâ€™s the full code, and a <a href="/code/go/kafka/producer_function/docker-compose.yml">Docker Compose</a> you can use to try it with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="go"><span style="color: #66d9ef;font-weight: bold">package</span> <span style="color: #f8f8f2;background-color: #49483e">main</span>

<span style="color: #66d9ef;font-weight: bold">import</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
	<span style="color: #e6db74">&#34;errors&#34;</span>
	<span style="color: #e6db74">&#34;fmt&#34;</span>
	<span style="color: #e6db74">&#34;os&#34;</span>
	<span style="color: #e6db74">&#34;time&#34;</span>

	<span style="color: #e6db74">&#34;gopkg.in/confluentinc/confluent-kafka-go.v1/kafka&#34;</span>
<span style="color: #f8f8f2;background-color: #49483e">)</span>

<span style="color: #66d9ef;font-weight: bold">func</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>

	<span style="color: #75715e;font-style: italic">// Read the first commandline argument to get the broker details</span>
	<span style="color: #66d9ef;font-weight: bold">var</span> <span style="color: #f8f8f2;background-color: #49483e">broker</span> <span style="color: #66d9ef;font-weight: bold">string</span>
	<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2">len</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">os</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Args</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #f92672;font-weight: bold">==</span> <span style="color: #ae81ff">2</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #f8f8f2;background-color: #49483e">broker</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #f8f8f2;background-color: #49483e">os</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Args</span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
	<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;â„¹ï¸ No broker specified on commandline; defaulting to localhost:9092</span><span style="color: #ae81ff">\n\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
		<span style="color: #f8f8f2;background-color: #49483e">broker</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#34;localhost:9092&#34;</span>
	<span style="color: #f8f8f2;background-color: #49483e">}</span>
	<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;Broker: %v</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

	<span style="color: #75715e;font-style: italic">// Set the topic name that we&#39;ll use</span>
	<span style="color: #f8f8f2;background-color: #49483e">topic</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #e6db74">&#34;rmoff_test_00&#34;</span>

	<span style="color: #75715e;font-style: italic">// Create Admin Connection</span>
	<span style="color: #75715e;font-style: italic">// doAdmin(broker)</span>
	<span style="color: #75715e;font-style: italic">// Produce message</span>
	<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">doProduce</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">topic</span><span style="color: #f8f8f2;background-color: #49483e">);</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">There was a problem calling the producer :-(</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">%v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
	<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Println</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;Oh joy! Oh rejoice! Calling the producer worked *just fine*.&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
	<span style="color: #f8f8f2;background-color: #49483e">}</span>
	<span style="color: #75715e;font-style: italic">// Consume message</span>
	<span style="color: #75715e;font-style: italic">// doConsume()</span>
	<span style="color: #75715e;font-style: italic">// fin.</span>

<span style="color: #f8f8f2;background-color: #49483e">}</span>

<span style="color: #66d9ef;font-weight: bold">func</span> <span style="color: #f8f8f2;background-color: #49483e">doProduce</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">topic</span> <span style="color: #66d9ef;font-weight: bold">string</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">error</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>

	<span style="color: #75715e;font-style: italic">// --</span>
	<span style="color: #75715e;font-style: italic">// Create Producer instance</span>
	<span style="color: #75715e;font-style: italic">// https://docs.confluent.io/current/clients/confluent-kafka-go/index.html#NewProducer</span>

	<span style="color: #75715e;font-style: italic">// Store the config</span>
	<span style="color: #f8f8f2;background-color: #49483e">c</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">ConfigMap</span><span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #e6db74">&#34;bootstrap.servers&#34;</span><span style="color: #f92672;font-weight: bold">:</span> <span style="color: #f8f8f2;background-color: #49483e">broker</span><span style="color: #f8f8f2;background-color: #49483e">}</span>

	<span style="color: #75715e;font-style: italic">// Check for errors in creating the Producer</span>
	<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">NewProducer</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">&amp;</span><span style="color: #f8f8f2;background-color: #49483e">c</span><span style="color: #f8f8f2;background-color: #49483e">);</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
		<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">ke</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">ok</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Error</span><span style="color: #f8f8f2;background-color: #49483e">);</span> <span style="color: #f8f8f2;background-color: #49483e">ok</span> <span style="color: #f92672;font-weight: bold">==</span> <span style="color: #66d9ef">true</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #66d9ef;font-weight: bold">switch</span> <span style="color: #f8f8f2;background-color: #49483e">ec</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">ke</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Code</span><span style="color: #f8f8f2;background-color: #49483e">();</span> <span style="color: #f8f8f2;background-color: #49483e">ec</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">ErrInvalidArg</span><span style="color: #f92672;font-weight: bold">:</span>
				<span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Errorf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ˜¢ Can&#39;t create the producer because you&#39;ve configured it wrong (code: %d)!</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">%v</span><span style="color: #ae81ff">\n\n</span><span style="color: #e6db74">To see the configuration options, refer to https://github.com/edenhill/librdkafka/blob/master/CONFIGURATION.md&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">ec</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
			<span style="color: #66d9ef;font-weight: bold">default</span><span style="color: #f92672;font-weight: bold">:</span>
				<span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Errorf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ˜¢ Can&#39;t create the producer (Kafka error code %d)</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">Error: %v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">ec</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
			<span style="color: #f8f8f2;background-color: #49483e">}</span>
		<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #75715e;font-style: italic">// It&#39;s not a kafka.Error</span>
			<span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Errorf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ˜¢ Oh noes, there&#39;s a generic error creating the Producer! %v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Error</span><span style="color: #f8f8f2;background-color: #49483e">())</span>
		<span style="color: #f8f8f2;background-color: #49483e">}</span>

	<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>

		<span style="color: #66d9ef;font-weight: bold">defer</span> <span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Close</span><span style="color: #f8f8f2;background-color: #49483e">()</span>

		<span style="color: #75715e;font-style: italic">// For signalling termination from main to go-routine</span>
		<span style="color: #f8f8f2;background-color: #49483e">termChan</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2">make</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">chan</span> <span style="color: #66d9ef;font-weight: bold">bool</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
		<span style="color: #75715e;font-style: italic">// For signalling that termination is done from go-routine to main</span>
		<span style="color: #f8f8f2;background-color: #49483e">doneChan</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2">make</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">chan</span> <span style="color: #66d9ef;font-weight: bold">bool</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
		<span style="color: #75715e;font-style: italic">// For capturing errors from the go-routine</span>
		<span style="color: #f8f8f2;background-color: #49483e">errorChan</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2">make</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">chan</span> <span style="color: #66d9ef;font-weight: bold">string</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">8</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

		<span style="color: #75715e;font-style: italic">// --</span>
		<span style="color: #75715e;font-style: italic">// Send a message using Produce()</span>
		<span style="color: #75715e;font-style: italic">// https://docs.confluent.io/current/clients/confluent-kafka-go/index.html#Producer.Produce</span>
		<span style="color: #75715e;font-style: italic">//</span>
		<span style="color: #75715e;font-style: italic">// Build the message</span>
		<span style="color: #f8f8f2;background-color: #49483e">m</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Message</span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2;background-color: #49483e">TopicPartition</span><span style="color: #f92672;font-weight: bold">:</span> <span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">TopicPartition</span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2;background-color: #49483e">Topic</span><span style="color: #f92672;font-weight: bold">:</span> <span style="color: #f92672;font-weight: bold">&amp;</span><span style="color: #f8f8f2;background-color: #49483e">topic</span><span style="color: #f8f8f2;background-color: #49483e">},</span>
			<span style="color: #f8f8f2;background-color: #49483e">Value</span><span style="color: #f92672;font-weight: bold">:</span> <span style="color: #f8f8f2;background-color: #49483e">[]</span><span style="color: #66d9ef;font-weight: bold">byte</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;foo / %v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
				<span style="color: #f8f8f2;background-color: #49483e">time</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Now</span><span style="color: #f8f8f2;background-color: #49483e">()</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Format</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">time</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">RFC1123Z</span><span style="color: #f8f8f2;background-color: #49483e">)))}</span>

		<span style="color: #75715e;font-style: italic">// Handle any events that we get</span>
		<span style="color: #66d9ef;font-weight: bold">go</span> <span style="color: #66d9ef;font-weight: bold">func</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #f8f8f2;background-color: #49483e">doTerm</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #66d9ef">false</span>
			<span style="color: #66d9ef;font-weight: bold">for</span> <span style="color: #f92672;font-weight: bold">!</span><span style="color: #f8f8f2;background-color: #49483e">doTerm</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
				<span style="color: #75715e;font-style: italic">// The `select` blocks until one of the `case` conditions</span>
				<span style="color: #75715e;font-style: italic">// are met - therefore we run it in a Go Routine.</span>
				<span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
				<span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #f8f8f2;background-color: #49483e">ev</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f92672;font-weight: bold">&lt;-</span><span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Events</span><span style="color: #f8f8f2;background-color: #49483e">()</span><span style="color: #f92672;font-weight: bold">:</span>
					<span style="color: #75715e;font-style: italic">// Look at the type of Event we&#39;ve received</span>
					<span style="color: #66d9ef;font-weight: bold">switch</span> <span style="color: #f8f8f2;background-color: #49483e">ev</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">type</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>

					<span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Message</span><span style="color: #f92672;font-weight: bold">:</span>
						<span style="color: #75715e;font-style: italic">// It&#39;s a delivery report</span>
						<span style="color: #f8f8f2;background-color: #49483e">km</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">ev</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Message</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
						<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">km</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">TopicPartition</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Error</span> <span style="color: #f92672;font-weight: bold">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
							<span style="color: #f8f8f2;background-color: #49483e">errorChan</span> <span style="color: #f92672;font-weight: bold">&lt;-</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">**â˜ ï¸ Failed to send message &#39;%v&#39; to topic &#39;%v&#39;</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">Err: %v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
								<span style="color: #66d9ef;font-weight: bold">string</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">km</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Value</span><span style="color: #f8f8f2;background-color: #49483e">),</span>
								<span style="color: #66d9ef;font-weight: bold">string</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">km</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">TopicPartition</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Topic</span><span style="color: #f8f8f2;background-color: #49483e">),</span>
								<span style="color: #f8f8f2;background-color: #49483e">km</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">TopicPartition</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Error</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

						<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
							<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;âœ… Message &#39;%v&#39; delivered to topic &#39;%v&#39; (partition %d at offset %d)</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
								<span style="color: #66d9ef;font-weight: bold">string</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">km</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Value</span><span style="color: #f8f8f2;background-color: #49483e">),</span>
								<span style="color: #66d9ef;font-weight: bold">string</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">km</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">TopicPartition</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Topic</span><span style="color: #f8f8f2;background-color: #49483e">),</span>
								<span style="color: #f8f8f2;background-color: #49483e">km</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">TopicPartition</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Partition</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
								<span style="color: #f8f8f2;background-color: #49483e">km</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">TopicPartition</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Offset</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
						<span style="color: #f8f8f2;background-color: #49483e">}</span>

					<span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Error</span><span style="color: #f92672;font-weight: bold">:</span>
						<span style="color: #75715e;font-style: italic">// It&#39;s an error</span>
						<span style="color: #f8f8f2;background-color: #49483e">em</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">ev</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">kafka</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Error</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
						<span style="color: #f8f8f2;background-color: #49483e">errorChan</span> <span style="color: #f92672;font-weight: bold">&lt;-</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">**â˜ ï¸ Uh oh, caught an error:</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">%v</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">em</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

					<span style="color: #66d9ef;font-weight: bold">default</span><span style="color: #f92672;font-weight: bold">:</span>
						<span style="color: #75715e;font-style: italic">// It&#39;s not anything we were expecting</span>
						<span style="color: #f8f8f2;background-color: #49483e">errorChan</span> <span style="color: #f92672;font-weight: bold">&lt;-</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">**Got an event that&#39;s not a Message or Error ðŸ‘»</span><span style="color: #ae81ff">\n\t</span><span style="color: #e6db74">%v</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">ev</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

					<span style="color: #f8f8f2;background-color: #49483e">}</span>
				<span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #f92672;font-weight: bold">&lt;-</span><span style="color: #f8f8f2;background-color: #49483e">termChan</span><span style="color: #f92672;font-weight: bold">:</span>
					<span style="color: #f8f8f2;background-color: #49483e">doTerm</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #66d9ef">true</span>

				<span style="color: #f8f8f2;background-color: #49483e">}</span>
			<span style="color: #f8f8f2;background-color: #49483e">}</span>
			<span style="color: #f8f8f2">close</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">errorChan</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
			<span style="color: #f8f8f2">close</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">doneChan</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
		<span style="color: #f8f8f2;background-color: #49483e">}()</span>

		<span style="color: #75715e;font-style: italic">// Produce the message</span>
		<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Produce</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">&amp;</span><span style="color: #f8f8f2;background-color: #49483e">m</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef">nil</span><span style="color: #f8f8f2;background-color: #49483e">);</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">!=</span> <span style="color: #66d9ef">nil</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #f8f8f2;background-color: #49483e">errorChan</span> <span style="color: #f92672;font-weight: bold">&lt;-</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ˜¢ Darn, there&#39;s an error producing the message! %v&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Error</span><span style="color: #f8f8f2;background-color: #49483e">())</span>
		<span style="color: #f8f8f2;background-color: #49483e">}</span>

		<span style="color: #75715e;font-style: italic">// --</span>
		<span style="color: #75715e;font-style: italic">// Flush the Producer queue</span>
		<span style="color: #f8f8f2;background-color: #49483e">t</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #ae81ff">1000</span>
		<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">r</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Flush</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">t</span><span style="color: #f8f8f2;background-color: #49483e">);</span> <span style="color: #f8f8f2;background-color: #49483e">r</span> <span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #f8f8f2;background-color: #49483e">errorChan</span> <span style="color: #f92672;font-weight: bold">&lt;-</span> <span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Sprintf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">--</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">âš ï¸ Failed to flush all messages after %d milliseconds. %d message(s) remain&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">t</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">r</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

		<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Println</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">--</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">âœ¨ All messages flushed from the queue&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
		<span style="color: #f8f8f2;background-color: #49483e">}</span>
		<span style="color: #75715e;font-style: italic">// --</span>
		<span style="color: #75715e;font-style: italic">// Stop listening to events and close the producer</span>
		<span style="color: #75715e;font-style: italic">// We&#39;re ready to finish</span>
		<span style="color: #f8f8f2;background-color: #49483e">termChan</span> <span style="color: #f92672;font-weight: bold">&lt;-</span> <span style="color: #66d9ef">true</span>
		<span style="color: #75715e;font-style: italic">// wait for go-routine to terminate</span>
		<span style="color: #f92672;font-weight: bold">&lt;-</span><span style="color: #f8f8f2;background-color: #49483e">doneChan</span>
		<span style="color: #75715e;font-style: italic">// Now we can get ready to exit</span>
		<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">-=-=</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">Wrapping upâ€¦</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>

		<span style="color: #75715e;font-style: italic">// When we&#39;re ready to return, check if the go routine has sent errors</span>
		<span style="color: #75715e;font-style: italic">// Note that we&#39;re relying on the Go routine to close the channel, otherwise</span>
		<span style="color: #75715e;font-style: italic">// we deadlock.</span>
		<span style="color: #75715e;font-style: italic">// If there are no errors then the channel is simply closed and we read no values.</span>
		<span style="color: #f8f8f2;background-color: #49483e">done</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #66d9ef">false</span>
		<span style="color: #66d9ef;font-weight: bold">var</span> <span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #66d9ef;font-weight: bold">string</span>
		<span style="color: #66d9ef;font-weight: bold">for</span> <span style="color: #f92672;font-weight: bold">!</span><span style="color: #f8f8f2;background-color: #49483e">done</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2;background-color: #49483e">t</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">o</span> <span style="color: #f92672;font-weight: bold">:=</span> <span style="color: #f92672;font-weight: bold">&lt;-</span><span style="color: #f8f8f2;background-color: #49483e">errorChan</span><span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2;background-color: #49483e">o</span> <span style="color: #f92672;font-weight: bold">==</span> <span style="color: #66d9ef">false</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
				<span style="color: #75715e;font-style: italic">// o is false if we&#39;ve read all the values and the channel is closed</span>
				<span style="color: #75715e;font-style: italic">// If that&#39;s the case, then we&#39;re done here</span>
				<span style="color: #f8f8f2;background-color: #49483e">done</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #66d9ef">true</span>
			<span style="color: #f8f8f2;background-color: #49483e">}</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
				<span style="color: #75715e;font-style: italic">// We&#39;ve read a value so let&#39;s concatenate it with the others</span>
				<span style="color: #75715e;font-style: italic">// that we&#39;ve got</span>
				<span style="color: #f8f8f2;background-color: #49483e">e</span> <span style="color: #f92672;font-weight: bold">+=</span> <span style="color: #f8f8f2;background-color: #49483e">t</span>
			<span style="color: #f8f8f2;background-color: #49483e">}</span>
		<span style="color: #f8f8f2;background-color: #49483e">}</span>

		<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f8f8f2">len</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
			<span style="color: #75715e;font-style: italic">// If we&#39;ve got any errors, then return an error to the caller</span>

			<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;âŒ â€¦ returning an error</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
			<span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #f8f8f2;background-color: #49483e">errors</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">New</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">e</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
		<span style="color: #f8f8f2;background-color: #49483e">}</span>

		<span style="color: #75715e;font-style: italic">// assuming everything has gone ok return no error</span>
		<span style="color: #f8f8f2;background-color: #49483e">fmt</span><span style="color: #f92672;font-weight: bold">.</span><span style="color: #f8f8f2;background-color: #49483e">Printf</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;ðŸ‘‹ â€¦ and we&#39;re done.</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
		<span style="color: #66d9ef;font-weight: bold">return</span> <span style="color: #66d9ef">nil</span>

	<span style="color: #f8f8f2;background-color: #49483e">}</span>

<span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_more_episodes">ðŸ“º More Episodesâ€¦&nbsp;<a class="headline-hash" href="#_more_episodes">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Kafka and Go</p>
<div class="ulist">
<ul>
<li>
<p><a href="/2020/07/08/learning-golang-some-rough-notes-s02e00-kafka-and-go/">S02E00 - Kafka and Go</a></p>
</li>
<li>
<p><a href="/2020/07/08/learning-golang-some-rough-notes-s02e01-my-first-kafka-go-producer/">S02E01 - My First Kafka Go Producer</a></p>
</li>
<li>
<p><a href="/2020/07/10/learning-golang-some-rough-notes-s02e02-adding-error-handling-to-the-producer/">S02E02 - Adding error handling to the Producer</a></p>
</li>
<li>
<p><a href="/2020/07/14/learning-golang-some-rough-notes-s02e03-kafka-go-consumer-channel-based/">S02E03 - Kafka Go Consumer (Channel-based)</a></p>
</li>
<li>
<p><a href="/2020/07/14/learning-golang-some-rough-notes-s02e04-kafka-go-consumer-function-based/">S02E04 - Kafka Go Consumer (Function-based)</a></p>
</li>
<li>
<p><a href="/2020/07/15/learning-golang-some-rough-notes-s02e05-kafka-go-adminclient/">S02E05 - Kafka Go AdminClient</a></p>
</li>
<li>
<p><a href="/2020/07/15/learning-golang-some-rough-notes-s02e06-putting-the-producer-in-a-function-and-handling-errors-in-a-go-routine/">S02E06 - Putting the Producer in a function and handling errors in a Go routine</a></p>
</li>
<li>
<p><a href="/2020/07/16/learning-golang-some-rough-notes-s02e07-splitting-go-code-into-separate-source-files-and-building-a-binary-executable/">S02E07 - Splitting Go code into separate source files and building a binary executable</a></p>
</li>
<li>
<p><a href="/2020/07/17/learning-golang-some-rough-notes-s02e08-checking-kafka-advertised.listeners-with-go/">S02E08 - Checking Kafka advertised.listeners with Go</a></p>
</li>
<li>
<p><a href="/2020/07/23/learning-golang-some-rough-notes-s02e09-processing-chunked-responses-before-eof-is-reached/">S02E09 - Processing chunked responses before EOF is reached</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Learning Go</p>
<div class="ulist">
<ul>
<li>
<p><a href="/2020/06/25/learning-golang-some-rough-notes-s01e00/">S01E00 - Background</a></p>
</li>
<li>
<p><a href="/2020/06/25/learning-golang-some-rough-notes-s01e01-pointers/">S01E01 - Pointers</a></p>
</li>
<li>
<p><a href="/2020/06/25/learning-golang-some-rough-notes-s01e02-slices/">S01E02 - Slices</a></p>
</li>
<li>
<p><a href="/2020/06/29/learning-golang-some-rough-notes-s01e03-maps/">S01E03 - Maps</a></p>
</li>
<li>
<p><a href="/2020/06/29/learning-golang-some-rough-notes-s01e04-function-closures/">S01E04 - Function Closures</a></p>
</li>
<li>
<p><a href="/2020/06/30/learning-golang-some-rough-notes-s01e05-interfaces/">S01E05 - Interfaces</a></p>
</li>
<li>
<p><a href="/2020/07/01/learning-golang-some-rough-notes-s01e06-errors/">S01E06 - Errors</a></p>
</li>
<li>
<p><a href="/2020/07/01/learning-golang-some-rough-notes-s01e07-readers/">S01E07 - Readers</a></p>
</li>
<li>
<p><a href="/2020/07/02/learning-golang-some-rough-notes-s01e08-images/">S01E08 - Images</a></p>
</li>
<li>
<p><a href="/2020/07/02/learning-golang-some-rough-notes-s01e09-concurrency-channels-goroutines/">S01E09 - Concurrency (Channels, Goroutines)</a></p>
</li>
<li>
<p><a href="/2020/07/03/learning-golang-some-rough-notes-s01e10-concurrency-web-crawler/">S01E10 - Concurrency (Web Crawler)</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_command_line_arguments">Command line arguments</a></li>
    <li><a href="#_functions">Functions</a></li>
    <li><a href="#_errors">Errors</a>
      <ul>
        <li><a href="#_error_in_go_routines">Error in Go routines</a></li>
      </ul>
    </li>
    <li><a href="#_the_producer">The Producer</a></li>
    <li><a href="#_more_episodes">ðŸ“º More Episodesâ€¦</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
