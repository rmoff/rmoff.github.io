<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Streaming Geopoint data from Kafka to Elasticsearch</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/11/03/streaming-geopoint-data-from-kafka-to-elasticsearch/">
		
		
		
		<meta name="generator" content="Hugo 0.75.1" />

		
		<meta property="og:title" content="Streaming Geopoint data from Kafka to Elasticsearch" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/11/DSCF5274.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/11/03/streaming-geopoint-data-from-kafka-to-elasticsearch/" />
		<meta property="og:site_name" content="Streaming Geopoint data from Kafka to Elasticsearch" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/images/2020/11/DSCF5274.jpeg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Streaming Geopoint data from Kafka to Elasticsearch</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2020-11-03T10:36:18Z">Nov 3, 2020</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/kafka-connect" class="no-underline category near-white dim">Kafka Connect</a>, <a href="https://rmoff.net/categories/elasticsearch" class="no-underline category near-white dim">Elasticsearch</a>, <a href="https://rmoff.net/categories/geo-point" class="no-underline category near-white dim">Geo Point</a>, <a href="https://rmoff.net/categories/ksqldb" class="no-underline category near-white dim">KsqlDB</a>
								<span class="display-print">at https://rmoff.net/2020/11/03/streaming-geopoint-data-from-kafka-to-elasticsearch/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="https://twitter.com/rmoff/" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw7">
	<div class="paragraph">
<p>Streaming data from Kafka to Elasticsearch is easy with Kafka Connect - you can see how in this <a href="https://rmoff.dev/kafka-elasticsearch">tutorial</a> and <a href="https://rmoff.dev/kafka-elasticsearch-video">video</a>.</p>
</div>
<div class="paragraph">
<p>One of the things that sometimes causes issues though is how to get location data correctly indexed into Elasticsearch as <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-point.html"><code>geo_point</code></a> fields to enable all that lovely location analysis. Unlike data types like dates and numerics, Elasticsearch’s <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-field-mapping.html">Dynamic Field Mapping</a> won’t automagically pick up <code>geo_point</code> data, and so you have to do two things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Declare the index mapping in full, or use a <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-templates.html">dynamic template</a> to tell Elasticsearch to create new fields as a <code>geo_point</code> if they match the given pattern</p>
</li>
<li>
<p>Make sure that your <code>geo_point</code> source data is in the structure that Elasticsearch requires, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/geo-point.html">covered in full here</a> but basically:</p>
<div class="ulist">
<ul>
<li>
<p>object/struct</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="color: #d14">&#34;</span><span style="color: #d14">location</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">lat</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">41.12</span><span style="background-color: #f8f8f8">,</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">lon</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">71.34</span>
  <span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the field names are <strong>case sensitive</strong>
</td>
</tr>
</tbody></table>
</div>
</li>
<li>
<p>string</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="color: #d14">&#34;</span><span style="color: #d14">location</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">41.12,-71.34</span><span style="color: #d14">&#34;</span></code></pre>
</div>
</div>
</li>
<li>
<p>array</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="color: #d14">&#34;</span><span style="color: #d14">location</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">[</span> <span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">71.34</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">41.12</span> <span style="background-color: #f8f8f8">]</span></code></pre>
</div>
</div>
</li>
<li>
<p><em>plus geohash and WKT POINT.</em></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect1">
<h2 id="_how">How?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To get the data into the necessary format you can use ksqlDB to wrangle it, which is what I show below.</p>
</div>
<div class="paragraph">
<p>You could also use Kafka Connect’s Single Message Transform feature but no existing transformation exists that I’m aware of that does the necessary - <a href="https://twitter.com/rmoff/">drop me a line</a> if you write one!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example">Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here’s a worked example showing how to do this. It assumes that you’ve got a source topic with latitude and longitude, in this case it’s already as a struct but with the incorrect capitalisation (<code>&#34;Location&#34;: { &#34;Lat&#34;: 43.7575119, &#34;Lon&#34;: 11.2921363 }</code>).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Populate source topic with the sample data:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">kafkacat <span style="color: #000080">-b</span> localhost:9092 <span style="color: #000080">-P</span> <span style="color: #000080">-t</span> input_topic <span style="color: #000000;font-weight: bold">&lt;&lt;</span><span style="color: #008080">EOF</span><span style="color: #d14">
{ &#34;ID&#34;: &#34;7d6203f4-3ae7-4daa-af03-71f98d619f7e&#34;, &#34;Timestamp&#34;: &#34;2020-11-02T12:05:57.87639003Z&#34;, &#34;Type&#34;: &#34;CREATION&#34;, &#34;PlaceType&#34;: &#34;home&#34;, &#34;Location&#34;: { &#34;Lat&#34;: 43.7575119, &#34;Lon&#34;: 11.2921363 }, &#34;Created&#34;: &#34;2020-11-02T12:05:57.876390266Z&#34;, &#34;LastUpdated&#34;: &#34;2020-11-02T12:05:57.876390398Z&#34; }
EOF</span></code></pre>
</div>
</div>
</li>
<li>
<p>Taking a source topic of <code>source</code>, declare the ksqlDB <code>STREAM</code> object (which is basically Kafka topic with a schema overlaid):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="sql"><span style="color: #000000;font-weight: bold">CREATE</span> <span style="background-color: #f8f8f8">STREAM</span> <span style="background-color: #f8f8f8">SOURCE_STREAM</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ID</span> <span style="color: #0086B3">VARCHAR</span><span style="background-color: #f8f8f8">,</span>
                            <span style="color: #0086B3">Timestamp</span> <span style="color: #0086B3">VARCHAR</span><span style="background-color: #f8f8f8">,</span>
                            <span style="color: #000000;font-weight: bold">Type</span> <span style="color: #0086B3">VARCHAR</span><span style="background-color: #f8f8f8">,</span>
                            <span style="background-color: #f8f8f8">PlaceType</span> <span style="color: #0086B3">VARCHAR</span><span style="background-color: #f8f8f8">,</span>
                            <span style="color: #000000;font-weight: bold">Location</span> <span style="background-color: #f8f8f8">STRUCT</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Lat</span> <span style="color: #0086B3">DOUBLE</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">Lon</span> <span style="color: #0086B3">DOUBLE</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">,</span>
                            <span style="background-color: #f8f8f8">Created</span> <span style="color: #0086B3">VARCHAR</span><span style="background-color: #f8f8f8">,</span>
                            <span style="background-color: #f8f8f8">LastUpdated</span> <span style="color: #0086B3">VARCHAR</span><span style="background-color: #f8f8f8">)</span>
        <span style="color: #000000;font-weight: bold">WITH</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">KAFKA_TOPIC</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">&#39;input_topic&#39;</span><span style="background-color: #f8f8f8">,</span>
            <span style="background-color: #f8f8f8">VALUE_FORMAT</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">&#39;JSON&#39;</span><span style="background-color: #f8f8f8">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Confirm that the stream’s schema is valid by selecting fields from the first message:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="sql"><span style="background-color: #f8f8f8">ksql</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">SET</span> <span style="color: #d14">&#39;auto.offset.reset&#39;</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;earliest&#39;</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #000000;font-weight: bold">&gt;</span>
<span style="background-color: #f8f8f8">Successfully</span> <span style="background-color: #f8f8f8">changed</span> <span style="color: #000000;font-weight: bold">local</span> <span style="background-color: #f8f8f8">property</span> <span style="color: #d14">&#39;auto.offset.reset&#39;</span> <span style="color: #000000;font-weight: bold">to</span> <span style="color: #d14">&#39;earliest&#39;</span><span style="background-color: #f8f8f8">.</span> <span style="background-color: #f8f8f8">Use</span> <span style="background-color: #f8f8f8">the</span> <span style="background-color: #f8f8f8">UNSET</span> <span style="background-color: #f8f8f8">command</span> <span style="color: #000000;font-weight: bold">to</span> <span style="background-color: #f8f8f8">revert</span> <span style="background-color: #f8f8f8">your</span> <span style="background-color: #f8f8f8">change</span><span style="background-color: #f8f8f8">.</span>

<span style="background-color: #f8f8f8">ksql</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">SELECT</span> <span style="background-color: #f8f8f8">ID</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">PLACETYPE</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">LOCATION</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">LAT</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">LOCATION</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">LON</span> <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">SOURCE_STREAM</span> <span style="background-color: #f8f8f8">EMIT</span> <span style="background-color: #f8f8f8">CHANGES</span> <span style="color: #000000;font-weight: bold">LIMIT</span> <span style="color: #009999">1</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #000000;font-weight: bold">+</span><span style="color: #999988;font-style: italic">---------------------------------------+----------+-----------+-----------+</span>
<span style="color: #000000;font-weight: bold">|</span><span style="background-color: #f8f8f8">ID</span>                                     <span style="color: #000000;font-weight: bold">|</span><span style="background-color: #f8f8f8">PLACETYPE</span> <span style="color: #000000;font-weight: bold">|</span><span style="background-color: #f8f8f8">LAT</span>        <span style="color: #000000;font-weight: bold">|</span><span style="background-color: #f8f8f8">LON</span>        <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">+</span><span style="color: #999988;font-style: italic">---------------------------------------+----------+-----------+-----------+</span>
<span style="color: #000000;font-weight: bold">|</span><span style="color: #009999">7</span><span style="background-color: #f8f8f8">d6203f4</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">3</span><span style="background-color: #f8f8f8">ae7</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">4</span><span style="background-color: #f8f8f8">daa</span><span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">af03</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">71</span><span style="background-color: #f8f8f8">f98d619f7e</span>   <span style="color: #000000;font-weight: bold">|</span><span style="background-color: #f8f8f8">home</span>      <span style="color: #000000;font-weight: bold">|</span><span style="color: #009999">43</span><span style="background-color: #f8f8f8">.</span><span style="color: #009999">7575119</span> <span style="color: #000000;font-weight: bold">|</span><span style="color: #009999">11</span><span style="background-color: #f8f8f8">.</span><span style="color: #009999">2921363</span> <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">Limit</span> <span style="background-color: #f8f8f8">Reached</span>
<span style="background-color: #f8f8f8">Query</span> <span style="background-color: #f8f8f8">terminated</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create a target stream, mapping the lat/lon fields to lower-case names. Here I’m also showing the alternative approach of concatenating them, which Elasticsearch will also accept:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="sql"><span style="color: #000000;font-weight: bold">CREATE</span> <span style="background-color: #f8f8f8">STREAM</span> <span style="background-color: #f8f8f8">TARGET_STREAM</span> <span style="color: #000000;font-weight: bold">WITH</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">KAFKA_TOPIC</span><span style="color: #000000;font-weight: bold">=</span><span style="color: #d14">&#39;target_topic&#39;</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">AS</span>
    <span style="color: #000000;font-weight: bold">SELECT</span> <span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">,</span>
        <span style="background-color: #f8f8f8">STRUCT</span><span style="background-color: #f8f8f8">(</span><span style="color: #008080">&#34;lat&#34;</span> <span style="background-color: #f8f8f8">:</span><span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">LOCATION</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">LAT</span><span style="background-color: #f8f8f8">,</span> <span style="color: #008080">&#34;lon&#34;</span><span style="background-color: #f8f8f8">:</span><span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">LOCATION</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">LON</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">AS</span> <span style="color: #008080">&#34;location_example_01&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #000000;font-weight: bold">CAST</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">LOCATION</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">LAT</span> <span style="color: #000000;font-weight: bold">AS</span> <span style="color: #0086B3">VARCHAR</span><span style="background-color: #f8f8f8">)</span>  <span style="color: #000000;font-weight: bold">+</span> <span style="color: #d14">&#39;,&#39;</span> <span style="color: #000000;font-weight: bold">+</span> <span style="color: #000000;font-weight: bold">CAST</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">LOCATION</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">LON</span> <span style="color: #000000;font-weight: bold">AS</span> <span style="color: #0086B3">VARCHAR</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">AS</span> <span style="color: #008080">&#34;location_example_02&#34;</span>
    <span style="color: #000000;font-weight: bold">FROM</span> <span style="background-color: #f8f8f8">SOURCE_STREAM</span><span style="background-color: #f8f8f8">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Create an index template for Elasticsearch if the index does not already have the <code>geo_point</code> mapping declared. Here it’ll match any index created that begins with <code>target</code></p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">curl</span> <span style="color: #000000;font-weight: bold">--</span><span style="background-color: #f8f8f8">silent</span> <span style="color: #000000;font-weight: bold">--</span><span style="background-color: #f8f8f8">show</span><span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">error</span> <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">XPUT</span> <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">H</span> <span style="color: #d14">&#39;</span><span style="color: #d14">Content-Type: application/json</span><span style="color: #d14">&#39;</span> <span style="color: #000000;font-weight: bold">\</span>
    <span style="background-color: #f8f8f8">http</span><span style="background-color: #f8f8f8">:</span><span style="color: #999988;font-style: italic">//localhost:9200/_index_template/rmoff_template01/ \</span>
    <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">d</span><span style="color: #d14">&#39;</span><span style="color: #d14">{
        &#34;index_patterns&#34;: [ &#34;target*&#34; ],
        &#34;template&#34;: {
            &#34;mappings&#34;: {
                &#34;properties&#34;: {
                    &#34;location_example_01&#34;: {
                        &#34;type&#34;: &#34;geo_point&#34;
                    },
                    &#34;location_example_02&#34;: {
                        &#34;type&#34;: &#34;geo_point&#34;
                    }
                }
            }
        } }</span><span style="color: #d14">&#39;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Stream the data from Kafka to Elasticsearch using Kafka Connect. You can do configure this using the native Kafka Connect REST API, or do it directly from ksqlDB itself:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="sql"><span style="color: #000000;font-weight: bold">CREATE</span> <span style="background-color: #f8f8f8">SINK</span> <span style="background-color: #f8f8f8">CONNECTOR</span> <span style="background-color: #f8f8f8">SINK_ELASTIC_01</span> <span style="color: #000000;font-weight: bold">WITH</span> <span style="background-color: #f8f8f8">(</span>
<span style="color: #d14">&#39;connector.class&#39;</span>                     <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;io.confluent.connect.elasticsearch.ElasticsearchSinkConnector&#39;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#39;topics&#39;</span>                              <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;target_topic&#39;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#39;key.converter&#39;</span>                       <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;org.apache.kafka.connect.storage.StringConverter&#39;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#39;value.converter&#39;</span>                     <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;org.apache.kafka.connect.json.JsonConverter&#39;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#39;value.converter.schemas.enable&#39;</span>      <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;false&#39;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#39;connection.url&#39;</span>                      <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;http://elasticsearch:9200&#39;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#39;type.name&#39;</span>                           <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;_doc&#39;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#39;key.ignore&#39;</span>                          <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;true&#39;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#39;schema.ignore&#39;</span>                       <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;true&#39;</span><span style="background-color: #f8f8f8">);</span></code></pre>
</div>
</div>
</li>
<li>
<p>Inspect the mappings in the new Elasticsearch index</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">curl</span> <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">XGET</span> <span style="color: #000000;font-weight: bold">--</span><span style="background-color: #f8f8f8">silent</span> <span style="color: #000000;font-weight: bold">--</span><span style="background-color: #f8f8f8">show</span><span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">error</span> <span style="background-color: #f8f8f8">http</span><span style="background-color: #f8f8f8">:</span><span style="color: #999988;font-style: italic">//localhost:9200&#34;/target_topic/_mappings&#34;  | jq &#39;.&#39;</span>
<span style="background-color: #f8f8f8">{</span>
<span style="color: #d14">&#34;</span><span style="color: #d14">target_topic</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">mappings</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">properties</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">CREATED</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">date</span><span style="color: #d14">&#34;</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">ID</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">text</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">fields</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">keyword</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">keyword</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">ignore_above</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">256</span>
            <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">LASTUPDATED</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">date</span><span style="color: #d14">&#34;</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">LOCATION</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">properties</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">LAT</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">float</span><span style="color: #d14">&#34;</span>
            <span style="background-color: #f8f8f8">},</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">LON</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">float</span><span style="color: #d14">&#34;</span>
            <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">PLACETYPE</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">text</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">fields</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">keyword</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">keyword</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">ignore_above</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">256</span>
            <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">TIMESTAMP</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">date</span><span style="color: #d14">&#34;</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">TYPE</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">text</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">fields</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">keyword</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">keyword</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
            <span style="color: #d14">&#34;</span><span style="color: #d14">ignore_above</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">256</span>
            <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">}</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">location_example_01</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">geo_point</span><span style="color: #d14">&#34;</span>
        <span style="background-color: #f8f8f8">},</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">location_example_02</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">type</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">geo_point</span><span style="color: #d14">&#34;</span>
        <span style="background-color: #f8f8f8">}</span>
    <span style="background-color: #f8f8f8">}</span>
    <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>View the data:</p>
<div class="imageblock">
<div class="content">
<img src="/images/2020/11/es_kib_01.png" alt="es kib 01"/>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2020/11/es_kib_02.png" alt="es kib 02"/>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_learn_more_about_streaming_data_from_kafka_into_elasticsearch">Learn more about streaming data from Kafka into Elasticsearch</h2>
<div class="sectionbody">
<div class="paragraph">

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/Cq-2eGxOCc8" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

</div>
<div class="paragraph">
<p>Try out the <a href="https://rmoff.dev/kafka-elasticsearch">tutorial</a> for yourself!</p>
</div>
</div>
</div>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <em>Robin Moffatt is a Senior Developer Advocate at Confluent, and an Oracle ACE Director (Alumnus). He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2020 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
