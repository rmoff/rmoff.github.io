<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>🎄 Twelve Days of SMT 🎄 - Day 5: MaskField</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/12/14/twelve-days-of-smt-day-5-maskfield/">
		
		
		
		<meta name="generator" content="Hugo 0.75.1" />

		
		<meta property="og:title" content="🎄 Twelve Days of SMT 🎄 - Day 5: MaskField" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/12/smt_day5.jpg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/12/14/twelve-days-of-smt-day-5-maskfield/" />
		<meta property="og:site_name" content="🎄 Twelve Days of SMT 🎄 - Day 5: MaskField" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/images/2020/12/smt_day5.jpg'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">🎄 Twelve Days of SMT 🎄 - Day 5: MaskField</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2020-12-14T16:00:00Z">Dec 14, 2020</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/kafka-connect" class="no-underline category near-white dim">Kafka Connect</a>, <a href="https://rmoff.net/categories/single-message-transform" class="no-underline category near-white dim">Single Message Transform</a>, <a href="https://rmoff.net/categories/twelvedaysofsmt" class="no-underline category near-white dim">TwelveDaysOfSMT</a>
								<span class="display-print">at https://rmoff.net/2020/12/14/twelve-days-of-smt-day-5-maskfield/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="https://twitter.com/rmoff/" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw7">
	<div class="paragraph">
<p>If you want to mask fields of data as you ingest from a source into Kafka, or write to a sink from Kafka with Kafka Connect, the <a href="https://docs.confluent.io/platform/current/connect/transforms/maskfield.html"><code>MaskField</code></a> Single Message Transform is perfect for you. It retains the fields whilst replacing its value.</p>
</div>
<div class="paragraph">
<p>To use the Single Message Transform you specify the field to mask, and its replacement value. To mask the contents of a field called <code>cc_num</code> you would use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="color: #d14">&#34;</span><span style="color: #d14">transforms</span><span style="color: #d14">&#34;</span>                               <span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">maskCC</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#34;</span><span style="color: #d14">transforms.maskCC.type</span><span style="color: #d14">&#34;</span>                   <span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">org.apache.kafka.connect.transforms.MaskField$Value</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#34;</span><span style="color: #d14">transforms.maskCC.fields</span><span style="color: #d14">&#34;</span>                 <span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">cc_num</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
<span style="color: #d14">&#34;</span><span style="color: #d14">transforms.maskCC.replacement</span><span style="color: #d14">&#34;</span>            <span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">****-****-****-****</span><span style="color: #d14">&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/IOYrW3jyKoI" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

</div>
<div class="paragraph">
<p><a href="https://github.com/confluentinc/demo-scene/blob/master/kafka-connect-single-message-transforms/day5.adoc">👾 Demo code</a></p>
</div>
<div class="sect1">
<h2 id="_source_data">Source data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here’s the data being written by our source connector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #008080">$ </span>docker <span style="color: #0086B3">exec </span>kafkacat kafkacat <span style="color: #000080">-b</span> broker:29092 <span style="color: #000080">-r</span> http://schema-registry:8081 <span style="color: #000080">-s</span> <span style="color: #008080">key</span><span style="color: #000000;font-weight: bold">=</span>s <span style="color: #000080">-s</span> <span style="color: #008080">value</span><span style="color: #000000;font-weight: bold">=</span>avro <span style="color: #000080">-t</span> day5-00-person <span style="color: #000080">-C</span> <span style="color: #000080">-c1</span> <span style="color: #000080">-o</span> beginning <span style="color: #000080">-u</span> <span style="color: #000080">-q</span> <span style="color: #000080">-J</span> | jq  <span style="color: #d14">&#39;.&#39;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">{</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">topic</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">day5-00-person</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">partition</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">offset</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">tstype</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">create</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">ts</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">1607595830038</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">broker</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">1</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">key</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">648e4c63-ba83-4f3b-befe-505c07d9694f</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">payload</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">Gen0</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">phone_num</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">702.792.9316 x5223</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">lastName</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">Reinger</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">cc_exp</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">2015-11-11</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">firstName</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">Wayne</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">cc_num</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">1234-2121-1221-1211</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">fullAddress</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">2338 Andres Ville, North Tonymouth, OH 18398-3319</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">}</span>
    <span style="background-color: #f8f8f8">}</span>
  <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Check out all that sensitive information! Plenty of times we don’t want to have that either stored in the Kafka topic in the first place, or we OK with that but we don’t want to stream it verbatim to a target sink.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_masking_data_at_ingest_with_kafka_connect_source_connector">Masking data at ingest with Kafka Connect source connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can mask the data from an source connector in Kafka Connect with the <a href="https://docs.confluent.io/platform/current/connect/transforms/maskfield.html"><code>MaskField</code></a> Single Message Transform. Whilst the above Kafka Connect source connector is just generating dummy data, is still a Kafka Connect source connector nonetheless, so what I’m showing here is equally applicable to other source connectors—JDBC, Debezium, MQ, you name it—that’s the beauty of the Kafka Connect architecture, that you can mix &amp; match connectors with transforms (with converters too, but that’s another subject for another day).</p>
</div>
<div class="paragraph">
<p>Let’s create a second version of the above Kafka Connect source connector, and this time mask out the credit card number at ingest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">curl</span> <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">X</span> <span style="background-color: #f8f8f8">PUT</span> <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">H</span>  <span style="color: #d14">&#34;</span><span style="color: #d14">Content-Type:application/json</span><span style="color: #d14">&#34;</span> <span style="color: #000000;font-weight: bold">\</span>
    <span style="background-color: #f8f8f8">http</span><span style="background-color: #f8f8f8">:</span><span style="color: #999988;font-style: italic">//localhost:8083/connectors/source-voluble-datagen-day5-01/config \</span>
    <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">d</span> <span style="color: #d14">&#39;</span><span style="color: #d14">{
        &#34;connector.class&#34;                          : &#34;io.mdrogalis.voluble.VolubleSourceConnector&#34;,
        &#34;genkp.day5-01-person.with&#34;                : &#34;#{Internet.uuid}&#34;,
        &#34;genv.day5-01-person.firstName.with&#34;       : &#34;#{Address.firstName}&#34;,
        &#34;genv.day5-01-person.lastName.with&#34;        : &#34;#{Address.lastName}&#34;,
        &#34;genv.day5-01-person.fullAddress.with&#34;     : &#34;#{Address.fullAddress}&#34;,
        &#34;genv.day5-01-person.phone_num.with&#34;       : &#34;#{PhoneNumber.phoneNumber}&#34;,
        &#34;genv.day5-01-person.cc_num.with&#34;          : &#34;#{Business.creditCardNumber}&#34;,
        &#34;genv.day5-01-person.cc_exp.with&#34;          : &#34;#{Business.creditCardExpiry}&#34;,
        &#34;topic.day5-01-person.throttle.ms&#34;         : 500,
        &#34;transforms&#34;                               : &#34;maskCC&#34;,
        &#34;transforms.maskCC.type&#34;                   : &#34;org.apache.kafka.connect.transforms.MaskField$Value&#34;,
        &#34;transforms.maskCC.fields&#34;                 : &#34;cc_num,cc_exp&#34;,
        &#34;transforms.maskCC.replacement&#34;            : &#34;&lt;masked&gt;&#34;
    }</span><span style="color: #d14">&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here’s what it does to the data written <strong>to</strong> Kafka:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash"><span style="color: #008080">$ </span>docker <span style="color: #0086B3">exec </span>kafkacat kafkacat <span style="color: #000080">-b</span> broker:29092 <span style="color: #000080">-r</span> http://schema-registry:8081 <span style="color: #000080">-s</span> <span style="color: #008080">key</span><span style="color: #000000;font-weight: bold">=</span>s <span style="color: #000080">-s</span> <span style="color: #008080">value</span><span style="color: #000000;font-weight: bold">=</span>avro <span style="color: #000080">-t</span> day5-01-person <span style="color: #000080">-C</span> <span style="color: #000080">-c1</span> <span style="color: #000080">-o</span> end <span style="color: #000080">-u</span> <span style="color: #000080">-q</span> <span style="color: #000080">-J</span> | jq  <span style="color: #d14">&#39;.&#39;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">{</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">topic</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">day5-01-person</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">partition</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">offset</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">201</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">tstype</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">create</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">ts</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">1607596416414</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">broker</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #009999">1</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">key</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">f4d038da-bcc1-40d1-8b29-08d52305e796</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">,</span>
  <span style="color: #d14">&#34;</span><span style="color: #d14">payload</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #d14">&#34;</span><span style="color: #d14">Gen0</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">fullAddress</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">Apt. 801 356 Frami Canyon, East Irene, CA 15876-9608</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">phone_num</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">(910) 077-1824 x74606</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">cc_exp</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">&lt;masked&gt;</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">lastName</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">Thompson</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">cc_num</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">&lt;masked&gt;</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">},</span>
      <span style="color: #d14">&#34;</span><span style="color: #d14">firstName</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #d14">&#34;</span><span style="color: #d14">string</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">:</span> <span style="color: #d14">&#34;</span><span style="color: #d14">Wade</span><span style="color: #d14">&#34;</span>
      <span style="background-color: #f8f8f8">}</span>
    <span style="background-color: #f8f8f8">}</span>
  <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_masking_data_at_egress_in_a_kafka_connect_sink_connector">Masking data at egress in a Kafka Connect sink connector</h2>
<div class="sectionbody">
<div class="paragraph">
<p>👉 <a href="https://www.confluent.io/hub/confluentinc/kafka-connect-jdbc" class="bare">https://www.confluent.io/hub/confluentinc/kafka-connect-jdbc</a></p>
</div>
<div class="paragraph">
<p><em>See also 🎥 <a href="https://rmoff.dev/kafka-jdbc-video">Kafka Connect in Action : JDBC Sink</a> (👾 <a href="../kafka-to-database/README.adoc"><code>demo code</code></a>) and 🎥 <a href="https://rmoff.dev/ksqldb-jdbc-sink-video">ksqlDB &amp; Kafka Connect JDBC Sink in action</a> (👾 <a href="../kafka-to-database/ksqldb-jdbc-sink.adoc"><code>demo code</code></a>)</em></p>
</div>
<div class="paragraph">
<p>Here we’re going to stream the data from that topic above (<code>day5-01-person</code>) to MySQL, with the assumption that whilst the owner of the Kafka topic is permitted to hold a user’s full address, the owner of the database to which we’re streaming the data is not, and thus will mask it out at egress:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="javascript"><span style="background-color: #f8f8f8">curl</span> <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">X</span> <span style="background-color: #f8f8f8">PUT</span> <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">H</span> <span style="color: #d14">&#34;</span><span style="color: #d14">Accept:application/json</span><span style="color: #d14">&#34;</span> <span style="color: #000000;font-weight: bold">\</span>
    <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">H</span>  <span style="color: #d14">&#34;</span><span style="color: #d14">Content-Type:application/json</span><span style="color: #d14">&#34;</span> <span style="background-color: #f8f8f8">http</span><span style="background-color: #f8f8f8">:</span><span style="color: #999988;font-style: italic">//localhost:8083/connectors/sink-jdbc-mysql-day5-person-01/config \</span>
    <span style="color: #000000;font-weight: bold">-</span><span style="background-color: #f8f8f8">d</span> <span style="color: #d14">&#39;</span><span style="color: #d14">{
          &#34;connector.class&#34;                    : &#34;io.confluent.connect.jdbc.JdbcSinkConnector&#34;,
          &#34;connection.url&#34;                     : &#34;jdbc:mysql://mysql:3306/demo&#34;,
          &#34;connection.user&#34;                    : &#34;mysqluser&#34;,
          &#34;connection.password&#34;                : &#34;mysqlpw&#34;,
          &#34;topics&#34;                             : &#34;day5-01-person&#34;,
          &#34;tasks.max&#34;                          : &#34;4&#34;,
          &#34;auto.create&#34;                        : &#34;true&#34;,
          &#34;auto.evolve&#34;                        : &#34;true&#34;,
          &#34;transforms&#34;                         : &#34;maskAddress&#34;,
          &#34;transforms.maskAddress.type&#34;        : &#34;org.apache.kafka.connect.transforms.MaskField$Value&#34;,
          &#34;transforms.maskAddress.fields&#34;      : &#34;fullAddress&#34;,
          &#34;transforms.maskAddress.replacement&#34; : &#34;[❌redacted❌]&#34;
        }</span><span style="color: #d14">&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if we launch MySQL</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">docker <span style="color: #0086B3">exec</span> <span style="color: #000080">-it</span> mysql bash <span style="color: #000080">-c</span> <span style="color: #d14">&#39;mysql -u root -p$MYSQL_ROOT_PASSWORD demo&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and check out the table we can see we have the full schema:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="sql"><span style="background-color: #f8f8f8">mysql</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">describe</span> <span style="color: #008080">`day5-01-person`</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #000000;font-weight: bold">+</span><span style="color: #999988;font-style: italic">-------------+------+------+-----+---------+-------+</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Field</span>       <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">Type</span> <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">Null</span> <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">Key</span> <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">Default</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Extra</span> <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">+</span><span style="color: #999988;font-style: italic">-------------+------+------+-----+---------+-------+</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">fullAddress</span> <span style="color: #000000;font-weight: bold">|</span> <span style="color: #0086B3">text</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">YES</span>  <span style="color: #000000;font-weight: bold">|</span>     <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">NULL</span>    <span style="color: #000000;font-weight: bold">|</span>       <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">phone_num</span>   <span style="color: #000000;font-weight: bold">|</span> <span style="color: #0086B3">text</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">YES</span>  <span style="color: #000000;font-weight: bold">|</span>     <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">NULL</span>    <span style="color: #000000;font-weight: bold">|</span>       <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">cc_exp</span>      <span style="color: #000000;font-weight: bold">|</span> <span style="color: #0086B3">text</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">YES</span>  <span style="color: #000000;font-weight: bold">|</span>     <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">NULL</span>    <span style="color: #000000;font-weight: bold">|</span>       <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">lastName</span>    <span style="color: #000000;font-weight: bold">|</span> <span style="color: #0086B3">text</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">YES</span>  <span style="color: #000000;font-weight: bold">|</span>     <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">NULL</span>    <span style="color: #000000;font-weight: bold">|</span>       <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">cc_num</span>      <span style="color: #000000;font-weight: bold">|</span> <span style="color: #0086B3">text</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">YES</span>  <span style="color: #000000;font-weight: bold">|</span>     <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">NULL</span>    <span style="color: #000000;font-weight: bold">|</span>       <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">firstName</span>   <span style="color: #000000;font-weight: bold">|</span> <span style="color: #0086B3">text</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">YES</span>  <span style="color: #000000;font-weight: bold">|</span>     <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">NULL</span>    <span style="color: #000000;font-weight: bold">|</span>       <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">+</span><span style="color: #999988;font-style: italic">-------------+------+------+-----+---------+-------+</span>
<span style="color: #009999">6</span> <span style="color: #000000;font-weight: bold">rows</span> <span style="color: #000000;font-weight: bold">in</span> <span style="color: #000000;font-weight: bold">set</span> <span style="background-color: #f8f8f8">(</span><span style="color: #009999">0</span><span style="background-color: #f8f8f8">.</span><span style="color: #009999">00</span> <span style="background-color: #f8f8f8">sec</span><span style="background-color: #f8f8f8">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and the data is as it should be, with the <code>fullAddress</code> masked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="sql"><span style="background-color: #f8f8f8">mysql</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">select</span> <span style="color: #000000;font-weight: bold">*</span> <span style="color: #000000;font-weight: bold">from</span> <span style="color: #008080">`day5-01-person`</span> <span style="color: #000000;font-weight: bold">LIMIT</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #000000;font-weight: bold">+</span><span style="color: #999988;font-style: italic">--------------+-----------------------+----------+---------------+----------+-------------+</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">fullAddress</span>  <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">phone_num</span>             <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">cc_exp</span>   <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">lastName</span>      <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">cc_num</span>   <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">firstName</span>   <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">+</span><span style="color: #999988;font-style: italic">--------------+-----------------------+----------+---------------+----------+-------------+</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">redacted</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">]</span> <span style="color: #000000;font-weight: bold">|</span> <span style="color: #009999">383</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">349</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">1787</span> <span style="background-color: #f8f8f8">x792</span>     <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Koss</span>          <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Courtney</span>    <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">redacted</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">]</span> <span style="color: #000000;font-weight: bold">|</span> <span style="color: #009999">989</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">731</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">8207</span>          <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Hand</span>          <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Trudy</span>       <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">redacted</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">]</span> <span style="color: #000000;font-weight: bold">|</span> <span style="color: #009999">809</span><span style="background-color: #f8f8f8">.</span><span style="color: #009999">775</span><span style="background-color: #f8f8f8">.</span><span style="color: #009999">2196</span> <span style="background-color: #f8f8f8">x66858</span>   <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Pollich</span>       <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Jame</span>        <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">redacted</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">]</span> <span style="color: #000000;font-weight: bold">|</span> <span style="color: #009999">1</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">788</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">930</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">4978</span>        <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Boyle</span>         <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Claud</span>       <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">redacted</span><span style="color: #000000;font-weight: bold">?</span><span style="background-color: #f8f8f8">]</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">(</span><span style="color: #009999">599</span><span style="background-color: #f8f8f8">)</span> <span style="color: #009999">706</span><span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">0041</span> <span style="background-color: #f8f8f8">x0995</span>  <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Stark</span>         <span style="color: #000000;font-weight: bold">|</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">masked</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">|</span> <span style="background-color: #f8f8f8">Gertie</span>      <span style="color: #000000;font-weight: bold">|</span>
<span style="color: #000000;font-weight: bold">+</span><span style="color: #999988;font-style: italic">--------------+-----------------------+----------+---------------+----------+-------------+</span>
<span style="color: #009999">5</span> <span style="color: #000000;font-weight: bold">rows</span> <span style="color: #000000;font-weight: bold">in</span> <span style="color: #000000;font-weight: bold">set</span> <span style="background-color: #f8f8f8">(</span><span style="color: #009999">0</span><span style="background-color: #f8f8f8">.</span><span style="color: #009999">00</span> <span style="background-color: #f8f8f8">sec</span><span style="background-color: #f8f8f8">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(maybe the ❌ emojis were just a step too far <code>;)</code> )</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_try_it_out">Try it out!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can find the full code for trying this out—including a Docker Compose so you can spin it up on your local machine— <a href="https://github.com/confluentinc/demo-scene/blob/master/kafka-connect-single-message-transforms/day5.adoc">👾 here</a></p>
</div>
</div>
</div>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --> <em>Robin Moffatt is a Senior Developer Advocate at Confluent, and an Oracle ACE Director (Alumnus). He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2020 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
