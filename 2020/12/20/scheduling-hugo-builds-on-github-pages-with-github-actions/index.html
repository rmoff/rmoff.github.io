<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2020/12/IMG_7971.jpeg" >
		
		<title>Scheduling Hugo Builds on GitHub pages with GitHub Actions</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2020/12/20/scheduling-hugo-builds-on-github-pages-with-github-actions/">
		
		

		
		<meta property="og:title" content="Scheduling Hugo Builds on GitHub pages with GitHub Actions" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2020/12/IMG_7971.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2020/12/20/scheduling-hugo-builds-on-github-pages-with-github-actions/" />
		<meta property="og:site_name" content="Scheduling Hugo Builds on GitHub pages with GitHub Actions" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2020/12/IMG_7971.jpeg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Scheduling Hugo Builds on GitHub pages with GitHub Actions</h1>
			<p class="article-hero-meta">
				
					<time datetime="2020-12-20T23:45:03Z">20 Dec 2020</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/blogging">Blogging</a>, <a href="https://rmoff.net/categories/hugo">Hugo</a>, <a href="https://rmoff.net/categories/github">GitHub</a>, <a href="https://rmoff.net/categories/github-actions">GitHub Actions</a>
					<span class="display-print">at https://rmoff.net/2020/12/20/scheduling-hugo-builds-on-github-pages-with-github-actions/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_preparation">Preparation</a>
      <ul>
        <li><a href="#_repository_secret_source_repository">Repository secret (<strong>source</strong> repository)</a></li>
        <li><a href="#_deploy_key_target_repository">Deploy key (<strong>target</strong> repository)</a></li>
      </ul>
    </li>
    <li><a href="#_configuring_the_action">Configuring the Action</a></li>
    <li><a href="#_summary">Summary</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Blogging</span><span data-pagefind-filter="category" style="display:none">Hugo</span><span data-pagefind-filter="category" style="display:none">GitHub</span><span data-pagefind-filter="category" style="display:none">GitHub Actions</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2020/12/IMG_7971.jpeg" style="display:none" alt="">
	<div class="paragraph">
<p>Over the years I‚Äôve used various blogging platforms; after a brief dalliance with Blogger I started for real with the near-inevitable Wordpress.com. From there I decided it would be fun to self-host using Ghost, and then almost <a href="/2018/12/17/moving-from-ghost-to-hugo/">exactly two years ago to the day</a> decided it definitely was not fun to spend time patching and upgrading my blog platform instead of writing blog articles, so headed over to my current platform of choice: Hugo hosted on GitHub pages. This has worked extremely well for me during that time, doing everything I want from it until recently.</p>
</div>
<div class="paragraph">
<p>As a static-site generator, Hugo supports the idea of future-dated posts, but you still need to regenerate that static site once the date has arrived. It‚Äôs not the same as serving dynamic content on a blog in which you simply say <code>IF blogDate ‚áí NOW()</code>. With a static site you publish content by building it and pushing those static files to the server (GitHub Pages in my case) - and if you‚Äôve published content that‚Äôs future dated, you need to find a way to trigger that publishing process.</p>
</div>
<div class="paragraph">
<p>I recently undertook a little project to create and publish twelve videos in the run-up to Christmas; three of them were to be published after I‚Äôd hung up my laptop for the year and would be comfortably ensconced on a sofa and up to my ears in Quality Street and mince pies. Whilst there were plenty of tools to publish tweets on a schedule, and YouTube can schedule the publication of a video, my blog (from which the videos were linked) looked like it was going to be a bit of a problem. A bash <code>while</code> loop running on my laptop, or even a crontab, seemed a bit hacky and ultimately not reliable enough.</p>
</div>
<div class="paragraph">
<p>The answer turned out to be this thing called GitHub Actions which, like a lot of technology these days, I‚Äôd heard of and was vaguely aware of‚Äîbut had no idea what it actually did.</p>
</div>
<div class="paragraph">
<p>GitHub Actions lets you take actions (duh!) based on the code in your repo on GitHub. Since my blog <a href="https://github.com/rmoff/rmoff-blog/">is just a repo</a>, it can be set to trigger an action every time I push a new article to it (like this one), or indeed on a schedule also.</p>
</div>
<div class="paragraph">
<p>I found a few articles to use, primarily <a href="https://www.morling.dev/blog/automatically-deploying-hugo-website-via-github-actions/">this nice one</a> from <a href="https://twitter.com/gunnarmorling">Gunnar Morling</a>.</p>
</div>
<div class="sect1">
<h2 id="_preparation">Preparation&nbsp;<a class="headline-hash" href="#_preparation">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>See <a href="/2018/12/17/moving-from-ghost-to-hugo/">my previous article</a> for details of how I‚Äôve installed and configured Hugo</em>.</p>
</div>
<div class="paragraph">
<p>I‚Äôve got two repositories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><a href="https://github.com/rmoff/rmoff-blog/" class="bare">https://github.com/rmoff/rmoff-blog/</a></code> - holds the source code for my blog</p>
</li>
<li>
<p><code><a href="https://github.com/rmoff/rmoff.github.io" class="bare">https://github.com/rmoff/rmoff.github.io</a></code> - the static site served through GitHub Pages. I have a custom domain (<code>rmoff.net</code>) set on this</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_repository_secret_source_repository">Repository secret (<strong>source</strong> repository)&nbsp;<a class="headline-hash" href="#_repository_secret_source_repository">üîó</a> </h3>
<div class="paragraph">
<p>In the source repository, from which the GitHub Action will run, you need to create a <a href="https://docs.github.com/en/free-pro-team@latest/actions/reference/encrypted-secrets#creating-encrypted-secrets-for-a-repository"><strong>Repository secret</strong></a>. This is the authorisation under which the Action will run.</p>
</div>
<div class="paragraph">
<p>I‚Äôve seen tutorials do this with both SSH keypairs, and with GitHub <a href="https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token">Personal Access Tokens</a>. Based on <a href="https://www.morling.dev/blog/automatically-deploying-hugo-website-via-github-actions/">Gunnar‚Äôs article</a>, I used the SSH keypair approach, generating a unique pair just for this purpose:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">ssh-keygen <span style="color: #f92672">-t</span> rsa <span style="color: #f92672">-b</span> 4096 <span style="color: #f92672">-C</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">$(</span>git config user.email<span style="color: #e6db74">)</span><span style="color: #e6db74">&#34;</span> <span style="color: #f92672">-f</span> gh-pages <span style="color: #f92672">-N</span> <span style="color: #e6db74">&#34;&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the repository secret for your source repository (so <code><a href="https://github.com/rmoff/rmoff-blog/" class="bare">https://github.com/rmoff/rmoff-blog/</a></code> in my case) put the <strong>private</strong> half of the key (if you use the above command it‚Äôll be called <code>gh-pages</code>). Give it a name and make a note of that name. I used <code>ACTIONS_DEPLOY_KEY</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2020/12/gh1.png" alt="gh1"/>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You configure this secret against <strong>the source repository</strong> - I wasted time in my GitHub profile settings looking for an option that wasn‚Äôt there ü§¶‚Äç‚ôÇÔ∏è
</td>
</tr>
</tbody></table>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_key_target_repository">Deploy key (<strong>target</strong> repository)&nbsp;<a class="headline-hash" href="#_deploy_key_target_repository">üîó</a> </h3>
<div class="paragraph">
<p>The deploy key is configured against the repository to which your Action is going to push the static site content, which is <code><a href="https://github.com/rmoff/rmoff.github.io" class="bare">https://github.com/rmoff/rmoff.github.io</a></code> in my case. If you are using SSH keys then it is the <strong>public</strong> part of your keypair that you generated, and using the above code will be called <code>gh-pages.pub</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2020/12/gh2.png" alt="gh2"/>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You configure this deploy key against <strong>the target repository that holds your static site</strong> - I wasted time in my GitHub profile settings looking for an option that wasn‚Äôt there ü§¶‚Äç‚ôÇÔ∏è
</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_the_action">Configuring the Action&nbsp;<a class="headline-hash" href="#_configuring_the_action">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you‚Äôve set up the auth per above, you need to configure the action itself. This is done through a YAML file that you put in the source repository from which you want it to run. Mine is based heavily on the one in <a href="https://www.morling.dev/blog/automatically-deploying-hugo-website-via-github-actions/">Gunnar‚Äôs article</a>, with a few tweaks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Build &amp; deploy live site</span>

<span style="color: #a6e22e">on</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">push</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">branches</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
     <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #e6db74">main</span>
<span style="color: #75715e;font-style: italic">#   schedule:</span>
<span style="color: #75715e;font-style: italic">#     # Run on the hour</span>
<span style="color: #75715e;font-style: italic">#     - cron: &#39;0 * * * *&#39;</span>

<span style="color: #a6e22e">jobs</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">build-deploy</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">runs-on</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">ubuntu-22.04</span>
    <span style="color: #a6e22e">permissions</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #a6e22e">contents</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">read</span>
      <span style="color: #a6e22e">packages</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">read</span>
    <span style="color: #a6e22e">steps</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">uses</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">actions/checkout@v3</span>

    <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Log in to Container Registry</span>
      <span style="color: #a6e22e">uses</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">docker/login-action@v3</span>
      <span style="color: #a6e22e">with</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">registry</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">ghcr.io</span>
        <span style="color: #a6e22e">username</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">${{ github.actor }}</span>
        <span style="color: #a6e22e">password</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">${{ secrets.GITHUB_TOKEN }}</span>

    <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Build reveal.js presentations (requires local asciidoctor)</span>
      <span style="color: #a6e22e">run</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">|</span>
        <span style="color: #e6db74">sudo apt-get update</span>
        <span style="color: #e6db74">sudo apt-get install -y ruby-dev</span>
        <span style="color: #e6db74">sudo gem install asciidoctor asciidoctor-revealjs</span>
        <span style="color: #e6db74">./build-slides.sh</span>

    <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Build Hugo site with Docker</span>
      <span style="color: #a6e22e">run</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">|</span>
        <span style="color: #e6db74">docker run --rm \</span>
          <span style="color: #e6db74">-v $(pwd):/src \</span>
          <span style="color: #e6db74">ghcr.io/${{ github.repository }}:0.152.2 \</span>
          <span style="color: #e6db74">--destination public</span>

    <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Build Pagefind search index</span>
      <span style="color: #a6e22e">run</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">npx pagefind --site public</span>

    <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Deploy</span>
      <span style="color: #a6e22e">uses</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">peaceiris/actions-gh-pages@v3</span>
      <span style="color: #a6e22e">with</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">deploy_key</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">${{ secrets.ACTIONS_DEPLOY_KEY }}</span>
        <span style="color: #a6e22e">external_repository</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">rmoff/rmoff.github.io</span>
        <span style="color: #a6e22e">publish_branch</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">master</span>
        <span style="color: #75715e;font-style: italic"># Without `keep_files` the `CNAME` file in the target repo will get removed</span>
        <span style="color: #75715e;font-style: italic"># and the custom domain configured for GitHub pages will get dropped every</span>
        <span style="color: #75715e;font-style: italic"># time the action runs‚Ä¶</span>
        <span style="color: #a6e22e">keep_files</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Points to note:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The action will trigger every ten minutes (in practice this seems to not be honoured and instead seems to run every 40 minutes or so instead, maybe because I‚Äôm on the GitHub free plan?):</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml">  <span style="color: #a6e22e">schedule</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #75715e;font-style: italic"># Run every ten minutes</span>
    <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">cron</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#39;</span><span style="color: #e6db74">*/10</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">*</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">*</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">*</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">*&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>as well as when a push is made to the master branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml">  <span style="color: #a6e22e">push</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">branches</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
     <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #e6db74">master</span></code></pre>
</div>
</div>
</li>
<li>
<p>You can tie the Hugo version to a particular number; I‚Äôve used the same one as I run locally</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml">        <span style="color: #a6e22e">hugo-version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#39;</span><span style="color: #e6db74">0.75.1&#39;</span></code></pre>
</div>
</div>
</li>
<li>
<p>You need to make sure <code>deploy_key</code> matches whatever name you gave to the repository secret that you configured above</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml">        <span style="color: #a6e22e">deploy_key</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">${{ secrets.ACTIONS_DEPLOY_KEY }}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Hugo deployments are usually set up with <code>/public</code> as a submodule from another repo (the hosted static site repo). I got tied in knots here with this, so ended up setting <code>external_repository</code> and it works just fine. <code>/public</code> is the folder that <a href="https://github.com/peaceiris/actions-hugo">the Hugo action</a> pushes by default</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml">        <span style="color: #a6e22e">external_repository</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">rmoff/rmoff.github.io</span></code></pre>
</div>
</div>
</li>
<li>
<p>This last setting is a crucial one. I use a custom domain on my GitHub Pages site, and when I was setting this up <a href="https://twitter.com/rmoff/status/1339983386031611909">that custom domain kept getting dropped each time I ran the action</a>‚Ä¶very confusing! Until I realised that the custom domain name is stored as a file <code>CNAME</code> in the repository, and the action was <strong>replacing</strong> the contents of the repository each time it ran! So, without <code>keep_files</code> the <code>CNAME</code> file in the target repo will get removed and the custom domain configured for GitHub pages will get dropped every time the action runs‚Ä¶</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml">        <span style="color: #a6e22e">keep_files</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #66d9ef">true</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The only issue I had was to do with my theme, and some dodgy <code>include</code> directives that I‚Äôd set up. I ended up ditching the theme that I use as a submodule and just including it in my site code. Dirty, but it works, and the theme isn‚Äôt actively developed any more, so ¬Ø_(„ÉÑ)_/¬Ø</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary&nbsp;<a class="headline-hash" href="#_summary">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>That‚Äôs pretty much it. The build chugs away every few minutes, meaning that posts that I‚Äôve written that are future dated will hopefully publish just fine when their time comes around.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2020/12/actions.png" alt="actions"/>
</div>
</div>
<div class="paragraph">
<p>Gunnar noted that he‚Äôs evolved his build from what he originally published, as well as setting up preview builds for PRs which is a neat idea.</p>
</div>
<div class="paragraph">
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Also got my preview flow properly set up now. Proper base URL, and e.g. Disqus disabled on staging (via Hugo environments). Also considering to add noindex metadata, but probably not worth it, as those previews are rather short-lived. <a href="https://t.co/KdPxlrk1E4">https://t.co/KdPxlrk1E4</a>.</p>&mdash; Gunnar Morling üåç (@gunnarmorling) <a href="https://twitter.com/gunnarmorling/status/1340619722887483394?ref_src=twsrc%5Etfw">December 20, 2020</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_preparation">Preparation</a>
      <ul>
        <li><a href="#_repository_secret_source_repository">Repository secret (<strong>source</strong> repository)</a></li>
        <li><a href="#_deploy_key_target_repository">Deploy key (<strong>target</strong> repository)</a></li>
      </ul>
    </li>
    <li><a href="#_configuring_the_action">Configuring the Action</a></li>
    <li><a href="#_summary">Summary</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
