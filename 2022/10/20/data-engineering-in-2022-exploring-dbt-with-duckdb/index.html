<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2022/10/h_IMG_8370.jpeg" >
		
		<title>Data Engineering in 2022: Exploring dbt with DuckDB</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2022/10/20/data-engineering-in-2022-exploring-dbt-with-duckdb/">
		
		

		
		<meta property="og:title" content="Data Engineering in 2022: Exploring dbt with DuckDB" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2022/10/h_IMG_8370.jpeg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2022/10/20/data-engineering-in-2022-exploring-dbt-with-duckdb/" />
		<meta property="og:site_name" content="Data Engineering in 2022: Exploring dbt with DuckDB" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2022/10/h_IMG_8370.jpeg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Data Engineering in 2022: Exploring dbt with DuckDB</h1>
			<p class="article-hero-meta">
				
					<time datetime="2022-10-20T17:07:04Z">20 Oct 2022</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/data-engineering">Data Engineering</a>, <a href="https://rmoff.net/categories/dbt">dbt</a>, <a href="https://rmoff.net/categories/duckdb">DuckDB</a>
					<span class="display-print">at https://rmoff.net/2022/10/20/data-engineering-in-2022-exploring-dbt-with-duckdb/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_mach_speed">Mach Speed</a></li>
    <li><a href="#_step_by_step">Step-by-Step</a>
      <ul>
        <li><a href="#_dbt_seed"><code>dbt seed</code></a></li>
        <li><a href="#_dbt_compile"><code>dbt compile</code></a></li>
        <li><a href="#_dbt_run"><code>dbt run</code></a></li>
        <li><a href="#_dbt_run_2"><code>dbt run</code></a></li>
      </ul>
    </li>
    <li><a href="#_wrapping_up">Wrapping upâ€¦</a></li>
    <li><a href="#_learning_more">Learning More</a></li>
    <li><a href="#_data_engineering_in_2022">Data Engineering in 2022</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Data Engineering</span><span data-pagefind-filter="category" style="display:none">dbt</span><span data-pagefind-filter="category" style="display:none">DuckDB</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2022/10/h_IMG_8370.jpeg" style="display:none" alt="">
	<div class="paragraph">
<p>Iâ€™ve been wanting to try out dbt for some time now, and a recent long-haul flight seemed like the obvious opportunity to do so. Except many of the tutorials with dbt that I found were based on using Cloud, and airplane WiFi is generally sucky or non-existant. Then I found the <a href="https://github.com/dbt-labs/jaffle_shop_duckdb">DuckDB-based demo of dbt</a>, which seemed to fit the bill (ðŸ¦† geddit?!) perfectly, since DuckDB runs locally. In addition, <a href="https://duckdb.org/">DuckDB</a> had appeared on my radar recently and I was keen to check it out.</p>
</div>
<div class="paragraph">
<p>The <a href="https://github.com/dbt-labs/jaffle_shop_duckdb/blob/duckdb/README.md">README</a> for <a href="https://github.com/dbt-labs/jaffle_shop_duckdb">jaffle_shop_duckdb</a> is comprehensive and well-written. Kudos to the author for providing copy-paste for <em>all</em> the steps needed to get set up including an isolated Python virtual environment.</p>
</div>
<div class="paragraph">
<p>My starting point for this was pretty much zero knowledge of dbt, and I used this opportunity to poke around it and understand it better. I could go and read the <a href="https://docs.getdbt.com/">docs</a> and the <a href="https://courses.getdbt.com/">training material</a>, but thatâ€™d be too obvious ;)</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>If youâ€™re interested in DuckDB make sure to also check out the noodling around with it that I did <a href="/2022/10/14/current-22-session-analysis-with-duckdb-and-jupyter-notebook/">in a notebook recently</a></em>.
</td>
</tr>
</tbody></table>
</div>
<div class="sect1">
<h2 id="_mach_speed">Mach Speed&nbsp;<a class="headline-hash" href="#_mach_speed">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first execution option of the demo is called <em>Mach Speed</em> and basically has you simply run the whole thing end-to-end with <code>dbt build</code> â€” and thatâ€™s it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #960050;background-color: #1e0010">$</span> <span style="color: #f8f8f2;background-color: #49483e">dbt</span> <span style="color: #f8f8f2;background-color: #49483e">build</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">22</span>  <span style="color: #f8f8f2;background-color: #49483e">Running</span> <span style="color: #66d9ef;font-weight: bold">with</span> <span style="color: #f8f8f2;background-color: #49483e">dbt</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">1</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">22</span>  <span style="color: #66d9ef;font-weight: bold">Found</span> <span style="color: #ae81ff">5</span> <span style="color: #f8f8f2;background-color: #49483e">models</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">20</span> <span style="color: #f8f8f2;background-color: #49483e">tests</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">snapshots</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">analyses</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">167</span> <span style="color: #f8f8f2;background-color: #49483e">macros</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">operations</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">3</span> <span style="color: #f8f8f2;background-color: #49483e">seed</span> <span style="color: #f8f8f2;background-color: #49483e">files</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">sources</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">exposures</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">metrics</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">22</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">22</span>  <span style="color: #f8f8f2;background-color: #49483e">Concurrency</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span> <span style="color: #f8f8f2;background-color: #49483e">threads</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">22</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">22</span>  <span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">28</span> <span style="color: #66d9ef;font-weight: bold">START</span> <span style="color: #f8f8f2;background-color: #49483e">seed</span> <span style="color: #f8f8f2;background-color: #49483e">file</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #f8f8f2;background-color: #49483e">.....................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">RUN</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">22</span>  <span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">28</span> <span style="color: #f8f8f2;background-color: #49483e">OK</span> <span style="color: #f8f8f2;background-color: #49483e">loaded</span> <span style="color: #f8f8f2;background-color: #49483e">seed</span> <span style="color: #f8f8f2;background-color: #49483e">file</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #f8f8f2;background-color: #49483e">.................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #66d9ef;font-weight: bold">INSERT</span> <span style="color: #ae81ff">100</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">14</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">22</span>  <span style="color: #ae81ff">2</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">28</span> <span style="color: #66d9ef;font-weight: bold">START</span> <span style="color: #f8f8f2;background-color: #49483e">seed</span> <span style="color: #f8f8f2;background-color: #49483e">file</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">raw_orders</span> <span style="color: #f8f8f2;background-color: #49483e">........................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">RUN</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>  <span style="color: #ae81ff">2</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">28</span> <span style="color: #f8f8f2;background-color: #49483e">OK</span> <span style="color: #f8f8f2;background-color: #49483e">loaded</span> <span style="color: #f8f8f2;background-color: #49483e">seed</span> <span style="color: #f8f8f2;background-color: #49483e">file</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">raw_orders</span> <span style="color: #f8f8f2;background-color: #49483e">....................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #66d9ef;font-weight: bold">INSERT</span> <span style="color: #ae81ff">99</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">04</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>  <span style="color: #ae81ff">3</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">28</span> <span style="color: #66d9ef;font-weight: bold">START</span> <span style="color: #f8f8f2;background-color: #49483e">seed</span> <span style="color: #f8f8f2;background-color: #49483e">file</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">raw_payments</span> <span style="color: #f8f8f2;background-color: #49483e">......................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">RUN</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>  <span style="color: #ae81ff">3</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">28</span> <span style="color: #f8f8f2;background-color: #49483e">OK</span> <span style="color: #f8f8f2;background-color: #49483e">loaded</span> <span style="color: #f8f8f2;background-color: #49483e">seed</span> <span style="color: #f8f8f2;background-color: #49483e">file</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">raw_payments</span> <span style="color: #f8f8f2;background-color: #49483e">..................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #66d9ef;font-weight: bold">INSERT</span> <span style="color: #ae81ff">113</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">04</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>  <span style="color: #ae81ff">4</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">28</span> <span style="color: #66d9ef;font-weight: bold">START</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2;background-color: #49483e">model</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">stg_customers</span> <span style="color: #f8f8f2;background-color: #49483e">....................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">RUN</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>  <span style="color: #ae81ff">28</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">28</span> <span style="color: #66d9ef;font-weight: bold">START</span> <span style="color: #f8f8f2;background-color: #49483e">test</span> <span style="color: #f8f8f2;background-color: #49483e">unique_orders_order_id</span> <span style="color: #f8f8f2;background-color: #49483e">.....................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">RUN</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>  <span style="color: #ae81ff">28</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">28</span> <span style="color: #f8f8f2;background-color: #49483e">PASS</span> <span style="color: #f8f8f2;background-color: #49483e">unique_orders_order_id</span> <span style="color: #f8f8f2;background-color: #49483e">...........................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">PASS</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">03</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>  <span style="color: #f8f8f2;background-color: #49483e">Finished</span> <span style="color: #f8f8f2;background-color: #49483e">running</span> <span style="color: #ae81ff">3</span> <span style="color: #f8f8f2;background-color: #49483e">seeds</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">3</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2;background-color: #49483e">models</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">20</span> <span style="color: #f8f8f2;background-color: #49483e">tests</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">2</span> <span style="color: #66d9ef;font-weight: bold">table</span> <span style="color: #f8f8f2;background-color: #49483e">models</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">.</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>  <span style="color: #f8f8f2;background-color: #49483e">Completed</span> <span style="color: #f8f8f2;background-color: #49483e">successfully</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">23</span>  <span style="color: #f8f8f2;background-color: #49483e">Done</span><span style="color: #f8f8f2;background-color: #49483e">.</span> <span style="color: #f8f8f2;background-color: #49483e">PASS</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">28</span> <span style="color: #f8f8f2;background-color: #49483e">WARN</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">ERROR</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">SKIP</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">TOTAL</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">28</span>
<span style="color: #ae81ff">16</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">29</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">34</span>  <span style="color: #f8f8f2;background-color: #49483e">Error</span> <span style="color: #f8f8f2;background-color: #49483e">sending</span> <span style="color: #f8f8f2;background-color: #49483e">message</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">disabling</span> <span style="color: #f8f8f2;background-color: #49483e">tracking</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thatâ€™s a lot of things itâ€™s just done, with the resulting data loaded into DuckDB. The path of the database file is set in the <code>profiles.yml</code> dbt configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml">  <span style="color: #a6e22e">outputs</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">dev</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #a6e22e">type</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">duckdb</span>
      <span style="color: #a6e22e">path</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#39;</span><span style="color: #e6db74">jaffle_shop.duckdb&#39;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we check in DuckDB we can see thereâ€™s data been loaded and transformed in various forms - magic!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #960050;background-color: #1e0010">\</span><span style="color: #f8f8f2;background-color: #49483e">dt</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">name</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span>     <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">orders</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_orders</span>    <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_payments</span>  <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">stg_customers</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">stg_orders</span>    <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">stg_payments</span>  <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">020</span><span style="color: #f8f8f2;background-color: #49483e">s</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The source of the data is the CSV &#39;seed&#39; data in <code>/seed</code> - the demoâ€™s author notes that this is not an idiomatic way to work with dbt and typically the data will already be in the database.</p>
</div>
<div class="paragraph">
<p>As a side note - make sure to check out <a href="https://github.com/dbcli/duckcli">duckcli</a>, which gives DuckDB one of the most beautiful interactive CLI tools out of the box for any database that Iâ€™ve used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2022/10/SCR-20221002-ocy.png" alt="DuckDB CLI"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_by_step">Step-by-Step&nbsp;<a class="headline-hash" href="#_step_by_step">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whilst the README says very clearly :</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>What this repo is not:
A tutorial</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Iâ€™m still wanting to use it to understand a bit about dbt (and DuckDB), so Iâ€™m going to <a href="https://github.com/dbt-labs/jaffle_shop_duckdb/blob/duckdb/README.md#running-build-steps-independently">run each step at a time</a> to understand a bit more about what dbt is and what it does. The collection of steps here is what <a href="https://docs.getdbt.com/reference/commands/build"><code>dbt build</code></a> executes automagically for you.</p>
</div>
<div class="paragraph">
<p>To start with Iâ€™ll delete the DuckDB database that was created above, and then create a new one (since it doesnâ€™t exist when I launch the CLI itâ€™ll get created).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">rm </span>jaffle_shop.duckdb
<span style="color: #f8f8f2">$ </span>duckcli jaffle_shop.duckdb
Version: 0.0.1
GitHub: https://github.com/dbcli/duckcli
jaffle_shop.duckdb&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Confirm that itâ€™s empty:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #960050;background-color: #1e0010">\</span><span style="color: #f8f8f2;background-color: #49483e">dt</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">006</span><span style="color: #f8f8f2;background-color: #49483e">s</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_dbt_seed"><code>dbt seed</code>&nbsp;<a class="headline-hash" href="#_dbt_seed">ðŸ”—</a> </h3>
<div class="paragraph">
<p>Letâ€™s do the first bit of the processing (as shown in the <code>build</code> output above), which is going to be loading the sample data (&#39;seed&#39; data). Iâ€™m not 100% sure of the definition of a <strong>model</strong> at this point but Iâ€™m going to guess itâ€™s the CSV files.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The docs are rather good. Instead of just guessing I could look up <a href="https://docs.getdbt.com/reference/commands/seed"><code>dbt seed</code></a> and see that it says:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The <code>dbt seed</code> command will load <code>csv</code> files located in the <code>seed-paths</code> directory of your dbt project into your data warehouse.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><code>seed-paths</code> is defined in <code>./dbt_project.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #a6e22e">seed-paths</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #e6db74">&#34;</span><span style="color: #e6db74">seeds&#34;</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The help text says you can use <code>--models</code> to specify one or more models. There are three seed files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">ls</span> <span style="color: #f92672">-l</span> seeds
total 24
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  1302 27 Sep 21:33 raw_customers.csv
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  2723 27 Sep 21:33 raw_orders.csv
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  2560 27 Sep 21:33 raw_payments.csv</code></pre>
</div>
</div>
<div class="paragraph">
<p>So lets take one of the CSV filenames and use that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt seed <span style="color: #f92672">--models</span> raw_customers
16:59:27  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
16:59:28  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
16:59:28
16:59:28  Concurrency: 1 threads <span style="color: #f92672;font-weight: bold">(</span><span style="color: #f8f8f2">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f92672;font-weight: bold">)</span>
16:59:28
16:59:28  1 of 1 START seed file main.raw_customers ...................................... <span style="color: #f92672;font-weight: bold">[</span>RUN]
16:59:28  1 of 1 OK loaded seed file main.raw_customers .................................. <span style="color: #f92672;font-weight: bold">[</span>INSERT 100 <span style="color: #66d9ef;font-weight: bold">in </span>0.08s]
16:59:28
16:59:28  Finished running 1 seed <span style="color: #66d9ef;font-weight: bold">in </span>0.17s.
16:59:28
16:59:28  Completed successfully
16:59:28
16:59:28  Done. <span style="color: #f8f8f2">PASS</span><span style="color: #f92672;font-weight: bold">=</span>1 <span style="color: #f8f8f2">WARN</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">ERROR</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">SKIP</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">TOTAL</span><span style="color: #f92672;font-weight: bold">=</span>1
16:59:28  Error sending message, disabling tracking</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>INSERT 100</code>. Iâ€™m guessing this is what it says on the tin - that itâ€™s inserted 100 rows. Letâ€™s check DuckDB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #960050;background-color: #1e0010">\</span><span style="color: #f8f8f2;background-color: #49483e">dt</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">name</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">018</span><span style="color: #f8f8f2;background-color: #49483e">s</span>
<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #66d9ef;font-weight: bold">count</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">count_star</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">100</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">007</span><span style="color: #f8f8f2;background-color: #49483e">s</span>
<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The tableâ€™s been created by dbt, but Iâ€™m not sure using what schema definition. Hereâ€™s how it looks in DuckDB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----+------------+---------+---------+------------+-------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">cid</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">name</span>       <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">type</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">notnull</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">dflt_value</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">pk</span>    <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----+------------+---------+---------+------------+-------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">0</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">id</span>         <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2">INTEGER</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">first_name</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2">VARCHAR</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2">VARCHAR</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----+------------+---------+---------+------------+-------+</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Perhaps it just takes a best guess from the CSV file - the fields all being nullable would make sense, and the field names match the CSV header</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">head</span> <span style="color: #f92672">-n1</span> seeds/raw_customers.csv
<span style="color: #f8f8f2">id</span>,first_name,last_name</code></pre>
</div>
</div>
<div class="paragraph">
<p>I wonder if dbt will overwrite the data thatâ€™s there if you re-run the <code>seed</code> step. Letâ€™s muck about with the data and see what happens.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">update</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #66d9ef;font-weight: bold">set</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;Astley&#39;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">Count</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">100</span>   <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">012</span><span style="color: #f8f8f2;background-color: #49483e">s</span>

<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #66d9ef;font-weight: bold">count</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #66d9ef;font-weight: bold">group</span> <span style="color: #66d9ef;font-weight: bold">by</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----------+--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">count_star</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----------+--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Astley</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">100</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----------+--------------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">011</span><span style="color: #f8f8f2;background-color: #49483e">s</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Re-run the seed step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt seed <span style="color: #f92672">--models</span> raw_customers
17:06:50  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
17:06:50  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
17:06:50
17:06:50  Concurrency: 1 threads <span style="color: #f92672;font-weight: bold">(</span><span style="color: #f8f8f2">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f92672;font-weight: bold">)</span>
17:06:50
17:06:50  1 of 1 START seed file main.raw_customers ...................................... <span style="color: #f92672;font-weight: bold">[</span>RUN]
17:06:51  1 of 1 OK loaded seed file main.raw_customers .................................. <span style="color: #f92672;font-weight: bold">[</span>INSERT 100 <span style="color: #66d9ef;font-weight: bold">in </span>0.16s]
17:06:51
17:06:51  Finished running 1 seed <span style="color: #66d9ef;font-weight: bold">in </span>0.32s.
17:06:51
17:06:51  Completed successfully
17:06:51
17:06:51  Done. <span style="color: #f8f8f2">PASS</span><span style="color: #f92672;font-weight: bold">=</span>1 <span style="color: #f8f8f2">WARN</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">ERROR</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">SKIP</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">TOTAL</span><span style="color: #f92672;font-weight: bold">=</span>1
17:06:51  Error sending message, disabling tracking</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check the data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #66d9ef;font-weight: bold">count</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #66d9ef;font-weight: bold">group</span> <span style="color: #66d9ef;font-weight: bold">by</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----------+--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">count_star</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----------+--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Astley</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">100</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----------+--------------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">011</span><span style="color: #f8f8f2;background-color: #49483e">s</span>
<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So it looks like itâ€™s not changed. BUTâ€¦if we re-launch the DuckDB CLI youâ€™ll see something different:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span>
<span style="color: #f8f8f2;background-color: #49483e">Goodbye</span><span style="color: #f92672;font-weight: bold">!</span>
<span style="color: #960050;background-color: #1e0010">$</span> <span style="color: #f8f8f2;background-color: #49483e">duckcli</span> <span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span>
<span style="color: #66d9ef;font-weight: bold">Version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">1</span>
<span style="color: #f8f8f2;background-color: #49483e">GitHub</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">https</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f92672;font-weight: bold">//</span><span style="color: #f8f8f2;background-color: #49483e">github</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">com</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">dbcli</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">duckcli</span>
<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #66d9ef;font-weight: bold">count</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #66d9ef;font-weight: bold">group</span> <span style="color: #66d9ef;font-weight: bold">by</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----------+--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">count_star</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----------+--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">P</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">7</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">M</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">8</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">C</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">7</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">R</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">13</span>           <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">F</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">5</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">W</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">11</span>           <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">S</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">3</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">D</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">3</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">H</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">11</span>           <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">K</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">4</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">A</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">6</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">G</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">4</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">B</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">5</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">O</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">4</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">T</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">J</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">3</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">N</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">L</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">E</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----------+--------------+</span>
<span style="color: #ae81ff">19</span> <span style="color: #66d9ef;font-weight: bold">rows</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">023</span><span style="color: #f8f8f2;background-color: #49483e">s</span>
<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So, the CLI queries the state of the DuckDB file as it was on launch, perhaps? But for sure, we can say that the <code>dbt seed</code> operation will reset the seed data and fix any changes that have been made.</p>
</div>
<div class="paragraph">
<p>Letâ€™s run the rest of the seed steps (including the one weâ€™ve been changing):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt seed
17:11:30  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
17:11:30  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
17:11:30
17:11:31  Concurrency: 1 threads <span style="color: #f92672;font-weight: bold">(</span><span style="color: #f8f8f2">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f92672;font-weight: bold">)</span>
17:11:31
17:11:31  1 of 3 START seed file main.raw_customers ...................................... <span style="color: #f92672;font-weight: bold">[</span>RUN]
17:11:31  1 of 3 OK loaded seed file main.raw_customers .................................. <span style="color: #f92672;font-weight: bold">[</span>INSERT 100 <span style="color: #66d9ef;font-weight: bold">in </span>0.16s]
17:11:31  2 of 3 START seed file main.raw_orders ......................................... <span style="color: #f92672;font-weight: bold">[</span>RUN]
17:11:31  2 of 3 OK loaded seed file main.raw_orders ..................................... <span style="color: #f92672;font-weight: bold">[</span>INSERT 99 <span style="color: #66d9ef;font-weight: bold">in </span>0.08s]
17:11:31  3 of 3 START seed file main.raw_payments ....................................... <span style="color: #f92672;font-weight: bold">[</span>RUN]
17:11:31  3 of 3 OK loaded seed file main.raw_payments ................................... <span style="color: #f92672;font-weight: bold">[</span>INSERT 113 <span style="color: #66d9ef;font-weight: bold">in </span>0.06s]
17:11:31
17:11:31  Finished running 3 seeds <span style="color: #66d9ef;font-weight: bold">in </span>0.44s.
17:11:31
17:11:31  Completed successfully
17:11:31
17:11:31  Done. <span style="color: #f8f8f2">PASS</span><span style="color: #f92672;font-weight: bold">=</span>3 <span style="color: #f8f8f2">WARN</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">ERROR</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">SKIP</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">TOTAL</span><span style="color: #f92672;font-weight: bold">=</span>3
17:11:31  Error sending message, disabling tracking</code></pre>
</div>
</div>
<div class="paragraph">
<p>Re-launch the DuckDB CLI and observe that the three seed tables now exist and have data in them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #960050;background-color: #1e0010">$</span> <span style="color: #f8f8f2;background-color: #49483e">duckcli</span> <span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span>
<span style="color: #66d9ef;font-weight: bold">Version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">1</span>
<span style="color: #f8f8f2;background-color: #49483e">GitHub</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">https</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f92672;font-weight: bold">//</span><span style="color: #f8f8f2;background-color: #49483e">github</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">com</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">dbcli</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">duckcli</span>
<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #960050;background-color: #1e0010">\</span><span style="color: #f8f8f2;background-color: #49483e">dt</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">name</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_orders</span>    <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_payments</span>  <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">021</span><span style="color: #f8f8f2;background-color: #49483e">s</span>

<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">raw_payments</span> <span style="color: #66d9ef;font-weight: bold">limit</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">----+----------+----------------+--------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">id</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">order_id</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">----+----------+----------------+--------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">credit_card</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1000</span>   <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">----+----------+----------------+--------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">007</span><span style="color: #f8f8f2;background-color: #49483e">s</span>
<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #66d9ef;font-weight: bold">limit</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">----+------------+-----------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">id</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">first_name</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">----+------------+-----------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Michael</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">P</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">----+------------+-----------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">007</span><span style="color: #f8f8f2;background-color: #49483e">s</span>
<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">raw_orders</span> <span style="color: #66d9ef;font-weight: bold">limit</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">----+---------+------------+----------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">id</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">user_id</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">order_date</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">status</span>   <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">----+---------+------------+----------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>       <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2018</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">01</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">01</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">returned</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">----+---------+------------+----------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">067</span><span style="color: #f8f8f2;background-color: #49483e">s</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using DBeaver you can open the DuckDB database and visualise the tables with their FK relationships (I added these; theyâ€™re not defined by default)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2022/10/SCR-20221011-n9u.png" alt="DuckDB ERD"/>
</div>
</div>
<hr/>
<div class="paragraph">
<p>The next bit weâ€™ll poke at, based on the <a href="https://docs.getdbt.com/reference/commands/build"><code>build</code></a> docs is <code>dbt run</code>.</p>
</div>
<div class="paragraph">
<p>But before we quite get to that, <a href="https://docs.getdbt.com/reference/commands/run">the docs</a> for <code>dbt run</code> say in turn:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><code>dbt run</code> executes compiled sql model files against the current <code>target</code> database</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Which makes me think it would be interesting to first check out <a href="https://docs.getdbt.com/reference/commands/compile"><code>dbt compile</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dbt_compile"><code>dbt compile</code>&nbsp;<a class="headline-hash" href="#_dbt_compile">ðŸ”—</a> </h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><code>dbt compile</code> generates executable SQL from source <code>model</code>, <code>test</code>, and <code>analysis</code> files. You can find these compiled SQL files in the <code>target/</code> directory of your dbt project.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>I noted that <code>target/</code> is in the <code>.gitignore</code> so I figure can be deleted (from being created in the  <code>dbt build</code> above) and then observed to see the output in each step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">rm</span> <span style="color: #f92672">-rf</span> target</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whilst there are three source file types described above (<code>model</code>, <code>test</code>, and <code>analysis</code>) I only see <code>/models</code> present (the paths, as before, are defined in <code>dbt_project.yml</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">ls</span> <span style="color: #f92672">-l</span> models tests analysis
<span style="color: #f8f8f2">ls</span>: analysis: No such file or directory
<span style="color: #f8f8f2">ls</span>: tests: No such file or directory
models:
total 40
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  1195 27 Sep 21:33 customers.sql
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  1068 27 Sep 21:33 docs.md
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff   970 27 Sep 21:33 orders.sql
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff   272 27 Sep 21:33 overview.md
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  2311 27 Sep 21:33 schema.yml
drwxr-xr-x  6 rmoff  staff   192 27 Sep 21:33 staging</code></pre>
</div>
</div>
<div class="paragraph">
<p>Letâ€™s compile one of the models. If I take a look at the top of <code>customers.sql</code> itâ€™s clearly referencing something else:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #960050;background-color: #1e0010">$</span> <span style="color: #f8f8f2;background-color: #49483e">head</span> <span style="color: #f8f8f2;background-color: #49483e">models</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #66d9ef;font-weight: bold">sql</span>
<span style="color: #66d9ef;font-weight: bold">with</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>

    <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">{{</span> <span style="color: #66d9ef;font-weight: bold">ref</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;stg_customers&#39;</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #f8f8f2;background-color: #49483e">}}</span>

<span style="color: #f8f8f2;background-color: #49483e">),</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So whereâ€™s <code>stg_customers</code> defined? In <code>models/staging/stg_customers.sql</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">with</span> <span style="color: #66d9ef;font-weight: bold">source</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>

    <span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f92672;font-weight: bold">#-</span>
    <span style="color: #f8f8f2;background-color: #49483e">Normally</span> <span style="color: #f8f8f2;background-color: #49483e">we</span> <span style="color: #f8f8f2;background-color: #49483e">would</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">the</span> <span style="color: #66d9ef;font-weight: bold">table</span> <span style="color: #f8f8f2;background-color: #49483e">here</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">but</span> <span style="color: #f8f8f2;background-color: #49483e">we</span> <span style="color: #66d9ef;font-weight: bold">are</span> <span style="color: #66d9ef;font-weight: bold">using</span> <span style="color: #f8f8f2;background-color: #49483e">seeds</span> <span style="color: #66d9ef;font-weight: bold">to</span> <span style="color: #66d9ef;font-weight: bold">load</span>
    <span style="color: #f8f8f2;background-color: #49483e">our</span> <span style="color: #66d9ef;font-weight: bold">data</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #f8f8f2;background-color: #49483e">this</span> <span style="color: #f8f8f2;background-color: #49483e">project</span>
    <span style="color: #f92672;font-weight: bold">#</span><span style="color: #f8f8f2;background-color: #49483e">}</span>
    <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">{{</span> <span style="color: #66d9ef;font-weight: bold">ref</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;raw_customers&#39;</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #f8f8f2;background-color: #49483e">}}</span>

<span style="color: #f8f8f2;background-color: #49483e">),</span>

<span style="color: #f8f8f2;background-color: #49483e">renamed</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>

    <span style="color: #66d9ef;font-weight: bold">select</span>
        <span style="color: #f8f8f2;background-color: #49483e">id</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">first_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">last_name</span>

    <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #66d9ef;font-weight: bold">source</span>

<span style="color: #f8f8f2;background-color: #49483e">)</span>

<span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">renamed</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So this pulls from the <code>raw_customers</code> that was loaded in the seed step and changes a column name (<code>id</code> to <code>customer_id</code>). Letâ€™s <code>dbt compile</code> it and see what happens.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt compile <span style="color: #f92672">--model</span> models/staging/stg_customers.sql
16:14:53  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
16:14:53  Partial parse save file not found. Starting full parse.
16:14:54  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
16:14:54
16:14:54  Concurrency: 1 threads <span style="color: #f92672;font-weight: bold">(</span><span style="color: #f8f8f2">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f92672;font-weight: bold">)</span>
16:14:54
16:14:54  Done.</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we head over to <code>target/</code> (which we removed before the compile, so whatever we see was created by this step) we see a bunch of new content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">ls</span> <span style="color: #f92672">-lR</span> target
total 984
drwxr-xr-x  3 rmoff  staff      96 11 Oct 17:14 compiled
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff   23490 11 Oct 17:14 graph.gpickle
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  239522 11 Oct 17:14 manifest.json
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  232476 11 Oct 17:14 partial_parse.msgpack
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff    2077 11 Oct 17:14 run_results.json

target/compiled:
total 0
drwxr-xr-x  3 rmoff  staff  96 11 Oct 17:14 jaffle_shop

target/compiled/jaffle_shop:
total 0
drwxr-xr-x  3 rmoff  staff  96 11 Oct 17:14 models

target/compiled/jaffle_shop/models:
total 0
drwxr-xr-x  4 rmoff  staff  128 11 Oct 17:14 staging

target/compiled/jaffle_shop/models/staging:
total 8
drwxr-xr-x  4 rmoff  staff  128 11 Oct 17:14 schema.yml
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  202 11 Oct 17:14 stg_customers.sql

target/compiled/jaffle_shop/models/staging/schema.yml:
total 16
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff   96 11 Oct 17:14 not_null_stg_customers_customer_id.sql
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  187 11 Oct 17:14 unique_stg_customers_customer_id.sql</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we look at the compiled version of the <code>compiled/jaffle_shop/models/staging/stg_customers.sql</code> model that we saw above youâ€™ll see the reference is now resolved, with the rest of the file remaining the same:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">with</span> <span style="color: #66d9ef;font-weight: bold">source</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
    <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2">&#34;main&#34;</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2">&#34;main&#34;</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2">&#34;raw_customers&#34;</span>

<span style="color: #f8f8f2;background-color: #49483e">),</span>

<span style="color: #f8f8f2;background-color: #49483e">renamed</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>

    <span style="color: #66d9ef;font-weight: bold">select</span>
        <span style="color: #f8f8f2;background-color: #49483e">id</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">first_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">last_name</span>

    <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #66d9ef;font-weight: bold">source</span>

<span style="color: #f8f8f2;background-color: #49483e">)</span>

<span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">renamed</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another SQL file that youâ€™ll notice has appeared is under <code>target/compiled/jaffle_shop/models/staging/schema.yml</code> (yes itâ€™s a folder, even if its got a <code>.yml</code> extension, welcome to UNIX):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">ls</span> <span style="color: #f92672">-lR</span> target/compiled/jaffle_shop/models/staging/schema.yml
total 16
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff   96 11 Oct 17:14 not_null_stg_customers_customer_id.sql
<span style="color: #f92672">-rw-r--r--</span>  1 rmoff  staff  187 11 Oct 17:14 unique_stg_customers_customer_id.sql</code></pre>
</div>
</div>
<div class="paragraph">
<p>These two SQL files look like theyâ€™re to check two different constraints (NOT NULL and uniqueness):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #960050;background-color: #1e0010">$</span> <span style="color: #f8f8f2;background-color: #49483e">head</span> <span style="color: #f8f8f2;background-color: #49483e">target</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">compiled</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">models</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">staging</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #66d9ef;font-weight: bold">schema</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">yml</span><span style="color: #75715e;font-style: italic">/*
==&gt; target/compiled/jaffle_shop/models/staging/schema.yml/not_null_stg_customers_customer_id.sql &lt;==

select customer_id
from &#34;main&#34;.&#34;main&#34;.&#34;stg_customers&#34;
where customer_id is null

==&gt; target/compiled/jaffle_shop/models/staging/schema.yml/unique_stg_customers_customer_id.sql &lt;==

select
    customer_id as unique_field,
    count(*) as n_records

from &#34;main&#34;.&#34;main&#34;.&#34;stg_customers&#34;
where customer_id is not null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>But where are these constraints defined? Itâ€™s not in the <code>staging/stg_customers.sql</code> because we saw that above and there was no DDL there. Instead the clue is in the name of the folder - <code>staging/schema.yml</code>. If we head back to the <code>models</code> folder and look at <code>staging/schema.yml</code> weâ€™ll see the constraints defined in YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #e6db74">$ cat models/staging/schema.yml</span>
<span style="color: #a6e22e">version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">2</span>

<span style="color: #a6e22e">models</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">stg_customers</span>
    <span style="color: #a6e22e">columns</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">customer_id</span>
        <span style="color: #a6e22e">tests</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
          <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #e6db74">unique</span>
          <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #e6db74">not_null</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So this is starting to come together (<em>it would still be easier to learn if I just read the docs instead of reverse engineering this stuffâ€¦but thatâ€™s how I learn by poking things and see what yelps ðŸ¤·â€â™‚ï¸</em>): the <code>schema.yml</code> defines the names of the objects in a schema folder (my assumption is that <code>staging</code> is seen as a schema, and the parent folder under <code>models</code> another schema), and then the <code>.sql</code> files in that folder define the objects themselves and their derivations from their source. The source is referenced and resolved and compilation time.</p>
</div>
<div class="paragraph">
<p>The only other files under <code>target/</code> at this point look like runtime info, metadata, and other such stuff. For example, hereâ€™s <code>run_results.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #f8f8f2;background-color: #49483e">$</span> <span style="color: #f8f8f2;background-color: #49483e">jq</span> <span style="color: #e6db74">&#39;</span><span style="color: #e6db74">.</span><span style="color: #e6db74">&#39;</span> <span style="color: #f8f8f2;background-color: #49483e">target</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">run_results</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">json</span>
<span style="color: #f8f8f2;background-color: #49483e">{</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">metadata</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">dbt_schema_version</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">https://schemas.getdbt.com/dbt/run-results/v4.json</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">dbt_version</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">1.1.1</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">generated_at</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">2022-10-11T16:14:54.519780Z</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">invocation_id</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">3363ffe7-90aa-4fc1-9a4b-306b180414b8</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
    <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">env</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{}</span>
  <span style="color: #f8f8f2;background-color: #49483e">},</span>
  <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">results</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
    <span style="color: #f8f8f2;background-color: #49483e">{</span>
      <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">status</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">success</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
      <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">timing</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">[</span>
        <span style="color: #f8f8f2;background-color: #49483e">{</span>
          <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">name</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">compile</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
          <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">started_at</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">2022-10-11T16:14:54.419911Z</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
          <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">completed_at</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">2022-10-11T16:14:54.423616Z</span><span style="color: #e6db74">&#34;</span>
        <span style="color: #f8f8f2;background-color: #49483e">},</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dbt_run"><code>dbt run</code>&nbsp;<a class="headline-hash" href="#_dbt_run">ðŸ”—</a> </h3>
<div class="paragraph">
<p>Having poked around what goes on during compilation, letâ€™s look at <a href="https://docs.getdbt.com/reference/commands/run"><code>dbt run</code></a>. Before I do that Iâ€™ll just double-check the state of the database first:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>duckdb jaffle_shop.duckdb <span style="color: #f92672">-c</span> show
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  table_name   â”‚              column_names              â”‚             column_types             â”‚ temporary â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ raw_customers â”‚ <span style="color: #f92672;font-weight: bold">[</span>first_name, <span style="color: #f8f8f2">id</span>, last_name]            â”‚ <span style="color: #f92672;font-weight: bold">[</span>VARCHAR, INTEGER, VARCHAR]          â”‚ <span style="color: #f8f8f2">false</span>     â”‚
â”‚ raw_orders    â”‚ <span style="color: #f92672;font-weight: bold">[</span><span style="color: #f8f8f2">id</span>, order_date, status, user_id]      â”‚ <span style="color: #f92672;font-weight: bold">[</span>INTEGER, DATE, VARCHAR, INTEGER]    â”‚ <span style="color: #f8f8f2">false</span>     â”‚
â”‚ raw_payments  â”‚ <span style="color: #f92672;font-weight: bold">[</span>amount, <span style="color: #f8f8f2">id</span>, order_id, payment_method] â”‚ <span style="color: #f92672;font-weight: bold">[</span>INTEGER, INTEGER, INTEGER, VARCHAR] â”‚ <span style="color: #f8f8f2">false</span>     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only the seed tables are there, as weâ€™d expect (from the <code>dbt seed</code> step; the <code>dbt compile</code> doesnâ€™t execute any data movement). Now we <code>run</code> - Iâ€™m going to run it just for one of the models (<code>customers</code>) to start with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash">dbt run <span style="color: #f92672">--models</span> raw_customers</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response to doing something daft (running the <code>raw_customers</code> model, instead of <code>customers</code>) is pleasingly forgiving (<code>[WARNING]: Nothing to do</code>) and informative (<code>Try checking your model configs and model specification args</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt run <span style="color: #f92672">--models</span> raw_customers
09:39:14  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
09:39:14  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
09:39:14
09:39:14  <span style="color: #f92672;font-weight: bold">[</span>WARNING]: Nothing to <span style="color: #66d9ef;font-weight: bold">do</span><span style="color: #f8f8f2">.</span> Try checking your model configs and model specification args</code></pre>
</div>
</div>
<div class="paragraph">
<p>Letâ€™s try the correct one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt run <span style="color: #f92672">--models</span> customers
09:40:59  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
09:41:00  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
09:41:00
09:41:00  Concurrency: 1 threads <span style="color: #f92672;font-weight: bold">(</span><span style="color: #f8f8f2">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f92672;font-weight: bold">)</span>
09:41:00
09:41:00  1 of 1 START table model main.customers ........................................ <span style="color: #f92672;font-weight: bold">[</span>RUN]
09:41:00  1 of 1 ERROR creating table model main.customers ............................... <span style="color: #f92672;font-weight: bold">[</span>ERROR <span style="color: #66d9ef;font-weight: bold">in </span>0.05s]
09:41:00
09:41:00  Finished running 1 table model <span style="color: #66d9ef;font-weight: bold">in </span>0.18s.
09:41:00
09:41:00  Completed with 1 error and 0 warnings:
09:41:00
09:41:00  Runtime Error <span style="color: #66d9ef;font-weight: bold">in </span>model customers <span style="color: #f92672;font-weight: bold">(</span>models/customers.sql<span style="color: #f92672;font-weight: bold">)</span>
09:41:00    Catalog Error: Table with name stg_customers does not exist!
09:41:00    Did you mean <span style="color: #e6db74">&#34;raw_customers&#34;</span>?
09:41:00
09:41:00  Done. <span style="color: #f8f8f2">PASS</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">WARN</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">ERROR</span><span style="color: #f92672;font-weight: bold">=</span>1 <span style="color: #f8f8f2">SKIP</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">TOTAL</span><span style="color: #f92672;font-weight: bold">=</span>1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Agh, still not quite there. Thereâ€™s probably a reason the docs exist.</p>
</div>
<div class="paragraph">
<p><code>Table with name stg_customers does not exist</code> tells us that <code>stg_customers</code> is needed first, so letâ€™s cross our fingers for third-time-lucky:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt run <span style="color: #f92672">--models</span> stg_customers
09:49:04  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
09:49:04  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
09:49:04
09:49:04  Concurrency: 1 threads <span style="color: #f92672;font-weight: bold">(</span><span style="color: #f8f8f2">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f92672;font-weight: bold">)</span>
09:49:04
09:49:04  1 of 1 START view model main.stg_customers ..................................... <span style="color: #f92672;font-weight: bold">[</span>RUN]
09:49:04  1 of 1 OK created view model main.stg_customers ................................ <span style="color: #f92672;font-weight: bold">[</span>OK <span style="color: #66d9ef;font-weight: bold">in </span>0.07s]
09:49:04
09:49:04  Finished running 1 view model <span style="color: #66d9ef;font-weight: bold">in </span>0.18s.
09:49:04
09:49:04  Completed successfully
09:49:04
09:49:04  Done. <span style="color: #f8f8f2">PASS</span><span style="color: #f92672;font-weight: bold">=</span>1 <span style="color: #f8f8f2">WARN</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">ERROR</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">SKIP</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">TOTAL</span><span style="color: #f92672;font-weight: bold">=</span>1</code></pre>
</div>
</div>
<div class="paragraph">
<p>ðŸŽ‰ðŸŽ‰</p>
</div>
<div class="paragraph">
<p>Itâ€™s almost like flailing around without reading the docs can be productive ðŸ¤”</p>
</div>
<div class="paragraph">
<p>If we look at whatâ€™s changed in the local folder we can see a few interesting things:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>find <span style="color: #f8f8f2">.</span> <span style="color: #f92672">-mtime</span> <span style="color: #f92672">-5m</span> <span style="color: #f92672">-print</span>
<span style="color: #f8f8f2">.</span>
./target/graph.gpickle
./target/compiled/jaffle_shop/models/staging/stg_customers.sql
./target/run_results.json
./target/manifest.json
./target/run/jaffle_shop/models
./target/run/jaffle_shop/models/staging
./target/run/jaffle_shop/models/staging/stg_customers.sql
./jaffle_shop.duckdb.wal
./jaffle_shop.duckdb
./logs/dbt.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thereâ€™s the same <code>./target/compiled/jaffle_shop/models/staging/stg_customers.sql</code> which we saw above when we ran <code>dbt compile</code>â€‰â€”â€‰although its timestamp shows that it was updated when we just ran <code>dbt run</code>. Alongside this <code>./target/compiled</code> file there a <code>./target/run</code> of the same name</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #960050;background-color: #1e0010">$</span> <span style="color: #f8f8f2;background-color: #49483e">cat</span> <span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">target</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">run</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">models</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">staging</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">stg_customers</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #66d9ef;font-weight: bold">sql</span>

  <span style="color: #66d9ef;font-weight: bold">create</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2">&#34;main&#34;</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2">&#34;stg_customers__dbt_tmp&#34;</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
    <span style="color: #66d9ef;font-weight: bold">with</span> <span style="color: #66d9ef;font-weight: bold">source</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
    <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2">&#34;main&#34;</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2">&#34;main&#34;</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2">&#34;raw_customers&#34;</span>

<span style="color: #f8f8f2;background-color: #49483e">),</span>

<span style="color: #f8f8f2;background-color: #49483e">renamed</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>

    <span style="color: #66d9ef;font-weight: bold">select</span>
        <span style="color: #f8f8f2;background-color: #49483e">id</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">first_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">last_name</span>

    <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #66d9ef;font-weight: bold">source</span>

<span style="color: #f8f8f2;background-color: #49483e">)</span>

<span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">renamed</span>
  <span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Youâ€™ll notice here that weâ€™ve actually got some DML: <code>create view â€¦ as</code>. Other than that, the <code>run</code> version of the SQL is the same as the <code>compile</code> version. If we head over to DuckDB we can see thereâ€™s now a view which performs the described transformation (rename <code>id</code> to <code>customer_id</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #66d9ef;font-weight: bold">table_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">table_type</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">information_schema</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">tables</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">table_name</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">table_type</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_payments</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_orders</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">stg_customers</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">VIEW</span>       <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+------------+</span>
<span style="color: #ae81ff">4</span> <span style="color: #66d9ef;font-weight: bold">rows</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>

<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f8f8f2;background-color: #49483e">definition</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">pg_views</span> <span style="color: #66d9ef;font-weight: bold">where</span> <span style="color: #f8f8f2;background-color: #49483e">viewname</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;stg_customers&#39;</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">definition</span>                                                                                                                                      <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #75715e;font-style: italic">/* {&#34;app&#34;: &#34;dbt&#34;, &#34;dbt_version&#34;: &#34;1.1.1&#34;, &#34;profile_name&#34;: &#34;jaffle_shop&#34;, &#34;target_name&#34;: &#34;dev&#34;, &#34;node_id&#34;: &#34;model.jaffle_shop.stg_customers&#34;} */</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>   <span style="color: #66d9ef;font-weight: bold">create</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2">&#34;main&#34;</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2">&#34;stg_customers__dbt_tmp&#34;</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>                                                                                              <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>     <span style="color: #66d9ef;font-weight: bold">with</span> <span style="color: #66d9ef;font-weight: bold">source</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>                                                                                                                            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>     <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2">&#34;main&#34;</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2">&#34;main&#34;</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2">&#34;raw_customers&#34;</span>                                                                                                 <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">),</span>                                                                                                                                              <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">renamed</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>                                                                                                                                    <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>     <span style="color: #66d9ef;font-weight: bold">select</span>                                                                                                                                      <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>         <span style="color: #f8f8f2;background-color: #49483e">id</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span>                                                                                                                      <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>         <span style="color: #f8f8f2;background-color: #49483e">first_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span>                                                                                                                             <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>         <span style="color: #f8f8f2;background-color: #49483e">last_name</span>                                                                                                                               <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>     <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #66d9ef;font-weight: bold">source</span>                                                                                                                                 <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">)</span>                                                                                                                                               <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">renamed</span>                                                                                                                           <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>   <span style="color: #f8f8f2;background-color: #49483e">);</span>                                                                                                                                            <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">;</span>                                                                                                                                               <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------------------------------------------------------------------------------------------------------------------------------------------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">012</span><span style="color: #f8f8f2;background-color: #49483e">s</span>

<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">first_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">stg_customers</span> <span style="color: #66d9ef;font-weight: bold">using</span> <span style="color: #f8f8f2;background-color: #49483e">sample</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+------------+-----------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">first_name</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+------------+-----------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">84</span>          <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Christina</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">R</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+------------+-----------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">016</span><span style="color: #f8f8f2;background-color: #49483e">s</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Iâ€™ll run the other two staging tables which will also create views. The <code>stg_orders</code> is the same as customers with just a change to the <code>id</code> field name. <code>stg_payments</code> also applies a transform to a currency field in the data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql">    <span style="color: #66d9ef;font-weight: bold">select</span>
        <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
        <span style="color: #75715e;font-style: italic">-- `amount` is currently stored in cents, so we convert it to dollars</span>
        <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #f92672;font-weight: bold">/</span> <span style="color: #ae81ff">100</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span>
        <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whereas before I used the name of the model, <a href="https://docs.getdbt.com/reference/node-selection/syntax#examples">per the docs</a> you can also specify a folder of models (<code>--models staging</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>--models</code> is deprecated in favour of <code>--select</code>
</td>
</tr>
</tbody></table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">dbt</span> <span style="color: #f8f8f2;background-color: #49483e">run</span> <span style="color: #75715e;font-style: italic">--models staging</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #f8f8f2;background-color: #49483e">Running</span> <span style="color: #66d9ef;font-weight: bold">with</span> <span style="color: #f8f8f2;background-color: #49483e">dbt</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">1</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #66d9ef;font-weight: bold">Found</span> <span style="color: #ae81ff">5</span> <span style="color: #f8f8f2;background-color: #49483e">models</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">20</span> <span style="color: #f8f8f2;background-color: #49483e">tests</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">snapshots</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">analyses</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">167</span> <span style="color: #f8f8f2;background-color: #49483e">macros</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">operations</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">3</span> <span style="color: #f8f8f2;background-color: #49483e">seed</span> <span style="color: #f8f8f2;background-color: #49483e">files</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">sources</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">exposures</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">metrics</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #f8f8f2;background-color: #49483e">Concurrency</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">1</span> <span style="color: #f8f8f2;background-color: #49483e">threads</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">3</span> <span style="color: #66d9ef;font-weight: bold">START</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2;background-color: #49483e">model</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">stg_customers</span> <span style="color: #f8f8f2;background-color: #49483e">.....................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">RUN</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">3</span> <span style="color: #f8f8f2;background-color: #49483e">OK</span> <span style="color: #f8f8f2;background-color: #49483e">created</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2;background-color: #49483e">model</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">stg_customers</span> <span style="color: #f8f8f2;background-color: #49483e">................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">OK</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">09</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #ae81ff">2</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">3</span> <span style="color: #66d9ef;font-weight: bold">START</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2;background-color: #49483e">model</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">stg_orders</span> <span style="color: #f8f8f2;background-color: #49483e">........................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">RUN</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #ae81ff">2</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">3</span> <span style="color: #f8f8f2;background-color: #49483e">OK</span> <span style="color: #f8f8f2;background-color: #49483e">created</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2;background-color: #49483e">model</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">stg_orders</span> <span style="color: #f8f8f2;background-color: #49483e">...................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">OK</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">04</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #ae81ff">3</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">3</span> <span style="color: #66d9ef;font-weight: bold">START</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2;background-color: #49483e">model</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">stg_payments</span> <span style="color: #f8f8f2;background-color: #49483e">......................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">RUN</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #ae81ff">3</span> <span style="color: #66d9ef;font-weight: bold">of</span> <span style="color: #ae81ff">3</span> <span style="color: #f8f8f2;background-color: #49483e">OK</span> <span style="color: #f8f8f2;background-color: #49483e">created</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2;background-color: #49483e">model</span> <span style="color: #f8f8f2;background-color: #49483e">main</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">stg_payments</span> <span style="color: #f8f8f2;background-color: #49483e">.................................</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2;background-color: #49483e">OK</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">06</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #f8f8f2;background-color: #49483e">Finished</span> <span style="color: #f8f8f2;background-color: #49483e">running</span> <span style="color: #ae81ff">3</span> <span style="color: #66d9ef;font-weight: bold">view</span> <span style="color: #f8f8f2;background-color: #49483e">models</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">30</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">.</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #f8f8f2;background-color: #49483e">Completed</span> <span style="color: #f8f8f2;background-color: #49483e">successfully</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>
<span style="color: #ae81ff">10</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">48</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #ae81ff">11</span>  <span style="color: #f8f8f2;background-color: #49483e">Done</span><span style="color: #f8f8f2;background-color: #49483e">.</span> <span style="color: #f8f8f2;background-color: #49483e">PASS</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">3</span> <span style="color: #f8f8f2;background-color: #49483e">WARN</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">ERROR</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">SKIP</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">0</span> <span style="color: #f8f8f2;background-color: #49483e">TOTAL</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #ae81ff">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now weâ€™ve got three views in DuckDB representing the staging models over the raw seed data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #960050;background-color: #1e0010">$</span> <span style="color: #f8f8f2;background-color: #49483e">duckdb</span> <span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span> <span style="color: #f92672;font-weight: bold">-</span><span style="color: #66d9ef;font-weight: bold">c</span> <span style="color: #f8f8f2">&#34;select table_name, table_type from information_schema.tables;&#34;</span>
<span style="color: #960050;background-color: #1e0010">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span style="color: #960050;background-color: #1e0010">â”‚</span>  <span style="color: #66d9ef;font-weight: bold">table_name</span>   <span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">table_type</span> <span style="color: #960050;background-color: #1e0010">â”‚</span>
<span style="color: #960050;background-color: #1e0010">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">raw_payments</span>  <span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #960050;background-color: #1e0010">â”‚</span>
<span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #960050;background-color: #1e0010">â”‚</span>
<span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">raw_orders</span>    <span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #960050;background-color: #1e0010">â”‚</span>
<span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">stg_orders</span>    <span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #66d9ef;font-weight: bold">VIEW</span>       <span style="color: #960050;background-color: #1e0010">â”‚</span>
<span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">stg_customers</span> <span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #66d9ef;font-weight: bold">VIEW</span>       <span style="color: #960050;background-color: #1e0010">â”‚</span>
<span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #f8f8f2;background-color: #49483e">stg_payments</span>  <span style="color: #960050;background-color: #1e0010">â”‚</span> <span style="color: #66d9ef;font-weight: bold">VIEW</span>       <span style="color: #960050;background-color: #1e0010">â”‚</span>
<span style="color: #960050;background-color: #1e0010">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So thatâ€™s staging run. dbt creates views here because thatâ€™s the <a href="https://docs.getdbt.com/docs/build/materializations">materialization config</a> thatâ€™s specified in the <code>dbt_project.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
<span style="color: #a6e22e">models</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #a6e22e">materialized</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">table</span>
      <span style="color: #a6e22e">staging</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">materialized</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">view</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Letâ€™s now take a look at the main models that build tables from staging.</p>
</div>
<div class="sect3">
<h4 id="_the_main_models_customers_sql">The Main Models: <code>customers.sql</code>&nbsp;<a class="headline-hash" href="#_the_main_models_customers_sql">ðŸ”—</a> </h4>
<div class="paragraph">
<p>Looking at <a href="https://github.com/dbt-labs/jaffle_shop_duckdb/blob/duckdb/models/customers.sql">this modelâ€™s SQL</a> you can see that calculates several aggregates by customer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From <strong>order data</strong> (earliest &amp; most recent order date, number of orders)</p>
</li>
<li>
<p>From <strong>payment data</strong> (total amount paid)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and builds a table of all customers with order and payment data where it exists (<code>LEFT JOIN</code>).</p>
</div>
<div class="paragraph">
<p>Letâ€™s run it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt run <span style="color: #f92672">--select</span> customers
13:39:39  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
13:39:39  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
13:39:39
13:39:39  Concurrency: 1 threads <span style="color: #f92672;font-weight: bold">(</span><span style="color: #f8f8f2">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f92672;font-weight: bold">)</span>
13:39:39
13:39:39  1 of 1 START table model main.customers ........................................ <span style="color: #f92672;font-weight: bold">[</span>RUN]
13:39:39  1 of 1 OK created table model main.customers ................................... <span style="color: #f92672;font-weight: bold">[</span>OK <span style="color: #66d9ef;font-weight: bold">in </span>0.10s]
13:39:39
13:39:39  Finished running 1 table model <span style="color: #66d9ef;font-weight: bold">in </span>0.31s.
13:39:39
13:39:39  Completed successfully
13:39:39
13:39:39  Done. <span style="color: #f8f8f2">PASS</span><span style="color: #f92672;font-weight: bold">=</span>1 <span style="color: #f8f8f2">WARN</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">ERROR</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">SKIP</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">TOTAL</span><span style="color: #f92672;font-weight: bold">=</span>1</code></pre>
</div>
</div>
<div class="paragraph">
<p>over in DuckDB we have a nice <code>customers</code> table populated for us:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #66d9ef;font-weight: bold">table_name</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">table_type</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">information_schema</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">tables</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">table_name</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">table_type</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_orders</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_customers</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">raw_payments</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">BASE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">stg_payments</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">VIEW</span>       <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">stg_customers</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">VIEW</span>       <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">stg_orders</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">VIEW</span>       <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">---------------+------------+</span>
<span style="color: #ae81ff">7</span> <span style="color: #66d9ef;font-weight: bold">rows</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">019</span><span style="color: #f8f8f2;background-color: #49483e">s</span>

<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">describe</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----+-------------------------+---------+---------+------------+-------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">cid</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">name</span>                    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">type</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">notnull</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">dflt_value</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">pk</span>    <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----+-------------------------+---------+---------+------------+-------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">0</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span>             <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2">INTEGER</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">first_name</span>              <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2">VARCHAR</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span>               <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2">VARCHAR</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">3</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">first_order</span>             <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2">DATE</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">4</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">most_recent_order</span>       <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2">DATE</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">5</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">number_of_orders</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2">BIGINT</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">6</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">customer_lifetime_value</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">HUGEINT</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span>   <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>     <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #66d9ef;font-weight: bold">False</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-----+-------------------------+---------+---------+------------+-------+</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">008</span><span style="color: #f8f8f2;background-color: #49483e">s</span>

<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #f92672;font-weight: bold">*</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span> <span style="color: #66d9ef;font-weight: bold">using</span> <span style="color: #f8f8f2;background-color: #49483e">sample</span> <span style="color: #ae81ff">5</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+------------+-----------+-------------+-------------------+------------------+-------------------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">customer_id</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">first_name</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">last_name</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">first_order</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">most_recent_order</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">number_of_orders</span> <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">customer_lifetime_value</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+------------+-----------+-------------+-------------------+------------------+-------------------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">67</span>          <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Michael</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">H</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>      <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>            <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>           <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f92672;font-weight: bold">&lt;</span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f92672;font-weight: bold">&gt;</span>                  <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">35</span>          <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Sara</span>       <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">T</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2018</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">02</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">21</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2018</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">03</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">21</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2</span>                <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">34</span>                      <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">12</span>          <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Amy</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">D</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2018</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">03</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">03</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2018</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">03</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">03</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>                <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">4</span>                       <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">52</span>          <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Laura</span>      <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">F</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2018</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">03</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">23</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2018</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">03</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">23</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">1</span>                <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">27</span>                      <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">94</span>          <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Gregory</span>    <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">H</span><span style="color: #f8f8f2;background-color: #49483e">.</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2018</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">01</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">04</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2018</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">01</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">29</span>        <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">2</span>                <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">24</span>                      <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">-------------+------------+-----------+-------------+-------------------+------------------+-------------------------+</span>
<span style="color: #ae81ff">5</span> <span style="color: #66d9ef;font-weight: bold">rows</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">012</span><span style="color: #f8f8f2;background-color: #49483e">s</span>

<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span> <span style="color: #66d9ef;font-weight: bold">select</span> <span style="color: #66d9ef;font-weight: bold">count</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">from</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">count_star</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------+</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">100</span>          <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">+</span><span style="color: #75715e;font-style: italic">--------------+</span>
<span style="color: #ae81ff">1</span> <span style="color: #66d9ef;font-weight: bold">row</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #66d9ef;font-weight: bold">set</span>
<span style="color: #f8f8f2">Time</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">009</span><span style="color: #f8f8f2;background-color: #49483e">s</span>
<span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">duckdb</span><span style="color: #f92672;font-weight: bold">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_main_models_orders_sql">The Main Models: <code>orders.sql</code>&nbsp;<a class="headline-hash" href="#_the_main_models_orders_sql">ðŸ”—</a> </h4>
<div class="paragraph">
<p><a href="https://github.com/dbt-labs/jaffle_shop_duckdb/blob/duckdb/models/orders.sql">The orders.sql model</a> is not quite as straight forward. Check out the first line of it</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f92672;font-weight: bold">%</span> <span style="color: #66d9ef;font-weight: bold">set</span> <span style="color: #f8f8f2;background-color: #49483e">payment_methods</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #e6db74">&#39;credit_card&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;coupon&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;bank_transfer&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;gift_card&#39;</span><span style="color: #f8f8f2;background-color: #49483e">]</span> <span style="color: #f92672;font-weight: bold">%</span><span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What SQL-devil magic is this?!</p>
</div>
<div class="tenor-gif-embed" data-postid="16135803" data-share-method="host" data-aspect-ratio="1.25" data-width="100%"><a href="https://tenor.com/view/friends-joey-scared-terrified-horrified-gif-16135803">Friends Joey GIF</a>from <a href="https://tenor.com/search/friends-gifs">Friends GIFs</a></div> <script type="text/javascript" async="" src="https://tenor.com/embed.js"></script>
<div class="paragraph">
<p>Well it turns out that you can super-charge SQL by adding <a href="https://docs.getdbt.com/docs/build/jinja-macros">Jinja</a> to it. <em>Which when you hear it on a podcast sounds exactly like &#39;Ginger&#39; and is really confusing.</em></p>
</div>
<div class="paragraph">
<p>The particular snippet above (<code>payment_methods</code>) is actually used in <a href="https://docs.getdbt.com/docs/build/jinja-macros#jinja">the doc page</a> as an example. It explains that, as seen later in the model, the variable <code>payment_methods</code> can then be iterated over:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f92672;font-weight: bold">%</span> <span style="color: #66d9ef;font-weight: bold">for</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #f8f8f2;background-color: #49483e">payment_methods</span> <span style="color: #f92672;font-weight: bold">%</span><span style="color: #f8f8f2;background-color: #49483e">}</span>
<span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;{{payment_method}}&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">{{</span><span style="color: #f8f8f2;background-color: #49483e">payment_method</span><span style="color: #f8f8f2;background-color: #49483e">}}</span><span style="color: #f8f8f2;background-color: #49483e">_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
<span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f92672;font-weight: bold">%</span> <span style="color: #f8f8f2;background-color: #49483e">endfor</span> <span style="color: #f92672;font-weight: bold">%</span><span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>to generate the desired SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;bank_transfer&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">bank_transfer_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
<span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;credit_card&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">credit_card_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
<span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;gift_card&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">gift_card_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is pretty smart. We <em>could</em> just write the SQL directly itself, but what happens when we start taking cheques and cryptocurrencies for payment? We either end up copy-and-pasting and search &amp; replace on this line twice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;cheque&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">cheque_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
<span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;crypto&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">crypto_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which is fiddly and error prone. In addition if you look further down the modelâ€™s SQL you can see that the variable is used again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f92672;font-weight: bold">%</span> <span style="color: #66d9ef;font-weight: bold">for</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #f8f8f2;background-color: #49483e">payment_methods</span> <span style="color: #f92672;font-weight: bold">-%</span><span style="color: #f8f8f2;background-color: #49483e">}</span>
  <span style="color: #f8f8f2;background-color: #49483e">order_payments</span><span style="color: #f8f8f2;background-color: #49483e">.{{</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f8f8f2;background-color: #49483e">}}</span><span style="color: #f8f8f2;background-color: #49483e">_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
<span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f92672;font-weight: bold">%</span> <span style="color: #f8f8f2;background-color: #49483e">endfor</span> <span style="color: #f92672;font-weight: bold">-%</span><span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So now your chances of making errors is even more so because you need to work out all the places in the SQL has appeared, and no way of telling which fields need replicating without knowing the code logic closely.</p>
</div>
<div class="paragraph">
<p>Alternatively, we just add them once to the nicely obvious and declared enum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f92672;font-weight: bold">%</span> <span style="color: #66d9ef;font-weight: bold">set</span> <span style="color: #f8f8f2;background-color: #49483e">payment_methods</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #e6db74">&#39;cheque&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #e6db74">&#39;crypto&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #e6db74">&#39;credit_card&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;coupon&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;bank_transfer&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;gift_card&#39;</span><span style="color: #f8f8f2;background-color: #49483e">]</span> <span style="color: #f92672;font-weight: bold">%</span><span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Pretty smart huh.</p>
</div>
<div class="tenor-gif-embed" data-postid="16733420" data-share-method="host" data-aspect-ratio="1.40351" data-width="100%"><a href="https://tenor.com/view/thumbs-up-friends-approve-gif-16733420">Thumbs Up Friends GIF</a>from <a href="https://tenor.com/search/thumbs+up-gifs">Thumbs Up GIFs</a></div> <script type="text/javascript" async="" src="https://tenor.com/embed.js"></script>
<div class="paragraph">
<p>This is where <code>dbt compile</code> comes into its own too. It was useful above to understand a bit more about the flow of things, but here itâ€™s going to let us take the model and check how the Jinja will resolve into SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt compile <span style="color: #f92672">--select</span> orders
15:13:58  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
15:13:58  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
15:13:58
15:13:58  Concurrency: 1 threads <span style="color: #f92672;font-weight: bold">(</span><span style="color: #f8f8f2">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f92672;font-weight: bold">)</span>
15:13:58
15:13:58  Done.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #960050;background-color: #1e0010">$</span> <span style="color: #f8f8f2;background-color: #49483e">cat</span> <span style="color: #f8f8f2;background-color: #49483e">target</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">compiled</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">jaffle_shop</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">models</span><span style="color: #f92672;font-weight: bold">/</span><span style="color: #f8f8f2;background-color: #49483e">orders</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #66d9ef;font-weight: bold">sql</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span>

<span style="color: #f8f8f2;background-color: #49483e">order_payments</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>

    <span style="color: #66d9ef;font-weight: bold">select</span>
        <span style="color: #f8f8f2;background-color: #49483e">order_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span>

        <span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;cheque&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #ae81ff">0</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">cheque_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;crypto&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #ae81ff">0</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">crypto_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;credit_card&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #ae81ff">0</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">credit_card_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;coupon&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #ae81ff">0</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">coupon_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;bank_transfer&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #ae81ff">0</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">bank_transfer_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #66d9ef;font-weight: bold">case</span> <span style="color: #66d9ef;font-weight: bold">when</span> <span style="color: #f8f8f2;background-color: #49483e">payment_method</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;gift_card&#39;</span> <span style="color: #66d9ef;font-weight: bold">then</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span> <span style="color: #66d9ef;font-weight: bold">else</span> <span style="color: #ae81ff">0</span> <span style="color: #66d9ef;font-weight: bold">end</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">gift_card_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #66d9ef;font-weight: bold">sum</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">amount</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">total_amount</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span>
    <span style="color: #66d9ef;font-weight: bold">select</span>
        <span style="color: #f8f8f2;background-color: #49483e">orders</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">order_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">orders</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">customer_id</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">orders</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">order_date</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">orders</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">status</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">order_payments</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">cheque_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">order_payments</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">crypto_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">order_payments</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">credit_card_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">order_payments</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">coupon_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">order_payments</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">bank_transfer_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">order_payments</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">gift_card_amount</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
        <span style="color: #f8f8f2;background-color: #49483e">order_payments</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">total_amount</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">amount</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #960050;background-color: #1e0010">â€¦</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thereâ€™s a nice <a href="https://docs.getdbt.com/docs/build/jinja-macros#dbtonic-jinja">note in the docs</a> about a <em>dbtonic</em> approach to the use of Jinja (<em>this is nothing to do with Gin, but a nice nod to the</em> pythonic <em>concept</em>) which is worth a read including strong advice to <del>not be a smartarse</del> <a href="https://docs.getdbt.com/docs/build/jinja-macros#favor-readability-overâ€”â€‹ness">favour readability over DRY-ness</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dbt_run_2"><code>dbt run</code>&nbsp;<a class="headline-hash" href="#_dbt_run_2">ðŸ”—</a> </h3>
<div class="paragraph">
<p>Now that weâ€™ve understood how all of this works, letâ€™s run it all:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>dbt run
15:51:46  Running with <span style="color: #f8f8f2">dbt</span><span style="color: #f92672;font-weight: bold">=</span>1.1.1
15:51:46  Found 5 models, 20 tests, 0 snapshots, 0 analyses, 167 macros, 0 operations, 3 seed files, 0 sources, 0 exposures, 0 metrics
15:51:46
15:51:46  Concurrency: 1 threads <span style="color: #f92672;font-weight: bold">(</span><span style="color: #f8f8f2">target</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;dev&#39;</span><span style="color: #f92672;font-weight: bold">)</span>
15:51:46
15:51:46  1 of 5 START view model main.stg_customers ..................................... <span style="color: #f92672;font-weight: bold">[</span>RUN]
15:51:46  1 of 5 OK created view model main.stg_customers ................................ <span style="color: #f92672;font-weight: bold">[</span>OK <span style="color: #66d9ef;font-weight: bold">in </span>0.11s]
15:51:46  2 of 5 START view model main.stg_orders ........................................ <span style="color: #f92672;font-weight: bold">[</span>RUN]
15:51:47  2 of 5 OK created view model main.stg_orders ................................... <span style="color: #f92672;font-weight: bold">[</span>OK <span style="color: #66d9ef;font-weight: bold">in </span>0.06s]
15:51:47  3 of 5 START view model main.stg_payments ...................................... <span style="color: #f92672;font-weight: bold">[</span>RUN]
15:51:47  3 of 5 OK created view model main.stg_payments ................................. <span style="color: #f92672;font-weight: bold">[</span>OK <span style="color: #66d9ef;font-weight: bold">in </span>0.07s]
15:51:47  4 of 5 START table model main.customers ........................................ <span style="color: #f92672;font-weight: bold">[</span>RUN]
15:51:47  4 of 5 OK created table model main.customers ................................... <span style="color: #f92672;font-weight: bold">[</span>OK <span style="color: #66d9ef;font-weight: bold">in </span>0.09s]
15:51:47  5 of 5 START table model main.orders ........................................... <span style="color: #f92672;font-weight: bold">[</span>RUN]
15:51:47  5 of 5 OK created table model main.orders ...................................... <span style="color: #f92672;font-weight: bold">[</span>OK <span style="color: #66d9ef;font-weight: bold">in </span>0.05s]
15:51:47
15:51:47  Finished running 3 view models, 2 table models <span style="color: #66d9ef;font-weight: bold">in </span>0.54s.
15:51:47
15:51:47  Completed successfully
15:51:47
15:51:47  Done. <span style="color: #f8f8f2">PASS</span><span style="color: #f92672;font-weight: bold">=</span>5 <span style="color: #f8f8f2">WARN</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">ERROR</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">SKIP</span><span style="color: #f92672;font-weight: bold">=</span>0 <span style="color: #f8f8f2">TOTAL</span><span style="color: #f92672;font-weight: bold">=</span>5</code></pre>
</div>
</div>
<div class="paragraph">
<p>We end up with two final tables built and populated from this, <code>customers</code> and <code>orders</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">$ </span>duckdb jaffle_shop.duckdb <span style="color: #f92672">-c</span> <span style="color: #e6db74">&#34;select table_name, table_type from information_schema.tables;&#34;</span>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  table_name   â”‚ table_type â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ orders        â”‚ BASE TABLE â”‚
â”‚ customers     â”‚ BASE TABLE â”‚
<span style="color: #f92672;font-weight: bold">[</span>â€¦]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wrapping_up">Wrapping upâ€¦&nbsp;<a class="headline-hash" href="#_wrapping_up">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>So that was fun. Slightly back-to-front, but fun nonetheless.</p>
</div>
<div class="paragraph">
<p>dbt gives us a nice way to use SQL to declare the transformations that weâ€™d like to do on our data. Itâ€™s predicated on your data being in place alreadyâ€‰â€”â€‰<a href="/2022/10/02/data-engineering-in-2022-architectures-terminology/">itâ€™s the T of the ELT/ETL process</a>.</p>
</div>
<div class="paragraph">
<p>With dozens of <a href="https://docs.getdbt.com/docs/supported-data-platforms">adaptors</a> you can use the same build platform but with different targets. I can see the appeal of this massively both as a way early in a project to evaluate different data stores side-by-side, as well as later on in a project as technology perhaps evolves to the point that you want to move your workload elsewhere.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_learning_more">Learning More&nbsp;<a class="headline-hash" href="#_learning_more">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.getdbt.com/docs/introduction">dbt Documentation</a></p>
</li>
<li>
<p><a href="https://courses.getdbt.com/collections">dbt Training</a></p>
</li>
<li>
<p><a href="https://docs.getdbt.com/community/join">dbt Community</a></p>
</li>
</ul>
</div>
<hr/>
</div>
</div>
<div class="sect1">
<h2 id="_data_engineering_in_2022">Data Engineering in 2022&nbsp;<a class="headline-hash" href="#_data_engineering_in_2022">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="/2022/09/14/stretching-my-legs-in-the-data-engineering-ecosystem-in-2022/">Introduction</a></p>
</li>
<li>
<p><a href="/2022/09/14/data-engineering-in-2022-storage-and-access/">Storage and Access</a></p>
</li>
<li>
<p><a href="/2022/09/16/data-engineering-in-2022-exploring-lakefs-with-jupyter-and-pyspark/">Exploring LakeFS with Jupyter and PySpark</a></p>
</li>
<li>
<p><a href="/2022/10/02/data-engineering-in-2022-architectures-terminology/">Architectures &amp; Terminology</a></p>
</li>
<li>
<p><a href="/2022/10/24/data-engineering-in-2022-wrangling-the-feedback-data-from-current-22-with-dbt">Wrangling the feedback data from Current 22 with dbt</a></p>
</li>
<li>
<p><a href="/2022/11/08/data-engineering-in-2022-elt-tools/">ELT tools</a></p>
</li>
<li>
<p>Query &amp; Transformation Engines [TODO]</p>
</li>
<li>
<p><a href="/2022/09/14/data-engineering-resources/">Resources</a></p>
</li>
</ul>
</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_mach_speed">Mach Speed</a></li>
    <li><a href="#_step_by_step">Step-by-Step</a>
      <ul>
        <li><a href="#_dbt_seed"><code>dbt seed</code></a></li>
        <li><a href="#_dbt_compile"><code>dbt compile</code></a></li>
        <li><a href="#_dbt_run"><code>dbt run</code></a></li>
        <li><a href="#_dbt_run_2"><code>dbt run</code></a></li>
      </ul>
    </li>
    <li><a href="#_wrapping_up">Wrapping upâ€¦</a></li>
    <li><a href="#_learning_more">Learning More</a></li>
    <li><a href="#_data_engineering_in_2022">Data Engineering in 2022</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
