<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2024/11/GdAQ-cXWoAA00tP.jpg" >
		
		<title>Streaming Data from Postgres to Snowflake with CDC and Decodable</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2024/11/19/streaming-data-from-postgres-to-snowflake-with-cdc-and-decodable/">
		
		

		
		<meta property="og:title" content="Streaming Data from Postgres to Snowflake with CDC and Decodable" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2024/11/GdAQ-cXWoAA00tP.jpg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2024/11/19/streaming-data-from-postgres-to-snowflake-with-cdc-and-decodable/" />
		<meta property="og:site_name" content="Streaming Data from Postgres to Snowflake with CDC and Decodable" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2024/11/GdAQ-cXWoAA00tP.jpg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Streaming Data from Postgres to Snowflake with CDC and Decodable</h1>
			<p class="article-hero-meta">
				
					<time datetime="2024-11-19T00:00:00Z">19 Nov 2024</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/postgres">Postgres</a>, <a href="https://rmoff.net/categories/snowflake">Snowflake</a>, <a href="https://rmoff.net/categories/decodable">Decodable</a>
					<span class="display-print">at https://rmoff.net/2024/11/19/streaming-data-from-postgres-to-snowflake-with-cdc-and-decodable/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_getting_data_out_of_postgres_with_cdc">Getting data out of Postgres with CDC</a></li>
    <li><a href="#_loading_data_into_snowflake">Loading data into Snowflake</a></li>
    <li><a href="#_configuring_authentication">Configuring authentication</a></li>
    <li><a href="#_creating_the_snowflake_connector">Creating the Snowflake connector</a></li>
    <li><a href="#_lets_do_the_same_thing_but_declaratively">Let‚Äôs do the same thing, but declaratively</a></li>
    <li><a href="#_should_you_use_a_web_interface_or_the_declarative_approach">Should you use a web interface or the declarative approach?</a></li>
    <li><a href="#_summary">Summary</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Postgres</span><span data-pagefind-filter="category" style="display:none">Snowflake</span><span data-pagefind-filter="category" style="display:none">Decodable</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2024/11/GdAQ-cXWoAA00tP.jpg" style="display:none" alt="">
	<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This post originally appeared on the <a href="https://www.decodable.co/blog/streaming-data-from-postgres-to-snowflake">Decodable blog</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>In my  <a href="/2024/10/15/why-do-i-need-cdc/">last blog post</a>  I looked at why you might need CDC.
In this post I‚Äôm going to put it into practice with probably the most common use case‚Äîextracting data from an operational transactional database to store somewhere else for analytics.
I‚Äôm going to show Postgres to Snowflake, but the pattern is the same for pretty much any combination, such as MySQL to BigQuery, SQL Server to Redshift, and so on.</p>
</div>
<div class="paragraph">
<p>The data is a set of tables that take inspiration from Gunnar‚Äôs recent article about  <a href="https://www.morling.dev/blog/revisiting-the-outbox-pattern/">the Outbox pattern</a> .
We‚Äôre developing systems for a pet-grooming company, Oh-My-Dawg.
But in this version of the cat-cleaning, guinea pig-grooming universe, we went with a monolithic application with all the data held on a single Postgres instance.</p>
</div>
<div class="paragraph">
<p>We‚Äôve got a set of transaction tables in Postgres:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd1d2d3bd0a469d2e95_673a22218903e38734c9bf0e_673a2177d2a51e0bd0d10fb2_AD_4nXcMR0iT0XyLI9f3nyh65Fi8i1AOGLVvLArKzppq2Uox4rK9iP9yNCJgTkxRdzZ6Hh8M1Myd2dsB0RDDUtzsMvi9G9Z8I5mznnsXf-lX-H2yHa-6eFsBYJOv0848vu-TEUbRZyxJNg.png" alt="673a2cd1d2d3bd0a469d2e95 673a22218903e38734c9bf0e 673a2177d2a51e0bd0d10fb2 AD 4nXcMR0iT0XyLI9f3nyh65Fi8i1AOGLVvLArKzppq2Uox4rK9iP9yNCJgTkxRdzZ6Hh8M1Myd2dsB0RDDUtzsMvi9G9Z8I5mznnsXf lX H2yHa 6eFsBYJOv0848vu TEUbRZyxJNg"/>
</div>
</div>
<div class="paragraph">
<p>Customers have pets, pets need grooming and so they have appointments, and finally appointments are for pets and their owners.
A straightforward data model, perfect for a transactional system.
But for analytics, we don‚Äôt want to query it in place.
Not only is querying the production database a bit of a no-no (for reasons including security of access and performance), it turns out that Oh-My-Dawg is a subsidiary of a larger pet care company which means analytics are done centrally on the Snowflake data warehouse platform.</p>
</div>
<div class="paragraph">
<p>So how do we get the data out of Postgres and over to Snowflake?
We want it to be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Easy‚Äîwe‚Äôve got better things to do than mess about with complex tools and pipelines (<em>however much fun they might be</em>)</p>
</li>
<li>
<p>Low impact on the source</p>
</li>
<li>
<p>Low latency</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is where Decodable comes in.
The  <a href="https://docs.decodable.co/connect/source/postgres-cdc.html">Postgres CDC source connector</a>  (built on the industry-standard  <a href="https://debezium.io">Debezium</a> ) captures changes to the source tables as they happen and writes them to Snowflake using the (guess what)  <a href="https://docs.decodable.co/connect/sink/snowflake.html">Snowflake sink connector</a> .</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd1d2d3bd0a469d2e9b_673a22218903e38734c9bf0b_673a21779b5a83352932e14f_AD_4nXcQZqM8D-vIAfUQtNKNsdDXstEBN_YUCZEHr4wnxOnQT7z9gPbJJJFMTvq0cTPE_Bb7sepGGv7kiczjpQlygnBjN_zfFpUv6GTa2UlXr0rARUgXgZpIqahlapGcuOIOWWqjOOFt.png" alt="673a2cd1d2d3bd0a469d2e9b 673a22218903e38734c9bf0b 673a21779b5a83352932e14f AD 4nXcQZqM8D vIAfUQtNKNsdDXstEBN YUCZEHr4wnxOnQT7z9gPbJJJFMTvq0cTPE Bb7sepGGv7kiczjpQlygnBjN zfFpUv6GTa2UlXr0rARUgXgZpIqahlapGcuOIOWWqjOOFt"/>
</div>
</div>
<div class="paragraph">
<p>My Postgres database exists already, as does my Snowflake one.
All we need to do in Decodable is connect them together.
I want to show you two different ways you can do this, with the same end result.
The first is point &amp; click in the web interface, and the second is using our YAML-based declarative interface.
As I said, the end result is the same, but you get to choose your own adventure.</p>
</div>
<div class="paragraph">
<p>Let‚Äôs start off with the visual approach since this also gives you a clear idea of what components we‚Äôre building with.
In this post I‚Äôm going to give you an overview of what‚Äôs involved in building the pipelines.
For a hands-on guide,  <a href="https://app.decodable.co/-/accounts/create">sign up today</a>  and try out  <a href="https://docs.decodable.co/get-started/quickstart.html">the quickstart</a> .</p>
</div>
<div class="sect1">
<h2 id="_getting_data_out_of_postgres_with_cdc">Getting data out of Postgres with CDC&nbsp;<a class="headline-hash" href="#_getting_data_out_of_postgres_with_cdc">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>For CDC to work, the Postgres tables need to have  <a href="https://www.postgresql.org/docs/current/logical-replication-publication.html">replica identity</a>  set to <code>FULL</code>.
This is so that the complete (i.e., the <code>FULL</code>) contents of the row are captured for each change.</p>
</div>
<div class="paragraph">
<p>Let‚Äôs go ahead and do this from the Postgres SQL prompt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">ALTER</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f8f8f2;background-color: #49483e">customers</span> <span style="color: #f8f8f2;background-color: #49483e">REPLICA</span> <span style="color: #66d9ef;font-weight: bold">IDENTITY</span> <span style="color: #66d9ef;font-weight: bold">FULL</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #66d9ef;font-weight: bold">ALTER</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f8f8f2;background-color: #49483e">pets</span> <span style="color: #f8f8f2;background-color: #49483e">REPLICA</span> <span style="color: #66d9ef;font-weight: bold">IDENTITY</span> <span style="color: #66d9ef;font-weight: bold">FULL</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #66d9ef;font-weight: bold">ALTER</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f8f8f2;background-color: #49483e">appointments</span> <span style="color: #f8f8f2;background-color: #49483e">REPLICA</span> <span style="color: #66d9ef;font-weight: bold">IDENTITY</span> <span style="color: #66d9ef;font-weight: bold">FULL</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We‚Äôll check it worked too‚Äî<code>relreplident</code> should be <code>f</code> (i.e., ‚Äúfull‚Äù):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f8f8f2;background-color: #49483e">oid</span><span style="color: #f8f8f2;background-color: #49483e">::</span><span style="color: #f8f8f2;background-color: #49483e">regclass</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">relreplident</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">pg_class</span>
 <span style="color: #66d9ef;font-weight: bold">WHERE</span> <span style="color: #f8f8f2;background-color: #49483e">oid</span> <span style="color: #66d9ef;font-weight: bold">in</span> <span style="color: #f8f8f2;background-color: #49483e">(</span> <span style="color: #e6db74">&#39;customers&#39;</span><span style="color: #f8f8f2;background-color: #49483e">::</span><span style="color: #f8f8f2;background-color: #49483e">regclass</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;pets&#39;</span><span style="color: #f8f8f2;background-color: #49483e">::</span><span style="color: #f8f8f2;background-color: #49483e">regclass</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #e6db74">&#39;appointments&#39;</span><span style="color: #f8f8f2;background-color: #49483e">::</span><span style="color: #f8f8f2;background-color: #49483e">regclass</span><span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">     oid      | relreplident
<span style="color: #f92672">--------------</span>+--------------
 customers    | f
 pets         | f
 appointments | f
<span style="color: #f92672;font-weight: bold">(</span>3 rows<span style="color: #f92672;font-weight: bold">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now to connect Decodable to Postgres.
In order for Decodable to authenticate to Postgres, it‚Äôll need the user‚Äôs password.
Decodable treats authentication credentials as first-class resources called  <a href="https://docs.decodable.co/administer/manage-secrets.html">secrets</a> , so let‚Äôs add a secret that holds the Postgres user‚Äôs password:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd1d2d3bd0a469d2e98_673a22228903e38734c9bf30_673a217869dd74f37e77906f_AD_4nXeF5uvNo6C1Ul3h5syJqGZo76l6JutpbE_aBPf98NGBZTmNPikElUhigzcik7JuarxsaFDxo5ODh3jjpGpyuF6ABAVkPdlca7K2XHU6rnVMONfME0l4jGnrWsexmM879jK6x_Rikg.png" alt="673a2cd1d2d3bd0a469d2e98 673a22228903e38734c9bf30 673a217869dd74f37e77906f AD 4nXeF5uvNo6C1Ul3h5syJqGZo76l6JutpbE aBPf98NGBZTmNPikElUhigzcik7JuarxsaFDxo5ODh3jjpGpyuF6ABAVkPdlca7K2XHU6rnVMONfME0l4jGnrWsexmM879jK6x Rikg"/>
</div>
</div>
<div class="paragraph">
<p>All set!
Now we can go ahead and create our connection to Postgres.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd2d2d3bd0a469d2edd_673a22228903e38734c9bf4f_673a2178f1c9484e315d1dbd_AD_4nXcUeCEZUX7kwRv1FKbNr4PGYpbY7WlgvUQUeVmxpPDmXh4BGTfWRLHGdoBJnOAteA-zSEc4Bvpph-Zvdakz6Xr1bIEMTBRzJo1GG83hTVSPkDEyICi9265tX8pSWD5XJ0lEFT8Y6Q.png" alt="673a2cd2d2d3bd0a469d2edd 673a22228903e38734c9bf4f 673a2178f1c9484e315d1dbd AD 4nXcUeCEZUX7kwRv1FKbNr4PGYpbY7WlgvUQUeVmxpPDmXh4BGTfWRLHGdoBJnOAteA zSEc4Bvpph Zvdakz6Xr1bIEMTBRzJo1GG83hTVSPkDEyICi9265tX8pSWD5XJ0lEFT8Y6Q"/>
</div>
</div>
<div class="paragraph">
<p>Once Decodable has connected to Postgres, it gives us a list of the available tables.
There are quite a lot of tables in the database, and for our purpose we only want the Oh-My-Dawg (omd) ones, so let‚Äôs search for those and select them:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd2d2d3bd0a469d2eff_673a22228903e38734c9bf52_673a217811d8940ac3373a54_AD_4nXcNsBCIBd7920FvONPjQ1WDZyLCUyLuFzExDdEbSHnYM83zizq34d5aAa8rfuiVsHcD9GMNtVK1CoP2FBkxWdGdu4hTS4yYdnLshHwrbFJP2eYzav4-u-sbGh-YKZtlxzrXMbIroA.png" alt="673a2cd2d2d3bd0a469d2eff 673a22228903e38734c9bf52 673a217811d8940ac3373a54 AD 4nXcNsBCIBd7920FvONPjQ1WDZyLCUyLuFzExDdEbSHnYM83zizq34d5aAa8rfuiVsHcD9GMNtVK1CoP2FBkxWdGdu4hTS4yYdnLshHwrbFJP2eYzav4 u sbGh YKZtlxzrXMbIroA"/>
</div>
</div>
<div class="paragraph">
<p>With that done we can create the connection, start it, and see in the Decodable console a nice visual representation of the three streams that are populated from the Postgres data that we selected.
A  <a href="https://docs.decodable.co/streams.html">stream in Decodable</a>  is a series of records similar in concept to a Kafka topic or Kinesis stream, and used to connect connectors and pipelines together:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673b7ecb8ac1c227adf9c5c9_673b7e70c96f3733e99d7547_CleanShot%202024-11-08%20at%2012.42.11.gif" alt="673b7ecb8ac1c227adf9c5c9 673b7e70c96f3733e99d7547 CleanShot 2024 11 08 at 12.42.11"/>
</div>
</div>
<div class="paragraph">
<p>Clicking on one of these streams we can see the full snapshot of the data is in the stream, along with the changes as they happen.
Here‚Äôs a happy pooch who was first booked in for an appointment (<code>Scheduled</code>), and then attended the appointment (<code>Completed</code>):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd1d2d3bd0a469d2e9f_673a22218903e38734c9bf11_673a2177f1c9484e315d1da9_AD_4nXczvlOL0b5NQDezh6fJl0WpqoqW3BF7B3n2krLOSkWyOiAvnFznc7vUPTrYMFi5JpprOhMJbWoEFiYO8lYVdRzNqxHn1VTu7yKyI2JfilVRxUFQdzWUHLhx8rcmSL4ugWEsKMxw5Q.png" alt="673a2cd1d2d3bd0a469d2e9f 673a22218903e38734c9bf11 673a2177f1c9484e315d1da9 AD 4nXczvlOL0b5NQDezh6fJl0WpqoqW3BF7B3n2krLOSkWyOiAvnFznc7vUPTrYMFi5JpprOhMJbWoEFiYO8lYVdRzNqxHn1VTu7yKyI2JfilVRxUFQdzWUHLhx8rcmSL4ugWEsKMxw5Q"/>
</div>
</div>
<div class="paragraph">
<p>OK, so that‚Äôs the data coming from Postgres.
Let‚Äôs now see about sending it over to Snowflake.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_loading_data_into_snowflake">Loading data into Snowflake&nbsp;<a class="headline-hash" href="#_loading_data_into_snowflake">üîó</a> </h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_configuring_authentication">Configuring authentication&nbsp;<a class="headline-hash" href="#_configuring_authentication">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similar to when we set up the Postgres connector, we need to store the authentication credentials for Snowflake as a Decodable secret before setting up the connector itself.</p>
</div>
<div class="paragraph">
<p>The  <a href="https://docs.decodable.co/connect/sink/snowflake.html#generate-key-pair">documentation</a>  is comprehensive, so I‚Äôll not cover all the details here.
In short, we need to generate a new key pair so that Decodable can authenticate as our Snowflake user.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">openssl genrsa 2048 | <span style="color: #ae81ff">\</span>
openssl pkcs8 <span style="color: #f92672">-topk8</span> <span style="color: #f92672">-v2</span> des3 <span style="color: #f92672">-inform</span> PEM <span style="color: #f92672">-nocrypt</span> <span style="color: #f92672">-out</span> rsa_key.p8 <span style="color: #f92672;font-weight: bold">&amp;&amp;</span> <span style="color: #ae81ff">\</span>
openssl rsa <span style="color: #f92672">-in</span> rsa_key.p8 <span style="color: #f92672">-pubout</span> <span style="color: #f92672">-out</span> rsa_key.pub</code></pre>
</div>
</div>
<div class="paragraph">
<p>This writes two files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rsa_key.p8</code> - the private key. This is the bit that we need to keep secure as it confirms us as being us. We‚Äôll store that as a secret in Decodable.</p>
</li>
<li>
<p><code>rsa_key.pub</code> - the public key. This is not sensitive and we can give to anyone‚Äîin this case, it‚Äôs what we attach to the Snowflake user.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To attach the public key to the Snowflake user, you need to extract the raw key itself, without the header and footer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd1d2d3bd0a469d2ea5_673a22218903e38734c9bf14_673a2177c1d3616750fee30f_AD_4nXex_RC3as2kvjgHQC-S6OR0G4UQ_iSyyWJRV30Wt91y8aULxz83E1p_o0SOq9g2XQjBWinjiXNFL63Z5AX5R009ZOdpIQebqnvr75PQ4vEhcklWCXiRBmAdj4rTEMJHx7vXl9MteA.png" alt="673a2cd1d2d3bd0a469d2ea5 673a22218903e38734c9bf14 673a2177c1d3616750fee30f AD 4nXex RC3as2kvjgHQC S6OR0G4UQ iSyyWJRV30Wt91y8aULxz83E1p o0SOq9g2XQjBWinjiXNFL63Z5AX5R009ZOdpIQebqnvr75PQ4vEhcklWCXiRBmAdj4rTEMJHx7vXl9MteA"/>
</div>
</div>
<div class="paragraph">
<p>Then in Snowflake run an <code>ALTER USER</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #f8f8f2;background-color: #49483e">USE</span> <span style="color: #66d9ef;font-weight: bold">ROLE</span> <span style="color: #f8f8f2;background-color: #49483e">securityadmin</span><span style="color: #f8f8f2;background-color: #49483e">;</span>
<span style="color: #66d9ef;font-weight: bold">ALTER</span> <span style="color: #66d9ef;font-weight: bold">USER</span> <span style="color: #f8f8f2">&#34;DECODABLE&#34;</span> <span style="color: #66d9ef;font-weight: bold">SET</span> <span style="color: #f8f8f2;background-color: #49483e">RSA_PUBLIC_KEY</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAr8HM6We/I8TfvsozVagm
mmaF6tpNwCGFpBXKC+i3XtdNIeUxbOMbTa1TOyq9XUOjKumDJ6TLtmPsXtcVogcr
DRnkZ911tSV3c4J9oVPs3Tam3v/BHptrE9xL/tMpvY5s2QFRRfzhC1I5AbOIj4qR
/gSULZg1K8UeFSwoDg9lC25TPSwDmzHQYDLkQ5FlwsHQc6hx/E7PtyM95ArHu+dV
ngHXM13euOhWKfCdK3XOPtdAofdB2a2m/ENEsNGrRiiaTvxiUN4BU0Us1RcdRc0N
LCIwxxh/dNCo6zLYvl93WLtcTA1sd6v2x1G6jCwwniAeG/f7GtIcVq5S5jQlrRlU
jwIDAQAB
&#39;</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>DECODABLE</code> user has just an arbitrary name; you can use an existing user if that suits your organization‚Äôs standards, or  <a href="https://docs.decodable.co/connect/sink/snowflake.html#generate-key-pair">create a new one</a>  dedicated for this sink.
Check the rest of the  <a href="https://docs.decodable.co/connect/sink/snowflake.html">connector documentation</a>  for the additional authorisations that need configuring in Snowflake.</p>
</div>
<div class="paragraph">
<p>Now let‚Äôs add the private key to Decodable as a secret.
The process is the same as when we set up the Postgres password above.
As before, make sure you are only using the key itself and not the header or footer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd2d2d3bd0a469d2ed7_673a22228903e38734c9bf26_673a2177d746e88bae899f03_AD_4nXc2bdENhptIqDxFpXSyNeqkPCpMa4rMM2Ue4ah3W_hCaISin_dceaKfIaiqiVxZrlftt-84YaX6IIcVU5VYjdGT6llhpiYIemx5cCyF7Ss0XgqEunLLIwZxPsQjvQ-1WvDkXsK_UQ.png" alt="673a2cd2d2d3bd0a469d2ed7 673a22228903e38734c9bf26 673a2177d746e88bae899f03 AD 4nXc2bdENhptIqDxFpXSyNeqkPCpMa4rMM2Ue4ah3W hCaISin dceaKfIaiqiVxZrlftt 84YaX6IIcVU5VYjdGT6llhpiYIemx5cCyF7Ss0XgqEunLLIwZxPsQjvQ 1WvDkXsK UQ"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_the_snowflake_connector">Creating the Snowflake connector&nbsp;<a class="headline-hash" href="#_creating_the_snowflake_connector">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now all that remains is to create the sink connector to send the data we‚Äôre ingesting from Postgres to Snowflake.
First off we define the connection details, including the name of the secret that we created to hold the private key:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd2d2d3bd0a469d2ed4_673a22228903e38734c9bf55_673a21776d29e80b7406fcb8_AD_4nXcKnreRXKr5r6GcX_AfLFXB8il-KIFM7KB-_jzwsmTQBQ89ZShBGKvwekclC87D86tMae7K-W5o75UnBef-9fWGj5wl0_lwuOW8AIyYlAL-nCk6YYULKKn0r7UWFvOaorDr0eHc.png" alt="673a2cd2d2d3bd0a469d2ed4 673a22228903e38734c9bf55 673a21776d29e80b7406fcb8 AD 4nXcKnreRXKr5r6GcX AfLFXB8il KIFM7KB  jzwsmTQBQ89ZShBGKvwekclC87D86tMae7K W5o75UnBef 9fWGj5wl0 lwuOW8AIyYlAL nCk6YYULKKn0r7UWFvOaorDr0eHc"/>
</div>
</div>
<div class="paragraph">
<p>Then we select which streams we want to send to Snowflake‚Äîas before, there‚Äôs a search box to help us narrow it down so we can select just the ones that we want.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd2d2d3bd0a469d2ed1_673a22238903e38734c9bf6d_673a21788cb024738cbb2b53_AD_4nXdQtiLJDgaBNdBaN9ZpGV8Y6vbkXtttlbDQLV2ZGlGJ31c4jGMBLGrjir7cDGglHorEO5J4rIL2BRCTPPaGC_xmjx-XOhoeTs1FI6dAQP_yQhZVq5CzrzZ1n_yXmuSB2JMyY7X5pg.png" alt="673a2cd2d2d3bd0a469d2ed1 673a22238903e38734c9bf6d 673a21788cb024738cbb2b53 AD 4nXdQtiLJDgaBNdBaN9ZpGV8Y6vbkXtttlbDQLV2ZGlGJ31c4jGMBLGrjir7cDGglHorEO5J4rIL2BRCTPPaGC xmjx XOhoeTs1FI6dAQP yQhZVq5CzrzZ1n yXmuSB2JMyY7X5pg"/>
</div>
</div>
<div class="paragraph">
<p>One thing you can change if you want is the name of the target table; since there‚Äôs a bunch of Postgres namespace stuff in there, I‚Äôm going to tidy it up a bit:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd2d2d3bd0a469d2eda_673a22228903e38734c9bf2a_673a2177fe8fdf240c4f6fe1_AD_4nXeFJ3qGOaBmDDDuXn9W7xvMzQ85_MVZQbUhjqMwHViU-8_H-dIfv9aGaRgGGX6G9e9cWYzSCUveWPsUFZHEhoP0qOzSxtINxcpQ_LhRk22mtOLrGRylo_WguesTIQIJ6CZdGDBCEA.png" alt="673a2cd2d2d3bd0a469d2eda 673a22228903e38734c9bf2a 673a2177fe8fdf240c4f6fe1 AD 4nXeFJ3qGOaBmDDDuXn9W7xvMzQ85 MVZQbUhjqMwHViU 8 H dIfv9aGaRgGGX6G9e9cWYzSCUveWPsUFZHEhoP0qOzSxtINxcpQ LhRk22mtOLrGRylo WguesTIQIJ6CZdGDBCEA"/>
</div>
</div>
<div class="paragraph">
<p>The connector will create the table for me in Snowflake since they don‚Äôt exist already.
Now we start the connection, and off it goes!</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673b7ecb8ac1c227adf9c5cc_673b7e86c3e3d6f240a60711_CleanShot%202024-11-08%20at%2016.11.50.gif" alt="673b7ecb8ac1c227adf9c5cc 673b7e86c3e3d6f240a60711 CleanShot 2024 11 08 at 16.11.50"/>
</div>
</div>
<div class="paragraph">
<p>Heading over to Snowflake we can see we‚Äôve got data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd2d2d3bd0a469d2ef4_673a22228903e38734c9bf58_673a2178b54fd220860e73ed_AD_4nXd1V7uelVzzjKOxjswSXN5NtYw0erY57s6LVEd22FEgDPa6mrh9MWlO-JhN2PK8jRJdob28C6owexLU0fx_uvRjeIPq0MI4rxhG7VydlPw9VfVD_nZqGHEgxGlukMBSYzLzlueb.png" alt="673a2cd2d2d3bd0a469d2ef4 673a22228903e38734c9bf58 673a2178b54fd220860e73ed AD 4nXd1V7uelVzzjKOxjswSXN5NtYw0erY57s6LVEd22FEgDPa6mrh9MWlO JhN2PK8jRJdob28C6owexLU0fx uvRjeIPq0MI4rxhG7VydlPw9VfVD nZqGHEgxGlukMBSYzLzlueb"/>
</div>
</div>
<div class="paragraph">
<p>Referring to the data model at the top of the post, we can construct a query to start to denormalise the data:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd1d2d3bd0a469d2eb0_673a22218903e38734c9bf17_673a2178d1826ad972c792f6_AD_4nXedH0R3zhGqjRx2dwz72WuDMuGvWauQO2jV6ZwZ2plGBTZK6gNluoKEEbbxUhYrtSc7Br55wN_v4YDaFgvHNkWolVbbKOmu0eD0Kby7cM4_UotvjZIgTxwPED2Hd4_KCexpYbIlZw.png" alt="673a2cd1d2d3bd0a469d2eb0 673a22218903e38734c9bf17 673a2178d1826ad972c792f6 AD 4nXedH0R3zhGqjRx2dwz72WuDMuGvWauQO2jV6ZwZ2plGBTZK6gNluoKEEbbxUhYrtSc7Br55wN v4YDaFgvHNkWolVbbKOmu0eD0Kby7cM4 UotvjZIgTxwPED2Hd4 KCexpYbIlZw"/>
</div>
</div>
<div class="paragraph">
<p>and build analytical queries on it, such as looking at the proportion of appointments that get canceled:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd1d2d3bd0a469d2ead_673a22228903e38734c9bf2d_673a2177e7df6842870d167d_AD_4nXeHJncCSPVt3WLQvPOB5MeomLnq_Gp8s0xvf85zvk7EP9Al5_ZuFxB4BASFAsn6G_oF_4uZn6qBNFNyCVfJC1N4iY28UK2D5MBfdq8bwRPcsCfz3ExbEWYDE2cUFAsZ8queWWAaBw.png" alt="673a2cd1d2d3bd0a469d2ead 673a22228903e38734c9bf2d 673a2177e7df6842870d167d AD 4nXeHJncCSPVt3WLQvPOB5MeomLnq Gp8s0xvf85zvk7EP9Al5 ZuFxB4BASFAsn6G oF 4uZn6qBNFNyCVfJC1N4iY28UK2D5MBfdq8bwRPcsCfz3ExbEWYDE2cUFAsZ8queWWAaBw"/>
</div>
</div>
<div class="paragraph">
<p>or which customer has canceled appointments the most:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd1d2d3bd0a469d2eb3_673a22228903e38734c9bf33_673a2178d1826ad972c792f9_AD_4nXctzuddtsUr4XtBu18iOZ4uC74dC2Fb50SdwaAu0ksHfaQnLyLhhMyZO4039LNCIyyiwnJavmzyB625L2mhR1rGsOzgLcLA3YHuBYMXMwa4V2BVFWtDY-9Kqj3EN5d2yRKr3KnUrQ.png" alt="673a2cd1d2d3bd0a469d2eb3 673a22228903e38734c9bf33 673a2178d1826ad972c792f9 AD 4nXctzuddtsUr4XtBu18iOZ4uC74dC2Fb50SdwaAu0ksHfaQnLyLhhMyZO4039LNCIyyiwnJavmzyB625L2mhR1rGsOzgLcLA3YHuBYMXMwa4V2BVFWtDY 9Kqj3EN5d2yRKr3KnUrQ"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lets_do_the_same_thing_but_declaratively">Let‚Äôs do the same thing, but declaratively&nbsp;<a class="headline-hash" href="#_lets_do_the_same_thing_but_declaratively">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the mouse, or trackpad, is your thing, look away now.
If, on the other hand, nothing gets you more excited than the idea of a keyboard, a CLI, and a git repository, then this section is for YOU.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.decodable.co/declarative/overview.html">Declarative resource management</a>  in Decodable will be familiar to anyone who has worked with tools such as Terraform.
Instead of giving a set of imperative instructions (‚ÄúDo this!‚Äù, ‚ÄúCreate this!‚Äù, ‚ÄúChange this!‚Äù) you <em>declare</em> how things should look, and the declarative process then makes it so.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2178216f7b6ceb386cb5_AD_4nXfQ0fGRVxxeDSDL3E-heaxcC1esLwQQxCP5lC5wWHrDfXWYBAWKTYHNBdf8gG2X9BdWMjxKGDvk5UWLy4EC0_zq7DqoV_-7iOubHgIkzmei7crdxCRQhTMychVctX3J1lP5kEeM.gif" alt="673a2178216f7b6ceb386cb5 AD 4nXfQ0fGRVxxeDSDL3E heaxcC1esLwQQxCP5lC5wWHrDfXWYBAWKTYHNBdf8gG2X9BdWMjxKGDvk5UWLy4EC0 zq7DqoV  7iOubHgIkzmei7crdxCRQhTMychVctX3J1lP5kEeM"/>
</div>
</div>
<div class="paragraph">
<p>What this means in the context of Decodable is that we can build a set of YAML documents that describe the resources that we created above (two secrets, two connectors, three streams), and then run a command to make sure that our Decodable account reflects this.
If it doesn‚Äôt, it‚Äôs updated by the declarative process until it is.
This is perfect for things like putting your data pipelines into source control, as well as  <a href="https://docs.decodable.co/cli/integrate-with-github-actions.html">automating deployments</a> .</p>
</div>
<div class="paragraph">
<p>To start off, we‚Äôll create YAML documents that describe the secrets.
Whether you create one YAML file for everything, one per resource, or somewhere in between (e.g.
one per set of secrets, or per pipeline) is entirely up to you.
Here I‚Äôll create one per resource just to make it clear.
Note that embedding secret values like this in plain text is not a great idea‚Äîbetter is to  <a href="https://docs.decodable.co/declarative/definitions.html#secret">provide the value</a>  as a file (which could be populated from your organization‚Äôs secrets manager) or an environment variable.</p>
</div>
<div class="paragraph">
<p>The Postgres secret looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #f8f8f2">---</span>
<span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">secret</span>
<span style="color: #a6e22e">metadata</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">omd-postgres</span>
<span style="color: #a6e22e">spec_version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">v1</span>
<span style="color: #a6e22e">spec</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">value_literal</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Welcome123</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whilst the Snowflake one is a bit more complex because of the private key (don‚Äôt bother trying to hack into my Snowflake account, this is not my actual key üòâ):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #f8f8f2">---</span>
<span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">secret</span>
<span style="color: #a6e22e">metadata</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">omd-snowflake</span>
<span style="color: #a6e22e">spec_version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">v1</span>
<span style="color: #a6e22e">spec</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">value_literal</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">|</span>
    <span style="color: #e6db74">MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQChdeAhINX2/Q+0</span>
    <span style="color: #e6db74">YkF+45es8sootZHq+nPUNL/9IXaEDasFwAi/w0sjGbjzJE9a2qTIzSoqyRQPob0H</span>
    <span style="color: #e6db74">ufu7RZUrF5zV0ga0dZSXn+QGSm7jZDy21tzGCn8it7xstDB3ROjThOPxwjP8TqWa</span>
    <span style="color: #e6db74">ytvO0XcSFwn6pVK+MUUqHtPp5E0b8OXb4FHVvCQGihpobM13KiVgjmN/jgw6loMD</span>
    <span style="color: #e6db74">[‚Ä¶]</span>
    <span style="color: #e6db74">5io5kmFVae7r25YO5XoU7EBp1q1zIT+UScbySCLcAdX3o7j8FmFZBs5hsBLb0voB</span>
    <span style="color: #e6db74">McOx/+kPJYb2Hzqs5ycjTQ==</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Declarative resource management in Decodable is provided by commands under the  <a href="https://docs.decodable.co/cli.html">Decodable CLI</a>  - primarily <code>decodable apply</code> and <code>decodable query</code>.
Let‚Äôs use the first of these to make sure the secrets we‚Äôve defined are present and up to date.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">ls</span> <span style="color: #f92672">-l</span> <span style="color: #66d9ef;font-weight: bold">*</span>.yaml
<span style="color: #f92672">-rw-r--r--</span>@ 1 rmoff  staff    92  8 Nov 17:32 pg-secret.yaml
<span style="color: #f92672">-rw-r--r--</span>@ 1 rmoff  staff  1846  8 Nov 15:44 sf-secret.yaml

<span style="color: #f8f8f2">$ </span>decodable apply <span style="color: #66d9ef;font-weight: bold">*</span><span style="color: #f92672">-secret</span>.yaml
<span style="color: #f92672">---</span>
kind: secret
name: omd-pg
<span style="color: #f8f8f2">id</span>: ee94bd72
result: created
<span style="color: #f92672">---</span>
kind: secret
name: omd-snowflake
<span style="color: #f8f8f2">id</span>: ce086296
result: created
‚Ä¢ Wrote plaintext values <span style="color: #66d9ef;font-weight: bold">for </span>secret IDs: <span style="color: #f92672;font-weight: bold">[</span>ce086296 ee94bd72]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can create the YAML  <a href="https://docs.decodable.co/declarative/definitions.html">resource definitions</a>  for the Postgres and Snowflake connections.
We <em>could</em> write the YAML by hand.
But who has time for that?
Wouldn‚Äôt it be nice if we could find out the data that‚Äôs available and generate the resource definition from that instead?
That‚Äôs where <code>decodable connection scan</code> comes in.
We pass it the details of the connection that we want to create (name, type, host, etc.), as well as information about which tables we want (<code>--include-pattern</code>), and finally what the target should be called (<code>--output-resource-name-template</code>).
The <code>-02</code> suffix is just to show things here and keep it separate from the web-based approach earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable connection scan <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--name</span> oh-my-dawg-pg-02 <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--connector</span> postgres-cdc <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--type</span> <span style="color: #f8f8f2">source</span> <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">hostname</span><span style="color: #f92672;font-weight: bold">=</span>my.postgres.host.com <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">port</span><span style="color: #f92672;font-weight: bold">=</span>5432 <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> database-name<span style="color: #f92672;font-weight: bold">=</span>postgres <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">username</span><span style="color: #f92672;font-weight: bold">=</span>postgres <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">password</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">$(</span>decodable query <span style="color: #f92672">--name</span> omd-postgres <span style="color: #f92672">--kind</span> secret <span style="color: #f92672">--keep-ids</span> | yq <span style="color: #e6db74">&#39;.metadata.id&#39;</span><span style="color: #e6db74">)</span> <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--include-pattern</span> schema-name<span style="color: #f92672;font-weight: bold">=</span>public <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--output-resource-name-template</span> stream-name<span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;{table-name}-02&#34;</span> <span style="color: #ae81ff">\</span>
          <span style="color: #f92672;font-weight: bold">&gt;</span> omd-pg.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the <code>password</code> property is passed by reference to the <code>omd-postgres</code> secret that was created above using command substitution.
You don‚Äôt have to do this‚Äîyou could also specify it directly.</p>
</div>
<div class="paragraph">
<p>Out of this scan command comes a nice set of YAML, describing the connection and its schemas:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #f8f8f2">---</span>
<span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">connection</span>
<span style="color: #a6e22e">metadata</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">oh-my-dawg-pg-02</span>
<span style="color: #a6e22e">spec_version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">v1</span>
<span style="color: #a6e22e">spec</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">connector</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">postgres-cdc</span>
    <span style="color: #a6e22e">properties</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">database-name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">postgres</span>
        <span style="color: #a6e22e">hostname</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">my.postgres.host.com</span>
    <span style="color: #a6e22e">stream_mappings</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">stream_name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">omd_appointments-02</span>
          <span style="color: #a6e22e">external_resource_specifier</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
            <span style="color: #a6e22e">table-name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">omd_appointments</span>
        <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">stream_name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">omd_customers-02</span>
          <span style="color: #a6e22e">external_resource_specifier</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
            <span style="color: #a6e22e">table-name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">omd_customers</span>
        <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">stream_name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">omd_pets-02</span>
          <span style="color: #a6e22e">external_resource_specifier</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
            <span style="color: #a6e22e">table-name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">omd_pets</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">‚Ä¶</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We could make changes here to tweak things if needed, but let‚Äôs go ahead and apply this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable apply omd-pg.yaml

<span style="color: #f92672">---</span>
kind: connection
name: oh-my-dawg-pg-02
<span style="color: #f8f8f2">id</span>: fd98e89d
result: created
<span style="color: #f92672">---</span>
kind: stream
name: omd_appointments-02
<span style="color: #f8f8f2">id</span>: b62f1f50
result: created
<span style="color: #f92672">---</span>
kind: stream
name: omd_customers-02
<span style="color: #f8f8f2">id</span>: 2b365c13
result: created
<span style="color: #f92672">---</span>
kind: stream
name: omd_pets-02
<span style="color: #f8f8f2">id</span>: 5dd20920
result: created</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we‚Äôve created the connection.
But what if we realize we missed something, such as including a description for the connection?
This is what the relevant section of the YAML looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #f8f8f2">---</span>
<span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">connection</span>
<span style="color: #a6e22e">metadata</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">oh-my-dawg-pg-02</span>
    <span style="color: #a6e22e">description</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">&#34;</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">‚Ä¶</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To make the change to the connection all we need to do is update the YAML file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #f8f8f2">---</span>
<span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">connection</span>
<span style="color: #a6e22e">metadata</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">declarative-oh-my-dawg-pg</span>
    <span style="color: #a6e22e">description</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">An</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">example</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">of</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">using</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">declarative</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">resource</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">management</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">to</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">build</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">data</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">pipelines&#34;</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">‚Ä¶</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and then apply it again.
Declarative resource management compares the file to the current state and makes the needed changes.
This is a <em>lot</em> nicer than the regular drop/create route that you‚Äôd need to go if you were doing things imperatively.</p>
</div>
<div class="paragraph">
<p>Note here how only the connection has <code>result: updated</code> ‚Äî the resources that didn‚Äôt change (the streams) are <code>result: unchanged</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable apply omd-pg.yaml

<span style="color: #f92672">---</span>
kind: connection
name: oh-my-dawg-pg-02
<span style="color: #f8f8f2">id</span>: fd98e89d
result: updated
<span style="color: #f92672">---</span>
kind: stream
name: omd_appointments-02
<span style="color: #f8f8f2">id</span>: b62f1f50
result: unchanged
<span style="color: #f92672">---</span>
kind: stream
name: omd_customers-02
<span style="color: #f8f8f2">id</span>: 2b365c13
result: unchanged
<span style="color: #f92672">---</span>
kind: stream
name: omd_pets-02
<span style="color: #f8f8f2">id</span>: 5dd20920
result: unchanged</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let‚Äôs check that the description of the connection is now as expected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable query <span style="color: #f92672">--name</span> oh-my-dawg-pg-02 <span style="color: #f92672">--metadata-only</span>

<span style="color: #f92672">---</span>
kind: connection
metadata:
    name: oh-my-dawg-pg-02
    description: An example of using declarative resource management to build data pipelines</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having created the connection, we need to activate it.
It‚Äôs actually possible to  <a href="https://docs.decodable.co/declarative/definitions.html#connection_v2">specify in the YAML that the connection should be active</a> , but certainly whilst we‚Äôre finding our way, decoupling the creation from activation is useful._
_To activate it, we run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable query <span style="color: #f92672">--name</span> oh-my-dawg-pg-02 <span style="color: #ae81ff">\</span>
                  <span style="color: #f92672">--operation</span> activate <span style="color: #ae81ff">\</span>
                  <span style="color: #f92672">--stabilize</span>

<span style="color: #f92672">---</span>
kind: connection
name: oh-my-dawg-pg-02
<span style="color: #f8f8f2">id</span>: fd98e89d
result: activated

üîòÔ∏è STARTING   ‚Ä¢ connection fd98e89d oh-my-dawg-pg-02
........................................
‚úÖÔ∏è RUNNING    ‚Ä¢ connection fd98e89d oh-my-dawg-pg-02
üèÅ ‚Ä¢‚Ä¢‚Ä¢ All queried resources stable ‚Ä¢‚Ä¢‚Ä¢ üèÅ</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let‚Äôs create the Snowflake connection.
As before, we‚Äôre going to have Decodable generate the YAML for us, with all we need to do being to specify the connection details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable connection scan <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--name</span> oh-my-dawg-snowflake-02 <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--connector</span> snowflake <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--type</span> sink <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> snowflake.database<span style="color: #f92672;font-weight: bold">=</span>omd          <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> snowflake.schema<span style="color: #f92672;font-weight: bold">=</span>omd          <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> snowflake.user<span style="color: #f92672;font-weight: bold">=</span>decodable          <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> snowflake.private-key<span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">$(</span>decodable query <span style="color: #f92672">--name</span> omd-snowflake <span style="color: #f92672">--kind</span> secret <span style="color: #f92672">--keep-ids</span> | yq <span style="color: #e6db74">&#39;.metadata.id&#39;</span><span style="color: #e6db74">)</span>          <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> snowflake.role<span style="color: #f92672;font-weight: bold">=</span>load_data          <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> snowflake.account-name<span style="color: #f92672;font-weight: bold">=</span>MYORG-MYACCOUNTNAME          <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> snowflake.warehouse<span style="color: #f92672;font-weight: bold">=</span>stg          <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--prop</span> snowflake.merge-interval<span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;1 minute&#34;</span> <span style="color: #ae81ff">\</span>
          <span style="color: #f92672">--include-pattern</span> stream-name<span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;^omd\_.*-02$&#39;</span> <span style="color: #ae81ff">\</span>
          | decodable apply -</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time we‚Äôre not going to write it to an intermediate YAML file to then run through decodable apply, but just pipe it directly in.
It‚Äôs up to you if you want to do this.
For scratching around in development I find it‚Äôs quicker (and you can always get the YAML at a later date with <code>decodable query</code>).
You may prefer to write it to a file for visibility of what‚Äôs being run and any troubleshooting.</p>
</div>
<div class="paragraph">
<p>With the above run, we get a connection writing to three Snowflake tables created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f92672">---</span>
kind: connection
name: oh-my-dawg-snowflake-02
<span style="color: #f8f8f2">id</span>: 957714a0
result: created
<span style="color: #f92672">---</span>
specifier:
    snowflake.table: omd_appointments-02
result: SUCCESS
<span style="color: #f92672">---</span>
specifier:
    snowflake.table: omd_customers-02
result: SUCCESS
<span style="color: #f92672">---</span>
specifier:
    snowflake.table: omd_pets-02
result: SUCCESS</code></pre>
</div>
</div>
<div class="paragraph">
<p>So let‚Äôs activate the connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable query <span style="color: #f92672">--name</span> oh-my-dawg-snowflake-02 <span style="color: #f92672">-X</span> activate <span style="color: #f92672">--stabilize</span>

<span style="color: #f92672">---</span>
kind: connection
name: oh-my-dawg-snowflake-02
<span style="color: #f8f8f2">id</span>: 957714a0
result: activated

üîòÔ∏è STARTING   ‚Ä¢ connection 957714a0 oh-my-dawg-snowflake-02
........................................
‚úÖÔ∏è RUNNING    ‚Ä¢ connection 957714a0 oh-my-dawg-snowflake-02
üèÅ ‚Ä¢‚Ä¢‚Ä¢ All queried resources stable ‚Ä¢‚Ä¢‚Ä¢ üèÅ</code></pre>
</div>
</div>
<div class="paragraph">
<p>And now we have data in Snowflake!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>snow sql <span style="color: #f92672">-q</span> <span style="color: #e6db74">&#34;select count(*) from </span><span style="color: #ae81ff">\&#34;</span><span style="color: #e6db74">OMD_APPOINTMENTS-02</span><span style="color: #ae81ff">\&#34;</span><span style="color: #e6db74">&#34;</span> <span style="color: #ae81ff">\</span>
        <span style="color: #f92672">-x</span> <span style="color: #f92672">--account</span> <span style="color: #f8f8f2">$SNOWFLAKE_ACCOUNT</span> <span style="color: #f92672">--user</span> rmoff <span style="color: #f92672">--password</span> <span style="color: #f8f8f2">$SNOWFLAKE_PW</span> <span style="color: #ae81ff">\</span>
        <span style="color: #f92672">--database</span> omd <span style="color: #f92672">--schema</span> omd

WARNING! Using <span style="color: #f92672">--password</span> via the CLI is insecure. Use environment variables instead.
<span style="color: #66d9ef;font-weight: bold">select </span>count<span style="color: #f92672;font-weight: bold">(</span><span style="color: #66d9ef;font-weight: bold">*</span><span style="color: #f92672;font-weight: bold">)</span> from <span style="color: #e6db74">&#34;OMD_APPOINTMENTS-02&#34;</span>
+----------+
| COUNT<span style="color: #f92672;font-weight: bold">(</span><span style="color: #66d9ef;font-weight: bold">*</span><span style="color: #f92672;font-weight: bold">)</span> |
|----------|
| 9256     |
+----------+</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_should_you_use_a_web_interface_or_the_declarative_approach">Should you use a web interface or the declarative approach?&nbsp;<a class="headline-hash" href="#_should_you_use_a_web_interface_or_the_declarative_approach">üîó</a> </h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2178dcb347ef4bd005b0_AD_4nXdMNKDl8BebMmyRy3360IO4YfWhz8EOfF65uvxvHEsTYpT_nxIU4gWwPXoxzTr0r95wYkhPbfTPcQ6YS8UflhfkrnATYerF_hGlX0ptvF0nwJA7VjheeREGiDCsIfUeD_cQwBIo3g.gif" alt="673a2178dcb347ef4bd005b0 AD 4nXdMNKDl8BebMmyRy3360IO4YfWhz8EOfF65uvxvHEsTYpT nxIU4gWwPXoxzTr0r95wYkhPbfTPcQ6YS8UflhfkrnATYerF hGlX0ptvF0nwJA7VjheeREGiDCsIfUeD cQwBIo3g"/>
</div>
</div>
<div class="paragraph">
<p>A pattern that we see users commonly adopting is that they‚Äôll prototype and build pipelines in the web interface.
Once they‚Äôve tested them and ironed out any wrinkles, they then export these to YAML (using <code>decodable query</code>) and use them declaratively from there on, through staging environments and on into production.
Decodable supports  <a href="https://docs.decodable.co/cli/integrate-with-github-actions.html">workflows in GitHub</a>  for exactly this approach.
You can take it a step further and consider generating YAML resource files from a template driven with a tool like  <a href="https://jsonnet.org/">Jsonnet</a> .</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary&nbsp;<a class="headline-hash" href="#_summary">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Getting data from Postgres into Snowflake needs not be hard work üòÄ.
With Decodable and its  <a href="https://docs.decodable.co/connections.html">comprehensive library of connectors</a>  you can get data from one system to another in a scalable, low-latency way.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/11/673a2cd1d2d3bd0a469d2e9b_673a22218903e38734c9bf0b_673a21779b5a83352932e14f_AD_4nXcQZqM8D-vIAfUQtNKNsdDXstEBN_YUCZEHr4wnxOnQT7z9gPbJJJFMTvq0cTPE_Bb7sepGGv7kiczjpQlygnBjN_zfFpUv6GTa2UlXr0rARUgXgZpIqahlapGcuOIOWWqjOOFt.png" alt="673a2cd1d2d3bd0a469d2e9b 673a22218903e38734c9bf0b 673a21779b5a83352932e14f AD 4nXcQZqM8D vIAfUQtNKNsdDXstEBN YUCZEHr4wnxOnQT7z9gPbJJJFMTvq0cTPE Bb7sepGGv7kiczjpQlygnBjN zfFpUv6GTa2UlXr0rARUgXgZpIqahlapGcuOIOWWqjOOFt"/>
</div>
</div>
<div class="paragraph">
<p>In this post I showed two ways of creating this pipeline; using the web interface and using a YAML-based declarative approach.
Both achieve the same result of a CDC connection to Postgres sending an initial full snapshot of the data followed by all subsequent changes to the data to Snowflake.
With the data in Snowflake, we can perform whatever analytics on it that we want.</p>
</div>
<div class="paragraph">
<p>But Decodable is not just connectors, it also offers a powerful processing layer built on Flink SQL.
With this, you could take the streams of data from Postgres and apply transformations before they‚Äôre written to Snowflake.
For example, performing the denormalisation across the three source tables to then write One Big Table (OBT) to Snowflake, thus avoiding any need for subsequent pre-processing before analytical queries can be run.</p>
</div>
<div class="paragraph">
<p><em>You can find the source code used for the Postgres example, and sample YAML resource definitions,</em> <a href="https://github.com/decodableco/examples/tree/main/postgres-to-snowflake-with-cdc">on GitHub</a> <em>.</em></p>
</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_getting_data_out_of_postgres_with_cdc">Getting data out of Postgres with CDC</a></li>
    <li><a href="#_loading_data_into_snowflake">Loading data into Snowflake</a></li>
    <li><a href="#_configuring_authentication">Configuring authentication</a></li>
    <li><a href="#_creating_the_snowflake_connector">Creating the Snowflake connector</a></li>
    <li><a href="#_lets_do_the_same_thing_but_declaratively">Let‚Äôs do the same thing, but declaratively</a></li>
    <li><a href="#_should_you_use_a_web_interface_or_the_declarative_approach">Should you use a web interface or the declarative approach?</a></li>
    <li><a href="#_summary">Summary</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
