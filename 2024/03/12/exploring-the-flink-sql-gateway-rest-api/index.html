<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2024/03/rest01.jpg" >
		
		<title>Exploring the Flink SQL Gateway REST API</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2024/03/12/exploring-the-flink-sql-gateway-rest-api/">
		
		

		
		<meta property="og:title" content="Exploring the Flink SQL Gateway REST API" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2024/03/rest01.jpg" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2024/03/12/exploring-the-flink-sql-gateway-rest-api/" />
		<meta property="og:site_name" content="Exploring the Flink SQL Gateway REST API" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2024/03/rest01.jpg');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>Exploring the Flink SQL Gateway REST API</h1>
			<p class="article-hero-meta">
				
					<time datetime="2024-03-12T00:00:00Z">12 Mar 2024</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/apache-flink">Apache Flink</a>
					<span class="display-print">at https://rmoff.net/2024/03/12/exploring-the-flink-sql-gateway-rest-api/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_here_comes_the_postman">Here Comes the Postman</a></li>
    <li><a href="#_running_a_sql_statement_with_the_flink_sql_gateway">Running a SQL Statement with the Flink SQL Gateway</a></li>
    <li><a href="#_0_check_the_connection_and_flink_version">0. Check the connection and Flink version</a></li>
    <li><a href="#_1_create_a_session">1. Create a session</a>
      <ul>
        <li><a href="#_optional_validate_session_and_read_session_config">[Optional] Validate session and read session config</a></li>
      </ul>
    </li>
    <li><a href="#_2_submit_a_sql_statement">2. Submit a SQL statement</a></li>
    <li><a href="#_3_get_statement_execution_status">3. Get Statement Execution Status</a></li>
    <li><a href="#_4_get_results">4. Get Results</a></li>
    <li><a href="#_5_tidy_up">5. Tidy up</a></li>
    <li><a href="#_using_a_shell_script_to_execute_flink_sql">Using a Shell script to execute Flink SQL</a></li>
    <li><a href="#_where_next">Where Next?</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Apache Flink</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2024/03/rest01.jpg" style="display:none" alt="">
	<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This post originally appeared on the <a href="https://www.decodable.co/blog/exploring-the-flink-sql-gateway-rest-api">Decodable blog</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>The <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/overview/">SQL Gateway in Apache Flink</a>  provides a way to run SQL in Flink from places other than the SQL Client.
This includes using a <a href="link:/2023/11/16/learning-apache-flink-s01e06-the-flink-jdbc-driver/">JDBC Driver</a>  (which opens up a multitude of clients), a Hive client via the <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/hiveserver2/">HiveServer2 endpoint</a> , and directly against the <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/rest/">REST Endpoint</a> .</p>
</div>
<div class="paragraph">
<p>As I continue my journey with learning Flink SQL one thing I wondered was how one would go about submitting a Flink SQL job in a Production scenario.
It seems to me that the SQL Gatewayâ€™s REST API would be a good candidate for this.
Youâ€™d put the SQL code in a file under source control, and then use a deployment pipeline to submit that SQL against the endpoint.
Itâ€™s worth noting that itâ€™s recommended to use  <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/deployment/overview/#application-mode">application mode</a>  when deploying production jobs to Flinkâ€”and the SQL Client and Gateway donâ€™t support this yet.
There is a  <a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-316%3A+Support+application+mode+for+SQL+Gateway">FLIP under discussion</a>  but in the meantime if you want to use application mode youâ€™d need to wrap your SQL in a JAR to deploy it.
Either that, or continue to use SQL Client or Gateway and be aware of the limitations of running the job in  <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/deployment/overview/#session-mode">session mode</a>  (basically, no resource isolation).</p>
</div>
<div class="paragraph">
<p>In this article Iâ€™ll show you how to use the endpoint, including exploring it with the Postman tool, using <a href="https://httpie.io/">HTTPie</a>  to call the endpoint from the shell, and finishing off with a viable proof-of-concept script to execute statements from a script.</p>
</div>
<div class="paragraph">
<p>The API is <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/rest/#rest-api">documented</a>  and has two versions, each with their own OpenAPI YAML spec.
Iâ€™m going to look at <code>v2</code> here.
<em>Note that the docs say that the spec is still experimental.</em></p>
</div>
<div class="paragraph">
<p>To get started, letâ€™s bring up the Flink cluster and the SQL Gateway locally:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">./bin/start-cluster.sh
./bin/sql-gateway.sh start <span style="color: #f92672">-Dsql-gateway</span>.endpoint.rest.address<span style="color: #f92672;font-weight: bold">=</span>localhost</code></pre>
</div>
</div>
<div class="sect1">
<h2 id="_here_comes_the_postman">Here Comes the Postman&nbsp;<a class="headline-hash" href="#_here_comes_the_postman">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://getpostman.com/">Postman</a>  is a handy tool for doing tons of useful stuff with APIs.
Here Iâ€™m just using it to create the sample calls against the endpoints and to quickly understand how they relate to each other.
You can use it on the web but assuming youâ€™re using a local instance of Flink (or at least, one that is not publicly accessible) then youâ€™ll want the desktop version.
Note that youâ€™ll still need to sign up for a free account to access the <em>Import</em> feature that weâ€™re using here.</p>
</div>
<div class="paragraph">
<p>Under your Workspace click <strong>Import</strong> and paste in the URL of the SQL Gatewayâ€™s OpenAPI YAML file (<code><a href="https://nightlies.apache.org/flink/flink-docs-master/generated/rest_v2_sql_gateway.yml" class="bare">https://nightlies.apache.org/flink/flink-docs-master/generated/rest_v2_sql_gateway.yml</a></code>) which is linked to on the <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/rest/#rest-api">docs page</a> .
Import it as a <strong>Postman Collection</strong>.</p>
</div>
<div class="paragraph">
<p>Youâ€™ll now see under the Postman collection a list of all the API endpoints, with pre-created calls for each.
Go to <strong>Environments</strong> â†’ <strong>Globals</strong> and define <code>baseUrl</code> with the value for your SQL Gateway.
If youâ€™re running it locally then this is going to be <code><a href="http://localhost:8083" class="bare">http://localhost:8083</a></code></p>
</div>
<div class="paragraph">
<p>Now go back to <strong>Collections</strong> and under the Flink SQL Gateway REST API folder find the <code>get Info</code> call.
Open this up and hit <strong>Send</strong>.
You should see a successful response like this:</p>
</div>
<div class="paragraph">
<p>You can also click the <strong>Code</strong> icon (<code>&lt;/&gt;</code> ) to see the call in various different languages and tools including cURL and HTTPie.
For now this is not ground-breaking, but once you get onto payloads itâ€™s really handy.</p>
</div>
<div class="paragraph">
<p>Just as we manually populated the global variable <code>baseURL</code> above, we can also take the response from one call and use it in the making of another.
This is really useful, because there are two variables that the REST API returns that we need to use (<code>sessionHandle</code> and <code>operationHandle</code>).
To do this in Postman add the following to the <strong>Tests</strong> tab of the request pane:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="javascript"><span style="color: #66d9ef;font-weight: bold">var</span> <span style="color: #f8f8f2;background-color: #49483e">jsonData</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #f8f8f2;background-color: #49483e">JSON</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">parse</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">responseBody</span><span style="color: #f8f8f2;background-color: #49483e">);</span>
<span style="color: #f8f8f2;background-color: #49483e">postman</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">setEnvironmentVariable</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#34;</span><span style="color: #e6db74">sessionHandle</span><span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">jsonData</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">sessionHandle</span><span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That assumes that the variable to populate is called <code>sessionHandle</code> and itâ€™s returned in the root key called <code>sessionHandle</code> of the response.
Which it is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>http  <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 POST <span style="color: #e6db74">&#39;localhost:8083/sessions&#39;</span> <span style="color: #ae81ff">\</span>
 Content-Type:<span style="color: #e6db74">&#39;application/json&#39;</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span>
HTTP/1.1 200 OK
access-control-allow-origin: <span style="color: #66d9ef;font-weight: bold">*</span>
connection: keep-alive
content-length: 56
content-type: application/json<span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2">charset</span><span style="color: #f92672;font-weight: bold">=</span>UTF-8

<span style="color: #f92672;font-weight: bold">{</span>
    <span style="color: #e6db74">&#34;sessionHandle&#34;</span>: <span style="color: #e6db74">&#34;190edef5-df00-4182-be0e-431737b1e93b&#34;</span>
<span style="color: #f92672;font-weight: bold">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once youâ€™ve set a variable, you can use it in other calls by referencing it in double curly braces, like this:</p>
</div>
<div class="paragraph">
<p><em>Iâ€™ve shared a copy of my Postman collection with the above variable configuration done for you</em> <a href="https://gist.github.com/rmoff/81b3e1b7effff90b547e9017d31dcc6d">here</a></p>
</div>
<div class="paragraph">
<p>Letâ€™s now go through the workflow of how weâ€™d actually submit a SQL statement from scratch to the gateway.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_a_sql_statement_with_the_flink_sql_gateway">Running a SQL Statement with the Flink SQL Gateway&nbsp;<a class="headline-hash" href="#_running_a_sql_statement_with_the_flink_sql_gateway">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>In essence, the minimal steps are as follows.
You can see <a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/rest/#overview-of-sql-processing">the docs</a>  for more info.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Establish a Session (with optional configuration parameters set)</p>
</li>
<li>
<p>Submit a SQL Statement, which generates an Operation.</p>
</li>
<li>
<p>Check the status of the Operation until itâ€™s complete</p>
</li>
<li>
<p>Fetch the results of the Operation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Hereâ€™s how to do each one, using HTTPie as an example client and showing the response.
Iâ€™m using bash variables to hold the values of session and operation handles.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_0_check_the_connection_and_flink_version">0. Check the connection and Flink version&nbsp;<a class="headline-hash" href="#_0_check_the_connection_and_flink_version">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>http <span style="color: #f92672">--body</span> <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 GET <span style="color: #e6db74">&#39;localhost:8083/info&#39;</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span>
<span style="color: #f92672;font-weight: bold">{</span>
    <span style="color: #e6db74">&#34;productName&#34;</span>: <span style="color: #e6db74">&#34;Apache Flink&#34;</span>,
    <span style="color: #e6db74">&#34;version&#34;</span>: <span style="color: #e6db74">&#34;1.18.1&#34;</span>
<span style="color: #f92672;font-weight: bold">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_create_a_session">1. Create a session&nbsp;<a class="headline-hash" href="#_1_create_a_session">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/rest/">POST /session</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">printf</span> <span style="color: #e6db74">&#39;{
  &#34;properties&#34;: {
    &#34;execution.runtime-mode&#34;: &#34;batch&#34;
  }
}&#39;</span>| http  <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 POST <span style="color: #e6db74">&#39;localhost:8083/sessions&#39;</span> <span style="color: #ae81ff">\</span>
 Content-Type:<span style="color: #e6db74">&#39;application/json&#39;</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span>

HTTP/1.1 200 OK
access-control-allow-origin: <span style="color: #66d9ef;font-weight: bold">*</span>
connection: keep-alive
content-length: 56
content-type: application/json<span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2">charset</span><span style="color: #f92672;font-weight: bold">=</span>UTF-8

<span style="color: #f92672;font-weight: bold">{</span>
    <span style="color: #e6db74">&#34;sessionHandle&#34;</span>: <span style="color: #e6db74">&#34;e296eb18-9b6e-4fbc-bd6c-0cbb93a7fe28&#34;</span>
<span style="color: #f92672;font-weight: bold">}</span>

<span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">export </span><span style="color: #f8f8f2">SESSIONHANDLE</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;e296eb18-9b6e-4fbc-bd6c-0cbb93a7fe28&#34;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_optional_validate_session_and_read_session_config">[Optional] Validate session and read session config&nbsp;<a class="headline-hash" href="#_optional_validate_session_and_read_session_config">ðŸ”—</a> </h3>
<div class="paragraph">
<p><a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/rest/">GET /sessions/:session_handle</a></p>
</div>
<div class="paragraph">
<p>Note here the <code>runtime-mode</code> has been set from the <code>properties</code> that were passed above in the session creation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>http <span style="color: #f92672">--ignore-stdin</span> <span style="color: #f92672">--form</span> <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 GET <span style="color: #e6db74">&#39;localhost:8083/sessions/&#39;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span>
HTTP/1.1 200 OK
access-control-allow-origin: <span style="color: #66d9ef;font-weight: bold">*</span>
connection: keep-alive
content-length: 2129
content-type: application/json<span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2">charset</span><span style="color: #f92672;font-weight: bold">=</span>UTF-8</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="json"><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;properties&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;env.java.opts.all&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;--add-exports=java.base/sun.net.util=ALL-UNNAMED --add-exports=java.rmi/sun.rmi.registry=ALL-UNNAMED --add-exports=jdk.compiler/com.sun.tools.javac.api=ALL-UNN
AMED --add-exports=jdk.compiler/com.sun.tools.javac.file=ALL-UNNAMED --add-exports=jdk.compiler/com.sun.tools.javac.parser=ALL-UNNAMED --add-exports=jdk.compiler/com.sun.tools.javac.tree=AL
L-UNNAMED --add-exports=jdk.compiler/com.sun.tools.javac.util=ALL-UNNAMED --add-exports=java.security.jgss/sun.security.krb5=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-op
ens=java.base/java.net=ALL-UNNAMED --add-opens=java.base/java.io=ALL-UNNAMED --add-opens=java.base/java.nio=ALL-UNNAMED --add-opens=java.base/sun.nio.ch=ALL-UNNAMED --add-opens=java.base/ja
va.lang.reflect=ALL-UNNAMED --add-opens=java.base/java.text=ALL-UNNAMED --add-opens=java.base/java.time=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.base/java.ut
il.concurrent=ALL-UNNAMED --add-opens=java.base/java.util.concurrent.atomic=ALL-UNNAMED --add-opens=java.base/java.util.concurrent.locks=ALL-UNNAMED&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;execution.attached&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;true&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;execution.runtime-mode&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;batch&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;execution.savepoint-restore-mode&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;NO_CLAIM&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;execution.savepoint.ignore-unclaimed-state&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;false&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;execution.shutdown-on-attached-exit&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;false&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;execution.target&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;remote&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;jobmanager.bind-host&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;localhost&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;jobmanager.execution.failover-strategy&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;region&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;jobmanager.memory.process.size&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;1600m&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;jobmanager.rpc.address&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;localhost&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;jobmanager.rpc.port&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;6123&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;parallelism.default&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;1&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;pipeline.classpaths&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;pipeline.jars&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;file:/Users/rmoff/flink/flink-1.18.1/opt/flink-python-1.18.1.jar&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;rest.address&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;localhost&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;rest.bind-address&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;localhost&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;sql-gateway.endpoint.rest.address&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;localhost&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;table.catalog-store.file.path&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;./conf/catalogs&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;table.catalog-store.kind&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;file&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;table.resources.download-dir&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;/var/folders/7x/nscwrz557vlcd_ydgt7d5wt00000gn/T/sql-gateway-e296eb18-9b6e-4fbc-bd6c-0cbb93a7fe28&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;taskmanager.bind-host&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;localhost&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;taskmanager.host&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;localhost&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;taskmanager.memory.process.size&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;1728m&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;taskmanager.numberOfTaskSlots&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;1&#34;</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;background-color: #49483e">}</span><span style="color: #f8f8f2">
</span><span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_submit_a_sql_statement">2. Submit a SQL statement&nbsp;<a class="headline-hash" href="#_2_submit_a_sql_statement">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/rest/">POST /sessions/:session_handle/statements</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">printf</span> <span style="color: #e6db74">&#39;{
  &#34;statement&#34;: &#34;CREATE  TABLE t_foo  WITH ( &#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;connector&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39; = &#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;filesystem&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;, &#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;path&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39; = &#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;file:///tmp/flink-test&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;, &#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;format&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39; = &#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;csv&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;, &#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;csv.field-delimiter&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39; = &#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;,&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39; ) AS SELECT name, COUNT(*) AS cnt FROM (VALUES (&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;Bob&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;), (&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;Alice&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;), (&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;Greg&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;), (&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;Bob&#39;</span><span style="color: #ae81ff">\&#39;</span><span style="color: #e6db74">&#39;)) AS NameTable(name) GROUP BY name;&#34;
}&#39;</span>| http  <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 POST <span style="color: #e6db74">&#39;localhost:8083/sessions/&#39;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span><span style="color: #e6db74">&#39;/statements&#39;</span> <span style="color: #ae81ff">\</span>
 Content-Type:<span style="color: #e6db74">&#39;application/json&#39;</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span>
HTTP/1.1 200 OK
access-control-allow-origin: <span style="color: #66d9ef;font-weight: bold">*</span>
connection: keep-alive
content-length: 58
content-type: application/json<span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2">charset</span><span style="color: #f92672;font-weight: bold">=</span>UTF-8

<span style="color: #f92672;font-weight: bold">{</span>
    <span style="color: #e6db74">&#34;operationHandle&#34;</span>: <span style="color: #e6db74">&#34;ba45649c-07b2-4b1c-a190-df3631b53549&#34;</span>
<span style="color: #f92672;font-weight: bold">}</span>

<span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">export </span><span style="color: #f8f8f2">OPERATIONHANDLE</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;ba45649c-07b2-4b1c-a190-df3631b53549&#34;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_get_statement_execution_status">3. Get Statement Execution Status&nbsp;<a class="headline-hash" href="#_3_get_statement_execution_status">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/rest/">GET /sessions/:session_handle/operations/:operation_handle/status</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>http <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 GET <span style="color: #e6db74">&#39;localhost:8083/sessions/&#39;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span><span style="color: #e6db74">&#39;/operations/&#39;</span><span style="color: #f8f8f2">$OPERATIONHANDLE</span><span style="color: #e6db74">&#39;/status&#39;</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span>
HTTP/1.1 200 OK
access-control-allow-origin: <span style="color: #66d9ef;font-weight: bold">*</span>
connection: keep-alive
content-length: 21
content-type: application/json<span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2">charset</span><span style="color: #f92672;font-weight: bold">=</span>UTF-8

<span style="color: #f92672;font-weight: bold">{</span>
    <span style="color: #e6db74">&#34;status&#34;</span>: <span style="color: #e6db74">&#34;FINISHED&#34;</span>
<span style="color: #f92672;font-weight: bold">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_get_results">4. Get Results&nbsp;<a class="headline-hash" href="#_4_get_results">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql-gateway/rest/">GET /sessions/:session_handle/operations/:operation_handle/result/:token</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>http <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 GET <span style="color: #e6db74">&#39;localhost:8083/sessions/&#39;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span><span style="color: #e6db74">&#39;/operations/&#39;</span><span style="color: #f8f8f2">$OPERATIONHANDLE</span><span style="color: #e6db74">&#39;/result/0?rowFormat=JSON&#39;</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span>

HTTP/1.1 200 OK
access-control-allow-origin: <span style="color: #66d9ef;font-weight: bold">*</span>
connection: keep-alive
content-length: 483
content-type: application/json<span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2">charset</span><span style="color: #f92672;font-weight: bold">=</span>UTF-8</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="json"><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;resultType&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;PAYLOAD&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;isQueryResult&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef;font-weight: bold">false</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;jobID&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;fb1a5f06643364bc82a9a4e0bd3e9c10&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;resultKind&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;SUCCESS_WITH_CONTENT&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;results&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;columns&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">
      </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;name&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;job id&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;logicalType&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
          </span><span style="color: #f8f8f2;font-weight: bold">&#34;type&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;VARCHAR&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
          </span><span style="color: #f8f8f2;font-weight: bold">&#34;nullable&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef;font-weight: bold">true</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
          </span><span style="color: #f8f8f2;font-weight: bold">&#34;length&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">2147483647</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;background-color: #49483e">},</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;comment&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2">
      </span><span style="color: #f8f8f2;background-color: #49483e">}</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;background-color: #49483e">],</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;rowFormat&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;JSON&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;data&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">
      </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;kind&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;INSERT&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;fields&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">
          </span><span style="color: #e6db74">&#34;fb1a5f06643364bc82a9a4e0bd3e9c10&#34;</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;background-color: #49483e">]</span><span style="color: #f8f8f2">
      </span><span style="color: #f8f8f2;background-color: #49483e">}</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;background-color: #49483e">]</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;background-color: #49483e">},</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;nextResultUri&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;/v2/sessions/41ec5bb8-3574-4c6b-9b47-7bf9aa021ccc/operations/9bb84ff8-89a6-4f94-8dcc-e9125091c63b/result/1?rowFormat=JSON&#34;</span><span style="color: #f8f8f2">
</span><span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because <code>resultType</code> is not <code>EOS</code> and thereâ€™s a value for <code>nextResultUri</code> it tells us thereâ€™s more to fetch - at the location specified in <code>nextResultUri</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="json"><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;resultType&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;EOS&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;isQueryResult&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef;font-weight: bold">false</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;jobID&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;fb1a5f06643364bc82a9a4e0bd3e9c10&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;resultKind&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;SUCCESS_WITH_CONTENT&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;font-weight: bold">&#34;results&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;columns&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">
      </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;name&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;job id&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;logicalType&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
          </span><span style="color: #f8f8f2;font-weight: bold">&#34;type&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;VARCHAR&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
          </span><span style="color: #f8f8f2;font-weight: bold">&#34;nullable&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef;font-weight: bold">true</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
          </span><span style="color: #f8f8f2;font-weight: bold">&#34;length&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">2147483647</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;background-color: #49483e">},</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;font-weight: bold">&#34;comment&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef;font-weight: bold">null</span><span style="color: #f8f8f2">
      </span><span style="color: #f8f8f2;background-color: #49483e">}</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;background-color: #49483e">],</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;rowFormat&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;JSON&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;data&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">[]</span><span style="color: #f8f8f2">
  </span><span style="color: #f8f8f2;background-color: #49483e">}</span><span style="color: #f8f8f2">
</span><span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_tidy_up">5. Tidy up&nbsp;<a class="headline-hash" href="#_5_tidy_up">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Good practice is to close the session once youâ€™ve finished with it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>http <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 DELETE <span style="color: #e6db74">&#39;localhost:8083/sessions/&#39;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span>
HTTP/1.1 200 OK
access-control-allow-origin: <span style="color: #66d9ef;font-weight: bold">*</span>
connection: keep-alive
content-length: 19
content-type: application/json<span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2">charset</span><span style="color: #f92672;font-weight: bold">=</span>UTF-8

<span style="color: #f92672;font-weight: bold">{</span>
    <span style="color: #e6db74">&#34;status&#34;</span>: <span style="color: #e6db74">&#34;CLOSED&#34;</span>
<span style="color: #f92672;font-weight: bold">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_a_shell_script_to_execute_flink_sql">Using a Shell script to execute Flink SQL&nbsp;<a class="headline-hash" href="#_using_a_shell_script_to_execute_flink_sql">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>We can use all of the above and a bit of bash to script this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="bash"><span style="color: #f8f8f2">host</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;localhost:8083&#39;</span>

<span style="color: #f8f8f2">SESSIONHANDLE</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">$(</span><span style="color: #f8f8f2">printf</span> <span style="color: #e6db74">&#39;{
  &#34;properties&#34;: {
    &#34;execution.runtime-mode&#34;: &#34;batch&#34;
  }
}&#39;</span>| http  <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 POST <span style="color: #f8f8f2">$host</span><span style="color: #e6db74">&#39;/sessions&#39;</span> <span style="color: #ae81ff">\</span>
 Content-Type:<span style="color: #e6db74">&#39;application/json&#39;</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span> | jq <span style="color: #f92672">-r</span> <span style="color: #e6db74">&#39;.sessionHandle&#39;</span><span style="color: #e6db74">)</span>

<span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&#34;Got session handle: &#34;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span>


<span style="color: #f8f8f2">SQL_STATEMENT_ONE_LINE</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">$(</span><span style="color: #f8f8f2">tr</span> <span style="color: #e6db74">&#39;\n&#39;</span> <span style="color: #e6db74">&#39; &#39;</span> &lt; rmoff.sql<span style="color: #e6db74">)</span>

<span style="color: #f8f8f2">OPERATIONHANDLE</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">$(</span><span style="color: #f8f8f2">printf</span> <span style="color: #e6db74">&#39;{
  &#34;statement&#34;: &#34;%s&#34;
}&#39;</span> <span style="color: #e6db74">&#34;</span><span style="color: #f8f8f2">$SQL_STATEMENT_ONE_LINE</span><span style="color: #e6db74">&#34;</span> | http <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 POST <span style="color: #f8f8f2">$host</span><span style="color: #e6db74">&#39;/sessions/&#39;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span><span style="color: #e6db74">&#39;/statements&#39;</span> <span style="color: #ae81ff">\</span>
 Content-Type:<span style="color: #e6db74">&#39;application/json&#39;</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span> | jq <span style="color: #f92672">-r</span> <span style="color: #e6db74">&#39;.operationHandle&#39;</span><span style="color: #e6db74">)</span>

<span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&#34;Got operation handle: &#34;</span><span style="color: #f8f8f2">$OPERATIONHANDLE</span>

<span style="color: #66d9ef;font-weight: bold">while</span> <span style="color: #f92672;font-weight: bold">[</span> 1 <span style="color: #f92672">-eq</span> 1 <span style="color: #f92672;font-weight: bold">]</span>
<span style="color: #66d9ef;font-weight: bold">do
	</span><span style="color: #f8f8f2">STATUS</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">$(</span>http <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 GET <span style="color: #f8f8f2">$host</span><span style="color: #e6db74">&#39;/sessions/&#39;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span><span style="color: #e6db74">&#39;/operations/&#39;</span><span style="color: #f8f8f2">$OPERATIONHANDLE</span><span style="color: #e6db74">&#39;/status&#39;</span> <span style="color: #ae81ff">\</span>
 Accept:<span style="color: #e6db74">&#39;application/json&#39;</span> | jq <span style="color: #f92672">-r</span> <span style="color: #e6db74">&#39;.status&#39;</span><span style="color: #e6db74">)</span>
	 <span style="color: #f8f8f2">echo</span> <span style="color: #f8f8f2">$STATUS</span>
	<span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f92672;font-weight: bold">[</span> <span style="color: #f8f8f2">$STATUS</span> <span style="color: #f92672;font-weight: bold">!=</span> <span style="color: #e6db74">&#34;RUNNING&#34;</span> <span style="color: #f92672;font-weight: bold">]</span><span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #66d9ef;font-weight: bold">then
		</span><span style="color: #f8f8f2">break
	</span><span style="color: #66d9ef;font-weight: bold">fi
	</span><span style="color: #f8f8f2">sleep </span>2
<span style="color: #66d9ef;font-weight: bold">done

</span><span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\n\n</span><span style="color: #e6db74">----- ðŸ“ƒ RESULTS ðŸ“ƒ -----</span><span style="color: #ae81ff">\n</span><span style="color: #e6db74">&#34;</span>
<span style="color: #f8f8f2">URL</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#39;/sessions/&#39;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span><span style="color: #e6db74">&#39;/operations/&#39;</span><span style="color: #f8f8f2">$OPERATIONHANDLE</span><span style="color: #e6db74">&#39;/result/0?rowFormat=JSON&#39;</span>
<span style="color: #66d9ef;font-weight: bold">while</span> <span style="color: #f92672;font-weight: bold">[</span> 1 <span style="color: #f92672">-eq</span> 1 <span style="color: #f92672;font-weight: bold">]</span>
<span style="color: #66d9ef;font-weight: bold">do
  </span><span style="color: #f8f8f2">RESULT</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">$(</span>http <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 GET <span style="color: #f8f8f2">$host$URL</span> <span style="color: #ae81ff">\</span>
   Accept:<span style="color: #e6db74">&#39;application/json&#39;</span><span style="color: #e6db74">)</span>
  <span style="color: #f8f8f2">echo</span> <span style="color: #f8f8f2">$RESULT</span> | jq <span style="color: #e6db74">&#39;.&#39;</span>
  <span style="color: #f8f8f2">URL</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">$(</span><span style="color: #f8f8f2">echo</span> <span style="color: #f8f8f2">$RESULT</span> | jq <span style="color: #f92672">-r</span> <span style="color: #e6db74">&#39;.nextResultUri // &#34;&#34;&#39;</span><span style="color: #e6db74">)</span>
  <span style="color: #66d9ef;font-weight: bold">if</span> <span style="color: #f92672;font-weight: bold">[</span> <span style="color: #f92672">-z</span> <span style="color: #f8f8f2">$URL</span> <span style="color: #f92672;font-weight: bold">]</span><span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #66d9ef;font-weight: bold">then
    </span><span style="color: #f8f8f2">break
  </span><span style="color: #66d9ef;font-weight: bold">fi
  </span><span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&#34;(next result chunk ðŸ‘‡)&#34;</span>
<span style="color: #66d9ef;font-weight: bold">done

</span><span style="color: #f8f8f2">echo</span> <span style="color: #e6db74">&#34;Closing session ðŸ—‘ï¸&#34;</span>
http <span style="color: #f92672">--follow</span> <span style="color: #f92672">--timeout</span> 3600 DELETE <span style="color: #f8f8f2">$host</span><span style="color: #e6db74">&#39;/sessions/&#39;</span><span style="color: #f8f8f2">$SESSIONHANDLE</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Weâ€™ll put the actual SQL into a file called <code>rmoff.sql</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">CREATE</span> <span style="color: #66d9ef;font-weight: bold">TABLE</span> <span style="color: #f8f8f2;background-color: #49483e">t_foo</span> <span style="color: #66d9ef;font-weight: bold">WITH</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
  <span style="color: #e6db74">&#39;connector&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;filesystem&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#39;path&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;file:///tmp/flink-test&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#39;format&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;csv&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #e6db74">&#39;csv.field-delimiter&#39;</span> <span style="color: #f92672;font-weight: bold">=</span> <span style="color: #e6db74">&#39;,&#39;</span>
<span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f8f8f2;background-color: #49483e">name</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">cnt</span> <span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">(</span>
  <span style="color: #66d9ef;font-weight: bold">VALUES</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;Bob&#39;</span><span style="color: #f8f8f2;background-color: #49483e">),</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;Alice&#39;</span><span style="color: #f8f8f2;background-color: #49483e">),</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;Greg&#39;</span><span style="color: #f8f8f2;background-color: #49483e">),</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;Bob&#39;</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">NameTable</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">name</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">GROUP</span> <span style="color: #66d9ef;font-weight: bold">BY</span> <span style="color: #f8f8f2;background-color: #49483e">name</span><span style="color: #f8f8f2;background-color: #49483e">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when we run the shell script, we get this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">Got session handle: 8d7dc671-d7aa-4ddb-ba04-706b0311aa69
Got operation handle: 3aa41360-bd21-453a-a759-b54db69c81ae
RUNNING
FINISHED


<span style="color: #f92672">-----</span> ðŸ“ƒ RESULTS ðŸ“ƒ <span style="color: #f92672">-----</span>

<span style="color: #f92672;font-weight: bold">{</span>
  <span style="color: #e6db74">&#34;resultType&#34;</span>: <span style="color: #e6db74">&#34;PAYLOAD&#34;</span>,
  <span style="color: #e6db74">&#34;isQueryResult&#34;</span>: <span style="color: #f8f8f2">false</span>,
  <span style="color: #e6db74">&#34;jobID&#34;</span>: <span style="color: #e6db74">&#34;615365befee24c53d1efa195f9d72eee&#34;</span>,
  <span style="color: #e6db74">&#34;resultKind&#34;</span>: <span style="color: #e6db74">&#34;SUCCESS_WITH_CONTENT&#34;</span>,
  <span style="color: #e6db74">&#34;results&#34;</span>: <span style="color: #f92672;font-weight: bold">{</span>
    <span style="color: #e6db74">&#34;columns&#34;</span>: <span style="color: #f92672;font-weight: bold">[</span>
      <span style="color: #f92672;font-weight: bold">{</span>
        <span style="color: #e6db74">&#34;name&#34;</span>: <span style="color: #e6db74">&#34;job id&#34;</span>,
        <span style="color: #e6db74">&#34;logicalType&#34;</span>: <span style="color: #f92672;font-weight: bold">{</span>
          <span style="color: #e6db74">&#34;type&#34;</span>: <span style="color: #e6db74">&#34;VARCHAR&#34;</span>,
          <span style="color: #e6db74">&#34;nullable&#34;</span>: <span style="color: #f8f8f2">true</span>,
          <span style="color: #e6db74">&#34;length&#34;</span>: 2147483647
        <span style="color: #f92672;font-weight: bold">}</span>,
        <span style="color: #e6db74">&#34;comment&#34;</span>: null
      <span style="color: #f92672;font-weight: bold">}</span>
    <span style="color: #f92672;font-weight: bold">]</span>,
    <span style="color: #e6db74">&#34;rowFormat&#34;</span>: <span style="color: #e6db74">&#34;JSON&#34;</span>,
    <span style="color: #e6db74">&#34;data&#34;</span>: <span style="color: #f92672;font-weight: bold">[</span>
      <span style="color: #f92672;font-weight: bold">{</span>
        <span style="color: #e6db74">&#34;kind&#34;</span>: <span style="color: #e6db74">&#34;INSERT&#34;</span>,
        <span style="color: #e6db74">&#34;fields&#34;</span>: <span style="color: #f92672;font-weight: bold">[</span>
          <span style="color: #e6db74">&#34;615365befee24c53d1efa195f9d72eee&#34;</span>
        <span style="color: #f92672;font-weight: bold">]</span>
      <span style="color: #f92672;font-weight: bold">}</span>
    <span style="color: #f92672;font-weight: bold">]</span>
  <span style="color: #f92672;font-weight: bold">}</span>,
  <span style="color: #e6db74">&#34;nextResultUri&#34;</span>: <span style="color: #e6db74">&#34;/v2/sessions/8d7dc671-d7aa-4ddb-ba04-706b0311aa69/operations/3aa41360-bd21-453a-a759-b54db69c81ae/result/1?rowFormat=JSON&#34;</span>
<span style="color: #f92672;font-weight: bold">}</span>
<span style="color: #f92672;font-weight: bold">(</span>next result chunk ðŸ‘‡<span style="color: #f92672;font-weight: bold">)</span>
<span style="color: #f92672;font-weight: bold">{</span>
  <span style="color: #e6db74">&#34;resultType&#34;</span>: <span style="color: #e6db74">&#34;EOS&#34;</span>,
  <span style="color: #e6db74">&#34;isQueryResult&#34;</span>: <span style="color: #f8f8f2">false</span>,
  <span style="color: #e6db74">&#34;jobID&#34;</span>: <span style="color: #e6db74">&#34;615365befee24c53d1efa195f9d72eee&#34;</span>,
  <span style="color: #e6db74">&#34;resultKind&#34;</span>: <span style="color: #e6db74">&#34;SUCCESS_WITH_CONTENT&#34;</span>,
  <span style="color: #e6db74">&#34;results&#34;</span>: <span style="color: #f92672;font-weight: bold">{</span>
    <span style="color: #e6db74">&#34;columns&#34;</span>: <span style="color: #f92672;font-weight: bold">[</span>
      <span style="color: #f92672;font-weight: bold">{</span>
        <span style="color: #e6db74">&#34;name&#34;</span>: <span style="color: #e6db74">&#34;job id&#34;</span>,
        <span style="color: #e6db74">&#34;logicalType&#34;</span>: <span style="color: #f92672;font-weight: bold">{</span>
          <span style="color: #e6db74">&#34;type&#34;</span>: <span style="color: #e6db74">&#34;VARCHAR&#34;</span>,
          <span style="color: #e6db74">&#34;nullable&#34;</span>: <span style="color: #f8f8f2">true</span>,
          <span style="color: #e6db74">&#34;length&#34;</span>: 2147483647
        <span style="color: #f92672;font-weight: bold">}</span>,
        <span style="color: #e6db74">&#34;comment&#34;</span>: null
      <span style="color: #f92672;font-weight: bold">}</span>
    <span style="color: #f92672;font-weight: bold">]</span>,
    <span style="color: #e6db74">&#34;rowFormat&#34;</span>: <span style="color: #e6db74">&#34;JSON&#34;</span>,
    <span style="color: #e6db74">&#34;data&#34;</span>: <span style="color: #f92672;font-weight: bold">[]</span>
  <span style="color: #f92672;font-weight: bold">}</span>
<span style="color: #f92672;font-weight: bold">}</span>
Closing session ðŸ—‘ï¸
HTTP/1.1 200 OK
access-control-allow-origin: <span style="color: #66d9ef;font-weight: bold">*</span>
connection: keep-alive
content-length: 19
content-type: application/json<span style="color: #f8f8f2;background-color: #49483e">;</span> <span style="color: #f8f8f2">charset</span><span style="color: #f92672;font-weight: bold">=</span>UTF-8

<span style="color: #f92672;font-weight: bold">{</span>
    <span style="color: #e6db74">&#34;status&#34;</span>: <span style="color: #e6db74">&#34;CLOSED&#34;</span>
<span style="color: #f92672;font-weight: bold">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The actual SQL we ran wrote a CSV file to the <code>/tmp</code> folder, so letâ€™s go and check that it worked:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">ls</span> <span style="color: #f92672">-lrt</span> /tmp/flink-test <span style="color: #f92672;font-weight: bold">&amp;&amp;</span> <span style="color: #f8f8f2">cat</span> /tmp/flink-test/<span style="color: #66d9ef;font-weight: bold">*</span>
<span style="color: #f92672">-rw-r--r--</span>@ 1 rmoff  wheel  21  7 Mar 18:07 part-f50c05ae-e39e-40c1-8b00-b1a1ebfced0d-task-0-file-0
Alice,1
Bob,2
Greg,1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nice - it is exactly as expected.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_where_next">Where Next?&nbsp;<a class="headline-hash" href="#_where_next">ðŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to learn more about Flink SQL you might be interested in understanding more about the  <a href="/2024/02/16/catalogs-in-flink-sqla-primer/">role of the Catalog</a> ,  <a href="/2024/02/19/catalogs-in-flink-sqlhands-on/">hands-on examples</a>  of using the Catalog, or a deep dive into  <a href="/2024/02/27/flink-sql-and-the-joy-of-jars/">using JARs with Flink SQL</a> .</p>
</div>
<div class="paragraph">
<p>You might also be interested to try our Decodable which provides a fully managed Apache Flink and Debezium service.
Our  <a href="https://docs.decodable.co/cli/cli-quick-start.html#_pipelines">CLI</a>  and  <a href="https://docs.decodable.co/api/control-plane.html#tag/pipeline-operations/post/pipelines">API</a>  both support deployment of pipelines with Flink SQL.</p>
</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_here_comes_the_postman">Here Comes the Postman</a></li>
    <li><a href="#_running_a_sql_statement_with_the_flink_sql_gateway">Running a SQL Statement with the Flink SQL Gateway</a></li>
    <li><a href="#_0_check_the_connection_and_flink_version">0. Check the connection and Flink version</a></li>
    <li><a href="#_1_create_a_session">1. Create a session</a>
      <ul>
        <li><a href="#_optional_validate_session_and_read_session_config">[Optional] Validate session and read session config</a></li>
      </ul>
    </li>
    <li><a href="#_2_submit_a_sql_statement">2. Submit a SQL statement</a></li>
    <li><a href="#_3_get_statement_execution_status">3. Get Statement Execution Status</a></li>
    <li><a href="#_4_get_results">4. Get Results</a></li>
    <li><a href="#_5_tidy_up">5. Tidy up</a></li>
    <li><a href="#_using_a_shell_script_to_execute_flink_sql">Using a Shell script to execute Flink SQL</a></li>
    <li><a href="#_where_next">Where Next?</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
