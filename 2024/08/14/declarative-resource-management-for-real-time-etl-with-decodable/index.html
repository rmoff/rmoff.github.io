<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		
		<title>Declarative Resource Management for Real-time ETL with Decodable</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2024/08/14/declarative-resource-management-for-real-time-etl-with-decodable/">
		
		

		
		<meta property="og:title" content="Declarative Resource Management for Real-time ETL with Decodable" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2024/08/declarative-resource-management.webp" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2024/08/14/declarative-resource-management-for-real-time-etl-with-decodable/" />
		<meta property="og:site_name" content="Declarative Resource Management for Real-time ETL with Decodable" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true  feature-nohdr">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-header">
	<div class="title-box">
		<h1>Declarative Resource Management for Real-time ETL with Decodable</h1>
		<p class="title-subtitle">
			
				Published
				<time datetime="2024-08-14T00:00:00Z">14 Aug 2024</time>
				<span class="display-print">by </span>
				 in <a href="https://rmoff.net/categories/decodable">Decodable</a>
				<span class="display-print">at https://rmoff.net/2024/08/14/declarative-resource-management-for-real-time-etl-with-decodable/</span>
			
		</p>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_what_does_declarative_resource_management_look_like">What does declarative resource management look like?</a></li>
    <li><a href="#_you_say_tomato_i_say_potato">üçÖ You say tomato, I say potato? ü•î</a></li>
    <li><a href="#_storing_decodable_resources_in_source_control">Storing Decodable resources in source control</a></li>
    <li><a href="#_handling_secrets">Handling secrets</a></li>
    <li><a href="#_cicd">CI/CD</a></li>
    <li><a href="#_creating_yaml_files">Creating YAML files</a></li>
    <li><a href="#_copying_resources_between_environments">Copying resources between environments</a></li>
    <li><a href="#_templating_resources">Templating Resources</a></li>
    <li><a href="#_get_started_today">Get started today!</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Decodable</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2024/08/declarative-resource-management.webp" style="display:none" alt="">
	<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This post originally appeared on the <a href="https://www.decodable.co/blog/declarative-resource-management">Decodable blog</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>So you‚Äôve built your first real-time ETL pipeline with Decodable: congratulations!
Now what?</p>
</div>
<div class="paragraph">
<p>Well now comes the bit that those cool kids over in the SRE world like to call ‚ÄúGitOps,‚Äù ‚ÄúInfrastructure as Code‚Äù (IaC), or will talk about ‚Äúshift left.‚Äù In more formalised terms, it‚Äôs about being a grown-up and adopting good practices of Software Development Lifecycle (SDLC).
This is all about taking what you‚Äôve built and handling it as we would with any other software artifact, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>putting it in source control</p>
</li>
<li>
<p>optionally, continuous integration (CI) to the main development environment</p>
</li>
<li>
<p>optionally, continuous deployment (CD) to production</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is where declarative resource management comes in.
A core part of Decodable CLIs capabilities, it takes the approach of <em>declaring</em> in a YAML document the resources that should be present, and Decodable figures out how to make it so.
Contrast this to <em>imperatively</em>, in which you are responsible for specifying each resource and orchestrating the order of deployment.</p>
</div>
<div class="paragraph">
<p>For example, to create a sink connection, you‚Äôd need the stream from which it reads to exist first.
In a declarative world, you create a YAML document that specifies the stream and the sink, and Decodable figures out the rest.
Done imperatively, you wouldn‚Äôt be able to create the sink until the stream existed‚Äîwhich if you‚Äôre doing this by hand may be fine, but as soon as you start to try and script it the dependencies start to get complicated pretty quickly.</p>
</div>
<div class="paragraph">
<p>So as we‚Äôre going to see, declarative resource management enables you to tightly integrate Decodable with industry best-practice IaC/GitOps strategies.
It also has further uses, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bulk administration tasks‚Äîsuch as removing all connections that match a particular pattern, perhaps that connect to a server that‚Äôs been decommissioned.</p>
</li>
<li>
<p>Replicating resources from one Decodable environment to another. This could be to template parallel sandbox environments for multiple developers, or to manually deploy changes to an environment if full CI/CD isn‚Äôt in place.</p>
</li>
<li>
<p>Ad-hoc development‚Äîsome developers will simply prefer to interact with Decodable declaratively rather than imperatively.</p>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="_what_does_declarative_resource_management_look_like">What does declarative resource management look like?&nbsp;<a class="headline-hash" href="#_what_does_declarative_resource_management_look_like">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let‚Äôs say we‚Äôd like to create a connection.
Since we‚Äôre thinking <em>declaratively</em> instead of <em>imperatively</em> we create a YAML file that defines the <em>state</em> that we‚Äôd like our Decodable account to be in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #f8f8f2">---</span>
<span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">connection</span>
<span style="color: #a6e22e">metadata</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">datagen-envoy-01</span>
    <span style="color: #a6e22e">description</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">An</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">example</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">of</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">how</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">neat</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">declarative</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">resource</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">management</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">is</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">:)&#34;</span>
<span style="color: #a6e22e">spec_version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">v1</span>
<span style="color: #a6e22e">spec</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">connector</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">datagen</span>
    <span style="color: #a6e22e">type</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">source</span>
    <span style="color: #a6e22e">stream_name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">envoy</span>
    <span style="color: #a6e22e">schema_v2</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">fields</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
            <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">physical</span>
              <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">message</span>
              <span style="color: #a6e22e">type</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">STRING</span>
        <span style="color: #a6e22e">constraints</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">{}</span>
    <span style="color: #a6e22e">properties</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">delay</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">&#34;</span><span style="color: #e6db74">1000&#34;</span>
        <span style="color: #a6e22e">format</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">json</span>
        <span style="color: #a6e22e">data.type</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">envoy</span>
<span style="color: #f8f8f2">---</span>
<span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">stream</span>
<span style="color: #a6e22e">metadata</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">envoy</span>
<span style="color: #a6e22e">spec_version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">v1</span>
<span style="color: #a6e22e">spec</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">schema_v2</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">fields</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
            <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">physical</span>
              <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">message</span>
              <span style="color: #a6e22e">type</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">STRING</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we <em>apply</em> this resource definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable apply datagen01.yaml
<span style="color: #f92672">---</span>
kind: stream
name: envoy
<span style="color: #f8f8f2">id</span>: bc1934c6
result: unchanged
<span style="color: #f92672">---</span>
kind: connection
name: datagen-envoy-01
<span style="color: #f8f8f2">id</span>: a2c30b8c
result: created</code></pre>
</div>
</div>
<div class="paragraph">
<p>And thus it is so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">‚ùØ decodable connection list
<span style="color: #f8f8f2">id        </span>name                               connector     <span style="color: #f8f8f2">type    </span>state    create <span style="color: #f8f8f2">time           </span>update <span style="color: #f8f8f2">time
</span>a2c30b8c  datagen-envoy-01                   datagen       <span style="color: #f8f8f2">source  </span>STOPPED  2024-07-25T09:24:32Z  2024-07-25T09:24:32Z</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see the same thing through the Web UI, if you prefer:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/08/6717dbf782a396e17c578916_6702ad654ba82bb734df7cb6_66b6977a2d7c79ba6e261574_AD_4nXcdWIPXxHmaJLI6Gqg3qjCEjskB0sDknv-lplvcUouJIQtXa6OfbN88_x8RFAEAWv52hUxtRUWsf6MSWI4tMqJAJtZCMJIgtJFuOqa4U3BbFKRByiN8tshvLNeOKPGCwUQq7tBh-zpOPoieiogvcu2be4JH.webp" alt="6717dbf782a396e17c578916 6702ad654ba82bb734df7cb6 66b6977a2d7c79ba6e261574 AD 4nXcdWIPXxHmaJLI6Gqg3qjCEjskB0sDknv lplvcUouJIQtXa6OfbN88 x8RFAEAWv52hUxtRUWsf6MSWI4tMqJAJtZCMJIgtJFuOqa4U3BbFKRByiN8tshvLNeOKPGCwUQq7tBh zpOPoieiogvcu2be4JH"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_you_say_tomato_i_say_potato">üçÖ You say tomato, I say potato? ü•î&nbsp;<a class="headline-hash" href="#_you_say_tomato_i_say_potato">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>So now contrast the above to the imperative approach.
Here we tell Decodable <em>what to do</em>.
From the CLI this would be to run a <code>decodable connection create [‚Ä¶]</code> command.
Pretty much the same thing?
Well, no.
Because when we run this we see the problem straight away:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable connection create <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--name</span> datagen-envoy-01 <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--type</span> <span style="color: #f8f8f2">source</span>           <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--connector</span> datagen     <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">delay</span><span style="color: #f92672;font-weight: bold">=</span>500        <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">format</span><span style="color: #f92672;font-weight: bold">=</span>json      <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--prop</span> data.type<span style="color: #f92672;font-weight: bold">=</span>envoy  <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">message</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>
Error: 409: Resource name <span style="color: #f92672;font-weight: bold">[</span>datagen-envoy-01] is already <span style="color: #66d9ef;font-weight: bold">in </span>use by another resource of the same <span style="color: #f8f8f2">type</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because we‚Äôve said <em>do this thing</em>, the Decodable CLI has gone and created the connection.
Or rather, tried to‚Äîand failed, because it exists already (since we already created it above).</p>
</div>
<div class="paragraph">
<p>If this was part of a deployment script we‚Äôd now have a failure to deal with.
Did we expect the connection to exist?
Are we trying to update it and need to delete it first?
What if it‚Äôs already running?
All of this would fall to us to figure out and code around for the different eventualities.
Instead, by working declaratively, we‚Äôre instead saying <em>we want this thing to be in this state</em> and Decodable then figures out how to make it so.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/08/66b6977a82c940b3869f3cd6_AD_4nXcbDVOcQk0EQS2hTmZJ812klCZ9-ULxKNUREIBOpKaZTCmfw2fg74q3FHGUUfXZ02GX0f-QDqbAdiwWGp4g0EUnQ0rLYunmsM0eFOg4afxOLGNsFZkKbPo2oO-vyrSGTqNDLl7rXTOp-l0RfA1PFHy4boAU.gif" alt="66b6977a82c940b3869f3cd6 AD 4nXcbDVOcQk0EQS2hTmZJ812klCZ9 ULxKNUREIBOpKaZTCmfw2fg74q3FHGUUfXZ02GX0f QDqbAdiwWGp4g0EUnQ0rLYunmsM0eFOg4afxOLGNsFZkKbPo2oO vyrSGTqNDLl7rXTOp l0RfA1PFHy4boAU"/>
</div>
</div>
<div class="paragraph">
<p>This may seem somewhat contrived for a single connection‚Äîbut you‚Äôll very quickly see how it becomes not just beneficial, but <em>essential</em>.</p>
</div>
<div class="paragraph">
<p>A good example of this difference is making a change to an existing connection.
The connection that we created uses a  <a href="https://docs.decodable.co/connect/source/data-generator.html">datagen connector</a> , with configuration telling it to simulate  <a href="https://www.envoyproxy.io/docs/envoy/latest/configuration/observability/access_log/usage#default-format-string">Envoy access logs</a>  generated every 500 milliseconds._
_Let‚Äôs say we want to change that interval to 1000 milliseconds.</p>
</div>
<div class="paragraph">
<p>Done declaratively, we update the value for delay in our <code>datagen01.yaml</code> file.
Since we just dealing with text files, we can even just express this as a diff:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">@@ <span style="color: #f92672">-15</span>,6 +15,6 @@ spec:
<span style="color: #f8f8f2">type</span>: STRING
constraints: <span style="color: #f92672;font-weight: bold">{}</span>
properties:
- delay: <span style="color: #e6db74">&#34;500&#34;</span>
+ delay: <span style="color: #e6db74">&#34;1000&#34;</span>
format: json
data.type: envoy</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then we <em>apply</em> the file again, just as before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable apply connection01.yaml
<span style="color: #f92672">---</span>
kind: stream
name: envoy
<span style="color: #f8f8f2">id</span>: bc1934c6
result: unchanged
<span style="color: #f92672">---</span>
kind: connection
name: datagen-envoy-01
<span style="color: #f8f8f2">id</span>: a2c30b8c
result: updated</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that it‚Äôs exactly the same command that we ran before.</p>
</div>
<div class="paragraph">
<p>If we want to do this imperatively, we need to do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #75715e;font-style: italic"># See if the connection already exists</span>
<span style="color: #f8f8f2">$ </span>decodable connection list | <span style="color: #f8f8f2">grep </span>datagen-envoy-01
a2c30b8c  datagen-envoy-01                   datagen       <span style="color: #f8f8f2">source  </span>STOPPED  2024-07-25T09:24:32Z  2024-07-25T09:43:24Z

<span style="color: #75715e;font-style: italic"># Get the id of the connection</span>
<span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">id</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">$(</span>decodable connection list | <span style="color: #f8f8f2">grep </span>datagen-envoy-01 | <span style="color: #f8f8f2">cut</span> <span style="color: #f92672">-d</span> <span style="color: #e6db74">&#39; &#39;</span> <span style="color: #f92672">-f</span> 1<span style="color: #e6db74">)</span> <span style="color: #f92672;font-weight: bold">&amp;&amp;</span> <span style="color: #f8f8f2">echo</span> <span style="color: #f8f8f2">$id</span>
a2c30b8c

<span style="color: #75715e;font-style: italic"># Delete the connection</span>
<span style="color: #f8f8f2">$ </span>decodable connection delete <span style="color: #f8f8f2">$id</span>
Deleted connection a2c30b8c

<span style="color: #75715e;font-style: italic"># Recreate the connection with the changed interval value</span>
<span style="color: #f8f8f2">$ </span>decodable connection create <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--name</span> datagen-envoy-01 <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--type</span> <span style="color: #f8f8f2">source</span>           <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--connector</span> datagen     <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">delay</span><span style="color: #f92672;font-weight: bold">=</span>1000       <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">format</span><span style="color: #f92672;font-weight: bold">=</span>json      <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--prop</span> data.type<span style="color: #f92672;font-weight: bold">=</span>envoy  <span style="color: #ae81ff">\</span>
      <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">message</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>
Created connection datagen-envoy-01 <span style="color: #f92672;font-weight: bold">(</span>4c7c2c7d<span style="color: #f92672;font-weight: bold">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>‚Ä¶and that‚Äôs before we get onto any kind of error handling, logic branching (we‚Äôre assuming that the connection does exist, but if it doesn‚Äôt we need to skip the deletion, etc), execution control (for example, we can‚Äôt delete a running connection, so we‚Äôd have to stop it first).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_storing_decodable_resources_in_source_control">Storing Decodable resources in source control&nbsp;<a class="headline-hash" href="#_storing_decodable_resources_in_source_control">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>You may have spotted that the YAML file we created above to define the connection is perfectly suited to storing in source control.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/08/6717dbfe82a396e17c5789c5_6702ad654ba82bb734df7cbd_66b6977bfe009ba065241c30_AD_4nXdkT4xf1jkf13GHfJMauqnDY5euzxJKZ9OH3z-2yRJPAv_W0yaVVSTQBtjUurIp5AUQtcQce8fZYx390ryIumH0oMbt-6tm_6A34lo2Luf_ZbX78IQb_wkktVVmkV2dzSy196thksqLR85modAb3tuwVFs.webp" alt="6717dbfe82a396e17c5789c5 6702ad654ba82bb734df7cbd 66b6977bfe009ba065241c30 AD 4nXdkT4xf1jkf13GHfJMauqnDY5euzxJKZ9OH3z 2yRJPAv W0yaVVSTQBtjUurIp5AUQtcQce8fZYx390ryIumH0oMbt 6tm 6A34lo2Luf ZbX78IQb wkktVVmkV2dzSy196thksqLR85modAb3tuwVFs"/>
</div>
</div>
<div class="paragraph">
<p>Just as any software engineer worth their salt these days wouldn‚Äôt dream of not storing their code in a source control tool such as git, the same should be true in the world of data engineering.
The definition of pipelines and connections is our version of ‚Äòcode‚Äô, and being able to store it in source control is important.
It‚Äôs part of a broader adoption of Infrastructure as Code (IaC), with popular examples including Terraform, and Kubernetes‚Äô <code>kubectl</code> tool.</p>
</div>
<div class="paragraph">
<p>How you curate your resources is a matter of personal preference and organizational standards.
You might decide that the connection and its stream are one logical unit and store it as such (as shown in the example above):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">git add datagen01.yaml
git commit <span style="color: #f92672">-m</span> <span style="color: #e6db74">&#34;Datagen connection for envoy, plus envoy stream&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You could alternatively split resources into individual files, which would make a git diff easier to read particularly with a larger number of objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">git add c_datagen-envoy-01.yaml
git commit <span style="color: #f92672">-m</span> <span style="color: #e6db74">&#34;Datagen envoy connection&#34;</span>
git add s_envoy.yaml
git commit <span style="color: #f92672">-m</span> <span style="color: #e6db74">&#34;Envoy stream&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or put different resources in their own folders:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>tree <span style="color: #f8f8f2">.</span>
<span style="color: #f8f8f2">.</span>
‚îú‚îÄ‚îÄ connection
|   ‚îî‚îÄ‚îÄ c_datagen-envoy-01.yaml
‚îî‚îÄ‚îÄ stream
    ‚îî‚îÄ‚îÄ s_envoy.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Decodable CLI will take one or more yaml files as input, so however you arrange them, the declarative resource management remains the same in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #75715e;font-style: italic"># Individual resource files</span>
decodable apply c_datagen-envoy-01.yaml s_envoy.yaml
<span style="color: #75715e;font-style: italic"># Resource folders</span>
decodable apply connection/<span style="color: #66d9ef;font-weight: bold">*</span> stream/<span style="color: #66d9ef;font-weight: bold">*</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Resources in Decodable</strong></p>
</div>
<div class="paragraph">
<p>If you‚Äôre used to using Decodable through the web interface you may not have come across the concept of <em>resource types</em> before, or given them much thought.
When working with declarative resource management in Decodable it‚Äôs important to understand the four resource types and how they interact:
* Streams - unbounded series of data, similar in concept to a topic in Apache Kafka
* Connections - source or sink for getting data from and to external systems
* these write to, or read from, streams
* read secrets for authentication to external systems</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pipelines - transform data. Can be written in SQL or as Flink jobs (known as Custom Pipelines)</p>
</li>
<li>
<p>these write to, or read from, streams</p>
</li>
<li>
<p>Secrets - hold sensitive values such as passwords</p>
</li>
<li>
<p>used in connections (and also available to Custom Pipelines through the  <a href="https://docs.decodable.co/api/pipeline-sdk.html">Decodable SDK</a> )</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_handling_secrets">Handling secrets&nbsp;<a class="headline-hash" href="#_handling_secrets">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>There‚Äôs one important part that we‚Äôve not covered yet that‚Äôs going to be relevant here, and that‚Äôs how <strong>secrets</strong> are dealt with.
These are used to store authentication details that are used by connections and pipelines.
Secrets are useful for two key reasons: they avoid having to hard-code sensitive information, and they enable seamless movement between environments since the authentication details will (hopefully) be different.</p>
</div>
<div class="paragraph">
<p>Secrets are a resource  <a href="https://docs.decodable.co/declarative/definitions.html#secret">defined in YAML</a>  just like a connection, but they have a special way of specifying their value.
You can provide the value as a reference to an environment variable, or the contents of a file.
You can also hardcode it‚Ä¶but you almost certainly don‚Äôt want to do that!</p>
</div>
<div class="paragraph">
<p>Here‚Äôs an example of a snippet of a connection resource definition referencing a secret:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #f8f8f2">---</span>
<span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">connection</span>
<span style="color: #a6e22e">metadata</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">customers-source</span>
<span style="color: #a6e22e">spec_version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">v1</span>
<span style="color: #a6e22e">spec</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">connector</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">postgres-cdc</span>
    <span style="color: #a6e22e">type</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">source</span>
    <span style="color: #a6e22e">properties</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
        <span style="color: #a6e22e">hostname</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">my-pg-host.acme-corp.com</span>
        <span style="color: #a6e22e">username</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">etl_ro_user</span>
        <span style="color: #a6e22e">password</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">etl-ro-secret</span>
<span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">‚Ä¶</span><span style="color: #f8f8f2;background-color: #49483e">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Whilst <code>etl_ro_user</code> is the literal value of the user that will authenticate to Postgres (in this example), <code>etl-ro-secret</code> is a reference to a secret of that name.
Its definition might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #f8f8f2">---</span>
<span style="color: #a6e22e">kind</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">secret</span>
<span style="color: #a6e22e">metadata</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">etl-ro-secret</span>
<span style="color: #a6e22e">spec_version</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">v1</span>
<span style="color: #a6e22e">spec</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">value_env_var</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">ETL_PW</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When this is used, the Decodable CLI will fetch the value of the environment variable <code>ETL_PW</code> and set this as the secret in Decodable.
Here‚Äôs what it looks like in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #75715e;font-style: italic"># With no environment variable set, the apply command will fail</span>
<span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">echo</span> <span style="color: #f8f8f2">$ETL_PW</span>

<span style="color: #f8f8f2">$ </span>decodable apply etl-ro-secret.yaml
Error: secret <span style="color: #f92672;font-weight: bold">[</span>etl-ro-secret] has spec.value_env_var <span style="color: #f92672;font-weight: bold">[</span>ETL_PW] but that environment variable is not <span style="color: #f8f8f2">set</span>

<span style="color: #75715e;font-style: italic"># Set a value for the environment variable</span>
<span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">export </span><span style="color: #f8f8f2">ETL_PW</span><span style="color: #f92672;font-weight: bold">=</span>hunter2
<span style="color: #f8f8f2">$ </span>decodable apply etl-ro-secret.yaml
<span style="color: #f92672">---</span>
kind: secret
name: etl-ro-secret
<span style="color: #f8f8f2">id</span>: 3554ef3b
result: created
‚Ä¢ Wrote plaintext values <span style="color: #66d9ef;font-weight: bold">for </span>secret IDs: <span style="color: #f92672;font-weight: bold">[</span>3554ef3b]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cicd">CI/CD&nbsp;<a class="headline-hash" href="#_cicd">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>With our code in source control, the next step on our GitOps journey is to automate its deployment.
The Decodable CLI can be  <a href="https://docs.decodable.co/cli/integrate-with-github-actions.html">run as part of a GitHub Actions workflow</a> .
Common patterns that you might look to adopt here would be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Staging/Integration</strong>: Commit the resource YAML files in a feature branch. When you merge this into the shared development branch of your repository a workflow runs to deploy the resulting set of resources to a shared development or staging environment for integration/smoke testing.</p>
</li>
<li>
<p><strong>Production release</strong> When you merge into the production branch, a workflow runs to update the production Decodable environment to reflect the resources defined in the production branch of source control.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/08/6717dbfb82a396e17c578988_6702ad654ba82bb734df7cc0_66b6977a6fd0942d524b096c_AD_4nXfxMY8MlckBYPL9bTE_mxX4tmAAZGrcImlW98282PyJpwE56mpYpFbFjty7cIHKTzv8Ks0Mdyn_U14PIKTL8SiwRL1jdqqEhiV61cApz5j_HJWgv_8eLFY8kAtOmBkwOzxQH3fGiIOfqStoRceT6ZA3KsWv.webp" alt="6717dbfb82a396e17c578988 6702ad654ba82bb734df7cc0 66b6977a6fd0942d524b096c AD 4nXfxMY8MlckBYPL9bTE mxX4tmAAZGrcImlW98282PyJpwE56mpYpFbFjty7cIHKTzv8Ks0Mdyn U14PIKTL8SiwRL1jdqqEhiV61cApz5j HJWgv 8eLFY8kAtOmBkwOzxQH3fGiIOfqStoRceT6ZA3KsWv"/>
</div>
</div>
<div class="paragraph">
<p>A workflow for deployment to production might look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="yaml"><span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Deploy Decodable resources</span>
<span style="color: #a6e22e">on</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">push</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">branches</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #e6db74">main</span>
    <span style="color: #a6e22e">paths</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #e6db74">&#39;</span><span style="color: #e6db74">decodable/**&#39;</span> <span style="color: #75715e;font-style: italic"># only trigger if changes have been made under the decodable folder</span>
<span style="color: #a6e22e">jobs</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
  <span style="color: #a6e22e">apply_decodable_resources</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
    <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Apply Decodable Resources</span>
    <span style="color: #a6e22e">runs-on</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">ubuntu-22.04</span>
    <span style="color: #a6e22e">steps</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
      <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Install dependencies</span>
        <span style="color: #a6e22e">run</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">|</span>
          <span style="color: #e6db74">apt-get update &amp;&amp; apt-get install -y curl</span>
      <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Generate the authentication token for Decodable CLI</span>
        <span style="color: #a6e22e">env</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
          <span style="color: #a6e22e">DECODABLE_CLI_CLIENT_ID</span><span style="color: #f8f8f2;background-color: #49483e">:</span>     <span style="color: #e6db74">${{ secrets.DECODABLE_CLI_CLIENT_ID }}</span>
          <span style="color: #a6e22e">DECODABLE_CLI_CLIENT_SECRET</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">${{ secrets.DECODABLE_CLI_CLIENT_SECRET }}</span>
        <span style="color: #75715e;font-style: italic"># See https://docs.decodable.co/cli/integrate-with-github-actions.html</span>
        <span style="color: #a6e22e">run</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">./store-auth.sh</span>
      <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Checkout repository</span>
        <span style="color: #a6e22e">id</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">checkout_repo</span>
        <span style="color: #a6e22e">uses</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">actions/checkout@v4</span>
      <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Install Decodable CLI</span>
        <span style="color: #a6e22e">run</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">|</span>
          <span style="color: #e6db74">curl https://releases.decodable.co/decodable-cli/linux/amd64/decodable-cli-linux-amd64-1.17.0.tar.gz -O</span>
          <span style="color: #e6db74">tar xf decodable-cli-linux-amd64-1.17.0.tar.gz</span>
          <span style="color: #e6db74">mv decodable-cli-linux-amd64-1.17.0/bin/decodable /usr/local/bin/</span>
      <span style="color: #f8f8f2;background-color: #49483e">-</span> <span style="color: #a6e22e">name</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">Apply all the resources under the decodable folder</span>
        <span style="color: #a6e22e">env</span><span style="color: #f8f8f2;background-color: #49483e">:</span>
          <span style="color: #a6e22e">ETL_PW</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #e6db74">${{ secrets.ETL_PW }}</span>
        <span style="color: #a6e22e">run</span><span style="color: #f8f8f2;background-color: #49483e">:</span> <span style="color: #f8f8f2;background-color: #49483e">|</span>
          <span style="color: #e6db74">find ./decodable -type f \( -name &#34;*.yml&#34; -o -name &#34;*.yaml&#34; \) -print0 | \</span>
          <span style="color: #e6db74">xargs -0 decodable apply</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This uses the approach  <a href="https://docs.decodable.co/cli/integrate-with-github-actions.html">described in the documentation</a>  to configure authentication for your Decodable account, and then invokes <code>decodable apply</code> with every YAML file under <code>./decodable</code> as an argument.
The value for secrets (just one shown here, called <code>ETL_PW</code>) is set via an environment variable from a  <a href="https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions">GitHub secret</a> .</p>
</div>
<div class="paragraph">
<p>The excellent thing about declarative resource management is that if nothing has changed in the resource definition then no change will be made to the resource on Decodable.
This means that you can pass the whole set of resource definitions without worry about them getting dropped and recreated, because they‚Äôre simply left alone unless there is a change to make.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>find declarative <span style="color: #f92672">-type</span> f <span style="color: #ae81ff">\(</span> <span style="color: #f92672">-name</span> <span style="color: #e6db74">&#34;*.yml&#34;</span> <span style="color: #f92672">-o</span> <span style="color: #f92672">-name</span> <span style="color: #e6db74">&#34;*.yaml&#34;</span> <span style="color: #ae81ff">\)</span> <span style="color: #f92672">-print0</span> | <span style="color: #ae81ff">\</span>
    xargs <span style="color: #f92672">-0</span> decodable apply
<span style="color: #f92672">---</span>
kind: stream
name: envoy
<span style="color: #f8f8f2">id</span>: bc1934c6
result: created
<span style="color: #f92672">---</span>
kind: connection
name: datagen-envoy-01
<span style="color: #f8f8f2">id</span>: 4c7c2c7d
result: created
<span style="color: #f92672">---</span>
kind: secret
name: etl-ro-secret
<span style="color: #f8f8f2">id</span>: 3554ef3b
result: created</code></pre>
</div>
</div>
<div class="paragraph">
<p>It‚Äôs also worth pointing out that the execution intent is also part of the resource definition.
What‚Äôs that mean?
It means that the execution state of a connection or pipeline‚Äîwhether it should be active, and the task size and count to run the job if so‚Äîis dictated through the declarative process.
After applying a set of YAML files, resources that were running and should be will still be running.
Those that aren‚Äôt that should be, perhaps if they‚Äôve just been created, will then be run.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_yaml_files">Creating YAML files&nbsp;<a class="headline-hash" href="#_creating_yaml_files">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far, I‚Äôve shown you a lot of existing YAML files and how these can be used to declare the resources that should exist on the target Decodable account.
But how are these YAML files created?</p>
</div>
<div class="paragraph">
<p>One option is to lovingly craft them by hand, following the  <a href="https://docs.decodable.co/declarative/definitions.html">documented spec</a> .
That‚Äôs fine if writing raw YAML is your thing.
Quite possibly though, you‚Äôll want to get the definition of <em>existing</em> resources on your Decodable account.
This could be so that you can then modify it to suit the definition of a new resource (and it‚Äôs quicker than writing it from scratch).
But this is also a great way to quickly get a dump of some, or all, your resources in a form that you can then put into source control (like we saw above).</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="paragraph">
<p>+
This then provides a very efficient workflow of creating new resources: you first can define new connections and pipelines using the web UI, exploring and defining all their options, and then export them as a declarative resource, so you can put them into revision control, apply them in other environments, etc.</p>
</div>
<div class="paragraph">
<p>At its simplest invocation, the <code>decodable query</code> command returns <em>all</em> information about <em>all</em> resources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable query
<span style="color: #f92672">---</span>
kind: connection
metadata:
    name: datagen-envoy-01
    description: An example of how neat declarative resource management is :<span style="color: #f92672;font-weight: bold">)</span>
spec_version: v1
spec:
    connector: datagen
    <span style="color: #f8f8f2">type</span>: <span style="color: #f8f8f2">source
    </span>stream_name: envoy
    schema_v2:
        fields:
            - kind: physical
              name: message
              <span style="color: #f8f8f2">type</span>: STRING
        constraints: <span style="color: #f92672;font-weight: bold">{}</span>
    properties:
        delay: <span style="color: #e6db74">&#34;1000&#34;</span>
        format: json
        data.type: envoy
status:
    create_time: 2024-07-25T09:48:37.663+00:00
    update_time: 2024-07-25T13:49:48.482+00:00
    target_state: STOPPED
    actual_state: STOPPED
    requested_tasks: 1
    actual_tasks: 0
<span style="color: #f92672">---</span>
kind: connection
metadata:
    name: iceberg-basket_agg
    description: <span style="color: #e6db74">&#34;&#34;</span>
spec_version: v1
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You‚Äôll notice a <code>status</code> field there‚Äîuseful for runtime details, but not if we‚Äôre putting it into source control.
The query command provides an option specifically for this: <code>--export:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable query <span style="color: #f92672">--export</span>
<span style="color: #f92672">---</span>
kind: connection
metadata:
    name: datagen-envoy-01
    description: An example of how neat declarative resource management is :<span style="color: #f92672;font-weight: bold">)</span>
spec_version: v1
spec:
    connector: datagen
    <span style="color: #f8f8f2">type</span>: <span style="color: #f8f8f2">source
    </span>stream_name: envoy
    schema_v2:
        fields:
            - kind: physical
              name: message
              <span style="color: #f8f8f2">type</span>: STRING
        constraints: <span style="color: #f92672;font-weight: bold">{}</span>
    properties:
        delay: <span style="color: #e6db74">&#34;1000&#34;</span>
        format: json
        data.type: envoy
<span style="color: #f92672">---</span>
kind: connection
metadata:
    name: iceberg-basket_agg
    description: <span style="color: #e6db74">&#34;&#34;</span>
spec_version: v1
<span style="color: #f92672;font-weight: bold">[</span>‚Ä¶]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since it‚Äôs YAML that‚Äôs output, you can just redirect this into a target file, and then you have a file ready to be run with <code>decodable apply</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">decodable query <span style="color: #f92672">--export</span> <span style="color: #f92672;font-weight: bold">&gt;</span> decodable-resources.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>What about if you don‚Äôt want all of the resources returned by the query?
A rich set of  <a href="https://docs.decodable.co/declarative/query.html#filter_examples">filter options</a>  is available, such as <code>--name</code>, <code>--kind</code>, and more:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">decodable query <span style="color: #f92672">--name</span> datagen-envoy-01
<span style="color: #f92672">---</span>
kind: connection
metadata:
    name: datagen-envoy-01
    description: An example of how neat declarative resource management is :<span style="color: #f92672;font-weight: bold">)</span>
spec_version: v1
spec:
    connector: datagen
    <span style="color: #f8f8f2">type</span>: <span style="color: #f8f8f2">source
    </span>stream_name: envoy
    schema_v2:
        fields:
            - kind: physical
              name: message
              <span style="color: #f8f8f2">type</span>: STRING
        constraints: <span style="color: #f92672;font-weight: bold">{}</span>
    properties:
        delay: <span style="color: #e6db74">&#34;1000&#34;</span>
        format: json
        data.type: envoy
status:
    create_time: 2024-07-25T09:48:37.663+00:00
    update_time: 2024-07-25T13:49:48.482+00:00
    target_state: STOPPED
    actual_state: STOPPED
    requested_tasks: 1
    actual_tasks: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also do some  <a href="https://docs.decodable.co/declarative/query.html#yq">neat stuff using yq</a>  to post-process the YAML, giving you even more flexibility.
Here‚Äôs an example of getting the resource definitions for all connections that use the Kafka connector:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">decodable query <span style="color: #f92672">--export</span> <span style="color: #f92672">--kind</span> connection | <span style="color: #ae81ff">\</span>
    yq eval-all <span style="color: #e6db74">&#39;select(.spec.connector==&#34;kafka&#34;)&#39;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_copying_resources_between_environments">Copying resources between environments&nbsp;<a class="headline-hash" href="#_copying_resources_between_environments">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>It might have occurred to you by now that if the <code>decodable query</code> command returns YAML that‚Äôs consumable by <code>decodable apply</code>, this could be a nice way to copy resources between environments‚Äîand you‚Äôd be right!</p>
</div>
<div class="paragraph">
<p>You can configure  <a href="https://docs.decodable.co/cli/tips-and-tricks.html#using_multiple_profiles">multiple profiles</a>  in the Decodable CLI.
For each one, make sure you run a <code>decodable login</code>.
Let‚Äôs imagine my default profile is for my development environment, and I want to copy across some resources to the staging environment.
First up, I‚Äôll make sure I‚Äôm authentication to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">decodable login <span style="color: #f92672">--profile</span> staging</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now I can copy resources from my default profile to the staging one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">decodable query <span style="color: #f92672">--name</span> datagen-envoy-01,envoy <span style="color: #f92672">--export</span> | <span style="color: #ae81ff">\</span>
    decodable apply - <span style="color: #f92672">--profile</span> staging
<span style="color: #f92672">---</span>
kind: stream
name: envoy
<span style="color: #f8f8f2">id</span>: a0567f3e
result: created
<span style="color: #f92672">---</span>
kind: connection
name: datagen-envoy-01
<span style="color: #f8f8f2">id</span>: cdf9dfb2
result: created</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the use of the ‚Äì to tell the apply command to read from <code>stdin</code>.
Now I have the connection and stream in my staging environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">decodable query <span style="color: #f92672">--metadata-only</span> <span style="color: #f92672">--profile</span> staging
<span style="color: #f92672">---</span>
kind: stream
metadata:
    name: envoy
<span style="color: #f92672">---</span>
kind: connection
metadata:
    name: datagen-envoy-01
    description: An example of how neat declarative resource management is :<span style="color: #f92672;font-weight: bold">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, it‚Äôd probably be better practice to write the resource YAML to a file that‚Äôs getting committed to source control, and from <em>there</em> applied to the target Decodable environment.
But for quick ad-hoc resource migration, this works just great.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_templating_resources">Templating Resources&nbsp;<a class="headline-hash" href="#_templating_resources">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Another advantage of declarative resource management in Decodable is that it makes it easy to use templating to apply many resources of similar but slightly varying definitions.
For example, you might have multiple Postgres databases which are logically identical but split across geographical locations.
You want to set up each one as a connection in Decodable.</p>
</div>
<div class="paragraph">
<p>One option is you copy and paste 98% of the same content each time and hard code a set of files that are almost-but-not-quite the same:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/08/6717dc0082a396e17c578a15_6702ad654ba82bb734df7cc4_66b6977a628a4cd7eedf3bb9_AD_4nXcCLoHiWqS2pEZEjWo0CjlxUlKDU7969Rfn0OOy-Y7OB4DFUCxOz7f3V660o7fxwNComFXaZKEY-2Jy5yfINEOcWeqT-skz0wtdwwSyohEADk574zrjLRpMvq5gnBrO75GRfKDr2dSAHprgKDPs34qWyYH5.webp" alt="6717dc0082a396e17c578a15 6702ad654ba82bb734df7cc4 66b6977a628a4cd7eedf3bb9 AD 4nXcCLoHiWqS2pEZEjWo0CjlxUlKDU7969Rfn0OOy Y7OB4DFUCxOz7f3V660o7fxwNComFXaZKEY 2Jy5yfINEOcWeqT skz0wtdwwSyohEADk574zrjLRpMvq5gnBrO75GRfKDr2dSAHprgKDPs34qWyYH5"/>
</div>
</div>
<div class="paragraph">
<p>You now have a bunch of files to manage, all of which need updating if something changes.</p>
</div>
<div class="paragraph">
<p>The better option here is to template it and generate the YAML dynamically.
Tools that are commonly used for this include  <a href="https://jsonnet.org/">jsonnet</a>  and  <a href="https://kustomize.io/">kustomize</a> .
Here‚Äôs an example with jsonnet.
First we create the template connection in a function called <code>makeConnection</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="json"><span style="color: #960050;background-color: #1e0010">local</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">makeConnection(location)</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">=</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
 </span><span style="color: #960050;background-color: #1e0010">kind:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;connection&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
 </span><span style="color: #960050;background-color: #1e0010">metadata:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
   </span><span style="color: #960050;background-color: #1e0010">name:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;pg-customers-source-&#34;</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">+</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">location</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
   </span><span style="color: #960050;background-color: #1e0010">description:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
 </span><span style="color: #f8f8f2;background-color: #49483e">},</span><span style="color: #f8f8f2">
 </span><span style="color: #960050;background-color: #1e0010">spec_version:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;v1&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
 </span><span style="color: #960050;background-color: #1e0010">spec:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
   </span><span style="color: #960050;background-color: #1e0010">connector:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;postgres-cdc&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
   </span><span style="color: #960050;background-color: #1e0010">type:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;source&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
   </span><span style="color: #960050;background-color: #1e0010">stream_mappings:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">
     </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
       </span><span style="color: #960050;background-color: #1e0010">stream_name:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;customers&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
       </span><span style="color: #960050;background-color: #1e0010">external_resource_specifier:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
         </span><span style="color: #f8f8f2;font-weight: bold">&#34;database-name&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;pg&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
         </span><span style="color: #f8f8f2;font-weight: bold">&#34;schema-name&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;inventory&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
         </span><span style="color: #f8f8f2;font-weight: bold">&#34;table-name&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;customers&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
       </span><span style="color: #f8f8f2;background-color: #49483e">},</span><span style="color: #f8f8f2">
     </span><span style="color: #f8f8f2;background-color: #49483e">},</span><span style="color: #f8f8f2">
   </span><span style="color: #f8f8f2;background-color: #49483e">],</span><span style="color: #f8f8f2">
   </span><span style="color: #960050;background-color: #1e0010">properties:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
     </span><span style="color: #960050;background-color: #1e0010">hostname:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;location-&#34;</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">+</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">location</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">+</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;.acme-corp.com&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
     </span><span style="color: #960050;background-color: #1e0010">password:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;location-&#34;</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">+</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">location</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">+</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;-pg-secret&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
     </span><span style="color: #960050;background-color: #1e0010">port:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;5432&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
     </span><span style="color: #f8f8f2;font-weight: bold">&#34;database-name&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;pg&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
     </span><span style="color: #f8f8f2;font-weight: bold">&#34;decoding.plugin.name&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;pgoutput&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
     </span><span style="color: #960050;background-color: #1e0010">username:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;etl-ro&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
   </span><span style="color: #f8f8f2;background-color: #49483e">},</span><span style="color: #f8f8f2">
 </span><span style="color: #f8f8f2;background-color: #49483e">},</span><span style="color: #f8f8f2">
</span><span style="color: #f8f8f2;background-color: #49483e">}</span><span style="color: #960050;background-color: #1e0010">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and then in the same file invoke that function for the list of locations for which we want to create connections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="json"><span style="color: #960050;background-color: #1e0010">local</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">locations</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">=</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">
 </span><span style="color: #e6db74">&#34;london&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
 </span><span style="color: #e6db74">&#34;leeds&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
 </span><span style="color: #e6db74">&#34;leamington-spa&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
 </span><span style="color: #e6db74">&#34;llandudno&#34;</span><span style="color: #f8f8f2">
</span><span style="color: #f8f8f2;background-color: #49483e">]</span><span style="color: #960050;background-color: #1e0010">;</span><span style="color: #f8f8f2">

</span><span style="color: #960050;background-color: #1e0010">std.manifestYamlStream(</span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">
 </span><span style="color: #960050;background-color: #1e0010">makeConnection(location)</span><span style="color: #f8f8f2">
 </span><span style="color: #960050;background-color: #1e0010">for</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">location</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">in</span><span style="color: #f8f8f2"> </span><span style="color: #960050;background-color: #1e0010">locations</span><span style="color: #f8f8f2">
</span><span style="color: #f8f8f2;background-color: #49483e">]</span><span style="color: #960050;background-color: #1e0010">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we invoke jsonnet and pass the output through <code>yq</code> to format it as YAML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">jsonnet <span style="color: #f92672">-S</span> store-connections.jsonnet | yq <span style="color: #f92672">-P</span> <span style="color: #f92672;font-weight: bold">&gt;</span> connections.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>With that we have a file of connection resource definitions that we can use with <code>decodable apply</code>, in this case four different connections, one for each location, using a different hostname and connection name for each:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span><span style="color: #f8f8f2">grep</span> <span style="color: #f92672">-E</span> <span style="color: #e6db74">&#34;</span><span style="color: #ae81ff">\s</span><span style="color: #e6db74">name|hostname&#34;</span> connections.yaml


  name: pg-customers-source-london
    <span style="color: #f8f8f2">hostname</span>: location-london.acme-corp.com
  name: pg-customers-source-leeds
    <span style="color: #f8f8f2">hostname</span>: location-leeds.acme-corp.com
  name: pg-customers-source-leamington-spa
    <span style="color: #f8f8f2">hostname</span>: location-leamington-spa.acme-corp.com
  name: pg-customers-source-llandudno
    <span style="color: #f8f8f2">hostname</span>: location-llandudno.acme-corp.com</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_get_started_today">Get started today!&nbsp;<a class="headline-hash" href="#_get_started_today">üîó</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Declarative resource management in Decodable is, as you‚Äôve seen above, fantastically powerful.
Not only does it enable SDLC best-practices such as source control and GitOps, but comes with numerous other uses such as ad-hoc resource management, migration between environments, and even deleting resources.</p>
</div>
<div class="paragraph">
<p>You can find full details in  <a href="https://docs.decodable.co/declarative/overview.html">the documentation</a> .
<a href="https://app.decodable.co/-/accounts/create">Sign up with Decodable</a>  for free today to give it a try.</p>
</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_what_does_declarative_resource_management_look_like">What does declarative resource management look like?</a></li>
    <li><a href="#_you_say_tomato_i_say_potato">üçÖ You say tomato, I say potato? ü•î</a></li>
    <li><a href="#_storing_decodable_resources_in_source_control">Storing Decodable resources in source control</a></li>
    <li><a href="#_handling_secrets">Handling secrets</a></li>
    <li><a href="#_cicd">CI/CD</a></li>
    <li><a href="#_creating_yaml_files">Creating YAML files</a></li>
    <li><a href="#_copying_resources_between_environments">Copying resources between environments</a></li>
    <li><a href="#_templating_resources">Templating Resources</a></li>
    <li><a href="#_get_started_today">Get started today!</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
