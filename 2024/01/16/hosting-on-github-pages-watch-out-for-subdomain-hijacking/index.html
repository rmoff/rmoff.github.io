<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Hosting on GitHub Pages? Watch out for Subdomain Hijacking</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2024/01/16/hosting-on-github-pages-watch-out-for-subdomain-hijacking/">
		
		
		
		
		
		<meta property="og:title" content="Hosting on GitHub Pages? Watch out for Subdomain Hijacking" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2024/01/h_IMG_7345.webp" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2024/01/16/hosting-on-github-pages-watch-out-for-subdomain-hijacking/" />
		<meta property="og:site_name" content="Hosting on GitHub Pages? Watch out for Subdomain Hijacking" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<link rel="stylesheet" href="https://rmoff.net/css/tachyons.min.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/story.css" />
		<link rel="stylesheet" href="https://rmoff.net/css/descartes.css" />
		
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans:400,400i,700,700i|Quattrocento:400,700|Spectral:400,400i,700,700i&amp;subset=latin-ext" rel="stylesheet">
		

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		
		<script src="https://rmoff.net/js/story.js"></script>

	</head>
	<body class="ma0 bg-white section-post page-kind-page is-page-true ">
		
		<header class="cover bg-top" style="background-image: url('https://rmoff.net/images/2024/01/h_IMG_7345.webp'); background-position: center;">
			<div class="bg-black-30 bb bt">

				<nav class="hide-print sans-serif  border-box pa3 ph5-l">
					<a href="https://rmoff.net" title="Home">
						<img src="https://rmoff.net/img/logo.jpg" class="w2 h2 br-100" alt="rmoff&#39;s random ramblings" />
					</a>
					<div class="fr h2 pv2 tr">
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net/bio">about</a>
						<a class="link f5 ml2 dim near-white" href="https://talks.rmoff.net">talks</a>
						<a class="link f5 ml2 dim near-white" href="https://bsky.app/profile/rmoff.net"><i class="fa-brands fa-bluesky"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://github.com/rmoff/"><i class="fab fa-github-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.youtube.com/c/rmoff"><i class="fab fa-youtube-square"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://www.linkedin.com/in/robinmoffatt/"><i class="fab fa-linkedin"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://data-folks.masto.host/@rmoff"><i class="fab fa-mastodon"></i></a>
						<a class="link f5 ml2 dim near-white" href="https://twitter.com/rmoff/"><i class="fab fa-twitter-square"></i></a>
						<a class="link f5 ml2 dim near-white fas fa-rss-square" href="https://rmoff.net/index.xml" title="RSS Feed"></a>
						<a class="link f5 ml2 dim near-white fas fa-search" href="https://rmoff.net/search/" role="search" title="Search"></a>
					</div>
				</nav>

				<div id="hdr" class="tc-l pv4-ns pv5-l pv2 ph3 ph4-ns">
					<h1 class="near-white mt1-ns f2 fw3 mb0 mt0 lh-title">Hosting on GitHub Pages? Watch out for Subdomain Hijacking</h1>
					<h2 class="near-white mt3-l mb4-l fw1 f6 f3-l measure-wide-l center lh-copy mt2 mb3">
						
						
							
								Published
								<time datetime="2024-01-16T11:50:36Z">Jan 16, 2024</time>
								<span class="display-print">by </span>
								 in <a href="https://rmoff.net/categories/github" class="no-underline category near-white dim">GitHub</a>, <a href="https://rmoff.net/categories/dns" class="no-underline category near-white dim">DNS</a>
								<span class="display-print">at https://rmoff.net/2024/01/16/hosting-on-github-pages-watch-out-for-subdomain-hijacking/</span>
							
						
					</h2>
				</div>

				
				
				
				<div class="w-100 cf hide-print">
					<a class="fr f6 ma0 pa2 link white-50 dim fas fa-camera" href="https://bsky.app/profile/rmoff.net" title="Photo Credit"></a>
				</div>
				
				

			</div>
		</header>
		
		<main role="main">
		
<article class="center bg-white br-3 pv1 ph4 lh-copy f5 nested-links mw8">
	<div class="paragraph">
<p>A friend messaged me late last night with the scary news that Google had emailed him about a ton of spammy subdomains on his own domain.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/01/g1.webp" alt="A list of spam domains as reported by Google"/>
</div>
</div>
<div class="paragraph">
<p><em>Any idea how this could have happened, he asked?</em></p>
</div>
<div class="paragraph">
<p>Security is <strong>not</strong> my bag, but I do like poking around things to understand how they tick, and this particular exploit kinda intrigued me by its simplicity. I’m a big advocate of running your own blog, but the downside is you also own some (PaaS) or all (IaaS) of the security. Here’s an example where things can slip if you’re not careful.</p>
</div>
<div class="sect1">
<h2 id="_a_quick_primer_on_github_pages">A Quick Primer on GitHub Pages&nbsp;<a class="headline-hash" href="#_a_quick_primer_on_github_pages">🔗</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://pages.github.com/">GitHub Pages</a> give you the very nice ability to host a static site for free. Dump some HTML into a GitHub repository, tell GitHub to activate it for GitHub Pages, and off you go!</p>
</div>
<div class="paragraph">
<p>What’s more, you can use a <a href="https://docs.github.com/en/pages/configuring-a-custom-domain-for-your-github-pages-site">custom domain</a>. So instead of <code>your_user.github.io</code> you can send users to <code>fancy-website.com</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_github_pages_is_one_set_of_servers_serving_many_websites_not_just_yours">GitHub Pages Is One Set Of Servers Serving Many Websites Not Just Yours&nbsp;<a class="headline-hash" href="#_github_pages_is_one_set_of_servers_serving_many_websites_not_just_yours">🔗</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you breathlessly type in <code>rmoff.net</code> to your browser to read my latest ramblings it’s not going to a dedicated IP address. It’s going to the GitHub Pages web server farm, which sees the request for <code>rmoff.net</code> and happily serves up the requested content.</p>
</div>
<div class="paragraph">
<p>How does your browser know to ask GitHub Pages for <code>rmoff.net</code>? DNS.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">❯ nslookup rmoff.net
Server:         192.168.10.1
Address:        192.168.10.1#53

Non-authoritative answer:
Name:   rmoff.net
Address: 185.199.108.153</code></pre>
</div>
</div>
<div class="paragraph">
<p>That <code>185.199.108.153</code> is an IP address for GitHub Pages&#39; servers, and it’s where your browser will fetch the actual content from.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_heres_the_hijack">Here’s the Hijack&nbsp;<a class="headline-hash" href="#_heres_the_hijack">🔗</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let’s look at a real example, using another of my domains—<code>rmoff.info</code>.</p>
</div>
<div class="sect2">
<h3 id="_part_1_dns_cname_wildcard">Part 1 - DNS CNAME Wildcard&nbsp;<a class="headline-hash" href="#_part_1_dns_cname_wildcard">🔗</a> </h3>
<div class="paragraph">
<p>Here’s a seemingly-innocuous (to the untrained eye, i.e. me) set of DNS records for <code>rmoff.info</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/01/dns1.webp" alt="DNS records for rmoff.info pointing to GH servers"/>
</div>
</div>
<div class="paragraph">
<p>The brace of IP addresses is the servers from which GitHub Pages is serving the rmoff.info site.</p>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you’re eagle-eyed you might notice that the list here <em>includes</em> the IP address that we saw above, which is for a <strong>different</strong> domain. That’s by design and key to this issue.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>So if I lookup the IP address for <code>rmoff.info</code>, as expected I get back this set of IPs for GitHub Pages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">❯ dig +short moff.info
185.199.108.153
185.199.111.153
185.199.110.153
185.199.109.153</code></pre>
</div>
</div>
<div class="paragraph">
<p>What about a random subdomain?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="bash">❯ dig +short spammy-crap.rmoff.info
rmoff.info.
185.199.108.153
185.199.111.153
185.199.110.153
185.199.109.153</code></pre>
</div>
</div>
<div class="paragraph">
<p>Huh - turns out I <strong>also</strong> get the IP addresses for the GitHub Pages servers.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/01/dns2.webp" alt="Wilcard DNS records for rmoff.info"/>
</div>
</div>
<div class="paragraph">
<p>Herein lies the first part of the problem. The wildcard CNAME entry will match <strong>any</strong> subdomain and redirect it to <code>rmoff.info</code> (known as the &#34;apex&#34;, or root). This in turn is configured as we saw above to point to the GitHub Pages addresses. And thus any request for a subdomain will be directed to GitHub Pages&#39; servers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_part_2_github_pages_is_not_fussy">Part 2 - GitHub Pages Is Not Fussy&nbsp;<a class="headline-hash" href="#_part_2_github_pages_is_not_fussy">🔗</a> </h3>
<div class="paragraph">
<p>When I create <a href="https://github.com/rmoff/rmoff.github.io/blob/master/CNAME">the <code>CNAME</code> for my blog on GitHub Pages</a> I can put <strong>anything</strong> there. Same with the custom domain configuration in GitHub Pages settings:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/01/ghp1.webp" alt="ghp1"/>
</div>
</div>
<div class="paragraph">
<p>All this does is tell the GitHub Pages web servers that this content here is for the domain I tell it. If I decide to put in a domain that I don’t own but want to use for nefarious purposes, I can do so. So let’s say I am a h4x0r and want to pwn some subdomains on <code>rmoff.info</code>. I spin up <a href="https://github.com/rmoff/sdh-test">a GitHub pages repo</a> and put in <code>spammy-crap.rmoff.info</code> as the custom domain.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/01/ghp2.webp" alt="ghp2"/>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
I own <code>rmoff.info</code> so it’s up to me what I do with it, but I’m pretty sure doing this on someone else’s domain with this DNS mis-configuration is gonna be illegal and if not Just Wrong, so don’t.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>This means that anyone who hits the GitHub Pages web servers (which we’ve seen above is fronted by that block of four IP addresses) asking for <code>spammy-crap.rmoff.info</code> is going to get served the contents of <a href="https://github.com/rmoff/sdh-test">the repository that I created</a>.</p>
</div>
<div class="paragraph">
<p>Let’s try it out and go click on 🔗 <a href="http://spammy-crap.rmoff.info">spammy-crap.rmoff.info</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/01/sdh.webp" alt="sdh"/>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connecting_the_dots">Connecting the Dots&nbsp;<a class="headline-hash" href="#_connecting_the_dots">🔗</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>So GitHub Pages can be tricked into serving content for a domain that I don’t own. So what? Who is ever going to find that URL?</p>
</div>
<div class="paragraph">
<p>The next step in the hijacking attack is presumably to try and get Google to index these spam sites (hence the alert that went to my friend), or link to them from other sites, or whatever. The point is, once the URL is out there, it’s in the wild.</p>
</div>
<div class="paragraph">
<p>Now you, as the owner of the domain, appear to be hosting spam sites, bots, and who-knows-what-else.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tldr_be_very_careful_with_wildcards_in_dns_records">tl;dr: Be very careful with wildcards in DNS records&nbsp;<a class="headline-hash" href="#_tldr_be_very_careful_with_wildcards_in_dns_records">🔗</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have a wildcard DNS entry, make sure you know 💯 why it’s there. If not, you are leaving yourself wide open to this kind of hijacking of your subdomains. The reputational damage of spammers and ne’er-do-wells besmirching the good name of your domain is not worth it, whether in the eyes of actual visitors who somehow end up on the page, or Google et al who will see this kind of domain abuse as a reason to downgrade your domain itself. Because scammers won’t just create a simple rick-roll—they’ll create many dozens of subdomains, serving all sorts of botnets, phishing sites, and general crap.</p>
</div>
<div class="paragraph">
<p>And to recap, all that I needed to do to hijack subdomains was:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find a domain with a wildcard in the apex DNS entry (in this case, my own for demonstration purposes).</p>
</li>
<li>
<p>Create a GitHub Pages repository with its custom domain name configured to a subdomain within this domain.</p>
</li>
<li>
<p>That’s it!</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
My thanks to <a href="https://www.linkedin.com/in/oliverhookins/">Oliver Hookins</a> for his rapid help in diagnosing and explaining this issue.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><em>I have, obviously, removed the wildcard DNS record from <code>rmoff.info</code> before publishing this, so don’t even try 😝</em></p>
</div>
<div class="paragraph">
<p><em>I left in place an A record just for <code>spammy-crap</code> so that you can see the domain→GitHub Pages resolution in practice.</em></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/01/dns0.webp" alt="Wait" width="It&#39;s All DNS? Always Has Been"/>
</div>
</div>
</div>
</div>
</article>

		</main>
		
				<div class="hide-print sans-serif f6 f5-l mt5 ph3 pb6 center nested-copy-line-height lh-copy nested-links mw-100 measure-wide">
		<div class="about-the-author">
		
			
			
				
					<hr>
<p><img src="/images/2018/05/ksldn18-01.jpg" alt="Robin Moffatt"></p>
<p><a href="https://www.youtube.com/c/rmoff"><b class="fab fa-youtube-square"></b></a> <a href="https://www.linkedin.com/in/robinmoffatt/"><b class="fab fa-linkedin"></b></a> <em><a rel="me" href="https://data-folks.masto.host/@rmoff">Robin Moffatt</a> is a Principal DevEx Engineer at <a href="https://decodable.co">Decodable</a>. He likes writing about himself in the third person, eating good breakfasts, and drinking good beer.</em></p>

				
			
		
		</div>
		
	</div>

		
		
		
		<footer class="hide-print sans-serif f6 fw1 bg-black near-white bottom-0 w-100 pa3" role="contentinfo">
			<p class="w-50 fr tr">
			<a class="no-underline near-white" href="https://github.com/xaprb/story"><img class="dib" title="Made with Hugo and Story" alt="Story logo" src="https://rmoff.net/img/story-logo-white.svg" style="width: 1.5rem; height: 1.5rem" /></a>
			</p>
			<p class="w-50 near-white">
				&copy; 2024 
			</p>
		</footer>
		
	
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-75492960-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

	
	</body>
</html>
