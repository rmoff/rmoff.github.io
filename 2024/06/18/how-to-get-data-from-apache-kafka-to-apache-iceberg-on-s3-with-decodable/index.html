<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett">
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="preload" as="image" href="https://rmoff.net/images/2024/06/kafka-iceberg-decodable.webp" >
		
		<title>How to get data from Apache Kafka to Apache Iceberg on S3 with Decodable</title>
		<link rel="alternate" type="application/rss+xml" title="RSS" href="https://rmoff.net/index.xml">
		<link rel="canonical" href="https://rmoff.net/2024/06/18/how-to-get-data-from-apache-kafka-to-apache-iceberg-on-s3-with-decodable/">
		
		

		
		<meta property="og:title" content="How to get data from Apache Kafka to Apache Iceberg on S3 with Decodable" />
		<meta property="og:type" content="article" />
		<meta property="og:image" content="https://rmoff.net/images/2024/06/kafka-iceberg-decodable.webp" />
		<meta property="og:description" content="" />
		<meta property="og:url" content="https://rmoff.net/2024/06/18/how-to-get-data-from-apache-kafka-to-apache-iceberg-on-s3-with-decodable/" />
		<meta property="og:site_name" content="How to get data from Apache Kafka to Apache Iceberg on S3 with Decodable" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@" />


		
		<style>
			html { background-color: #FAF8F5; color: #2D2926; }
			body { opacity: 0; transition: opacity 0.1s ease; }
			body.loaded { opacity: 1; }
			.site-header { height: 60px; background-color: #FAF8F5; border-bottom: 1px solid #E8421E; }
		</style>

		
		
		<link rel="stylesheet" href="https://rmoff.net/css/redesign.css" />
		
		<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap">
		<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
		<noscript><link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,600;12..96,700;12..96,800&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@400;500;600&display=swap" rel="stylesheet"></noscript>
		

		
		<script src="/js/copy-code.js"></script>
		

		
		<script>
			!function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.crossOrigin="anonymous",p.async=!0,p.src=s.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="init capture register register_once register_for_session unregister unregister_for_session getFeatureFlag getFeatureFlagPayload isFeatureEnabled reloadFeatureFlags updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures on onFeatureFlags onSessionId getSurveys getActiveMatchingSurveys renderSurvey canRenderSurvey getNextSurveyStep identify setPersonProperties group resetGroups setPersonPropertiesForFlags resetPersonPropertiesForFlags setGroupPropertiesForFlags resetGroupPropertiesForFlags reset get_distinct_id getGroups get_session_id get_session_replay_url alias set_config startSessionRecording stopSessionRecording sessionRecordingStarted captureException loadToolbar get_property getSessionProperty createPersonProfile opt_in_capturing opt_out_capturing has_opted_in_capturing has_opted_out_capturing clear_opt_in_out_capturing debug".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
            posthog.init('phc_93NEP79Ju4xqXYWXnoLbr4HMW0Iaepj1BGOVoEXYX6P',{api_host:'https://eu.i.posthog.com', person_profiles: 'identified_only'})
		</script>

		
		<script src="https://rmoff.net/js/story.js"></script>
		<script src="https://rmoff.net/js/toc.js"></script>
		<script src="https://rmoff.net/js/medium-mirror.js"></script>
	</head>
	<body class="ma0 section-post page-kind-page is-page-true ">
		<script>document.body.classList.add('loaded');</script>

		<header class="site-header hide-print">
	<div class="site-header-inner">
		<a href="https://rmoff.net/" class="site-title">rmoff's random ramblings</a>
		<nav class="site-nav">
			<a href="/categories/interesting-links/" class="nav-il"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg> Interesting Links</a>
			<span class="nav-sep"></span>
			<a href="/categories/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg> Categories</a>
			<a href="https://rmoff.net/search/"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> Search</a>
			<a href="https://rmoff.net/index.xml"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg> RSS</a>
			<div class="nav-social">
				<a href="https://www.linkedin.com/in/robinmoffatt/" title="linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a>
				<a href="https://twitter.com/rmoff/" title="twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg></a>
				<a href="https://bsky.app/profile/rmoff.net" title="bluesky"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 568 501" fill="currentColor"><path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.659 1 75.291 1 57.946 1-28.906 76.135-1.612 123.121 33.664z"/></svg></a>
				<a href="https://www.youtube.com/c/rmoff" title="youtube"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg></a>
				<a href="https://talks.rmoff.net" title="talks"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="0"/><line x1="12" y1="17" x2="12" y2="22"/><line x1="8" y1="22" x2="16" y2="22"/><polyline points="7 8 12 12 17 8"/></svg></a>
				<a href="https://github.com/rmoff/" title="github"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
			</div>
		</nav>
		<button class="nav-toggle" onclick="document.querySelector('.mobile-nav').classList.toggle('open')" aria-label="Menu">
			<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
		</button>
	</div>
	<nav class="mobile-nav">
		<a href="https://rmoff.net/">Home</a>
		<a href="/categories/">Categories</a>
		<a href="/categories/interesting-links/">Interesting Links</a>
		<a href="https://rmoff.net/search/">Search</a>
		<a href="https://rmoff.net/index.xml">RSS</a>
		<a href="https://www.linkedin.com/in/robinmoffatt/">linkedin</a>
		<a href="https://twitter.com/rmoff/">twitter</a>
		<a href="https://bsky.app/profile/rmoff.net">bluesky</a>
		<a href="https://www.youtube.com/c/rmoff">youtube</a>
		<a href="https://talks.rmoff.net">talks</a>
		<a href="https://github.com/rmoff/">github</a>
	</nav>
</header>


		<main role="main">
		

<div class="article-hero" style="background-image: url('https://rmoff.net/images/2024/06/kafka-iceberg-decodable.webp');">
	<div class="article-hero-overlay">
		<div class="article-hero-content">
			<h1>How to get data from Apache Kafka to Apache Iceberg on S3 with Decodable</h1>
			<p class="article-hero-meta">
				
					<time datetime="2024-06-18T00:00:00Z">18 Jun 2024</time>
					<span class="display-print">by </span>
					 &middot; <a href="https://rmoff.net/categories/apache-kafka">Apache Kafka</a>, <a href="https://rmoff.net/categories/apache-iceberg">Apache Iceberg</a>, <a href="https://rmoff.net/categories/decodable">Decodable</a>
					<span class="display-print">at https://rmoff.net/2024/06/18/how-to-get-data-from-apache-kafka-to-apache-iceberg-on-s3-with-decodable/</span>
				
			</p>
		</div>
	</div>
</div>


<details class="toc-mobile">
	<summary>Table of Contents</summary>
	<nav id="TableOfContents">
  <ul>
    <li><a href="#_step_1_set_up_a_connection_to_kafka">Step 1: Set up a connection to Kafka</a></li>
    <li><a href="#_step_2_set_up_a_connection_to_iceberg">Step 2: Set up a connection to Iceberg</a></li>
    <li><a href="#_using_the_iceberg_data">Using the Iceberg data</a></li>
    <li><a href="#_duckdb">DuckDB</a></li>
    <li><a href="#_amazon_athena_and_quicksight">Amazon Athena and Quicksight</a></li>
    <li><a href="#_learn_more">Learn more</a></li>
    <li><a href="#_resources">Resources</a></li>
  </ul>
</nav>
</details>

<div class="container-fluid docs">
	<div class="row">
		<main class="docs-content" role="main">

<article class="article" data-pagefind-body>
	<span data-pagefind-filter="category" style="display:none">Apache Kafka</span><span data-pagefind-filter="category" style="display:none">Apache Iceberg</span><span data-pagefind-filter="category" style="display:none">Decodable</span>
	<img data-pagefind-meta="image[src]" src="https://rmoff.net/images/2024/06/kafka-iceberg-decodable.webp" style="display:none" alt="">
	<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This post originally appeared on the <a href="https://www.decodable.co/blog/kafka-to-iceberg-with-decodable">Decodable blog</a>.
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p><a href="https://iceberg.apache.org/">Apache Iceberg</a>  is an open table format.
It combines the benefits of data lakes (open standards, cheap object storage) with the good things that data warehouses have, like first-class support for tables and SQL capabilities including updates to data in place, time-travel, and transactions.
With the recent  <a href="https://www.databricks.com/company/newsroom/press-releases/databricks-agrees-acquire-tabular-company-founded-original-creators">acquisition</a>  by Databricks of Tabularâ€”one of the main companies that contribute to Icebergâ€”itâ€™s clear that Iceberg is winning out as one of the primary contenders in this space.</p>
</div>
<div class="paragraph">
<p>With all these benefits, who wouldnâ€™t want to use Iceberg?
And so getting data into it from the ubiquitous real-time streaming tool, <a href="https://kafka.apache.org/">Apache Kafka</a> , is a common requirement.
Perhaps youâ€™ve got data from your microservices that use Kafka as the message broker and you want to land that data to Iceberg for analysis and audit.
Maybe youâ€™re doing data movement between systems with Kafka as the message bus.
Whatever the data youâ€™ve got in Kafka, streaming it in real-time to Iceberg is a piece of cake with Decodable.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/06/6717dc2082a396e17c5796f5_666b8182c3f6e884ad6fefbf_AD_4nXfJJjuYnfNDdRq87E-vQMLH0KruAgoqZxKh30IfnlgatmusWo1qQx-QQzDp3uNdNAag-dKwtneg1fYEOvr_ac_8QRL5j1Do_aX5rejyNSeYhrfYmn0OA6XNOKkvKIec0idcaJr9vzblDwSBeCpJJFG2Gok.webp" alt="6717dc2082a396e17c5796f5 666b8182c3f6e884ad6fefbf AD 4nXfJJjuYnfNDdRq87E vQMLH0KruAgoqZxKh30IfnlgatmusWo1qQx QQzDp3uNdNAag dKwtneg1fYEOvr ac 8QRL5j1Do aX5rejyNSeYhrfYmn0OA6XNOKkvKIec0idcaJr9vzblDwSBeCpJJFG2Gok"/>
</div>
</div>
<div class="paragraph">
<p>Decodable is built on  <a href="https://flink.apache.org/">Apache Flink</a>  and  <a href="https://debezium.io/">Debezium</a> , but the beauty of it being a fully managed platform is that you donâ€™t even need to know that.
<em>I mean, you can know that, because Iâ€™ve just told you.</em>
<em>And in fact, you can</em> <a href="https://docs.decodable.co/pipelines/create-pipelines-using-your-own-apache-flink-jobs.html">bring your own Flink jobs and run them directly on Decodable</a> <em>.</em> But Iâ€™m going off on a tangent hereâ€¦to do data movement and processing with Decodable, you use a web interface, CLI, or API to define connections, and thatâ€™s it.
You can add some processing with SQL along the way if you want to, and if you do itâ€™s again just web, CLI or API.
Not a jot of code to be written!</p>
</div>
<div class="paragraph">
<p>So letâ€™s get started.
In this scenario weâ€™ve got point of sale (PoS) data from multiple stores streaming into a Kafka topic.
It is at the basket level, telling us for a particular transaction who the customer was, which store it was at, and what the customer bought.
Weâ€™re going to stream this to Amazon S3 in Iceberg format so that we can then build some analyses against it to answer business questions such as the number of baskets processed during the day, and volume of items sold.</p>
</div>
<div class="sect1">
<h2 id="_step_1_set_up_a_connection_to_kafka">Step 1: Set up a connection to Kafka&nbsp;<a class="headline-hash" href="#_step_1_set_up_a_connection_to_kafka">ğŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Our Kafka broker has a topic called <code>supermarketBaskets</code> with data in each record that looks like this:</p>
</div>
<div class="paragraph">
<p><code>Key:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="json"><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;basketId&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;4728c75b-ed83-eff3-9ed9-3fb11eb83443&#34;</span><span style="color: #f8f8f2">
</span><span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Value:</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="json"><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;customerId&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;d540b741-d188-ecd6-601d-de1b1b509502&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;customerName&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;Ardath Jenkins&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;customerAddress&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;Suite 726 730 Jeffry Ranch, East Isrealview, AR 73579&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;storeId&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;e1196df6-bb39-ab63-1082-4deafadc57f2&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;storeName&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;Leuschke-Langworth&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;storeLocation&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;Haiside&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;products&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #f8f8f2;background-color: #49483e">[</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
            </span><span style="color: #f8f8f2;font-weight: bold">&#34;productName&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;Intelligent Plastic Wallet&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
            </span><span style="color: #f8f8f2;font-weight: bold">&#34;quantity&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">4</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
            </span><span style="color: #f8f8f2;font-weight: bold">&#34;unitPrice&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">13.13</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
            </span><span style="color: #f8f8f2;font-weight: bold">&#34;category&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;Beauty, Home &amp; Outdoors&#34;</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;background-color: #49483e">},</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;background-color: #49483e">{</span><span style="color: #f8f8f2">
            </span><span style="color: #f8f8f2;font-weight: bold">&#34;productName&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;Sleek Marble Shoes&#34;</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
            </span><span style="color: #f8f8f2;font-weight: bold">&#34;quantity&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">5</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
            </span><span style="color: #f8f8f2;font-weight: bold">&#34;unitPrice&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">3.61</span><span style="color: #f8f8f2;background-color: #49483e">,</span><span style="color: #f8f8f2">
            </span><span style="color: #f8f8f2;font-weight: bold">&#34;category&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;Clothing &amp; Games&#34;</span><span style="color: #f8f8f2">
        </span><span style="color: #f8f8f2;background-color: #49483e">}</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;background-color: #49483e">],</span><span style="color: #f8f8f2">
    </span><span style="color: #f8f8f2;font-weight: bold">&#34;timestamp&#34;</span><span style="color: #f8f8f2;background-color: #49483e">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&#34;2024-06-05T11:21:56.736+0000&#34;</span><span style="color: #f8f8f2">
</span><span style="color: #f8f8f2;background-color: #49483e">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <a href="https://docs.decodable.co/cli.html">Decodable CLI</a>  weâ€™ll create a <strong>source connection</strong> for ingesting the messages from the Kafka topic into Decodable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">decodable connection create                                <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--name</span> rmoff-kafka-basket                              <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--type</span> <span style="color: #f8f8f2">source</span>                                          <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--connector</span> kafka                                      <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> bootstrap.servers<span style="color: #f92672;font-weight: bold">=</span>my_broker:9092                <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> value.format<span style="color: #f92672;font-weight: bold">=</span>json                               <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> key.fields<span style="color: #f92672;font-weight: bold">=</span>basketId                             <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> key.format<span style="color: #f92672;font-weight: bold">=</span>json                                 <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> parse-error-policy<span style="color: #f92672;font-weight: bold">=</span>FAIL                         <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> properties.auto.offset.reset<span style="color: #f92672;font-weight: bold">=</span>none               <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> scan.startup.mode<span style="color: #f92672;font-weight: bold">=</span>earliest-offset               <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">topic</span><span style="color: #f92672;font-weight: bold">=</span>supermarketBaskets                        <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> value.fields-include<span style="color: #f92672;font-weight: bold">=</span>EXCEPT_KEY                 <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">basketId</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                              <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">customerId</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                            <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">customerName</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                          <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">customerAddress</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                       <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">storeId</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                               <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">storeName</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                             <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">storeLocation</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                         <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">products</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;ARRAY&#34;</span>  <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">timestamp</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>From this we get the id of the connection thatâ€™s been created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">Created connection rmoff-kafka-basket <span style="color: #f92672;font-weight: bold">(</span>97f8ace4<span style="color: #f92672;font-weight: bold">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the connection defined we can now start it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">decodable connection activate 97f8ace4</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point letâ€™s hop over to the Decodable web UI and look at the data being brought in.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/06/6717dc2082a396e17c579707_666b818263d50583545649ac_AD_4nXcRcPhoe_wru5chUWqEcbT7vNzp9fI6Yp5Ncj5ZIfiVgT_fNa4hs0zQEZ7qfK4ubfiL_RCaP_pvzEp0x5hiaFSKvtSMD1dqiadh8L96ciQ8V9GmSlPhomSLhO2wf4kXZzLPJ-EKz52m_-urlrL_NyY7FcjQ.webp" alt="CleanShot 2024-06-06 at 12.35.03@2x.png"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_2_set_up_a_connection_to_iceberg">Step 2: Set up a connection to Iceberg&nbsp;<a class="headline-hash" href="#_step_2_set_up_a_connection_to_iceberg">ğŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Iâ€™ve already created an S3 bucket, Glue catalog, and done the necessary IAM configuration.
Now I just need to tell Decodable to send the data that weâ€™re ingesting from Kafka over to Iceberg by creating a sink connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>decodable connection create                                                      <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--name</span> rmoff-basket-iceberg                                                    <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--type</span> sink                                                                    <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--connector</span> iceberg                                                            <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> catalog-database<span style="color: #f92672;font-weight: bold">=</span>rmoff                                                  <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> catalog-table<span style="color: #f92672;font-weight: bold">=</span>rmoff_basket                                              <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> catalog-type<span style="color: #f92672;font-weight: bold">=</span>glue                                                       <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">format</span><span style="color: #f92672;font-weight: bold">=</span>parquet                                                          <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">region</span><span style="color: #f92672;font-weight: bold">=</span>us-west-2                                                        <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> role-arn<span style="color: #f92672;font-weight: bold">=</span>arn:aws:iam::xxxxx:role/rmoff-decodable-s3                     <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--prop</span> <span style="color: #f8f8f2">warehouse</span><span style="color: #f92672;font-weight: bold">=</span>s3://rmoff/iceberg-test/                                      <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--stream-id</span> <span style="color: #e6db74">$(</span>decodable query <span style="color: #f92672">--keep-ids</span> <span style="color: #f92672">--name</span>                                <span style="color: #ae81ff">\</span>
                  <span style="color: #e6db74">$(</span>decodable query <span style="color: #f92672">--name</span> rmoff-kafka-basket |                    <span style="color: #ae81ff">\</span>
                    yq <span style="color: #e6db74">&#39;.spec.stream_name&#39;</span><span style="color: #e6db74">)</span> |                                      <span style="color: #ae81ff">\</span>
                    yq <span style="color: #e6db74">&#39;.metadata.id&#39;</span><span style="color: #e6db74">)</span>                                             <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">basketId</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                                                      <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">customerId</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                                                    <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">customerName</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                                                  <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">customerAddress</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                                               <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">storeId</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                                                       <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">storeName</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                                                     <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">storeLocation</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span>                                                 <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">products</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;ARRAY&#34;</span>  <span style="color: #ae81ff">\</span>
    <span style="color: #f92672">--field</span> <span style="color: #f8f8f2">timestamp</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #e6db74">&#34;STRING&#34;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One thing to point out here is that the stream id is dynamically derived.
You can also hard code it based on the id shown in the web UI (as shown above when previewing the data).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">Created connection rmoff-basket-iceberg <span style="color: #f92672;font-weight: bold">(</span>003247ff<span style="color: #f92672;font-weight: bold">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As before, once created, we need to start the connection.
Because we want to send all of the data that weâ€™ve read (and are reading) from Kafka to Iceberg, weâ€™ll use <code>--start-position earliest</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell">decodable connection activate 003247ff <span style="color: #f92672">--start-position</span> earliest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Over in the Decodable web UI we can see that the connection is running, and metrics about the records processed<br/></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/06/6717dc2082a396e17c579704_666b81824d25e28f748a297b_AD_4nXdg0_qEpm8T8MADsPFfTr-nBlHjA8yDqzU-5JiTFs-YU8KLxDlWrd869ctoHhOtjhcJI9F98YjvoeKFbbU5s-T5hvkI51r4gxqpexORIzQY9ZTDUng8_TmL7q9CBQA40joM4-MKNitssomsM4UhxHCePWs.webp" alt="CleanShot 2024-06-06 at 13.35.04.png"/>
</div>
</div>
<div class="paragraph">
<p>Letâ€™s check that the data is indeed being written:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="shell"><span style="color: #f8f8f2">$ </span>aws s3 <span style="color: #f8f8f2">ls </span>s3://rmoff/iceberg-test/rmoff.db/rmoff_basket02/
                           PRE data/
                           PRE metadata/
<span style="color: #f8f8f2">$ </span>aws s3 <span style="color: #f8f8f2">ls </span>s3://rmoff/iceberg-test/rmoff.db/rmoff_basket02/data/
2024-06-05 18:07:22      30440 00000-0-dd5fc5f4-9821-448a-8bf6-b3b0a4e3d267-00001.parquet
<span style="color: #f92672;font-weight: bold">[</span>â€¦]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_the_iceberg_data">Using the Iceberg data&nbsp;<a class="headline-hash" href="#_using_the_iceberg_data">ğŸ”—</a> </h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_duckdb">DuckDB&nbsp;<a class="headline-hash" href="#_duckdb">ğŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>The wonderful thing about open formats is the proliferation of support from multiple technologies that they often prompt.
Iceberg has swept through the data ecosystem, with support from distributed compute such as Flink and Spark, and query engines including Presto, and DuckDB.</p>
</div>
<div class="paragraph">
<p>Using  <a href="https://duckdb.org/">DuckDB</a>  we can quickly do a row count check to make sure weâ€™re seeing what weâ€™d expect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #66d9ef;font-weight: bold">COUNT</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f92672;font-weight: bold">*</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">iceberg_scan</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;s3://dw/iceberg-test/rmoff.db/rmoff_basket02/metadata/00640-ed419044-046c-44c0-a20a-e51f0cce381f.metadata.json&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">skip_schema_inference</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #66d9ef;font-weight: bold">True</span><span style="color: #f8f8f2;background-color: #49483e">);</span>
<span style="color: #960050;background-color: #1e0010">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">count_star</span><span style="color: #f8f8f2;background-color: #49483e">()</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #f92672;font-weight: bold">|</span>    <span style="color: #f8f8f2;background-color: #49483e">int64</span>     <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #960050;background-color: #1e0010">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span style="color: #f92672;font-weight: bold">|</span>        <span style="color: #ae81ff">20100</span> <span style="color: #f92672;font-weight: bold">|</span>
<span style="color: #960050;background-color: #1e0010">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
<span style="color: #f8f8f2;background-color: #49483e">Run</span> <span style="color: #f8f8f2">Time</span> <span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">s</span><span style="color: #f8f8f2;background-color: #49483e">):</span> <span style="color: #f8f8f2">real</span> <span style="color: #ae81ff">19</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">045</span> <span style="color: #66d9ef;font-weight: bold">user</span> <span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">377048</span> <span style="color: #f8f8f2;background-color: #49483e">sys</span> <span style="color: #ae81ff">9</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #ae81ff">469687</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also sample the data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span> <span style="color: #f92672;font-weight: bold">*</span>
<span style="color: #66d9ef;font-weight: bold">FROM</span> <span style="color: #f8f8f2;background-color: #49483e">iceberg_scan</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #e6db74">&#39;s3://dw/iceberg-test/rmoff.db/rmoff_basket02/metadata/00640-ed419044-046c-44c0-a20a-e51f0cce381f.metadata.json&#39;</span><span style="color: #f8f8f2;background-color: #49483e">,</span> <span style="color: #f8f8f2;background-color: #49483e">skip_schema_inference</span><span style="color: #f92672;font-weight: bold">=</span><span style="color: #66d9ef;font-weight: bold">True</span><span style="color: #f8f8f2;background-color: #49483e">)</span>
<span style="color: #66d9ef;font-weight: bold">LIMIT</span> <span style="color: #ae81ff">1</span><span style="color: #f8f8f2;background-color: #49483e">;</span>

<span style="color: #960050;background-color: #1e0010">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span style="color: #f92672;font-weight: bold">|</span>       <span style="color: #f8f8f2;background-color: #49483e">basketId</span>       <span style="color: #f92672;font-weight: bold">|</span>      <span style="color: #f8f8f2;background-color: #49483e">customerId</span>      <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">customerName</span> <span style="color: #f92672;font-weight: bold">|</span>   <span style="color: #f8f8f2;background-color: #49483e">customerAddress</span>    <span style="color: #f92672;font-weight: bold">|</span>       <span style="color: #f8f8f2;background-color: #49483e">storeId</span>
<span style="color: #f92672;font-weight: bold">|</span>       <span style="color: #f8f8f2">varchar</span>        <span style="color: #f92672;font-weight: bold">|</span>       <span style="color: #f8f8f2">varchar</span>        <span style="color: #f92672;font-weight: bold">|</span>   <span style="color: #f8f8f2">varchar</span>    <span style="color: #f92672;font-weight: bold">|</span>       <span style="color: #f8f8f2">varchar</span>        <span style="color: #f92672;font-weight: bold">|</span>       <span style="color: #f8f8f2">varchar</span>
<span style="color: #960050;background-color: #1e0010">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">4629</span><span style="color: #f8f8f2;background-color: #49483e">c66e</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">7</span><span style="color: #f8f8f2;background-color: #49483e">b28</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2;background-color: #49483e">d3f</span><span style="color: #960050;background-color: #1e0010">â€¦</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">e65ac50</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">c12</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">cbd</span><span style="color: #960050;background-color: #1e0010">â€¦</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Sarita</span> <span style="color: #f8f8f2;background-color: #49483e">Hane</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #f8f8f2;background-color: #49483e">Suite</span> <span style="color: #ae81ff">069</span> <span style="color: #ae81ff">65438</span> <span style="color: #f8f8f2;background-color: #49483e">Wa</span><span style="color: #960050;background-color: #1e0010">â€¦</span>  <span style="color: #f92672;font-weight: bold">|</span> <span style="color: #ae81ff">4238</span><span style="color: #f8f8f2;background-color: #49483e">f9ef</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #ae81ff">0</span><span style="color: #f8f8f2;background-color: #49483e">c08</span><span style="color: #f92672;font-weight: bold">-</span><span style="color: #f8f8f2;background-color: #49483e">a4c3</span><span style="color: #960050;background-color: #1e0010">â€¦</span>
<span style="color: #960050;background-color: #1e0010">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_amazon_athena_and_quicksight">Amazon Athena and Quicksight&nbsp;<a class="headline-hash" href="#_amazon_athena_and_quicksight">ğŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are a variety of tools available for working with Iceberg data to build queries.
With the data in S3 and wanting a web UI (rather than CLI like DuckDB above) I reached for the obvious toolâ€” <a href="https://aws.amazon.com/athena/">Amazon Athena</a>  (which is built on PrestoDB).</p>
</div>
<div class="paragraph">
<p>Since Iâ€™m using the Glue catalog itâ€™s easy to find the table that Iâ€™ve loaded:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/06/6717dc2082a396e17c5796f2_666b818277a3b30c979cd9e2_AD_4nXffoy4JsnedDt5ppfmA2iKS2FUA-UaW5QyHNsY4xBMsZRbUEckpfuomLTm4gqVPeyIFmea6Dx79DxQiFfT884VjWIG7ElcJG5Tr1aak4rmLnm-5XhAobIif1PY7xmQnbBNPqk1VVZuDsOA_-1E4vFSdIu2e.webp" alt="CleanShot 2024-06-05 at 19.02.08.png"/>
</div>
</div>
<div class="paragraph">
<p>From here I can write a SQL query in Athena to look at the data and expand out the nested <code>products</code> field using <code>CROSS JOIN</code>:<br/></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/06/6717dc2082a396e17c57970a_666b8182c9b3461caad0bc80_AD_4nXf2rRvggwznql2ZVcsZcWleBye5yQQB3XhLpUv5K5NoKFRV5ezSCv81ivUoERzc7EioWkJjwimWmmqkuhAdL0GPHkmiqiabfKhlr-VVSvezrKqADEpYjDUYlz2TqRU0AgA7rgEsHjQH4J322sHs7Un1zBlp.webp" alt="CleanShot 2024-06-05 at 19.01.45.png"/>
</div>
</div>
<div class="paragraph">
<p>Using this query, I then put together a simple dashboard in  <a href="https://aws.amazon.com/quicksight/">Amazon Quicksight</a>  (again; easiest tool to hand since I had the AWS console already openâ€¦).
This uses a slightly modified version of the SQL shown above to split out the date and time components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="color: #f8f8f2;background-color: #49483e"><code data-lang="sql"><span style="color: #66d9ef;font-weight: bold">SELECT</span>
  <span style="color: #f8f8f2;background-color: #49483e">basketid</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #f8f8f2;background-color: #49483e">customername</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #f8f8f2;background-color: #49483e">storename</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #f8f8f2">&#34;timestamp&#34;</span>  <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">basket_ts</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #66d9ef;font-weight: bold">cast</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">from_iso8601_timestamp</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2">&#34;timestamp&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2">date</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">basket_date</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #66d9ef;font-weight: bold">cast</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">from_iso8601_timestamp</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2">&#34;timestamp&#34;</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2">time</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">as</span> <span style="color: #f8f8f2;background-color: #49483e">basket_time</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">productName</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">quantity</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">unitPrice</span><span style="color: #f8f8f2;background-color: #49483e">,</span>
  <span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2;background-color: #49483e">category</span>
<span style="color: #66d9ef;font-weight: bold">FROM</span>
  <span style="color: #f8f8f2">&#34;rmoff&#34;</span><span style="color: #f8f8f2;background-color: #49483e">.</span><span style="color: #f8f8f2">&#34;rmoff_basket02&#34;</span>
<span style="color: #66d9ef;font-weight: bold">CROSS</span> <span style="color: #66d9ef;font-weight: bold">JOIN</span>
  <span style="color: #66d9ef;font-weight: bold">UNNEST</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">products</span><span style="color: #f8f8f2;background-color: #49483e">)</span> <span style="color: #66d9ef;font-weight: bold">AS</span> <span style="color: #f8f8f2;background-color: #49483e">t</span><span style="color: #f8f8f2;background-color: #49483e">(</span><span style="color: #f8f8f2;background-color: #49483e">p</span><span style="color: #f8f8f2;background-color: #49483e">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this, I can plot the number of baskets (transactions) and products sold over time at different granularities, as well as a breakdown of unit sales by category.</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/06/6717dc2082a396e17c57970d_666b818297bd5839934c8d8d_AD_4nXdBCNibph6MEM1FAcqCyxqqhg0GdeSHon4EcYerSo7JFf8YuUpTrm1cBOa9qEQXxORnZiKO63msMAtaLpZubFQk20Jomnhu_7eDPkZKfo3HWgtAFJIWdXTdl24RomsLgpnAVQ_RC10TeNiO2sDhfdNjaoma.webp" alt="CleanShot 2024-06-05 at 19.39.19.png"/>
</div>
</div>
<div class="paragraph">
<p>The brilliant thing here is that this is not a batch process, in which I need to rerun a job to see the latest data.
As new sales are made in the stores, the data will flow into a Kafka topic and through to Iceberg, ready to query and drive my dashboard.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/2024/06/6717dc2082a396e17c5796f5_666b8182c3f6e884ad6fefbf_AD_4nXfJJjuYnfNDdRq87E-vQMLH0KruAgoqZxKh30IfnlgatmusWo1qQx-QQzDp3uNdNAag-dKwtneg1fYEOvr_ac_8QRL5j1Do_aX5rejyNSeYhrfYmn0OA6XNOKkvKIec0idcaJr9vzblDwSBeCpJJFG2Gok.webp" alt="6717dc2082a396e17c5796f5 666b8182c3f6e884ad6fefbf AD 4nXfJJjuYnfNDdRq87E vQMLH0KruAgoqZxKh30IfnlgatmusWo1qQx QQzDp3uNdNAag dKwtneg1fYEOvr ac 8QRL5j1Do aX5rejyNSeYhrfYmn0OA6XNOKkvKIec0idcaJr9vzblDwSBeCpJJFG2Gok"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_learn_more">Learn more&nbsp;<a class="headline-hash" href="#_learn_more">ğŸ”—</a> </h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ready to dive deeper into Flink and looking to avoid some of the more common technical pitfalls?
Check out the <a href="https://www.decodable.co/resource/top-5-mistakes-when-deploying-apache-flink">Top 5 Mistakes When Deploying Apache Flink</a> .</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resources">Resources&nbsp;<a class="headline-hash" href="#_resources">ğŸ”—</a> </h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://app.decodable.co/-/accounts/create">Sign up to Decodable</a>  and try the Iceberg sink for free todayâ€”no credit card required.</p>
</li>
<li>
<p><a href="https://docs.decodable.co/connect/source/kafka.html">Apache Kafka source connector</a></p>
</li>
<li>
<p><a href="https://docs.decodable.co/connect/sink/iceberg.html">Apache Iceberg sink connector</a></p>
</li>
<li>
<p><a href="https://github.com/decodableco/examples/tree/main/kafka-iceberg/decodable">Code used to generate this example</a></p>
</li>
</ul>
</div>
</div>
</div>
	<hr>
	<div class="giscus-container">
		<script src="https://giscus.app/client.js"
				data-repo="rmoff/rmoff-blog"
				data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE3NDg2MTE="
				data-category="Announcements"
				data-category-id="DIC_kwDOCQuAA84CvP5T"
				data-mapping="pathname"
				data-strict="1"
				data-reactions-enabled="1"
				data-emit-metadata="0"
				data-input-position="bottom"
				data-theme="light"
				data-lang="en"
				crossorigin="anonymous"
				async>
		</script>
	</div>
</article>
      </main>
    
      
      <div class="docs-toc">
        <ul class="nav toc-top">
          <li><a href="#" id="back_to_top" class="docs-toc-title">On this page</a></li>
        </ul>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#_step_1_set_up_a_connection_to_kafka">Step 1: Set up a connection to Kafka</a></li>
    <li><a href="#_step_2_set_up_a_connection_to_iceberg">Step 2: Set up a connection to Iceberg</a></li>
    <li><a href="#_using_the_iceberg_data">Using the Iceberg data</a></li>
    <li><a href="#_duckdb">DuckDB</a></li>
    <li><a href="#_amazon_athena_and_quicksight">Amazon Athena and Quicksight</a></li>
    <li><a href="#_learn_more">Learn more</a></li>
    <li><a href="#_resources">Resources</a></li>
  </ul>
</nav>
      </div>
      
    
    </div>
  </div>
</div>


		</main>

		

		
		<footer class="site-footer hide-print" role="contentinfo">
			<span>&copy; 2026 </span>
		</footer>
		

		
	</body>
</html>
